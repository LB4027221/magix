KISSY.add("magix/body",function(j,i,g,d){var a=g.has,j=g.mix,h=g.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),l=document.body,k={},p={},n=65536,m=function(e,b,c){c?e.setAttribute(b,c):c=e.getAttribute(b);return c},d=j({processEvent:function(e){for(var b=e.target||e.srcElement;b&&1!=b.nodeType;)b=b.parentNode;var c=b,f=e.type,q=p[f]||(p[f]=RegExp("(?:^|,)"+f+"(?:,|$)"));if(!q.test(m(b,"mx-ie"))){for(var h="mx-"+f,k,d,o=[];c&&c!=l&&!(k=m(c,h),d=m(c,"mx-ie"),k||q.test(d));)o.push(c),
c=c.parentNode;if(k){f=m(c,"mx-owner");if(!f){q=c;for(d=this.VOM.all();q&&q!=l;)if(a(d,q.id)){m(c,"mx-owner",f=q.id);break}else q=q.parentNode}if(f)this.fire("event",{info:k,se:e,tId:b.id||(b.id="mx-e-"+n--),cId:c.id||(c.id="mx-e-"+n--),hld:f});else throw Error("miss mx-owner:"+k);}else for(;o.length;)e=o.shift(),d=m(e,"mx-ie"),q.test(d)||(d=d?d+","+f:f,m(e,"mx-ie",d))}},attachEvent:function(e){var b=this;if(k[e])k[e]++;else if(k[e]=1,h[e])b.onUnbubble(l,e);else l["on"+e]=function(c){(c=c||window.event)&&
b.processEvent(c)}},detachEvent:function(e){var b=k[e];0<b&&(b--,b||(h[e]?this.offUnbubble(l,e):l["on"+e]=null),k[e]=b)}},d);return g.mix(d,i)},{requires:["magix/impl/body","magix/magix","magix/event"]});
KISSY.add("magix/event",function(j,i){var g=i.safeExec;return{fire:function(d,a,h,l){var k="~"+d,i=this[k];if(i){a||(a={});if(!a.type)a.type=d;for(var d=i.length,j=d-1,m,e;d--;)m=l?d:j-d,e=i[m],e.d&&(i.splice(m,1),j--),g(e,a,this)}h&&delete this[k]},on:function(d,a,h){d="~"+d;this[d]||(this[d]=[]);i.isNumeric(h)?this[d].splice(h,0,a):(a.d=h,this[d].push(a))},un:function(d,a){i.isArray(d)||(d=[d]);for(var h=0,l=d.length;h<l;h++){var k="~"+d[h],g=this[k];if(g)if(a)for(var k=0,j=g.length;k<j;k++){if(g[k]==
a){g.splice(k,1);break}}else delete this[k]}}}},{requires:["magix/magix"]});KISSY.add("magix/impl/body",function(j,i){var g={};return{onUnbubble:function(d,a){var h=this;i.delegate(d,a,"*[mx-"+a+"]",g[a]=function(a){h.processEvent(a)})},offUnbubble:function(d,a){i.undelegate(d,a,"*[mx-"+a+"]",g[a]);delete g[a]}}},{requires:["event"]});
KISSY.add("magix/impl/magix",function(j,i){i=[].slice;return{libRequire:function(g,d){if(g){var a=this.isFunction(d),h=this.isArray(g);j.use(h?g.join(","):g,a?function(a){d.apply(a,i.call(arguments,1))}:this.noop)}else d()},libEnv:function(g){var d=g.appHome,a=location,h=a.protocol,l=g.appName;~d.indexOf(h)||(d=this.path(a.href,d));j.endsWith(d,"/")||(d+="/");g.appHome=d;var k=g.debug;k&&(k=0==d.indexOf(h+"//"+a.host));"~"==l.charAt(0)&&j.config({map:[[RegExp("/"+l+"/"),"/"]]});a="";(a=k?j.now():
g.appTag)&&(a+=".js");h=g.appCombine;j.isUndefined(h)&&(h=j.config("combine"));j.config({packages:[{name:l,path:d,debug:g.debug=k,combine:h,tag:a}]})},isArray:j.isArray,isFunction:j.isFunction,isObject:j.isObject,isRegExp:j.isRegExp,isString:j.isString,isNumber:j.isNumber}});
KISSY.add("magix/impl/router",function(j,i){var g=window;return{useState:function(){var d=this,a=location.href;i.on(g,"popstate",function(){var h=location.href==a;if(d.$firedPop||!h)d.$firedPop=!0,d.route()})},useHash:function(){var d=this;i.on(g,"hashchange",function(){d.route()})}}},{requires:["event"]});
KISSY.add("magix/impl/view",function(j,i,g){var d=function(){},a=j.Env.mods,h={wrapAsyn:1,extend:1},l=function(a,d,h){for(var i in d)j.isObject(d[i])?(g.has(a,i)||(a[i]={}),l(a[i],d[i],!0)):h&&(a[i]=d[i])};d.extend=function(a,h){var l=function(){l.superclass.constructor.apply(this,arguments);h&&g.safeExec(h,arguments,this)};l.extend=d.extend;return j.extend(l,this,a)};d.prepare=function(d,i){if(!d.wrapAsyn){for(var j in this)g.has(h,j)&&(d[j]=this[j]);j=d.prototype;for(var m=d;m.superclass;)m=m.superclass.constructor,
l(j,m.prototype);i.home=a[i.path].packageInfo.getBase();g.mix(j,i)}d.wrapAsyn()};g.mix(d.prototype,{fetchTmpl:function(a,d,h){var m=l[a];m?m.push(d):(m=l[a]=[d],i({url:a+(h?"?_="+j.now():""),success:function(e){g.safeExec(m,e);delete l[a]},error:function(a,b){d(b)}}))}});return d},{requires:["ajax","magix/magix"]});
KISSY.add("magix/magix",function(j,i){var g=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,d=/[^\/]*$/,a=/[#?].*$/,h=/([^=&?\/#]+)=([^&=#?]*)/g,l=/^https?:\/\//i,k={},p=0,n={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},m=k.hasOwnProperty,e=function(b){return function(a,c,e){switch(arguments.length){case 0:e=b;break;case 1:e=t.isObject(a)?q(b,a):f(b,a)?b[a]:null;break;case 2:null===c?(delete b[a],e=c):b[a]=e=c}return e}},b=function(b){this.c=[];this.x=
b||20;this.b=this.x+5},c=function(a){return new b(a)},f=function(b,a){return b?m.call(b,a):0},q=function(b,a,c){for(var e in a)if(!c||!f(c,e))b[e]=a[e];return b};q(b.prototype,{get:function(b){var a=this.c,c,b="pathname"+b;if(f(a,b)&&(c=a[b],1<=c.f))c.f++,c.t=p++,c=c.v;return c},set:function(b,a){var c=this.c,b="pathname"+b,e=c[b];if(!f(c,b)){if(c.length>=this.b){c.sort(function(b,c){return c.f==b.f?c.t-b.t:c.f-b.f});for(var d=this.b-this.x;d--;)e=c.pop(),delete c[e.k]}e={};c.push(e);c[b]=e}e.k=b;
e.v=a;e.f=1;e.t=p++;return e},del:function(b){var b="pathname"+b,c=this.c,a=c[b];if(a)a.f=-1E5,delete c[b]},has:function(b){return f(this.c,"pathname"+b)}});var u=c(60),z=c(),v=function(b,c,a,e,d,f){t.isArray(b)||(b=[b]);if(!c||!t.isArray(c)&&!c.callee)c=[c];for(e=0;e<b.length;e++)try{f=b[e],d=t.isFunction(f)&&f.apply(a,c)}catch(o){}return d},o=function(){},t={isNumeric:function(b){return!isNaN(parseFloat(b))&&isFinite(b)},mix:q,has:f,safeExec:v,noop:o,config:e(n),start:function(b){var c=this,b=q(n,
b);c.libEnv(b);var a=b.iniFile.replace("~",b.appName);c.libRequire(a,function(a){n=q(b,a,b);var e=b.progress;c.libRequire(["magix/router","magix/vom"],function(a,f){a.on("changed",function(b){b.loc?f.locationUpdated(b.loc):b.changed.isView()?f.remountRoot(b):f.locationChanged(b)});f.on("progress",e||o);c.libRequire(b.extensions,function(){a.start()})})});b.ready&&(v(b.ready),delete b.ready)},keys:Object.keys||function(b){var c=[],a;for(a in b)f(b,a)&&c.push(a);return c},local:e({}),path:function(b,
c){var e=b+"\n"+c,f=z.get(e);if(!f){b=b.replace(a,"").replace(d,"");"/"==c.charAt(0)?(f=b.indexOf("://"),-1==f?f=c:(f=b.indexOf("/",f+3),f=-1==f?b+c:b.substring(0,f)+c)):f=b+c;for(;g.test(f);)f=f.replace(g,"$1/");z.set(e,f)}return f},pathToObject:function(b,c){var e=u.get(b);if(!e){var e={},f={},d="";a.test(b)?d=b.replace(a,""):~b.indexOf("=")||(d=b);if(d&&l.test(d))var o=d.indexOf("/",8),d=-1==o?"/":d.substring(o);b.replace(h,function(b,a,e){if(c)try{e=decodeURIComponent(e)}catch(d){}f[a]=e});e.pathname=
d;e.params=f;u.set(b,e)}return e},objectToPath:function(b,c){var a=b.pathname,e=[],f=b.params,d,o;for(o in f)d=f[o],c&&encodeURIComponent(d),e.push(o+"="+d);return a+(a&&e.length?"?":"")+e.join("&")},tmpl:function(b,c){return 1==arguments.length?{v:k[b],h:f(k,b)}:k[b]=c},listToMap:function(b,c){var a,e,f={},d;this.isString(b)&&(b=b.split(","));if(b&&(d=b.length))for(a=0;a<d;a++)e=b[a],f[c?e[c]:e]=c?e:1;return f},createCache:c};return t.mix(t,i)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(j,i,g,d){var a=window,h=g.has,l=g.mix,k=document,p=/^UTF-8$/i.test(k.charset||k.characterSet||"UTF-8"),n=g.config(),m=g.createCache(),e=g.createCache(),b,c,f,q=65536,u=/#.*$/,z=/^[^#]*#?!?/,v=n.nativeHistory,o,t,B=function(b,c,a){if(b){a=this.params;g.isArray(b)||(b=b.split(","));for(var e=0;e<b.length&&!(c=h(a,b[e]));e++);}return c},C=function(){return h(this,"pathname")},D=function(){return h(this,"view")},s=function(){return this.hash.pathname!=this.query.pathname},
x=function(b){return this.hash.params[b]!=this.query.params[b]},w=function(b){return h(this.hash.params,b)},E=function(b){return h(this.query.params,b)},A=function(b){return this.params[b]},j=l({getView:function(b){if(!f){f={routes:n.routes||{},e404:n.notFoundView};var c=n.defaultView;if(!c)throw Error("unset defaultView");f.home=c;var a=n.defaultPathname||"";f.routes[a]=c;f.pathname=a}b||(b=f.pathname);c=f.routes;c=g.isFunction(c)?c.call(n,b):c[b];return{view:c?c:f.e404||f.home,pathname:c?b:f.e404?
b:f.pathname}},start:function(){var b=a.history;o=v&&b.pushState;t=v&&!o;o?this.useState():this.useHash();this.route()},parsePath:function(b){var b=g.pathToObject(b,p),c=b.pathname;c&&"/"!=c.charAt(0)&&t&&(b.pathname=g.path(a.location.pathname,c));return b},parseQH:function(b){var b=b||a.location.href,c=m.get(b);if(!c){var c=b.replace(u,""),e=b.replace(z,""),f=this.parsePath(c),d=this.parsePath(e),o={};l(o,f.params);l(o,d.params);c={pathnameDiff:s,paramDiff:x,hashOwn:w,queryOwn:E,get:A,href:b,srcQuery:c,
srcHash:e,query:f,hash:d,params:o};m.set(b,c)}return c},parseLoc:function(b){b=this.parseQH(b);if(!b.view){var c=this.getView(v?b.hash.pathname||b.query.pathname:b.hash.pathname);l(b,c)}return b},getChged:function(b,c){var a=c.href,f=b.href+"\n"+a,d=e.get(f);d||(f=a+"\n"+f,d=e.get(f));if(!d){var o,d={params:{}};if(b.pathname!=c.pathname)o=d.pathname=1;if(b.view!=c.view)o=d.view=1;var a=b.params,q=c.params,h;for(h in a)a[h]!=q[h]&&(o=1,d.params[h]=1);for(h in q)a[h]!=q[h]&&(o=1,d.params[h]=1);d.occur=
o;d.isParam=B;d.isPathname=C;d.isView=D;e.set(f,d)}return d},route:function(){var a=this.parseLoc(),e=c||{params:{},href:"~"},f=!c;c=a;e=this.getChged(e,a);e.occur&&(b=a,this.fire("changed",{location:a,changed:e,firstFire:f}))},navigate2:function(c){if(c&&g.isString(c)){var a=this.parsePath(c),c={};c.params=l({},a.params);c.pathname=a.pathname;if(c.pathname){if(t&&(a=b.query)&&(a=a.params))for(var e in a)h(a,e)&&!h(c.params,e)&&(c.params[e]="")}else e=l({},b.params),c.params=l(e,c.params),c.pathname=
b.pathname;e=g.objectToPath(c);if(o?e!=b.srcQuery:e!=b.srcHash)o?(this.$firedPop=1,history.pushState(q--,k.title,e),this.route()):(l(c,b,c),c.srcHash=e,c.hash={params:c.params,pathname:c.pathname},this.fire("changed",{loc:b=c}),location.hash="#!"+e)}},navigate:function(b,c){!c&&g.isObject(b)&&(c=b,b="");c&&(b=g.objectToPath({params:c,pathname:b},p));this.navigate2(b)}},d);return g.mix(j,i)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(j,i,g,d){var a=document,h=65536,l=window.CollectGarbage||i.noop,k=i.mix,j=i.config(),p=j.tagName,n=j.rootId,m=i.has,e,b=function(b){return"object"==typeof b?b:a.getElementById(b)};a.createElement(p);var c=/<script[^>]*>[\s\S]*?<\/script>/ig,f=function(b){this.id=b;this.vId=b+"_v";this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};k(f,{root:function(c){if(!e){var d=b(n);if(!d)d=a.createElement(p),d.id=n,a.body.insertBefore(d,a.body.firstChild);e=new f(n);
c.add(e)}return e}});k(k(f.prototype,g),{useAnimUpdate:i.noop,oldViewDestroy:i.noop,prepareNextView:i.noop,newViewCreated:i.noop,mountView:function(a,e){var f=this,h=b(f.id);h._bak?h._chgd=1:(h._bak=1,h._tmpl=h.innerHTML.replace(c,""));var o=f.viewUsable&&f.useAnimUpdate();f.unmountView(o,1);if(a){var l=i.pathToObject(a),g=l.pathname,j=--f.sign;i.libRequire(g,function(c){if(j==f.sign){var a=f.owner;d.prepare(c,{$:b,path:g,vom:a});var q;o?(q=f.vId,f.prepareNextView()):q=f.id;var i=new c({owner:f,id:q,
vId:f.vId,vfId:f.id,location:a.getLocation()});f.view=i;i.on("interact",function(b){f.fire("viewInteract",{view:i});f.viewUsable=1;o&&f.newViewCreated(1);if(!b.tmpl){if(!o&&h._chgd)h.innerHTML=h._tmpl;f.mountZoneVframes(0,0,1)}i.on("rendered",function(){f.mountZoneVframes(0,0,1)});i.on("prerender",function(b){f.unmountZoneVframes(0,b.anim)})},0);e=e||{};i.load(k(e,l.params,e))}})}},unmountView:function(c,a){if(this.view){this.unmountZoneVframes(0,c);this.childrenAlter({});this.view.destroy();var e=
b(this.id);if(!c&&e._bak)e.innerHTML=e._tmpl;c&&a&&this.oldViewDestroy();delete this.view;delete this.viewUsable;this.fire("viewUnmounted");l()}this.un("viewInteract");this.sign--},mountVframe:function(b,c,a,e){var d=this.owner,h=d.get(b);if(!h)h=new f(b),h.pId=this.id,m(this.cM,b)||this.cC++,this.cM[b]=e,d.add(h);h.mountView(c,a);return h},mountZoneVframes:function(c,a,e){this.unmountZoneVframes(c);var c=c?c:b(this.vId)||b(this.id),c=b(c).getElementsByTagName(p),f=c.length,d={};if(f)for(var l=0,
g,i,k,j;l<f;l++){g=c[l];i=g.id||(g.id="magix_vf_"+h--);m(d,i)||(k=g.getAttribute("mx-view"),j=g.getAttribute("mx-defer"),(!j||k)&&this.mountVframe(i,k,a,e));g=b(g).getElementsByTagName(p);i=0;for(k=g.length;i<k;i++)d[g[i].id||(g[i].id="magix_vf_"+h--)]=1}this.cC==this.rC&&this.childrenCreated({})},unmountVframe:function(b,c){var b=b||this.id,a=this.owner,e=a.get(b);if(e){var f=e.fcc;e.unmountView(c);a.remove(b,f);if((a=a.get(e.pId))&&m(a.cM,b))delete a.cM[b],a.cC--}},unmountZoneVframes:function(c){if(c){for(var c=
b(c).getElementsByTagName(p),a={},e=this.cM,f=c.length-1,d;0<=f;f--)d=c[f].id,m(e,d)&&(a[d]=1);c=a}else c=this.cM;for(var h in c)this.unmountVframe(h)},childrenCreated:function(b){var c=this.view;if(c&&!this.fcc)this.fcc=1,delete this.fca,c.fire("created",b),this.fire("created",b);var a=this.owner;a.childCreated();c=this.id;if((a=a.get(this.pId))&&!m(a.rM,c))a.rM[c]=a.cM[c],a.rC++,a.rC==a.cC&&a.childrenCreated(b)},childrenAlter:function(b){delete this.fcc;if(!this.fca){var c=this.view,a=this.id;if(c)this.fca=
1,c.fire("alter",b),this.fire("alter",b);if((c=this.owner.get(this.pId))&&m(c.rM,a)){var e=c.rM[a];c.rC--;delete c.rM[a];e&&c.childrenAlter(b)}}},locationChanged:function(b,c){var a=this.view;if(a&&a.sign&&(a.location=b,a.rendered)){var e=a.olChanged(c),f={location:b,changed:c,prevent:function(){this.cs=[]},toChildren:function(b){b=b||[];i.isString(b)&&(b=b.split(","));this.cs=b}};e&&i.safeExec(a.locationChange,f,a);for(var a=f.cs||i.keys(this.cM),e=0,f=a.length,d=this.owner,h;e<f;e++)(h=d.get(a[e]))&&
h.locationChanged(b,c)}},locationUpdated:function(b){var c=this.view;if(c&&c.sign){c.location=b;var c=this.cM,a,e=this.owner,f;for(f in c)(a=e.get(f))&&a.locationUpdated(b)}}});return f},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(j,i,g,d,a){var h=g.safeExec,l=g.has,k=[],p=g.config(),n=/^~[^\/]*/,m=g.mix,e=g.listToMap("render,renderUI"),b=function(b){return function(){var c;this.sign&&(this.sign++,this.fire("rendercall"),c=b.apply(this,arguments));return c}},j=function(b){m(this,b);this.sign=1};m(j,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var c=this.prototype,a,f;for(f in c){a=c[f];var d=null;g.isFunction(a)&&a!=g.noop&&!a["~~"]&&l(e,f)&&(d=b(a),d["~~"]=a,c[f]=d)}}}});var c=j.prototype,
f=window.CollectGarbage||g.noop,q=/\smx-[^ohv][a-z]+\s*=/g,u={prevent:function(b){b=b||this.domEvent;b.preventDefault?b.preventDefault():b.returnValue=!1},stop:function(b){b=b||this.domEvent;b.stopPropagation?b.stopPropagation():b.cancelBubble=!0},halt:function(b){this.prevent(b);this.stop(b)}},z=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,v=/(\w+):([^,]+)/g;m(c,d);m(c,{render:g.noop,locationChange:g.noop,init:g.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var b=this,c=b.hasTmpl,a=arguments,
e=b.sign,f=function(){if(e==b.sign&&(b.delegateEvents(),b.fire("interact",{tmpl:c},1),h(b.init,a,b),h(b.render,k,b),!c&&!b.rendered))b.rendered=!0,b.fire("primed",null,1)};c&&!l(b,"template")?b.planTmpl(f):f()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var b=this.enableAnim;this.fire("refresh",0,1);this.fire("prerender",{anim:b});var c=this.owner;b&&(h(c.oldViewDestroy,k,c),h(c.prepareNextView,k,c),this.updateViewId())}},
endUpdateHTML:function(){if(this.sign){if(this.rendered&&this.enableAnim){var b=this.owner;h(b.newViewCreated,k,b)}this.rendered||this.fire("primed",null,1);this.rendered=!0;this.fire("rendered");f()}},wrapMxEvent:function(b){return b?(""+b).replace(q,' mx-owner="'+this.vfId+'"$&'):b},setViewHTML:function(b){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=this.wrapMxEvent(b);this.endUpdateHTML()},observeLocation:function(b){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var a=c.keys;
if(g.isObject(b))c.pn=b.pathname,b=b.keys;if(b)c.keys=a.concat(g.isString(b)?b.split(","):b)},olChanged:function(b){var c=this.$ol;if(c){var a=0;c.pn&&(a=b.isPathname());a||(a=b.isParam(c.keys));return a}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var b=this.vom.get(this.owner.pId),c=null;if(b&&b.viewUsable)c=b.view;return c},planTmpl:function(b){var c=this,a=g.tmpl(c.path);a.h?(c.template=a.v,b()):(a=c.home+
c.path.replace(n,"")+".html",c.fetchTmpl(a,function(a){c.template=g.tmpl(c.path,a);b()},p.debug))},processEvent:function(b){if(this.enableEvent&&this.sign){var c=b.se,a=b.info.match(z),e=a[1],f=a[2],a=a[3],d=this.events;if(d){var g=d[c.type];if(u[f])u[f](c);if(g&&g[e]){var i={};a&&a.replace(v,function(b,c,a){i[c]=a});h(g[e],m({view:this,currentId:b.cId,targetId:b.tId,domEvent:c,events:d,params:i},u),g)}}}},delegateEvents:function(b){var c=this.events,b=b?a.detachEvent:a.attachEvent,e;for(e in c)b.call(a,
e)}});g.mix(j,i,{prototype:!0});g.mix(j.prototype,i.prototype);return j},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]});
KISSY.add("magix/vom",function(j,i,g,d,a){var h=g.has,l=0,k=0,p=0,n=0,m={},e,b=g.mix({all:function(){return m},add:function(c){if(!h(m,c.id))l++,m[c.id]=c,c.owner=b,b.fire("add",{vframe:c})},get:function(b){return m[b]},remove:function(c,a){var e=m[c];e&&(l--,a&&k--,delete m[c],b.fire("remove",{vframe:e}))},childCreated:function(){if(!n){k++;var c=k/l;p<c&&(b.fire("progress",{percent:p=c}),1==c&&(n=1,b.un("progress")))}},root:function(){return i.root(b)},remountRoot:function(c){var a=b.root();e=c.location;
a.mountView(e.view)},locationChanged:function(c){e=c.location;b.root().locationChanged(e,c.changed)},locationUpdated:function(c){e=c;b.root().locationUpdated(c)},getLocation:function(){return e}},d);a.VOM=b;a.on("event",function(c){var a=b.get(c.hld);(a=a&&a.view)&&a.processEvent(c)});return b},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(j,i){var g=i.has,d=i.safeExec,a=function(a){i.isArray(a)||(a=[a]);for(var b=0,c;b<a.length;b++)c=a[b],delete c.cacheKey;return a},h=function(a){this.$modelClass=a;this.$modelsCache=i.createCache();this.$modelsCacheKeys={}},l=[].slice,k={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},p=function(a){var b={},c;for(c in a)k[c]||(b[c]=a[c]);return b},n=function(a,b){var c=l.call(arguments,2);return function(){return a.apply(b,c.concat(l.call(arguments)))}};
i.mix(h,{create:function(a){if(!a)throw Error("MManager.create modelClass ungiven");return new h(a)}});var m=function(a){this.$host=a;this.$task=!1};i.mix(m.prototype,{fetchModels:function(a,b,c){var f=this;if(f.$task)return f.next(function(f){f.fetchModels(a,b,error,c)}),f;f.$task=!0;var h=f.$host;if(!f.$reqModels)f.$reqModels={};var l=h.$modelsCache,k=h.$modelsCacheKeys,m=f.$reqModels;i.isArray(a)||(a=[a]);var o=a.length,p=0,B,C,D=Array(o),s=[],x={},w=[],E=j.isArray(b);E&&(s=Array(b.length));for(var A=
function(a,e,h,i){if(!f.$destroy){p++;delete m[h.id];var q=h._cacheKey;D[a]=h;if(e)C=!0,B=i||B,x[a]=i;else{q&&!l.has(q)&&l.set(q,h);var n=h.metaParams;h._doneAt=j.now();var r=h._context;r&&d(r.after,[h].concat(n),r)}if(2==c)(n=E?b[a]:b)&&(s[a]=d(n,[h,e?{msg:i}:null,C?x:null],f));else if(4==c){w[a]={m:h,e:e,s:i};for(a=w.i||0;n=w[a];a++)if(r=E?b[a]:b,s[a]=d(r,[n.m,n.e?{msg:n.s}:null,w.e?x:null,s],f),n.e)x[a]=n.s,w.e=1;w.i=a}q&&g(k,q)&&(a=k[q],delete k[q],d(a,[e,h,i],h));if(p>=o)x.msg=B,e=C?x:null,1==
c?(D.push(e),s[0]=d(b,D,f),s[1]=e):s.push(e),f.$ntId=setTimeout(function(){f.$task=!1;f.doNext(s)},30)}},y=0,r;y<a.length;y++)if(r=a[y]){var G;G=h.getModel(r);var F=G.cacheKey;F&&g(k,F)?k[F].push(n(A,f,y)):(r=G.entity,G.needUpdate?(m[r.id]=r,F&&(k[F]=[]),r.request({success:n(A,r,y,!1,r),error:n(A,r,y,!0,r)})):A(y,!1,r))}else throw Error("miss attrs:"+a);return f},fetchAll:function(a,b){return this.fetchModels(a,b,1)},saveAll:function(e,b){e=a(e);return this.fetchModels(e,b,1)},fetchOrder:function(a,
b){var c=l.call(arguments,1);return this.fetchModels(a,1<c.length?c:b,4)},saveOrder:function(e,b){var e=a(e),c=l.call(arguments,1);return this.fetchModels(e,1<c.length?c:b,4)},saveOne:function(e,b){var e=a(e),c=l.call(arguments,1);return this.reqModels(e,1<c.length?c:b,2)},fetchOne:function(a,b){var c=l.call(arguments,1);return this.fetchModels(a,1<c.length?c:b,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,b=this.$host.$modelsCacheKeys;if(a)for(var c in a){var f=a[c],h=f._cacheKey;
if(h&&g(b,h)){var i=b[h];delete b[h];d(i,[!0,f,"aborted"],f)}f.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$task||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){var b=this.$queue;b&&(b=b.shift())&&d(b,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});i.mix(h.prototype,{registerModels:function(a){i.isArray(a)||(a=[a]);for(var b=0,c;b<
a.length;b++){c=a[b];if(!c.name)throw Error("model must own a name attribute");this[c.name]=c}},registerMethods:function(a){var b=this,c;for(c in a)g(a,c)&&(b[c]=function(a){return function(){for(var c,e=arguments,h=[],g=0,l;g<e.length;g++)l=e[g],i.isFunction(l)?h.push(function(b){return function(){c||b.apply(b,arguments)}}(l)):h.push(l);var k=a.apply(b,h);return{abort:function(){k&&k.abort&&d(k.abort,["aborted"],k);c=!0}}}}(a[c]))},createModel:function(a){var b=this.getModelMeta(a),c=new this.$modelClass(p(b)),
f=a;f.before||(f=b);var h=a.metaParams||[];j.isFunction(f.before)&&d(f.before,[c].concat(h),f);f=a;f.after||(f=b);if(f.after)c._context=f;c._cacheKey=a.cacheKey||b.cacheKey;c._meta=b;c.set(p(a));c.setUrlParams(b.urlParams);c.setPostParams(b.postParams);c.setUrlParams(a.urlParams);c.setPostParams(a.postParams);c.metaParams=h;return c},getModelMeta:function(a){var b=this[a.name];if(!b)throw Error("Not found:"+a.name);return b},getModel:function(a){var b=this.getModelFromCache(a),c;b||(c=!0,b=this.createModel(a));
return{entity:b,cacheKey:b._cacheKey,needUpdate:c}},saveAll:function(a,b){return(new m(this)).saveAll(a,b)},fetchAll:function(a,b){return(new m(this)).fetchAll(a,b)},saveOrder:function(a,b){var c=new m(this);return c.saveOrder.apply(c,arguments)},fetchOrder:function(a,b){var c=new m(this);return c.fetchOrder.apply(c,arguments)},saveOne:function(a,b){var c=new m(this);return c.saveOne.apply(c,arguments)},fetchOne:function(a,b){var c=new m(this);return c.fetchOne.apply(c,arguments)},clearCacheByKey:function(a){var b=
this.$modelsCache;j.isString(a)&&b.del(a)},clearCacheByName:function(a){for(var b=this.$modelsCache.c,c=0;c<b.length;c++){var f=b[c];f.v&&f.v._meta.name==a&&delete b[f.k]}},getModelUrl:function(a){return this.$modelClass.prototype.url((j.isString(a)?this[a]:a).uri)},getModelFromCache:function(a){var b=this.$modelsCache,c=null,f;if(j.isString(a))f=a;else{var d=this.getModelMeta(a);f=a.cacheKey||d.cacheKey}if(f&&(c=b.get(f))){if(!d)d=c._meta;a=a.cacheTime||d.cacheTime||0;0<a&&j.now()-c._doneAt>a&&(this.clearCacheByKey(f),
c=null)}return c}});return h},{requires:["magix/magix"]});
KISSY.add("mxext/model",function(j,i){var g=function(a,d,l){for(var k in d)j.isObject(d[k])?(i.has(a,k)||(a[k]={}),g(a[k],d[k],!0)):l&&(a[k]=d[k])},d=function(a){a&&this.set(a);this.id=j.guid("m")};i.mix(d,{GET:"GET",POST:"POST",extend:function(a,d){var l=function(){l.superclass.constructor.apply(this,arguments);d&&i.safeExec(d,[],this)};i.mix(l,this,{prototype:!0});g(a,this.prototype);return j.extend(l,this,a)}});i.mix(d.prototype,{urlMap:{},sync:i.noop,parse:function(a){return a},getParamsObject:function(a){if(!a)a=
d.GET;return this["$"+a]||null},getUrlParamsObject:function(){return this.getParamsObject(d.GET)},getPostParamsObject:function(){return this.getParamsObject(d.POST)},getPostParams:function(){return this.getParams(d.POST)},getUrlParams:function(){return this.getParams(d.GET)},getParams:function(a){var a=a?a.toUpperCase():d.GET,a=this["$"+a],h=[],g;if(a)for(var i in a)if(g=a[i],j.isArray(g))for(var p=0;p<g.length;p++)h.push(i+"="+encodeURIComponent(g[p]));else h.push(i+"="+encodeURIComponent(g));return h.join("&")},
setUrlParamsIf:function(a,h){this.setParams(a,h,d.GET,!0)},setPostParamsIf:function(a,h){this.setParams(a,h,d.POST,!0)},setParams:function(a,h,g,i){g=g?g.toUpperCase():d.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[g]=!0;g="$"+g;this[g]||(this[g]={});if(j.isObject(a))for(var p in a){if(!i||!this[g][p])this[g][p]=a[p]}else if(a&&(!i||!this[g][a]))this[g][a]=h},setPostParams:function(a,h){this.setParams(a,h,d.POST)},setUrlParams:function(a,h){this.setParams(a,h,d.GET)},removeParamsObject:function(a){if(!a)a=
d.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(d.POST)},removeUrlParamsObject:function(){this.removeParamsObject(d.GET)},reset:function(){var a=this.$keysCache;if(a){for(var d in a)i.has(a,d)&&delete this["$"+d];delete this.$keysCache}a=this.$keys;d=this.$attrs;if(a){for(var g=0;g<a.length;g++)delete d[a[g]];delete this.$keys}},url:function(a){var a=a||this.get("uri"),d;if(a){d=a.split(":");var g=this.urlMap;if(g)for(var i=0,j=d.length;i<j&&!(g=g[d[i]],void 0===
g);i++)i==j-1&&(a=g)}else throw Error("model not set uri");return a},get:function(a){var d=this.$attrs;return d?d[a]:null},set:function(a,d,g){if(!this.$attrs)this.$attrs={};if(g&&!this.$keys)this.$keys=[];if(j.isObject(a))for(var i in a)g&&this.$keys.push(i),this.$attrs[i]=a[i];else a&&(g&&this.$keys.push(a),this.$attrs[a]=d)},load:function(a){this.request(a)},save:function(a){this.request(a)},request:function(a){a||(a={});var d=a.success,g=a.error,i=this;i.$abort=!1;a.success=function(a){if(!i.$abort){if(a){var g=
i.parse(a);g&&(j.isArray(g)&&(g={list:g}),i.set(g,null,!0))}d&&d.apply(this,arguments)}};a.error=function(){i.$abort||g&&g.apply(this,arguments)};i.$trans=i.sync(a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=j.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return d},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(j,i,g,d){var a=window,h="destroy,abort,stop,cancel,remove".split(","),l=0,k=i.safeExec,p=i.has,n={},m=function(b){if(!m.d)m.d=1,b.on("add",function(b){var b=b.vframe,a=n[b.id];if(a){for(var d=0;d<a.length;d++)e(b,a[d]);delete n[b.id]}}),b.on("remove",function(b){delete n[b.vframe.id]}),b.root().on("childrenCreated",function(){n={}})},e=function(b,a){var d=b.view;if(d&&b.viewUsable)k(d.receiveMessage,a,d);else{var e=function(d){b.un("viewInteract",e);k(d.view.receiveMessage,
a,d.view)};b.on("viewInteract",e)}};return g.extend({mxViewCtor:i.noop,navigate:function(b){d.navigate.apply(d,arguments)},manage:function(b,a){var d=!0;1==arguments.length&&(a=b,b="res_"+l++,d=!1);if(!this.$resCache)this.$resCache={};this.$resCache[b]={hasKey:d,res:a};return a},getManaged:function(b){var a=this.$resCache;return a&&p(a,b)?a[b].res:null},removeManaged:function(b){var a=null,d=this.$resCache;if(d)if(p(d,b))a=d[b].res,delete d[b];else for(var e in d)if(d[e].res===b){a=d[e].res;delete d[e];
break}return a},destroyManaged:function(b){var c=this.$resCache;if(c){for(var d in c){var e=c[d],g=e.res;if(i.isNumber(g))a.clearTimeout(g),a.clearInterval(g);else if(g)if(g.nodeType&&g.parentNode)j.one(g).remove();else for(var l=0;l<h.length;l++)i.isFunction(g[h[l]])&&k(g[h[l]],[],g);b&&!e.hasKey&&delete c[d]}b||delete this.$resCache}},receiveMessage:i.noop,postMessageTo:function(b,a){var d=this.vom;m(d);i.isArray(b)||(b=[b]);a||(a={});for(var g=0,h;g<b.length;g++){h=b[g];var j=d.get(h);j?e(j,a):
(n[h]||(n[h]=[]),n[h].push(a))}},destroyMRequest:function(){var a=this.$resCache;if(a)for(var c in a){var d=a[c].res;d&&d.fetchOne&&d.fetchAll&&(d.destroy(),delete a[c])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(j){var i=function(){};if(!j.console)j.console={log:i,info:i,error:i};var g,d={};if(!j.Magix)j.Magix={config:function(a){for(var g in a)d[g]=a[g]},start:function(a){g=a}},KISSY.use("magix/magix",function(a,h){j.Magix=h;h.config(d);g&&h.start(g)})})(this);