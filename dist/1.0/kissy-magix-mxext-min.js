KISSY.add("magix/body",function(m,h,i,g){var a=i.has,m=i.mix,b=i.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),e=document.body,q={},j={},r=65536,o=function(a,c,d){d?a.setAttribute(c,d):d=a.getAttribute(c);return d},g=m({processEvent:function(f){for(var c=f.target||f.srcElement;c&&1!=c.nodeType;)c=c.parentNode;var d=c,b=f.type,l=j[b]||(j[b]=RegExp("(?:^|,)"+b+"(?:,|$)"));if(!l.test(o(c,"mx-ie"))){for(var q="mx-"+b,t,g,p=[];d&&d!=e&&!(t=o(d,q),g=o(d,"mx-ie"),t||l.test(g));)p.push(d),
d=d.parentNode;if(t){b=o(d,"mx-owner");if(!b){l=d;for(g=this.VOM.all();l&&l!=e;)if(a(g,l.id)){o(d,"mx-owner",b=l.id);break}else l=l.parentNode}if(b)this.fire("event",{info:t,se:f,tId:c.id||(c.id="mx-e-"+r--),cId:d.id||(d.id="mx-e-"+r--),hld:b});else throw Error("miss mx-owner:"+t);}else for(;p.length;)f=p.shift(),g=o(f,"mx-ie"),l.test(g)||(g=g?g+","+b:b,o(f,"mx-ie",g))}},attachEvent:function(a){var c=this;if(q[a])q[a]++;else if(q[a]=1,b[a])c.onUnbubble(e,a);else e["on"+a]=function(a){(a=a||window.event)&&
c.processEvent(a)}},detachEvent:function(a){var c=q[a];0<c&&(c--,c||(b[a]?this.offUnbubble(e,a):e["on"+a]=null),q[a]=c)}},g);return i.mix(g,h)},{requires:["magix/impl/body","magix/magix","magix/event"]});
KISSY.add("magix/event",function(m,h){var i=h.safeExec;return{fire:function(g,a,b,e){var q="~"+g,j=this[q];if(j){a||(a={});if(!a.type)a.type=g;for(var g=j.length,h=g-1,o,f;g--;)o=e?g:h-g,f=j[o],f.d&&(j.splice(o,1),h--),i(f,a,this)}b&&delete this[q]},on:function(g,a,b){g="~"+g;this[g]||(this[g]=[]);h.isNumeric(b)?this[g].splice(b,0,a):(a.d=b,this[g].push(a))},un:function(g,a){h.isArray(g)||(g=[g]);for(var b=0,e=g.length;b<e;b++){var q="~"+g[b],j=this[q];if(j)if(a)for(var q=0,i=j.length;q<i;q++){if(j[q]==
a){j.splice(q,1);break}}else delete this[q]}}}},{requires:["magix/magix"]});KISSY.add("magix/impl/body",function(m,h){var i={};return{onUnbubble:function(g,a){var b=this;h.delegate(g,a,"*[mx-"+a+"]",i[a]=function(a){b.processEvent(a)})},offUnbubble:function(g,a){h.undelegate(g,a,"*[mx-"+a+"]",i[a]);delete i[a]}}},{requires:["event"]});
KISSY.add("magix/impl/magix",function(m,h){h=[].slice;return{libRequire:function(i,g){if(i){var a=this.isFunction(g),b=this.isArray(i);m.use(b?i.join(","):i,a?function(a){g.apply(a,h.call(arguments,1))}:this.noop)}else g()},libEnv:function(i){var g=i.appHome,a=location,b=a.protocol,e=i.appName;~g.indexOf(b)||(g=this.path(a.href,g));m.endsWith(g,"/")||(g+="/");i.appHome=g;var q=i.debug;q&&(q=0==g.indexOf(b+"//"+a.host));"~"==e.charAt(0)&&m.config({map:[[RegExp("/"+e+"/"),"/"]]});a="";(a=q?m.now():
i.appTag)&&(a+=".js");b=i.appCombine;m.isUndefined(b)&&(b=m.config("combine"));m.config({packages:[{name:e,path:g,debug:i.debug=q,combine:b,tag:a}]})},isArray:m.isArray,isFunction:m.isFunction,isObject:m.isObject,isRegExp:m.isRegExp,isString:m.isString,isNumber:m.isNumber}});
KISSY.add("magix/impl/router",function(m,h){var i=window;return{useState:function(){var g=this,a=location.href;h.on(i,"popstate",function(){var b=location.href==a;if(g.$firedPop||!b)g.$firedPop=!0,g.route()})},useHash:function(){var g=this;h.on(i,"hashchange",function(){g.route()})}}},{requires:["event"]});
KISSY.add("magix/impl/view",function(m,h,i){var g=function(){},a=m.Env.mods,b={wrapAsyn:1,extend:1},e=function(a,b,g){for(var h in b)m.isObject(b[h])?(i.has(a,h)||(a[h]={}),e(a[h],b[h],!0)):g&&(a[h]=b[h])};g.extend=function(a,b){var e=function(){e.superclass.constructor.apply(this,arguments);b&&i.safeExec(b,arguments,this)};e.extend=g.extend;return m.extend(e,this,a)};g.prepare=function(g,h){if(!g.wrapAsyn){for(var m in this)i.has(b,m)&&(g[m]=this[m]);m=g.prototype;for(var o=g;o.superclass;)o=o.superclass.constructor,
e(m,o.prototype);h.home=a[h.path].packageInfo.getBase();i.mix(m,h)}g.wrapAsyn()};i.mix(g.prototype,{fetchTmpl:function(a,b,e){h({url:a+(e?"?_="+m.now():""),success:b,error:function(a,f){b(f)}})}});return g},{requires:["ajax","magix/magix"]});
KISSY.add("magix/magix",function(m,h){var i=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,g=/[^\/]*$/,a=/[#?].*$/,b=/([^=&?\/#]+)=([^&=#?]*)/g,e=/^https?:\/\//i,q={},j=0,r={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},o=q.hasOwnProperty,f=function(a){return function(c,d,b){switch(arguments.length){case 0:b=a;break;case 1:b=s.isObject(c)?l(a,c):n(a,c)?a[c]:null;break;case 2:null===d?(delete a[c],b=d):a[c]=b=d}return b}},c=function(a){this.c=[];this.x=
a||20;this.b=this.x+5},d=function(a){return new c(a)},n=function(a,c){return a?o.call(a,c):0},l=function(a,c,d){for(var b in c)if(!0===d)a[b]=c[b];else if(n(c,b)&&(!d||!n(d,b)))a[b]=c[b];return a};l(c.prototype,{get:function(a){var c=this.c,d,a="pathname"+a;if(n(c,a)&&(d=c[a],1<=d.f))d.f++,d.t=j++,d=d.v;return d},set:function(a,c){var d=this.c,a="pathname"+a,b=d[a];if(!n(d,a)){if(d.length>=this.b){d.sort(function(a,c){return c.f==a.f?c.t-a.t:c.f-a.f});for(var f=this.b-this.x;f--;)b=d.pop(),delete d[b.k]}b=
{};d.push(b);d[a]=b}b.k=a;b.v=c;b.f=1;b.t=j++;return b},del:function(a){var a="pathname"+a,c=this.c,d=c[a];if(d)d.f=-1E5,delete c[a]},has:function(){k="pathname"+k;return n(this.c,k)}});var w=d(60),t=d(),x=function(a,c,d,b,f,l){s.isArray(a)||(a=[a]);if(!c||!s.isArray(c)&&!c.callee)c=[c];for(b=0;b<a.length;b++)try{l=a[b],f=s.isFunction(l)&&l.apply(d,c)}catch(p){}return f},p=function(){},s={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:l,has:n,safeExec:x,noop:p,config:f(r),start:function(a){var c=
this,a=l(r,a);c.libEnv(a);var d=a.iniFile.replace("~",a.appName);c.libRequire(d,function(d){r=l(a,d,a);var b=a.progress;c.libRequire(["magix/router","magix/vom"],function(d,f){d.on("changed",function(a){a.loc?f.locationUpdated(a.loc):a.changed.isView()?f.remountRoot(a):f.locationChanged(a)});f.on("progress",b||p);c.libRequire(a.extensions,function(){d.start()})})});a.ready&&(x(a.ready),delete a.ready)},keys:Object.keys||function(a){var c=[],d;for(d in a)n(a,d)&&c.push(d);return c},local:f({}),path:function(c,
d){var b=c+"\n"+d,f=t.get(b);if(!f){c=c.replace(a,"").replace(g,"");"/"==d.charAt(0)?(f=c.indexOf("://"),-1==f?f=d:(f=c.indexOf("/",f+3),f=-1==f?c+d:c.substring(0,f)+d)):f=c+d;for(;i.test(f);)f=f.replace(i,"$1/");t.set(b,f)}return f},pathToObject:function(c,d){var f=w.get(c);if(!f){var f={},l={},p="";a.test(c)?p=c.replace(a,""):~c.indexOf("=")||(p=c);if(p&&e.test(p))var n=p.indexOf("/",8),p=-1==n?"/":p.substring(n);c.replace(b,function(a,c,b){if(d)try{b=decodeURIComponent(b)}catch(f){}l[c]=b});f.pathname=
p;f.params=l;w.set(c,f)}return f},objectToPath:function(a,c){var d=a.pathname,b=[],f=a.params,l,p;for(p in f)l=f[p],c&&encodeURIComponent(l),b.push(p+"="+l);return d+(d&&b.length?"?":"")+b.join("&")},tmpl:function(a,c){return 1==arguments.length?q[a]:q[a]=c},listToMap:function(a,c){var d,b,f={},l;this.isString(a)&&(a=a.split(","));if(a&&(l=a.length))for(d=0;d<l;d++)b=a[d],f[c?b[c]:b]=c?b:1;return f},createCache:d};return s.mix(s,h)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(m,h,i,g){var a=window,b=i.has,e=i.mix,q=document,j=/^UTF-8$/i.test(q.charset||q.characterSet||"UTF-8"),r=i.config(),o=i.createCache(),f=i.createCache(),c,d,n,l=65536,w=/#.*$/,t=/^[^#]*#?!?/,x=r.nativeHistory,p,s,u=function(a,c,d){if(a){d=this.params;i.isArray(a)||(a=a.split(","));for(var f=0;f<a.length&&!(c=b(d,a[f]));f++);}return c},y=function(){return b(this,"pathname")},E=function(){return b(this,"view")},z=function(){return this.hash.pathname!=this.query.pathname},
B=function(a){return this.hash.params[a]!=this.query.params[a]},A=function(a){return b(this.hash.params,a)},F=function(a){return b(this.query.params,a)},D=function(a){return this.params[a]},m=e({getView:function(a){if(!n){n={routes:r.routes||{},e404:r.notFoundView};var c=r.defaultView;if(!c)throw Error("unset defaultView");n.home=c;var d=r.defaultPathname||"";n.routes[d]=c;n.pathname=d}a||(a=n.pathname);c=n.routes;c=i.isFunction(c)?c.call(r,a):c[a];return{view:c?c:n.e404||n.home,pathname:c?a:n.e404?
a:n.pathname}},start:function(){var c=a.history;p=x&&c.pushState;s=x&&!p;p?this.useState():this.useHash();this.route()},parsePath:function(c){var c=i.pathToObject(c,j),d=c.pathname;d&&"/"!=d.charAt(0)&&s&&(c.pathname=i.path(a.location.pathname,d));return c},parseQH:function(c){var c=c||a.location.href,d=o.get(c);if(!d){var d=c.replace(w,""),b=c.replace(t,""),f=this.parsePath(d),l=this.parsePath(b),p={};e(p,f.params);e(p,l.params);d={pathnameDiff:z,paramDiff:B,hashOwn:A,queryOwn:F,get:D,href:c,srcQuery:d,
srcHash:b,query:f,hash:l,params:p};o.set(c,d)}return d},parseLoc:function(a){a=this.parseQH(a);if(!a.view){var c=this.getView(x?a.hash.pathname||a.query.pathname:a.hash.pathname);e(a,c)}return a},getChged:function(a,c){var d=c.href,b=a.href+"\n"+d,l=f.get(b);l||(b=d+"\n"+b,l=f.get(b));if(!l){var p,l={params:{}};if(a.pathname!=c.pathname)p=l.pathname=1;if(a.view!=c.view)p=l.view=1;var d=a.params,e=c.params,n;for(n in d)d[n]!=e[n]&&(p=1,l.params[n]=1);for(n in e)d[n]!=e[n]&&(p=1,l.params[n]=1);l.occur=
p;l.isParam=u;l.isPathname=y;l.isView=E;f.set(b,l)}return l},route:function(){var a=this.parseLoc(),b=d||{params:{},href:"~"},f=!d;d=a;b=this.getChged(b,a);b.occur&&(c=a,this.fire("changed",{location:a,changed:b,firstFire:f}))},navigate2:function(a){if(a&&i.isString(a)){var d=this.parsePath(a),a={};a.params=e({},d.params);a.pathname=d.pathname;if(a.pathname){if(s&&(d=c.query)&&(d=d.params))for(var f in d)b(d,f)&&!b(a.params,f)&&(a.params[f]="")}else f=e({},c.params),a.params=e(f,a.params),a.pathname=
c.pathname;f=i.objectToPath(a);if(p?f!=c.srcQuery:f!=c.srcHash)p?(this.$firedPop=1,history.pushState(l--,q.title,f),this.route()):(e(a,c,a),a.srcHash=f,a.hash={params:a.params,pathname:a.pathname},this.fire("changed",{loc:c=a}),location.hash="#!"+f)}},navigate:function(a,c){!c&&i.isObject(a)&&(c=a,a="");c&&(a=i.objectToPath({params:c,pathname:a},j));this.navigate2(a)}},g);return i.mix(m,h)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(m,h,i,g){var a=document,b=65536,e=window.CollectGarbage||h.noop,q=h.mix,m=h.config(),j=m.tagName,r=m.rootId,o=h.has,f,c=function(c){return"object"==typeof c?c:a.getElementById(c)};a.createElement(j);var d=/<script[^>]*>[\s\S]*?<\/script>/ig,n=function(a){this.id=a;this.vId=a+"_v";this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};q(n,{root:function(d){if(!f){var b=c(r);if(!b)b=a.createElement(j),b.id=r,a.body.insertBefore(b,a.body.firstChild);f=new n(r);
d.add(f)}return f}});q(q(n.prototype,i),{useAnimUpdate:h.noop,oldViewDestroy:h.noop,prepareNextView:h.noop,newViewCreated:h.noop,mountView:function(a,b){var f=this,n=c(f.id);n._bak?n._chgd=1:(n._bak=1,n._tmpl=n.innerHTML.replace(d,""));var p=f.vN&&f.useAnimUpdate();f.unmountView(p,1);if(a){var e=h.pathToObject(a),i=e.pathname,j=--f.sign;h.libRequire(i,function(a){if(j==f.sign){var d=f.owner;g.prepare(a,{$:c,path:i,vom:d});var l;p?(l=f.vId,f.prepareNextView()):l=f.id;var h=new a({owner:f,id:l,vId:f.vId,
vfId:f.id,location:d.getLocation()});f.view=h;h.on("interact",function(a){f.fire("viewInteract",{view:h});f.viewUsable=1;p&&f.newViewCreated(1);if(!a.tmpl){if(!p&&n._chgd)n.innerHTML=n._tmpl;f.mountZoneVframes(0,0,1)}h.on("rendered",function(){f.mountZoneVframes(0,0,1)});h.on("prerender",function(a){f.unmountZoneVframes(0,a.anim)})},0);h.load(q(e.params,b,!0))}})}},unmountView:function(a,d){if(this.view){this.unmountZoneVframes(0,a);this.childrenAlter({});this.view.destroy();var f=c(this.id);if(!a&&
f._bak)f.innerHTML=f._tmpl;a&&d&&this.oldViewDestroy();delete this.view;delete this.viewUsable;this.fire("viewUnmounted");e()}this.un("viewInteract");this.sign--},mountVframe:function(a,c,d,f){var b=this.owner,e=b.get(a);if(!e)e=new n(a),e.pId=this.id,o(this.cM,a)||this.cC++,this.cM[a]=f,b.add(e);e.mountView(c,d);return e},mountZoneVframes:function(a,d,f){this.unmountZoneVframes(a);var a=a?a:c(this.vId)||c(this.id),a=c(a).getElementsByTagName(j),n=a.length,p={};if(n)for(var e=0,g,h;e<n;e++){g=a[e];
h=g.id||(g.id="magix_vf_"+b--);o(p,h)||this.mountVframe(h,g.getAttribute("mx-view"),d,f);g=c(g).getElementsByTagName(j);h=0;for(var q=g.length;h<q;h++)p[g[h].id||(g[h].id="magix_vf_"+b--)]=1}else this.cC==this.rC&&this.childrenCreated({})},unmountVframe:function(a,c){var a=a||this.id,d=this.owner,f=d.get(a);if(f){var b=f.fcc;f.unmountView(c);d.remove(a,b);if((d=d.get(f.pId))&&o(d.cM,a))delete d.cM[a],d.cC--}},unmountZoneVframes:function(a){if(a){for(var a=c(a).getElementsByTagName(j),d={},f=this.cM,
b=a.length-1,p;0<=b;b--)p=a[b].id,o(f,p)&&(d[p]=1);a=d}else a=this.cM;for(var n in a)this.unmountVframe(n)},childrenCreated:function(a){var c=this.view;if(c&&!this.fcc)this.fcc=1,delete this.fca,c.fire("created",a),this.fire("created",a);var d=this.owner;d.childCreated();c=this.id;if((d=d.get(this.pId))&&!o(d.rM,c))d.rM[c]=d.cM[c],d.rC++,d.rC==d.cC&&d.childrenCreated(a)},childrenAlter:function(a){delete this.fcc;if(!this.fca){var c=this.view,d=this.id;if(c)this.fca=1,c.fire("alter",a),this.fire("alter",
a);if((c=this.owner.get(this.pId))&&o(c.rM,d)){var f=c.rM[d];c.rC--;delete c.rM[d];f&&c.childrenAlter(a)}}},locationChanged:function(a,c){var d=this.view;if(d&&d.sign&&(d.location=a,d.rendered)){var f=d.olChanged(c),b={location:a,changed:c,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];h.isString(a)&&(a=a.split(","));this.cs=a}};f&&h.safeExec(d.locationChange,b,d);for(var d=b.cs||h.keys(this.cM),f=0,b=d.length,n=this.owner,e;f<b;f++)(e=n.get(d[f]))&&e.locationChanged(a,c)}},locationUpdated:function(a){var c=
this.view;if(c&&c.sign){c.location=a;var c=this.cM,d,f=this.owner,b;for(b in c)(d=f.get(b))&&d.locationUpdated(a)}}});return n},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(m,h,i,g,a){var b=i.safeExec,e=i.has,q=[],j=i.config(),r=/^~[^\/]*/,o=i.mix,f=i.listToMap("render,renderUI"),c=function(a){return function(){var c;this.sign&&(this.sign++,this.fire("rendercall"),c=a.apply(this,arguments));return c}},m=function(a){o(this,a);this.sign=1};o(m,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var a=this.prototype,d,b;for(b in a){d=a[b];var n=null;i.isFunction(d)&&d!=i.noop&&!d["~~"]&&e(f,b)&&(n=c(d),n["~~"]=d,a[b]=n)}}}});var d=m.prototype,
n=window.CollectGarbage||i.noop,l=/\smx-[^ohv][a-z]+\s*=/g,w={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},t=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,x=/(\w+):([^,]+)/g;o(d,g);o(d,{render:i.noop,locationChange:i.noop,init:i.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var a=this,c=a.hasTmpl,d=arguments,
f=a.sign,n=function(){if(f==a.sign&&(a.delegateEvents(),a.fire("interact",{tmpl:c},1),b(a.init,d,a),b(a.render,q,a),!c&&!a.rendered))a.rendered=!0,a.fire("primed",null,1)};c&&!a.template?a.planTmpl(n):n()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var a=this.enableAnim;this.fire("refresh",0,1);this.fire("prerender",{anim:a});var c=this.owner;a&&(b(c.oldViewDestroy,q,c),b(c.prepareNextView,q,c),this.updateViewId())}},
endUpdateHTML:function(){if(this.sign){if(this.rendered&&this.enableAnim){var a=this.owner;b(a.newViewCreated,q,a)}this.rendered||this.fire("primed",null,1);this.rendered=!0;this.fire("rendered");n()}},wrapMxEvent:function(a){return a?(""+a).replace(l,' mx-owner="'+this.vfId+'"$&'):a},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=this.wrapMxEvent(a);this.endUpdateHTML()},observeLocation:function(a){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var d=c.keys;
if(i.isObject(a))c.pn=a.pathname,a=a.keys;if(a)c.keys=d.concat(i.isString(a)?a.split(","):a)},olChanged:function(a){var c=this.$ol;if(c){var d=0;c.pn&&(d=a.isPathname());d||(d=a.isParam(c.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),c=null;if(a&&a.viewUsable)c=a.view;return c},planTmpl:function(a){var c=this,d=i.tmpl(c.path);if(void 0===d){var d=j.debug,
f=c.home+c.path.replace(r,"")+".html";c.fetchTmpl(f,function(d){c.template=i.tmpl(c.path,d);a()},d)}else c.template=d,a()},processEvent:function(a){if(this.enableEvent&&this.sign){var c=a.se,d=a.info.match(t),f=d[1],n=d[2],d=d[3],e=this.events;if(e){var g=e[c.type];if(w[n])w[n](c);if(g&&g[f]){var h={};d&&d.replace(x,function(a,c,d){h[c]=d});b(g[f],o({view:this,currentId:a.cId,targetId:a.tId,domEvent:c,events:e,params:h},w),g)}}}},delegateEvents:function(c){var d=this.events,c=c?a.detachEvent:a.attachEvent,
f;for(f in d)c.call(a,f)}});i.mix(m,h,{prototype:!0});i.mix(m.prototype,h.prototype);return m},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]});
KISSY.add("magix/vom",function(m,h,i,g,a){var b=i.has,e=0,q=0,j=0,r=0,o={},f,c=i.mix({all:function(){return o},add:function(a){if(!b(o,a.id))e++,o[a.id]=a,a.owner=c,c.fire("add",{vframe:a})},get:function(a){return o[a]},remove:function(a,f){var b=o[a];b&&(e--,f&&q--,delete o[a],c.fire("remove",{vframe:b}))},childCreated:function(){if(!r){q++;var a=q/e;j<a&&(c.fire("progress",{percent:j=a}),1==a&&(r=1,c.un("progress")))}},root:function(){return h.root(c)},remountRoot:function(a){var b=c.root();f=a.location;
b.mountView(f.view)},locationChanged:function(a){f=a.location;c.root().locationChanged(f,a.changed)},locationUpdated:function(a){f=a;c.root().locationUpdated(a)},getLocation:function(){return f}},g);a.VOM=c;a.on("event",function(a){var f=c.get(a.hld);(f=f&&f.view)&&f.processEvent(a)});return c},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(m,h){var i=h.has,g=h.safeExec,a=function(a){h.isArray(a)||(a=[a]);for(var c=0,d;c<a.length;c++)d=a[c],delete d.cacheKey;return a},b=function(a){this.$modelClass=a;this.$modelsCache=h.createCache();this.$modelsCacheKeys={}},e=[].slice,q={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},j=function(a){var c={},d;for(d in a)q[d]||(c[d]=a[d]);return c},r=function(a,c){var d=e.call(arguments,2);return function(){return a.apply(c,d.concat(e.call(arguments)))}};
h.mix(b,{create:function(a){if(!a)throw Error("MManager.create modelClass ungiven");return new b(a)}});var o=function(a){this.$host=a;this.$task=!1};h.mix(o.prototype,{fetchModels:function(a,c,d){var b=this;if(b.$task)return b.next(function(b){b.fetchModels(a,c,error,d)}),b;b.$task=!0;var e=b.$host;if(!b.$reqModels)b.$reqModels={};var q=e.$modelsCache,j=e.$modelsCacheKeys,o=b.$reqModels;h.isArray(a)||(a=[a]);var p=a.length,s=0,u,y,E=Array(p),z=[],B={},A=[],F=m.isArray(c);F&&(z=Array(c.length));for(var D=
function(a,f,e,h){if(!b.$destroy){s++;delete o[e.id];var l=e._cacheKey;E[a]=e;if(f)y=!0,u=h||u,B[a]=h;else{l&&!q.has(l)&&q.set(l,e);var r=e.metaParams;e._doneAt=m.now();var v=e._context;v&&g(v.after,[e].concat(r),v)}if(2==d)(r=F?c[a]:c)&&(z[a]=g(r,[e,f?{msg:h}:null,y?B:null],b));else if(4==d){A[a]={m:e,e:f,s:h};for(a=A.i||0;r=A[a];a++)if(v=F?c[a]:c,z[a]=g(v,[r.m,r.e?{msg:r.s}:null,A.e?B:null,z],b),r.e)B[a]=r.s,A.e=1;A.i=a}l&&i(j,l)&&(a=j[l],delete j[l],g(a,[f,e,h],e));if(s>=p)B.msg=u,f=y?B:null,1==
d?(E.push(f),z[0]=g(c,E,b),z[1]=f):z.push(f),b.$ntId=setTimeout(function(){b.$task=!1;b.doNext(z)},30)}},C=0,v;C<a.length;C++)if(v=a[C]){var H;H=e.getModel(v);var G=H.cacheKey;G&&i(j,G)?j[G].push(r(D,b,C)):(v=H.entity,H.needUpdate?(o[v.id]=v,G&&(j[G]=[]),v.request({success:r(D,v,C,!1,v),error:r(D,v,C,!0,v)})):D(C,!1,v))}else throw Error("miss attrs:"+a);return b},fetchAll:function(a,c){return this.fetchModels(a,c,1)},saveAll:function(b,c){b=a(b);return this.fetchModels(b,c,1)},fetchOrder:function(a,
c){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:c,4)},saveOrder:function(b,c){var b=a(b),d=e.call(arguments,1);return this.fetchModels(b,1<d.length?d:c,4)},saveOne:function(b,c){var b=a(b),d=e.call(arguments,1);return this.reqModels(b,1<d.length?d:c,2)},fetchOne:function(a,c){var d=e.call(arguments,1);return this.fetchModels(a,1<d.length?d:c,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,c=this.$host.$modelsCacheKeys;if(a)for(var d in a){var b=a[d],e=b._cacheKey;
if(e&&i(c,e)){var h=c[e];delete c[e];g(h,[!0,b,"aborted"],b)}b.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$task||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){var c=this.$queue;c&&(c=c.shift())&&g(c,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});h.mix(b.prototype,{registerModels:function(a){h.isArray(a)||(a=[a]);for(var c=0,d;c<
a.length;c++){d=a[c];if(!d.name)throw Error("model must own a name attribute");this[d.name]=d}},registerMethods:function(a){var c=this,d;for(d in a)i(a,d)&&(c[d]=function(a){return function(){for(var d,b=arguments,f=[],e=0,q;e<b.length;e++)q=b[e],h.isFunction(q)?f.push(function(a){return function(){d||a.apply(a,arguments)}}(q)):f.push(q);var j=a.apply(c,f);return{abort:function(){j&&j.abort&&g(j.abort,["aborted"],j);d=!0}}}}(a[d]))},createModel:function(a){var c=this.getModelMeta(a),d=new this.$modelClass(j(c)),
b=a;b.before||(b=c);var e=a.metaParams||[];m.isFunction(b.before)&&g(b.before,[d].concat(e),b);b=a;b.after||(b=c);if(b.after)d._context=b;d._cacheKey=a.cacheKey||c.cacheKey;d._meta=c;d.set(j(a));d.setUrlParams(c.urlParams);d.setPostParams(c.postParams);d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);d.metaParams=e;return d},getModelMeta:function(a){var c=this[a.name];if(!c)throw Error("Not found:"+a.name);return c},getModel:function(a){var c=this.getModelFromCache(a),d;c||(d=!0,c=this.createModel(a));
return{entity:c,cacheKey:c._cacheKey,needUpdate:d}},saveAll:function(a,c){return(new o(this)).saveAll(a,c)},fetchAll:function(a,c){return(new o(this)).fetchAll(a,c)},saveOrder:function(a,c){var d=new o(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(a,c){var d=new o(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(a,c){var d=new o(this);return d.saveOne.apply(d,arguments)},fetchOne:function(a,c){var d=new o(this);return d.fetchOne.apply(d,arguments)},clearCacheByKey:function(a){var c=
this.$modelsCache;m.isString(a)&&c.del(a)},clearCacheByName:function(a){for(var c=this.$modelsCache.c,d=0;d<c.length;d++){var b=c[d];b.v&&b.v._meta.name==a&&delete c[b.k]}},getModelUrl:function(a){return this.$modelClass.prototype.url((m.isString(a)?this[a]:a).uri)},getModelFromCache:function(a){var c=this.$modelsCache,d=null,b;if(m.isString(a))b=a;else{var e=this.getModelMeta(a);b=a.cacheKey||e.cacheKey}if(b&&(d=c.get(b))){if(!e)e=d._meta;a=a.cacheTime||e.cacheTime||0;0<a&&m.now()-d._doneAt>a&&(this.clearCacheByKey(b),
d=null)}return d}});return b},{requires:["magix/magix"]});
KISSY.add("mxext/model",function(m,h){var i=function(a,b,e){for(var g in b)m.isObject(b[g])?(h.has(a,g)||(a[g]={}),i(a[g],b[g],!0)):e&&(a[g]=b[g])},g=function(a){a&&this.set(a);this.id=m.guid("m")};h.mix(g,{GET:"GET",POST:"POST",extend:function(a,b){var e=function(){e.superclass.constructor.apply(this,arguments);b&&h.safeExec(b,[],this)};h.mix(e,this,{prototype:!0});i(a,this.prototype);return m.extend(e,this,a)}});h.mix(g.prototype,{urlMap:{},sync:h.noop,parse:function(a){return a},getParamsObject:function(a){if(!a)a=
g.GET;return this["$"+a]||null},getUrlParamsObject:function(){return this.getParamsObject(g.GET)},getPostParamsObject:function(){return this.getParamsObject(g.POST)},getPostParams:function(){return this.getParams(g.POST)},getUrlParams:function(){return this.getParams(g.GET)},getParams:function(a){var a=a?a.toUpperCase():g.GET,a=this["$"+a],b=[],e;if(a)for(var h in a)if(e=a[h],m.isArray(e))for(var j=0;j<e.length;j++)b.push(h+"="+encodeURIComponent(e[j]));else b.push(h+"="+encodeURIComponent(e));return b.join("&")},
setUrlParamsIf:function(a,b){this.setParams(a,b,g.GET,!0)},setPostParamsIf:function(a,b){this.setParams(a,b,g.POST,!0)},setParams:function(a,b,e,h){e=e?e.toUpperCase():g.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[e]=!0;e="$"+e;this[e]||(this[e]={});if(m.isObject(a))for(var j in a){if(!h||!this[e][j])this[e][j]=a[j]}else if(a&&(!h||!this[e][a]))this[e][a]=b},setPostParams:function(a,b){this.setParams(a,b,g.POST)},setUrlParams:function(a,b){this.setParams(a,b,g.GET)},removeParamsObject:function(a){if(!a)a=
g.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(g.POST)},removeUrlParamsObject:function(){this.removeParamsObject(g.GET)},reset:function(){var a=this.$keysCache;if(a){for(var b in a)h.has(a,b)&&delete this["$"+b];delete this.$keysCache}a=this.$keys;b=this.$attrs;if(a){for(var e=0;e<a.length;e++)delete b[a[e]];delete this.$keys}},url:function(a){var a=a||this.get("uri"),b;if(a){b=a.split(":");var e=this.urlMap;if(e)for(var g=0,h=b.length;g<h&&!(e=e[b[g]],void 0===
e);g++)g==h-1&&(a=e)}else throw Error("model not set uri");return a},get:function(a){var b=this.$attrs;return b?b[a]:null},set:function(a,b,e){if(!this.$attrs)this.$attrs={};if(e&&!this.$keys)this.$keys=[];if(m.isObject(a))for(var g in a)e&&this.$keys.push(g),this.$attrs[g]=a[g];else a&&(e&&this.$keys.push(a),this.$attrs[a]=b)},load:function(a){this.request(a)},save:function(a){this.request(a)},request:function(a){a||(a={});var b=a.success,e=a.error,g=this;g.$abort=!1;a.success=function(a){if(!g.$abort){if(a){var e=
g.parse(a);e&&(m.isArray(e)&&(e={list:e}),g.set(e,null,!0))}b&&b.apply(this,arguments)}};a.error=function(){g.$abort||e&&e.apply(this,arguments)};g.$trans=g.sync(a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=m.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return g},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(m,h){var i=function(a){this.$modelClass=a},g=function(a){if(a._wraped_)return a;var b=function(b){var g=b.success,j=this;j.get("~~ui")?(b.success=function(){j.set("~~ui",!1);j._after&&h.safeExec(j._after,j);g&&g.apply(b)},a.call(j,b)):g&&g.apply(b)};b._wraped_=!0;return b};h.mix(i,{mClsCache:{},create:function(a,b){if(!b)throw Error("Factory.create modelClass ungiven");var e=this.mClsCache;a||(a=m.guid());e[a]||(e[a]=new i(b));return e[a]}});h.mix(i.prototype,
{registerModels:function(a){h.isArray(a)||(a=[a]);for(var b=0,e;b<a.length;b++){e=a[b];if(!e.type)throw Error("model must own a type attribute");this[e.type]=e}},registerMethods:function(a){for(var b in a)h.hasProp(a,b)&&(this[b]=a[b])},callMethods:function(a,b,e){for(var g=[],h="",i=a.length,o=0,f,c=function(a,c,d){f||(o++,d?h=a:g[c]=a,i<=o&&(h?m.isFunction(e)&&e(h):m.isFunction(b)&&b.apply(b,g)))},d=function(a,d){return function(b){c(b,a,!d)}},n=0,l;n<a.length;n++){l=a[n];var w;if(w=m.isFunction(l.name)?
l.name:this[l.name]){if(!l.params)l.params=[];l.params.push(d(n,!0),d(n));w.apply(this,l.params)}else c("unfound:"+l.name,n,!0)}return{abort:function(){f=!0}}},fetchModels:function(a,b,e,g){var i=this;if(!i.$modelsCache)i.$modelsCache={};if(!i.$modelsCacheKeys)i.$modelsCacheKeys={};var r=i.$modelsCache,o=i.$modelsCacheKeys;h.isArray(a)||(a=[a]);for(var f=a.length,c=0,d,n=[],l=[],w,t=function(a,l,p,t){c++;if(l)d=t||"fetch data error";else{w=!0;p.set("~~ui",!1);n[a]=p;if((a=p._cacheKey)&&!h.hasProp(r,
a))r[p._cacheKey]=p,a=p._params,p._doneAt=m.now(),p._after&&h.safeExec(p._after,[p].concat(a));4==g&&b(p)}if((a=p._cacheKey)&&h.hasProp(o,a)){var s=o[a];delete o[a];h.safeExec(s,[l,p,t],p)}4!=g&&c>=f&&(2==g?w?b&&b.apply(i,n):e&&e(d):d?e&&e(d):b&&b.apply(i,n))},x=Array.prototype.slice,p=function(a,c){var d=x.call(arguments,2);return function(){return a.apply(c,d.concat(x.call(arguments)))}},s=0,u;s<a.length;s++){u=a[s];var y=u.cacheKey;y&&h.hasProp(o,y)?o[y].push(p(t,i,s)):(u=i.create(u,!0),u.get("~~ui")?
(l.push(u),y&&(o[y]=[]),u.request({success:p(t,u,s,!1,u),error:p(t,u,s,!0,u)})):t(s,!1,u))}return{abort:function(){for(var a=0,c;a<l.length;a++){c=l[a];var d=c._cacheKey;if(d&&h.hasProp(o,d)){var b=o[d];delete o[d];h.safeExec(b,[!0,c,"abort"],c)}c.abort()}}}},fetchAll:function(a,b,e){return this.fetchModels(a,b,e,1)},fetchAny:function(a,b,e){return this.fetchModels(a,b,e,2)},fetchOne:function(a,b){return this.fetchModels(a,b,h.noop,4)},getIf:function(a){var b=this.$modelsCache;return b&&h.hasProp(b,
a)?b[a]:null},setUpdateIdent:function(a){(a=this.getIf(a))&&a.set("~~ui",!0)},create:function(a,b){if(!a.type)throw Error('model must own a "type" attribute');var e=a.type,i=a.cacheKey||e.cacheKey,j,r=a.expires||e.expires||0;if(!this.$modelsCache)this.$modelsCache={};var o=this.$modelsCache,f=a.params||[];if(i&&h.hasProp(o,i)){j=o[i];var c=j.get("~~ui");!c&&0<r&&m.now()-j._doneAt>r&&(c=!0);c&&(delete o[i],j.set("~~ui",!0))}else j=new this.$modelClass(e.ops),j._after=e.after,j._cacheKey=i,j.set("~~ui",
!0);j._params=f;if(c=j.get("~~ui"))j.reset(),j.set(a.ops),j.setParams(e.gets),j.setPostParams(e.posts),j.setParams(a.gets),j.setPostParams(a.posts),h.isFunction(e.before)&&h.safeExec(e.before,[j].concat(f),e);if(!b)j.request=g(j.request);return j}});return i},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(m,h,i,g){var a=window,b="destroy,abort,stop,cancel,remove".split(","),e=0,q=h.safeExec,j=h.has,r={},o=function(a){if(!o.d)o.d=1,a.on("add",function(a){var a=a.vframe,c=r[a.id];if(c){for(var b=0;b<c.length;b++)f(a,c[b]);delete r[a.id]}}),a.on("remove",function(a){delete r[a.vframe.id]}),a.root().on("childrenCreated",function(){r={}})},f=function(a,b){var e=a.view;if(e&&a.viewUsable)q(e.receiveMessage,b,e);else{var f=function(e){a.un("viewInteract",f);q(e.view.receiveMessage,
b,e.view)};a.on("viewInteract",f)}};return i.extend({mxViewCtor:h.noop,navigate:function(a){g.navigate.apply(g,arguments)},manage:function(a,b){var f=!0;1==arguments.length&&(b=a,a="res_"+e++,f=!1);if(!this.$resCache)this.$resCache={};this.$resCache[a]={hasKey:f,res:b};return b},getManaged:function(a){var b=this.$resCache;return b&&j(b,a)?b[a].res:null},removeManaged:function(a){var b=null,e=this.$resCache;if(e)if(j(e,a))b=e[a].res,delete e[a];else for(var f in e)if(e[f].res===a){b=e[f].res;delete e[f];
break}return b},destroyManaged:function(c){var d=this.$resCache;if(d){for(var e in d){var f=d[e],g=f.res;if(h.isNumber(g))a.clearTimeout(g),a.clearInterval(g);else if(g)if(g.nodeType&&g.parentNode)m.one(g).remove();else for(var i=0;i<b.length;i++)h.isFunction(g[b[i]])&&q(g[b[i]],[],g);c&&!f.hasKey&&delete d[e]}c||delete this.$resCache}},receiveMessage:h.noop,postMessageTo:function(a,b){var e=this.vom;o(e);h.isArray(a)||(a=[a]);b||(b={});for(var g=0,i;g<a.length;g++){i=a[g];var j=e.get(i);j?f(j,b):
(r[i]||(r[i]=[]),r[i].push(b))}},destroyMRequest:function(){var a=this.$resCache;if(a)for(var b in a){var e=a[b].res;e&&e.fetchOne&&e.fetchAll&&(e.destroy(),delete a[b])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(m){var h=function(){};if(!m.console)m.console={log:h,info:h,error:h};var i,g={};if(!m.Magix)m.Magix={config:function(a){for(var b in a)g[b]=a[b]},start:function(a){i=a}},KISSY.use("magix/magix",function(a,b){m.Magix=b;b.config(g);i&&b.start(i)})})(this);