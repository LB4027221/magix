KISSY.add("magix/body",function(g,d,r,k){var b={},j=d.has,g=d.mix,f=d.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),h=document.body,l={},p={},m=65536,o=function(a,c,e){e?a.setAttribute(c,e):e=a.getAttribute(c);return e},d=g({processEvent:function(a){for(var c=a.target||a.srcElement;c&&1!=c.nodeType;)c=c.parentNode;var e=c,i=a.type,b=p[i]||(p[i]=RegExp("(?:^|,)"+i+"(?:,|$)"));if(!b.test(o(c,"mx-ie"))){for(var q="mx-"+i,d,f,k=[];e&&e!=h&&!(d=o(e,q),f=o(e,"mx-ie"),d||b.test(f));)k.push(e),
e=e.parentNode;if(d){i=o(e,"mx-owner");if(!i){b=e;for(f=this.VOM.all();b&&b!=h;)if(j(f,b.id)){o(e,"mx-owner",i=b.id);break}else b=b.parentNode}if(i)this.fire("event",{info:d,se:a,tId:c.id||(c.id="mx-e-"+m--),cId:e.id||(e.id="mx-e-"+m--),hld:i});else throw Error("miss mx-owner:"+d);}else for(;k.length;)a=k.shift(),f=o(a,"mx-ie"),b.test(f)||(f=f?f+","+i:i,o(a,"mx-ie",f))}},attachEvent:function(a){var c=this;if(l[a])l[a]++;else if(l[a]=1,f[a])c.onUnbubble(h,a);else h["on"+a]=function(a){(a=a||window.event)&&
c.processEvent(a)}},detachEvent:function(a){var c=l[a];0<c&&(c--,c||(f[a]?this.offUnbubble(h,a):h["on"+a]=null),l[a]=c)}},r);d.onUnbubble=function(a,c){var e=this;k.delegate(a,c,"*[mx-"+c+"]",b[c]=function(a){e.processEvent(a)})};d.offUnbubble=function(a,c){k.undelegate(a,c,"*[mx-"+c+"]",b[c]);delete b[c]};return d},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/event",function(g,d){var r=d.safeExec;return{fire:function(d,b,j,f){var h="~"+d,g=this[h];if(g){b||(b={});if(!b.type)b.type=d;for(var d=g.length,p=d-1,m,o;d--;)m=f?d:p-d,o=g[m],o.d&&(g.splice(m,1),p--),r(o,b,this)}j&&delete this[h]},on:function(g,b,j){g="~"+g;this[g]||(this[g]=[]);d.isNumeric(j)?this[g].splice(j,0,b):(b.d=j,this[g].push(b))},un:function(g,b){d.isArray(g)||(g=[g]);for(var j=0,f=g.length;j<f;j++){var h="~"+g[j],l=this[h];if(l)if(b)for(var h=0,p=l.length;h<p;h++){if(l[h]==
b){l.splice(h,1);break}}else delete this[h]}}}},{requires:["magix/magix"]});
KISSY.add("magix/magix",function(g){var d=[].slice,r=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,k=/[^\/]*$/,b=/[#?].*$/,j=/([^=&?\/#]+)=([^&=#?]*)/g,f=/^https?:\/\//i,h={},l=0,p={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},m=h.hasOwnProperty,o=function(a){return function(c,n,b){switch(arguments.length){case 0:b=a;break;case 1:b=w.isObject(c)?i(a,c):e(a,c)?a[c]:null;break;case 2:null===n?(delete a[c],b=n):a[c]=b=n}return b}},a=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},c=function(c){return new a(c)},e=function(a,c){return a?m.call(a,c):0},i=function(a,c,n){for(var b in c)if(!n||!e(n,b))a[b]=c[b];return a};i(a.prototype,{get:function(a){var c=this.c,n,a="pathname"+a;if(e(c,a)&&(n=c[a],1<=n.f))n.f++,n.t=l++,n=n.v;return n},set:function(a,c){var n=this.c,a="pathname"+a,b=n[a];if(!e(n,a)){if(n.length>=this.b){n.sort(function(a,c){return c.f==a.f?c.t-a.t:c.f-a.f});for(var i=this.b-this.x;i--;)b=n.pop(),delete n[b.k]}b={};n.push(b);n[a]=
b}b.k=a;b.v=c;b.f=1;b.t=l++;return b},del:function(a){var a="pathname"+a,c=this.c,n=c[a];if(n)n.f=-1E5,n.v="",delete c[a]},has:function(a){return e(this.c,"pathname"+a)}});var s=c(60),q=c(),B=function(a,c,n,b,e,i){w.isArray(a)||(a=[a]);if(!c||!w.isArray(c)&&!c.callee)c=[c];for(b=0;b<a.length;b++)try{i=a[b],e=w.isFunction(i)&&i.apply(n,c)}catch(d){}return e},y=function(){},w={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:i,has:e,safeExec:B,noop:y,config:o(p),start:function(a){var c=
this,a=i(p,a);c.libEnv(a);var b=a.iniFile.replace("~",a.appName);c.libRequire(b,function(b){p=i(a,b,a);var n=a.progress;c.libRequire(["magix/router","magix/vom"],function(b,e){b.on("changed",function(a){a.loc?e.locUpdated(a.loc):a.changed.isView()?e.mountRoot(a):e.locChanged(a)});e.on("progress",n||y);c.libRequire(a.extensions,function(){b.start()})})});a.ready&&(B(a.ready),delete a.ready)},keys:Object.keys||function(a){var c=[],b;for(b in a)e(a,b)&&c.push(b);return c},local:o({}),path:function(a,
c){var e=a+"\n"+c,i=q.get(e);if(!i){a=a.replace(b,"").replace(k,"");"/"==c.charAt(0)?(i=a.indexOf("://"),-1==i?i=c:(i=a.indexOf("/",i+3),i=-1==i?a+c:a.substring(0,i)+c)):i=a+c;for(;r.test(i);)i=i.replace(r,"$1/");q.set(e,i)}return i},pathToObject:function(a,c){var e=s.get(a);if(!e){var e={},i={},d="";b.test(a)?d=a.replace(b,""):~a.indexOf("=")||(d=a);if(d&&f.test(d))var q=d.indexOf("/",8),d=-1==q?"/":d.substring(q);a.replace(j,function(a,b,e){if(c)try{e=decodeURIComponent(e)}catch(n){}i[b]=e});e.pathname=
d;e.params=i;s.set(a,e)}return e},objectToPath:function(a,c){var b=a.pathname,e=[],i=a.params,d,s;for(s in i)d=i[s],c&&encodeURIComponent(d),e.push(s+"="+d);return b+(b&&e.length?"?":"")+e.join("&")},tmpl:function(a,c){return 1==arguments.length?{v:h[a],h:e(h,a)}:h[a]=c},listToMap:function(a,c){var b,e,i={},d;this.isString(a)&&(a=a.split(","));if(a&&(d=a.length))for(b=0;b<d;b++)e=a[b],i[c?e[c]:e]=c?e:1;return i},createCache:c};return i(w,{libRequire:function(a,c){if(a){var b=this.isFunction(c),e=
this.isArray(a);g.use(e?a.join(","):a,b?function(a){c.apply(a,d.call(arguments,1))}:this.noop)}else c()},libEnv:function(a){var c=a.appHome,b=location,e=b.protocol,i=a.appName;~c.indexOf(e)||(c=this.path(b.href,c));g.endsWith(c,"/")||(c+="/");a.appHome=c;var d=a.debug;d&&(d=0==c.indexOf(e+"//"+b.host));"~"==i.charAt(0)&&g.config({map:[[RegExp("/"+i+"/"),"/"]]});b="";(b=d?g.now():a.appTag)&&(b+=".js");e=a.appCombine;g.isUndefined(e)&&(e=g.config("combine"));g.config({packages:[{name:i,path:c,debug:a.debug=
d,combine:e,tag:b}]})},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isObject,isRegExp:g.isRegExp,isString:g.isString,isNumber:g.isNumber})});
KISSY.add("magix/router",function(g,d,r,k){var b=window,j=d.has,f=d.mix,h=document,l=/^UTF-8$/i.test(h.charset||h.characterSet||"UTF-8"),p=d.config(),m=d.createCache(),o=d.createCache(),a,c,e,i=65536,s=/#.*$/,q=/^[^#]*#?!?/,B=p.nativeHistory,y,w,I=function(a,c,b){if(a){b=this.params;d.isArray(a)||(a=a.split(","));for(var e=0;e<a.length&&!(c=j(b,a[e]));e++);}return c},J=function(){return j(this,"pathname")},n=function(){return j(this,"view")},C=function(){return this.hash.pathname!=this.query.pathname},
z=function(a){return this.hash.params[a]!=this.query.params[a]},D=function(a){return j(this.hash.params,a)},E=function(a){return j(this.query.params,a)},F=function(a){return this.params[a]},g=f({getView:function(a){if(!e){e={routes:p.routes||{},e404:p.notFoundView};var c=p.defaultView;if(!c)throw Error("unset defaultView");e.home=c;var b=p.defaultPathname||"";e.routes[b]=c;e.pathname=b}a||(a=e.pathname);c=e.routes;c=d.isFunction(c)?c.call(p,a):c[a];return{view:c?c:e.e404||e.home,pathname:c?a:e.e404?
a:e.pathname}},start:function(){var a=b.history;y=B&&a.pushState;w=B&&!y;y?this.useState():this.useHash();this.route()},parsePath:function(a){var a=d.pathToObject(a,l),c=a.pathname;c&&"/"!=c.charAt(0)&&w&&(a.pathname=d.path(b.location.pathname,c));return a},parseQH:function(a){var a=a||b.location.href,c=m.get(a);if(!c){var c=a.replace(s,""),e=a.replace(q,""),i=this.parsePath(c),n=this.parsePath(e),d={};f(d,i.params);f(d,n.params);c={pathnameDiff:C,paramDiff:z,hashOwn:D,queryOwn:E,get:F,href:a,srcQuery:c,
srcHash:e,query:i,hash:n,params:d};m.set(a,c)}return c},parseLoc:function(a){a=this.parseQH(a);if(!a.view){var c=this.getView(B?a.hash.pathname||a.query.pathname:a.hash.pathname);f(a,c)}return a},getChged:function(a,c){var b=c.href,e=a.href+"\n"+b,i=o.get(e);i||(e=b+"\n"+e,i=o.get(e));if(!i){var d,i={params:{}};if(a.pathname!=c.pathname)d=i.pathname=1;if(a.view!=c.view)d=i.view=1;var b=a.params,s=c.params,q;for(q in b)b[q]!=s[q]&&(d=1,i.params[q]=1);for(q in s)b[q]!=s[q]&&(d=1,i.params[q]=1);i.occur=
d;i.isParam=I;i.isPathname=J;i.isView=n;o.set(e,i)}return i},route:function(){var b=this.parseLoc(),e=c||{params:{},href:"~"},i=!c;c=b;e=this.getChged(e,b);e.occur&&(a=b,this.fire("changed",{location:b,changed:e,force:i}))},navigate2:function(c){if(c&&d.isString(c)){var b=this.parsePath(c),c={};c.params=f({},b.params);c.pathname=b.pathname;if(c.pathname){if(w&&(b=a.query)&&(b=b.params))for(var e in b)j(b,e)&&!j(c.params,e)&&(c.params[e]="")}else e=f({},a.params),c.params=f(e,c.params),c.pathname=
a.pathname;e=d.objectToPath(c);if(y?e!=a.srcQuery:e!=a.srcHash)y?(this.$firedPop=1,history.pushState(i--,h.title,e),this.route()):(f(c,a,c),c.srcHash=e,c.hash={params:c.params,pathname:c.pathname},this.fire("changed",{loc:a=c}),location.hash="#!"+e)}},navigate:function(a,c){!c&&d.isObject(a)&&(c=a,a="");c&&(a=d.objectToPath({params:c,pathname:a},l));this.navigate2(a)}},r);g.useState=function(){var a=this,c=location.href;k.on(b,"popstate",function(){var b=location.href==c;if(a.$firedPop||!b)a.$firedPop=
!0,a.route()})};g.useHash=function(){var a=this;k.on(b,"hashchange",function(){a.route()})};return g},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(g,d,r,k){var b=document,j=65536,f=window.CollectGarbage||d.noop,h=d.mix,g=d.config(),l=g.tagName,p=g.rootId,m=d.has,o,a=function(a){return"object"==typeof a?a:b.getElementById(a)};b.createElement(l);var c=/<script[^>]*>[\s\S]*?<\/script>/ig,e=function(a){this.id=a;this.vId=a+"_v";this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};h(e,{root:function(c){if(!o){var d=a(p);if(!d)d=b.createElement(l),d.id=p,b.body.insertBefore(d,b.body.firstChild);o=new e(p);
c.add(o)}return o}});h(h(e.prototype,r),{useAnimUpdate:d.noop,oldViewDestroy:d.noop,prepareNextView:d.noop,newViewCreated:d.noop,mountView:function(b,e){var q=this,f=a(q.id);f._bak?f._chgd=1:(f._bak=1,f._tmpl=f.innerHTML.replace(c,""));var j=q.viewUsable&&q.useAnimUpdate();q.unmountView(j,1);if(b){var g=d.pathToObject(b),l=g.pathname,p=--q.sign;d.libRequire(l,function(c){if(p==q.sign){var b=q.owner;k.prepare(c,{$:a,path:l,vom:b});var i;j?(i=q.vId,q.prepareNextView()):i=q.id;var d=new c({owner:q,id:i,
vId:q.vId,vfId:q.id,location:b.getLoc()});q.view=d;d.on("interact",function(a){q.fire("viewInteract",{view:d});q.viewUsable=1;j&&q.newViewCreated(1);if(!a.tmpl){if(!j&&f._chgd)f.innerHTML=f._tmpl;q.mountZoneVframes(0,0,1)}d.on("rendered",function(){q.mountZoneVframes(0,0,1)});d.on("prerender",function(a){q.unmountZoneVframes(0,a.anim)})},0);e=e||{};d.load(h(e,g.params,e))}})}},unmountView:function(c,b){if(this.view){this.unmountZoneVframes(0,c);this.childrenAlter({});this.view.destroy();var e=a(this.id);
if(!c&&e._bak)e.innerHTML=e._tmpl;c&&b&&this.oldViewDestroy();delete this.view;delete this.viewUsable;this.fire("viewUnmounted");f()}this.un("viewInteract");this.sign--},mountVframe:function(a,c,b,d){var f=this.owner,j=f.get(a);if(!j)j=new e(a),j.pId=this.id,m(this.cM,a)||this.cC++,this.cM[a]=d,f.add(j);j.mountView(c,b);return j},mountZoneVframes:function(c,b,e){this.unmountZoneVframes(c);var c=c?c:a(this.vId)||a(this.id),c=a(c).getElementsByTagName(l),d=c.length,f={};if(d)for(var h=0,g,k,n,C;h<d;h++){g=
c[h];k=g.id||(g.id="magix_vf_"+j--);m(f,k)||(n=g.getAttribute("mx-view"),C=g.getAttribute("mx-defer"),(!C||n)&&this.mountVframe(k,n,b,e));g=a(g).getElementsByTagName(l);k=0;for(n=g.length;k<n;k++)f[g[k].id||(g[k].id="magix_vf_"+j--)]=1}this.cC==this.rC&&this.childrenCreated({})},unmountVframe:function(a,c){var a=a||this.id,b=this.owner,e=b.get(a);if(e){var d=e.fcc;e.unmountView(c);b.remove(a,d);if((b=b.get(e.pId))&&m(b.cM,a))delete b.cM[a],b.cC--}},unmountZoneVframes:function(c){if(c){for(var c=a(c).getElementsByTagName(l),
b={},e=this.cM,d=c.length-1,f;0<=d;d--)f=c[d].id,m(e,f)&&(b[f]=1);c=b}else c=this.cM;for(var j in c)this.unmountVframe(j)},childrenCreated:function(a){var c=this.view;if(c&&!this.fcc)this.fcc=1,delete this.fca,c.fire("created",a),this.fire("created",a);var b=this.owner;b.childCreated();c=this.id;if((b=b.get(this.pId))&&!m(b.rM,c))b.rM[c]=b.cM[c],b.rC++,b.rC==b.cC&&b.childrenCreated(a)},childrenAlter:function(a){delete this.fcc;if(!this.fca){var c=this.view,b=this.id;if(c)this.fca=1,c.fire("alter",
a),this.fire("alter",a);if((c=this.owner.get(this.pId))&&m(c.rM,b)){var e=c.rM[b];c.rC--;delete c.rM[b];e&&c.childrenAlter(a)}}},locationChanged:function(a,c){var b=this.view;if(b&&b.sign&&(b.location=a,b.rendered)){var e=b.olChanged(c),f={location:a,changed:c,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];d.isString(a)&&(a=a.split(","));this.cs=a}};e&&d.safeExec(b.locationChange,f,b);for(var b=f.cs||d.keys(this.cM),e=0,f=b.length,j=this.owner,g;e<f;e++)(g=j.get(b[e]))&&g.locationChanged(a,
c)}},locationUpdated:function(a){var c=this.view;if(c&&c.sign){c.location=a;var c=this.cM,b,e=this.owner,d;for(d in c)(b=e.get(d))&&b.locationUpdated(a)}}});return e},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(g,d,r,k,b){var j=g.Env.mods,f={wrapAsyn:1,extend:1},h=function(a,c,b){for(var e in c)g.isObject(c[e])?(d.has(a,e)||(a[e]={}),h(a[e],c[e],!0)):b&&(a[e]=c[e])},l=d.safeExec,p=d.has,m=[],o=d.config(),a=/^~[^\/]*/,c=d.mix,e=d.listToMap("render,renderUI"),i=function(a){return function(){var c;this.sign&&(this.sign++,this.fire("rendercall"),c=a.apply(this,arguments));return c}},s=function(a){c(this,a);this.sign=1};c(s,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var a=
this.prototype,c,b;for(b in a){c=a[b];var f=null;d.isFunction(c)&&c!=d.noop&&!c["~~"]&&p(e,b)&&(f=i(c),f["~~"]=c,a[b]=f)}}}});var q=s.prototype,B=window.CollectGarbage||d.noop,y=/\smx-[^ohv][a-z]+\s*=/g,w={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},I=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,J=/(\w+):([^,]+)/g;c(q,
r);c(q,{render:d.noop,locationChange:d.noop,init:d.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var a=this,c=a.hasTmpl,b=arguments,e=a.sign,d=function(){if(e==a.sign&&(a.delegateEvents(),a.fire("interact",{tmpl:c},1),l(a.init,b,a),l(a.render,m,a),!c&&!a.rendered))a.rendered=!0,a.fire("primed",null,1)};c&&!p(a,"template")?a.planTmpl(d):d()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var a=this.enableAnim;
this.fire("refresh",0,1);this.fire("prerender",{anim:a});var c=this.owner;a&&(l(c.oldViewDestroy,m,c),l(c.prepareNextView,m,c),this.updateViewId())}},endUpdateHTML:function(){if(this.sign){if(this.rendered&&this.enableAnim){var a=this.owner;l(a.newViewCreated,m,a)}this.rendered||this.fire("primed",null,1);this.rendered=!0;this.fire("rendered");B()}},wrapMxEvent:function(a){return a?(""+a).replace(y,' mx-owner="'+this.vfId+'"$&'):a},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=
this.wrapMxEvent(a);this.endUpdateHTML()},observeLocation:function(a){var c;if(!this.$ol)this.$ol={keys:[]};c=this.$ol;var b=c.keys;if(d.isObject(a))c.pn=a.pathname,a=a.keys;if(a)c.keys=b.concat(d.isString(a)?a.split(","):a)},olChanged:function(a){var c=this.$ol;if(c){var b=0;c.pn&&(b=a.isPathname());b||(b=a.isParam(c.keys));return b}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),
c=null;if(a&&a.viewUsable)c=a.view;return c},planTmpl:function(c){var b=this,e=d.tmpl(b.path);e.h?(b.template=e.v,c()):(e=b.home+b.path.replace(a,"")+".html",b.fetchTmpl(e,function(a){b.template=d.tmpl(b.path,a);c()},o.debug))},processEvent:function(a){if(this.enableEvent&&this.sign){var b=a.se,e=a.info.match(I),d=e[1],i=e[2],e=e[3],f=this.events;if(f){var j=f[b.type];if(w[i])w[i](b);if(j&&j[d]){var g={};e&&e.replace(J,function(a,c,b){g[c]=b});l(j[d],c({view:this,currentId:a.cId,targetId:a.tId,domEvent:b,
events:f,params:g},w),j)}}}},delegateEvents:function(a){var c=this.events,a=a?k.detachEvent:k.attachEvent,b;for(b in c)a.call(k,b)}});s.prototype.fetchTmpl=function(a,c,e){var i=h[a];i?i.push(c):(i=h[a]=[c],b({url:a+(e?"?_="+g.now():""),success:function(c){d.safeExec(i,c);delete h[a]},error:function(a,b){c(b)}}))};s.extend=function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments);c&&d.safeExec(c,arguments,this)};b.extend=this.extend;return g.extend(b,this,a)};s.prepare=function(a,
c){if(!a.wrapAsyn){for(var b in this)d.has(f,b)&&(a[b]=this[b]);b=a.prototype;for(var e=a;e.superclass;)e=e.superclass.constructor,h(b,e.prototype);c.home=j[c.path].packageInfo.getBase();d.mix(b,c)}a.wrapAsyn()};return s},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(g,d,r,k,b){var j=r.has,f=0,h=0,l=0,p=0,m={},o,a=r.mix({all:function(){return m},add:function(c){if(!j(m,c.id))f++,m[c.id]=c,c.owner=a,a.fire("add",{vframe:c})},get:function(a){return m[a]},remove:function(c,b){var d=m[c];d&&(f--,b&&h--,delete m[c],a.fire("remove",{vframe:d}))},childCreated:function(){if(!p){h++;var c=h/f;l<c&&(a.fire("progress",{percent:l=c}),1==c&&(p=1,a.un("progress")))}},root:function(){return d.root(a)},mountRoot:function(c){var b=a.root();o=c.location;
b.mountView(o.view)},locChanged:function(c){o=c.location;a.root().locationChanged(o,c.changed)},locUpdated:function(c){o=c;a.root().locationUpdated(c)},getLoc:function(){return o}},k);b.VOM=a;b.on("event",function(c){var b=a.get(c.hld);(b=b&&b.view)&&b.processEvent(c)});return a},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(g,d,r){var k=d.has,b=d.safeExec,j=function(a){g.isArray(a)||(a=[a]);for(var c=0,b;c<a.length;c++)b=a[c],delete b.cacheKey;return a},f=function(a){this.$modelClass=a;this.$modelsCache=d.createCache();this.$modelsCacheKeys={}},h=[].slice,l={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},p=function(a){var c={},b;for(b in a)l[b]||(c[b]=a[b]);return c},m=function(a,c){var b=h.call(arguments,2);return function(){return a.apply(c,b.concat(h.call(arguments)))}};
d.mix(f,{create:function(a){if(!a)throw Error("MManager.create modelClass ungiven");return new f(a)}});var o=function(a){this.$host=a;this.$task=!1};d.mix(o.prototype,{fetchModels:function(a,c,e){var d=this;if(d.$task)return d.next(function(b){b.fetchModels(a,c,error,e)}),d;d.$task=!0;var f=d.$host;if(!d.$reqModels)d.$reqModels={};var j=f.$modelsCache,h=f.$modelsCacheKeys,l=d.$reqModels;g.isArray(a)||(a=[a]);var p=a.length,o=0,r,n,C=Array(p),z=[],D={},E=[],F=g.isArray(c);F&&(z=Array(c.length));for(var G=
function(a,m,v,t){if(!d.$destroy){o++;delete l[v.id];var u=v._cacheKey;C[a]=v;if(m)n=!0,r=t||r,D[a]=t;else{u&&!j.has(u)&&j.set(u,v);var A=v.metaParams;v._doneAt=g.now();var x=v._context;x&&b(x.after,[v].concat(A),x);f.fireAfter(v._meta.name,[v])}if(2==e)(A=F?c[a]:c)&&(z[a]=b(A,[v,m?{msg:t}:null,n?D:null],d));else if(4==e){E[a]={m:v,e:m,s:t};for(a=E.i||0;A=E[a];a++)if(x=F?c[a]:c,z[a]=b(x,[A.m,A.e?{msg:A.s}:null,E.e?D:null,z],d),A.e)D[a]=A.s,E.e=1;E.i=a}u&&k(h,u)&&(a=h[u],delete h[u],b(a,[m,v,t],v));
if(o>=p)D.msg=r,m=n?D:null,1==e?(C.push(m),z[0]=b(c,C,d),z[1]=m):z.push(m),d.$ntId=setTimeout(function(){d.$task=!1;d.doNext(z)},30)}},u=0,t;u<a.length;u++)if(t=a[u]){var H;H=f.getModel(t);var x=H.cacheKey;x&&k(h,x)?h[x].push(m(G,d,u)):(t=H.entity,H.needUpdate?(l[t.id]=t,x&&(h[x]=[]),t.request({success:m(G,t,u,!1,t),error:m(G,t,u,!0,t)})):G(u,!1,t))}else throw Error("miss attrs:"+a);return d},fetchAll:function(a,c){return this.fetchModels(a,c,1)},saveAll:function(a,c){a=j(a);return this.fetchModels(a,
c,1)},fetchOrder:function(a,c){var b=h.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOrder:function(a,c){var a=j(a),b=h.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,4)},saveOne:function(a,c){var a=j(a),b=h.call(arguments,1);return this.reqModels(a,1<b.length?b:c,2)},fetchOne:function(a,c){var b=h.call(arguments,1);return this.fetchModels(a,1<b.length?b:c,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,c=this.$host.$modelsCacheKeys;if(a)for(var e in a){var d=
a[e],f=d._cacheKey;if(f&&k(c,f)){var j=c[f];delete c[f];b(j,[!0,d,"aborted"],d)}d.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$task||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){var c=this.$queue;c&&(c=c.shift())&&b(c,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});d.mix(f.prototype,{registerModels:function(a){g.isArray(a)||(a=
[a]);for(var c=0,b;c<a.length;c++){b=a[c];if(!b.name)throw Error("model must own a name attribute");this[b.name]=b}},registerMethods:function(a){var c=this,b;for(b in a)c[b]=function(a){return function(){for(var b,e=arguments,d=[],f=0,j;f<e.length;f++)j=e[f],g.isFunction(j)?d.push(function(a){return function(){b||a.apply(a,arguments)}}(j)):d.push(j);var h=a.apply(c,d);return{destroy:function(){b=!0;h&&h.destroy&&h.destroy()}}}}(a[b])},createModel:function(a){var c=this.getModelMeta(a),e=new this.$modelClass(p(c)),
d=a;d.before||(d=c);var f=a.metaParams||[];this.fireBefore(c.name,[e]);g.isFunction(d.before)&&b(d.before,[e].concat(f),d);d=a;d.after||(d=c);if(d.after)e._context=d;e._cacheKey=a.cacheKey||c.cacheKey;e._meta=c;e.set(p(a));e.setUrlParams(c.urlParams);e.setPostParams(c.postParams);e.setUrlParams(a.urlParams);e.setPostParams(a.postParams);e.metaParams=f;return e},getModelMeta:function(a){var c=this[a.name];if(!c)throw Error("Not found:"+a.name);return c},getModel:function(a){var c=this.getModelFromCache(a),
b;c||(b=!0,c=this.createModel(a));return{entity:c,cacheKey:c._cacheKey,needUpdate:b}},saveAll:function(a,c){return(new o(this)).saveAll(a,c)},fetchAll:function(a,c){return(new o(this)).fetchAll(a,c)},saveOrder:function(a,c){var b=new o(this);return b.saveOrder.apply(b,arguments)},fetchOrder:function(a,c){var b=new o(this);return b.fetchOrder.apply(b,arguments)},saveOne:function(a,c){var b=new o(this);return b.saveOne.apply(b,arguments)},fetchOne:function(a,c){var b=new o(this);return b.fetchOne.apply(b,
arguments)},clearCacheByKey:function(a){var c=this.$modelsCache;g.isString(a)&&c.del(a)},clearCacheByName:function(a){for(var c=this.$modelsCache,b=c.c,d=0;d<b.length;d++){var f=b[d].v;(f&&f._meta.name)==a&&c.del(f._cacheKey)}},getModelUrl:function(a){return this.$modelClass.prototype.url((g.isString(a)?this[a]:a).uri)},listenBefore:function(a,c){r.on.call(this,a+"_before",c)},listenAfter:function(a,c){r.on.call(this,a+"_after",c)},unlistenBefore:function(a,c){r.un.call(this,a+"_before",c)},unlistenAfter:function(a,
c){r.un.call(this,a+"_after",c)},fireBefore:function(a,c){r.fire.call(this,a+"_before",c)},fireAfter:function(a,c){r.fire.call(this,a+"_after",c)},getModelFromCache:function(a){var c=this.$modelsCache,b=null,d;if(g.isString(a))d=a;else{var f=this.getModelMeta(a);d=a.cacheKey||f.cacheKey}if(d&&(b=c.get(d))){if(!f)f=b._meta;a=a.cacheTime||f.cacheTime||0;0<a&&g.now()-b._doneAt>a&&(this.clearCacheByKey(d),b=null)}return b}});return f},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(g,d){var r=function(b,j,f){for(var h in j)g.isObject(j[h])?(d.has(b,h)||(b[h]={}),r(b[h],j[h],!0)):f&&(b[h]=j[h])},k=function(b){b&&this.set(b);this.id=g.guid("m")};d.mix(k,{GET:"GET",POST:"POST",extend:function(b,j){var f=function(){f.superclass.constructor.apply(this,arguments);j&&d.safeExec(j,[],this)};d.mix(f,this,{prototype:!0});r(b,this.prototype);return g.extend(f,this,b)}});d.mix(k.prototype,{urlMap:{},sync:d.noop,parse:function(b){return b},getParamsObject:function(b){if(!b)b=
k.GET;return this["$"+b]||null},getUrlParamsObject:function(){return this.getParamsObject(k.GET)},getPostParamsObject:function(){return this.getParamsObject(k.POST)},getPostParams:function(){return this.getParams(k.POST)},getUrlParams:function(){return this.getParams(k.GET)},getParams:function(b){var b=b?b.toUpperCase():k.GET,b=this["$"+b],d=[],f;if(b)for(var h in b)if(f=b[h],g.isArray(f))for(var l=0;l<f.length;l++)d.push(h+"="+encodeURIComponent(f[l]));else d.push(h+"="+encodeURIComponent(f));return d.join("&")},
setUrlParamsIf:function(b,d){this.setParams(b,d,k.GET,!0)},setPostParamsIf:function(b,d){this.setParams(b,d,k.POST,!0)},setParams:function(b,d,f,h){f=f?f.toUpperCase():k.GET;if(!this.$types)this.$types={};this.$types[f]=!0;f="$"+f;this[f]||(this[f]={});if(g.isObject(b))for(var l in b){if(!h||!this[f][l])this[f][l]=b[l]}else if(b&&(!h||!this[f][b]))this[f][b]=d},setPostParams:function(b,d){this.setParams(b,d,k.POST)},setUrlParams:function(b,d){this.setParams(b,d,k.GET)},removeParamsObject:function(b){if(!b)b=
k.GET;delete this["$"+b]},removePostParamsObject:function(){this.removeParamsObject(k.POST)},removeUrlParamsObject:function(){this.removeParamsObject(k.GET)},reset:function(){var b=this.$types;if(b){for(var g in b)d.has(b,g)&&delete this["$"+g];delete this.$types}b=this.$keys;g=this.$attrs;if(b){for(var f=0;f<b.length;f++)delete g[b[f]];delete this.$keys}},url:function(b){var b=b||this.get("uri"),d;if(b){d=b.split(":");var f=this.urlMap;if(f){for(var g=0,k=d.length;g<k&&!(f=f[d[g]],!f);g++);b=f||
b}}else throw Error("model not set uri");return b},get:function(b){var d=this.$attrs;return d?d[b]:null},set:function(b,d,f){if(!this.$attrs)this.$attrs={};if(f&&!this.$keys)this.$keys=[];if(g.isObject(b))for(var h in b)f&&this.$keys.push(h),this.$attrs[h]=b[h];else b&&(f&&this.$keys.push(b),this.$attrs[b]=d)},load:function(b){this.request(b)},save:function(b){this.request(b)},request:function(b){b||(b={});var d=b.success,f=b.error,h=this;h.$abort=!1;b.success=function(b){if(!h.$abort){if(b){var f=
h.parse(b);g.isObject(f)||(f={data:f});h.set(f,null,!0)}d&&d.apply(this,arguments)}};b.error=function(){h.$abort||f&&f.apply(this,arguments)};h.$trans=h.sync(b)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=g.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return k},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(g,d,r,k){var b=window,j="destroy,abort,stop,cancel,remove".split(","),f=0,h=d.safeExec,l=d.has,p={},m=function(a){if(!m.d)m.d=1,a.on("add",function(a){var a=a.vframe,b=p[a.id];if(b){for(var d=0;d<b.length;d++)o(a,b[d]);delete p[a.id]}}),a.on("remove",function(a){delete p[a.vframe.id]}),a.root().on("childrenCreated",function(){p={}})},o=function(a,c){var b=a.view;if(b&&a.viewUsable)h(b.receiveMessage,c,b);else{var d=function(b){a.un("viewInteract",d);h(b.view.receiveMessage,
c,b.view)};a.on("viewInteract",d)}};return r.extend({mxViewCtor:d.noop,navigate:function(){k.navigate.apply(k,arguments)},manage:function(a,c){var b=!0;1==arguments.length&&(c=a,a="res_"+f++,b=!1);if(!this.$res)this.$res={};this.$res[a]={hasKey:b,res:c};return c},getManaged:function(a){var c=this.$res;return c&&l(c,a)?c[a].res:null},removeManaged:function(a){var c=null,b=this.$res;if(b)if(l(b,a))c=b[a].res,delete b[a];else for(var d in b)if(b[d].res===a){c=b[d].res;delete b[d];break}return c},destroyManaged:function(a){var c=
this.$res;if(c){for(var e in c){var f=c[e],k=f.res;if(d.isNumber(k))b.clearTimeout(k),b.clearInterval(k);else if(k)if(k.nodeType&&k.parentNode)g.one(k).remove();else for(var l=0;l<j.length;l++)d.isFunction(k[j[l]])&&h(k[j[l]],[],k);a&&!f.hasKey&&delete c[e]}a||delete this.$res}},receiveMessage:d.noop,postMessageTo:function(a,c){var b=this.vom;m(b);d.isArray(a)||(a=[a]);c||(c={});for(var f=0,g;f<a.length;f++){g=a[f];var h=b.get(g);h?o(h,c):(p[g]||(p[g]=[]),p[g].push(c))}},destroyMRequest:function(){var a=
this.$res;if(a)for(var b in a){var d=a[b].res;d&&d.fetchOne&&d.fetchAll&&(d.destroy(),delete a[b])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(g){var d=function(){};if(!g.console)g.console={log:d,info:d,error:d};var r,k={};if(!g.Magix)g.Magix={config:function(b){for(var d in b)k[d]=b[d]},start:function(b){r=b}},KISSY.use("magix/magix",function(b,d){g.Magix=d;d.config(k);r&&d.start(r)})})(this);