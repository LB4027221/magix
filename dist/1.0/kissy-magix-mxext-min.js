KISSY.add("magix/body",function(h,e,r,k){var c={},j=e.has,h=e.mix,f=e.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),g=document.body,l={},q={},m=65536,o=function(b,a,d){d?b.setAttribute(a,d):d=b.getAttribute(a);return d},e=h({processEvent:function(b){for(var a=b.target||b.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var d=a,i=b.type,c=q[i]||(q[i]=RegExp("(?:^|,)"+i+"(?:,|$)"));if(!c.test(o(a,"mx-ie"))){for(var p="mx-"+i,e,f,k=[];d&&d!=g&&!(e=o(d,p),f=o(d,"mx-ie"),e||c.test(f));)k.push(d),
d=d.parentNode;if(e){i=o(d,"mx-owner");if(!i){c=d;for(f=this.VOM.all();c&&c!=g;)if(j(f,c.id)){o(d,"mx-owner",i=c.id);break}else c=c.parentNode}if(i)this.fire("event",{info:e,se:b,tId:a.id||(a.id="mx-e-"+m--),cId:d.id||(d.id="mx-e-"+m--),hld:i});else throw Error("miss mx-owner:"+e);}else for(;k.length;)b=k.shift(),f=o(b,"mx-ie"),c.test(f)||(f=f?f+","+i:i,o(b,"mx-ie",f))}},attachEvent:function(b){var a=this;if(l[b])l[b]++;else if(l[b]=1,f[b])a.onUnbubble(g,b);else g["on"+b]=function(b){(b=b||window.event)&&
a.processEvent(b)}},detachEvent:function(b){var a=l[b];0<a&&(a--,a||(f[b]?this.offUnbubble(g,b):g["on"+b]=null),l[b]=a)}},r);e.onUnbubble=function(b,a){var d=this;k.delegate(b,a,"*[mx-"+a+"]",c[a]=function(a){d.processEvent(a)})};e.offUnbubble=function(b,a){k.undelegate(b,a,"*[mx-"+a+"]",c[a]);delete c[a]};return e},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/event",function(h,e){var r=e.safeExec;return{fire:function(e,c,j,f){var g="~"+e,h=this[g];if(h){c||(c={});if(!c.type)c.type=e;for(var e=h.length,q=e-1,m,o;e--;)m=f?e:q-e,o=h[m],o.d&&(h.splice(m,1),q--),r(o,c,this)}j&&delete this[g]},on:function(h,c,j){h="~"+h;this[h]||(this[h]=[]);e.isNumeric(j)?this[h].splice(j,0,c):(c.d=j,this[h].push(c))},un:function(h,c){e.isArray(h)||(h=[h]);for(var j=0,f=h.length;j<f;j++){var g="~"+h[j],l=this[g];if(l)if(c)for(var g=0,q=l.length;g<q;g++){if(l[g]==
c){l.splice(g,1);break}}else delete this[g]}}}},{requires:["magix/magix"]});
KISSY.add("magix/magix",function(h){var e=[].slice,r=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,k=/[^\/]*$/,c=/[#?].*$/,j=/([^=&?\/#]+)=([^&=#?]*)/g,f=/^https?:\/\//i,g={},l=0,q={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},m=g.hasOwnProperty,o=function(a){return function(b,n,c){switch(arguments.length){case 0:c=a;break;case 1:c=v.isObject(b)?i(a,b):d(a,b)?a[b]:null;break;case 2:null===n?(delete a[b],c=n):a[b]=c=n}return c}},b=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new b(a)},d=function(a,b){return a?m.call(a,b):0},i=function(a,b,n){for(var c in b)if(!n||!d(n,c))a[c]=b[c];return a};i(b.prototype,{get:function(a){var b=this.c,n,a="pathname"+a;if(d(b,a)&&(n=b[a],1<=n.f))n.f++,n.t=l++,n=n.v;return n},set:function(a,b){var n=this.c,a="pathname"+a,c=n[a];if(!d(n,a)){if(n.length>=this.b){n.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var i=this.b-this.x;i--;)c=n.pop(),delete n[c.k]}c={};n.push(c);n[a]=
c}c.k=a;c.v=b;c.f=1;c.t=l++;return c},del:function(a){var a="pathname"+a,b=this.c,n=b[a];if(n)n.f=-1E5,n.v="",delete b[a]},has:function(a){return d(this.c,"pathname"+a)}});var s=a(60),p=a(),B=function(a,b,n,c,d,i){v.isArray(a)||(a=[a]);if(!b||!v.isArray(b)&&!b.callee)b=[b];for(c=0;c<a.length;c++)try{i=a[c],d=v.isFunction(i)&&i.apply(n,b)}catch(e){}return d},x=function(){},v={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:i,has:d,safeExec:B,noop:x,config:o(q),start:function(a){var b=
this,a=i(q,a);b.libEnv(a);var c=a.iniFile.replace("~",a.appName);b.libRequire(c,function(c){q=i(a,c,a);var d=a.progress;b.libRequire(["magix/router","magix/vom"],function(c,n){c.on("changed",function(a){a.loc?n.locUpdated(a.loc):a.changed.isView()?n.mountRoot(a):n.locChanged(a)});n.on("progress",d||x);b.libRequire(a.extensions,function(){c.start()})})});a.ready&&(B(a.ready),delete a.ready)},keys:Object.keys||function(a){var b=[],c;for(c in a)d(a,c)&&b.push(c);return b},local:o({}),path:function(a,
b){var d=a+"\n"+b,i=p.get(d);if(!i){a=a.replace(c,"").replace(k,"");"/"==b.charAt(0)?(i=a.indexOf("://"),-1==i?i=b:(i=a.indexOf("/",i+3),i=-1==i?a+b:a.substring(0,i)+b)):i=a+b;for(;r.test(i);)i=i.replace(r,"$1/");p.set(d,i)}return i},pathToObject:function(a,b){var d=s.get(a);if(!d){var d={},i={},e="";c.test(a)?e=a.replace(c,""):~a.indexOf("=")||(e=a);if(e&&f.test(e))var p=e.indexOf("/",8),e=-1==p?"/":e.substring(p);a.replace(j,function(a,c,d){if(b)try{d=decodeURIComponent(d)}catch(n){}i[c]=d});d.pathname=
e;d.params=i;s.set(a,d)}return d},objectToPath:function(a,b){var c=a.pathname,d=[],i=a.params,e,s;for(s in i)e=i[s],b&&encodeURIComponent(e),d.push(s+"="+e);return c+(c&&d.length?"?":"")+d.join("&")},tmpl:function(a,b){return 1==arguments.length?{v:g[a],h:d(g,a)}:g[a]=b},listToMap:function(a,b){var c,d,i={},e;this.isString(a)&&(a=a.split(","));if(a&&(e=a.length))for(c=0;c<e;c++)d=a[c],i[b?d[b]:d]=b?d:1;return i},createCache:a};return i(v,{libRequire:function(a,b){if(a){var c=this.isFunction(b),d=
this.isArray(a);h.use(d?a.join(","):a,c?function(a){b.apply(a,e.call(arguments,1))}:this.noop)}else b()},libEnv:function(a){var b=a.appHome,c=location,d=c.protocol,i=a.appName;~b.indexOf(d)||(b=this.path(c.href,b));h.endsWith(b,"/")||(b+="/");a.appHome=b;var e=a.debug;e&&(e=0==b.indexOf(d+"//"+c.host));"~"==i.charAt(0)&&h.config({map:[[RegExp("/"+i+"/"),"/"]]});c="";(c=e?h.now():a.appTag)&&(c+=".js");d=a.appCombine;h.isUndefined(d)&&(d=h.config("combine"));h.config({packages:[{name:i,path:b,debug:a.debug=
e,combine:d,tag:c}]})},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber})});
KISSY.add("magix/router",function(h,e,r,k){var c=window,j=e.has,f=e.mix,g=document,l=/^UTF-8$/i.test(g.charset||g.characterSet||"UTF-8"),q=e.config(),m=e.createCache(),o=e.createCache(),b,a,d,i=65536,s=/#.*$/,p=/^[^#]*#?!?/,B=q.nativeHistory,x,v,I=function(a,b,c){if(a){c=this.params;e.isArray(a)||(a=a.split(","));for(var d=0;d<a.length&&!(b=j(c,a[d]));d++);}return b},J=function(){return j(this,"pathname")},n=function(){return j(this,"view")},C=function(){return this.hash.pathname!=this.query.pathname},
y=function(a){return this.hash.params[a]!=this.query.params[a]},D=function(a){return j(this.hash.params,a)},E=function(a){return j(this.query.params,a)},F=function(a){return this.params[a]},h=f({getView:function(a){if(!d){d={routes:q.routes||{},e404:q.notFoundView};var b=q.defaultView;if(!b)throw Error("unset defaultView");d.home=b;var c=q.defaultPathname||"";d.routes[c]=b;d.pathname=c}a||(a=d.pathname);b=d.routes;b=e.isFunction(b)?b.call(q,a):b[a];return{view:b?b:d.e404||d.home,pathname:b?a:d.e404?
a:d.pathname}},start:function(){var a=c.history;x=B&&a.pushState;v=B&&!x;x?this.useState():this.useHash();this.route()},parsePath:function(a){var a=e.pathToObject(a,l),b=a.pathname;b&&"/"!=b.charAt(0)&&v&&(a.pathname=e.path(c.location.pathname,b));return a},parseQH:function(a){var a=a||c.location.href,b=m.get(a);if(!b){var b=a.replace(s,""),d=a.replace(p,""),i=this.parsePath(b),n=this.parsePath(d),e={};f(e,i.params);f(e,n.params);b={pathnameDiff:C,paramDiff:y,hashOwn:D,queryOwn:E,get:F,href:a,srcQuery:b,
srcHash:d,query:i,hash:n,params:e};m.set(a,b)}return b},parseLoc:function(a){a=this.parseQH(a);if(!a.view){var b=this.getView(B?a.hash.pathname||a.query.pathname:a.hash.pathname);f(a,b)}return a},getChged:function(a,b){var c=b.href,d=a.href+"\n"+c,i=o.get(d);i||(d=c+"\n"+d,i=o.get(d));if(!i){var e,i={params:{}};if(a.pathname!=b.pathname)e=i.pathname=1;if(a.view!=b.view)e=i.view=1;var c=a.params,s=b.params,p;for(p in c)c[p]!=s[p]&&(e=1,i.params[p]=1);for(p in s)c[p]!=s[p]&&(e=1,i.params[p]=1);i.occur=
e;i.isParam=I;i.isPathname=J;i.isView=n;o.set(d,i)}return i},route:function(){var c=this.parseLoc(),d=a||{params:{},href:"~"},i=!a;a=c;d=this.getChged(d,c);d.occur&&(b=c,this.fire("changed",{location:c,changed:d,force:i}))},navigate2:function(a){if(a&&e.isString(a)){var c=this.parsePath(a),a={};a.params=f({},c.params);a.pathname=c.pathname;if(a.pathname){if(v&&(c=b.query)&&(c=c.params))for(var d in c)j(c,d)&&!j(a.params,d)&&(a.params[d]="")}else d=f({},b.params),a.params=f(d,a.params),a.pathname=
b.pathname;d=e.objectToPath(a);if(x?d!=b.srcQuery:d!=b.srcHash)x?(this.$firedPop=1,history.pushState(i--,g.title,d),this.route()):(f(a,b,a),a.srcHash=d,a.hash={params:a.params,pathname:a.pathname},this.fire("changed",{loc:b=a}),location.hash="#!"+d)}},navigate:function(a,b){!b&&e.isObject(a)&&(b=a,a="");b&&(a=e.objectToPath({params:b,pathname:a},l));this.navigate2(a)}},r);h.useState=function(){var a=this,b=location.href;k.on(c,"popstate",function(){var d=location.href==b;if(a.$firedPop||!d)a.$firedPop=
!0,a.route()})};h.useHash=function(){var a=this;k.on(c,"hashchange",function(){a.route()})};return h},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(h,e,r,k){var c=document,j=65536,f=window.CollectGarbage||e.noop,g=e.mix,h=e.config(),l=h.tagName,q=h.rootId,m=e.has,o,b=function(a){return"object"==typeof a?a:c.getElementById(a)};c.createElement(l);var a=/<script[^>]*>[\s\S]*?<\/script>/ig,d=function(a){this.id=a;this.vId=a+"_v";this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};g(d,{root:function(a){if(!o){var e=b(q);if(!e)e=c.createElement(l),e.id=q,c.body.insertBefore(e,c.body.firstChild);o=new d(q);
a.add(o)}return o}});g(g(d.prototype,r),{useAnimUpdate:e.noop,oldViewDestroy:e.noop,prepareNextView:e.noop,newViewCreated:e.noop,mountView:function(d,c){var p=this,f=b(p.id);f._bak?f._chgd=1:(f._bak=1,f._tmpl=f.innerHTML.replace(a,""));var j=p.viewUsable&&p.useAnimUpdate();p.unmountView(j,1);if(d){var h=e.pathToObject(d),l=h.pathname,o=--p.sign;e.libRequire(l,function(a){if(o==p.sign){var d=p.owner;k.prepare(a,{$:b,path:l,vom:d});var i;j?(i=p.vId,p.prepareNextView()):i=p.id;var e=new a({owner:p,id:i,
vId:p.vId,vfId:p.id,location:d.getLoc()});p.view=e;e.on("interact",function(a){p.fire("viewInteract",{view:e});p.viewUsable=1;j&&p.newViewCreated(1);if(!a.tmpl){if(!j&&f._chgd)f.innerHTML=f._tmpl;p.mountZoneVframes(0,0,1)}e.on("rendered",function(){p.mountZoneVframes(0,0,1)});e.on("prerender",function(a){p.unmountZoneVframes(0,a.anim)})},0);c=c||{};e.load(g(c,h.params,c))}})}},unmountView:function(a,d){if(this.view){this.unmountZoneVframes(0,a);this.childrenAlter({});this.view.destroy();var c=b(this.id);
if(!a&&c._bak)c.innerHTML=c._tmpl;a&&d&&this.oldViewDestroy();delete this.view;delete this.viewUsable;this.fire("viewUnmounted");f()}this.un("viewInteract");this.sign--},mountVframe:function(a,b,c,e){var f=this.owner,j=f.get(a);if(!j)j=new d(a),j.pId=this.id,m(this.cM,a)||this.cC++,this.cM[a]=e,f.add(j);j.mountView(b,c);return j},mountZoneVframes:function(a,d,c){this.unmountZoneVframes(a);var a=a?a:b(this.vId)||b(this.id),a=b(a).getElementsByTagName(l),e=a.length,f={};if(e)for(var h=0,g,k,n,C;h<e;h++){g=
a[h];k=g.id||(g.id="magix_vf_"+j--);m(f,k)||(n=g.getAttribute("mx-view"),C=g.getAttribute("mx-defer"),(!C||n)&&this.mountVframe(k,n,d,c));g=b(g).getElementsByTagName(l);k=0;for(n=g.length;k<n;k++)f[g[k].id||(g[k].id="magix_vf_"+j--)]=1}this.cC==this.rC&&this.childrenCreated({})},unmountVframe:function(a,b){var a=a||this.id,d=this.owner,c=d.get(a);if(c){var e=c.fcc;c.unmountView(b);d.remove(a,e);if((d=d.get(c.pId))&&m(d.cM,a))delete d.cM[a],d.cC--}},unmountZoneVframes:function(a){if(a){for(var a=b(a).getElementsByTagName(l),
d={},c=this.cM,e=a.length-1,f;0<=e;e--)f=a[e].id,m(c,f)&&(d[f]=1);a=d}else a=this.cM;for(var j in a)this.unmountVframe(j)},childrenCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;d.childCreated();b=this.id;if((d=d.get(this.pId))&&!m(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.childrenCreated(a)},childrenAlter:function(a){delete this.fcc;if(!this.fca){var b=this.view,d=this.id;if(b)this.fca=1,b.fire("alter",
a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&m(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.childrenAlter(a)}}},locationChanged:function(a,b){var d=this.view;if(d&&d.sign&&(d.location=a,d.rendered)){var c=d.olChanged(b),f={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];e.isString(a)&&(a=a.split(","));this.cs=a}};c&&e.safeExec(d.locationChange,f,d);for(var d=f.cs||e.keys(this.cM),c=0,f=d.length,j=this.owner,g;c<f;c++)(g=j.get(d[c]))&&g.locationChanged(a,
b)}},locationUpdated:function(a){var b=this.view;if(b&&b.sign){b.location=a;var b=this.cM,d,c=this.owner,e;for(e in b)(d=c.get(e))&&d.locationUpdated(a)}}});return d},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(h,e,r,k,c){var j=h.Env.mods,f={wrapAsyn:1,extend:1},g=function(a,b,d){for(var c in b)h.isObject(b[c])?(e.has(a,c)||(a[c]={}),g(a[c],b[c],!0)):d&&(a[c]=b[c])},l=e.safeExec,q=e.has,m=[],o=e.config(),b=/^~[^\/]*/,a=e.mix,d=e.listToMap("render,renderUI"),i=function(a){return function(){var b;this.sign&&(this.sign++,this.fire("rendercall"),b=a.apply(this,arguments));return b}},s=function(b){a(this,b);this.sign=1};a(s,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var a=
this.prototype,b,c;for(c in a){b=a[c];var f=null;e.isFunction(b)&&b!=e.noop&&!b["~~"]&&q(d,c)&&(f=i(b),f["~~"]=b,a[c]=f)}}}});var p=s.prototype,B=window.CollectGarbage||e.noop,x=/\smx-[^ohv][a-z]+\s*=/g,v={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},I=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,J=/(\w+):([^,]+)/g;a(p,
r);a(p,{render:e.noop,locationChange:e.noop,init:e.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var a=this,b=a.hasTmpl,d=arguments,c=a.sign,e=function(){if(c==a.sign&&(a.delegateEvents(),a.fire("interact",{tmpl:b},1),l(a.init,d,a),l(a.render,m,a),!b&&!a.rendered))a.rendered=!0,a.fire("primed",null,1)};b&&!q(a,"template")?a.planTmpl(e):e()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var a=this.enableAnim;
this.fire("refresh",0,1);this.fire("prerender",{anim:a});var b=this.owner;a&&(l(b.oldViewDestroy,m,b),l(b.prepareNextView,m,b),this.updateViewId())}},endUpdateHTML:function(){if(this.sign){if(this.rendered&&this.enableAnim){var a=this.owner;l(a.newViewCreated,m,a)}this.rendered||this.fire("primed",null,1);this.rendered=!0;this.fire("rendered");B()}},wrapMxEvent:function(a){return a?(""+a).replace(x,' mx-owner="'+this.vfId+'"$&'):a},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=
this.wrapMxEvent(a);this.endUpdateHTML()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(e.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat(e.isString(a)?a.split(","):a)},olChanged:function(a){var b=this.$ol;if(b){var d=0;b.pn&&(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),
b=null;if(a&&a.viewUsable)b=a.view;return b},planTmpl:function(a){var d=this,c=e.tmpl(d.path);c.h?(d.template=c.v,a()):(c=d.home+d.path.replace(b,"")+".html",d.fetchTmpl(c,function(b){d.template=e.tmpl(d.path,b);a()},o.debug))},processEvent:function(b){if(this.enableEvent&&this.sign){var d=b.se,c=b.info.match(I),e=c[1],i=c[2],c=c[3],f=this.events;if(f){var j=f[d.type];if(v[i])v[i](d);if(j&&j[e]){var g={};c&&c.replace(J,function(a,b,d){g[b]=d});l(j[e],a({view:this,currentId:b.cId,targetId:b.tId,domEvent:d,
events:f,params:g},v),j)}}}},delegateEvents:function(a){var b=this.events,a=a?k.detachEvent:k.attachEvent,d;for(d in b)a.call(k,d)}});s.prototype.fetchTmpl=function(a,b,d){var i=g[a];i?i.push(b):(i=g[a]=[b],c({url:a+(d?"?_="+h.now():""),success:function(b){e.safeExec(i,b);delete g[a]},error:function(a,d){b(d)}}))};s.extend=function(a,b){var d=function(){d.superclass.constructor.apply(this,arguments);b&&e.safeExec(b,arguments,this)};d.extend=this.extend;return h.extend(d,this,a)};s.prepare=function(a,
b){if(!a.wrapAsyn){for(var d in this)e.has(f,d)&&(a[d]=this[d]);d=a.prototype;for(var c=a;c.superclass;)c=c.superclass.constructor,g(d,c.prototype);b.home=j[b.path].packageInfo.getBase();e.mix(d,b)}a.wrapAsyn()};return s},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(h,e,r,k,c){var j=r.has,f=0,g=0,l=0,q=0,m={},o,b=r.mix({all:function(){return m},add:function(a){if(!j(m,a.id))f++,m[a.id]=a,a.owner=b,b.fire("add",{vframe:a})},get:function(a){return m[a]},remove:function(a,d){var c=m[a];c&&(f--,d&&g--,delete m[a],b.fire("remove",{vframe:c}))},childCreated:function(){if(!q){g++;var a=g/f;l<a&&(b.fire("progress",{percent:l=a}),1==a&&(q=1,b.un("progress")))}},root:function(){return e.root(b)},mountRoot:function(a){var d=b.root();o=a.location;
d.mountView(o.view)},locChanged:function(a){o=a.location;b.root().locationChanged(o,a.changed)},locUpdated:function(a){o=a;b.root().locationUpdated(a)},getLoc:function(){return o}},k);c.VOM=b;c.on("event",function(a){var d=b.get(a.hld);(d=d&&d.view)&&d.processEvent(a)});return b},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(h,e,r){var k=e.has,c=e.safeExec,j=function(b){h.isArray(b)||(b=[b]);for(var a=0,d;a<b.length;a++)d=b[a],delete d.cacheKey;return b},f=function(b){this.$modelClass=b;this.$modelsCache=e.createCache();this.$modelsCacheKeys={}},g=[].slice,l={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},q=function(b){var a={},d;for(d in b)l[d]||(a[d]=b[d]);return a},m=function(b,a){var d=g.call(arguments,2);return function(){return b.apply(a,d.concat(g.call(arguments)))}};
e.mix(f,{create:function(b){if(!b)throw Error("MManager.create modelClass ungiven");return new f(b)}});var o=function(b){this.$host=b;this.$task=!1};e.mix(o.prototype,{fetchModels:function(b,a,d){var e=this;if(e.$task)return e.next(function(c){c.fetchModels(b,a,error,d)}),e;e.$task=!0;var f=e.$host;if(!e.$reqModels)e.$reqModels={};var j=f.$modelsCache,g=f.$modelsCacheKeys,l=e.$reqModels;h.isArray(b)||(b=[b]);var o=b.length,q=0,r,n,C=Array(o),y=[],D={},E=[],F=h.isArray(a);F&&(y=Array(a.length));for(var G=
function(b,m,w,t){if(!e.$destroy){q++;delete l[w.id];var u=w._cacheKey;C[b]=w;if(m)n=!0,r=t||r,D[b]=t;else{u&&!j.has(u)&&j.set(u,w);w._doneAt=h.now();var A=w._after,z=w._meta;A&&c(A,[w,z]);f.fireAfter(z.name,[w])}if(2==d)(A=F?a[b]:a)&&(y[b]=c(A,[w,m?{msg:t}:null,n?D:null],e));else if(4==d){E[b]={m:w,e:m,s:t};for(b=E.i||0;A=E[b];b++)if(z=F?a[b]:a,y[b]=c(z,[A.m,A.e?{msg:A.s}:null,E.e?D:null,y],e),A.e)D[b]=A.s,E.e=1;E.i=b}u&&k(g,u)&&(b=g[u],delete g[u],c(b,[m,w,t],w));if(q>=o)D.msg=r,m=n?D:null,1==d?
(C.push(m),y[0]=c(a,C,e),y[1]=m):y.push(m),e.$ntId=setTimeout(function(){e.$task=!1;e.doNext(y)},30)}},u=0,t;u<b.length;u++)if(t=b[u]){var H;H=f.getModel(t);var z=H.cacheKey;z&&k(g,z)?g[z].push(m(G,e,u)):(t=H.entity,H.needUpdate?(l[t.id]=t,z&&(g[z]=[]),t.request({success:m(G,t,u,!1,t),error:m(G,t,u,!0,t)})):G(u,!1,t))}else throw Error("miss attrs:"+b);return e},fetchAll:function(b,a){return this.fetchModels(b,a,1)},saveAll:function(b,a){b=j(b);return this.fetchModels(b,a,1)},fetchOrder:function(b,
a){var d=g.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,4)},saveOrder:function(b,a){var b=j(b),d=g.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,4)},saveOne:function(b,a){var b=j(b),d=g.call(arguments,1);return this.reqModels(b,1<d.length?d:a,2)},fetchOne:function(b,a){var d=g.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,2)},abort:function(){clearTimeout(this.$ntId);var b=this.$reqModels,a=this.$host.$modelsCacheKeys;if(b)for(var d in b){var e=b[d],f=e._cacheKey;
if(f&&k(a,f)){var g=a[f];delete a[f];c(g,[!0,e,"aborted"],e)}e.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(b){if(!this.$queue)this.$queue=[];this.$queue.push(b);this.$task||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(b){var a=this.$queue;a&&(a=a.shift())&&c(a,[this].concat(b),this);this.$latest=b},destroy:function(){this.$destroy=!0;this.abort()}});e.mix(f.prototype,{registerModels:function(b){h.isArray(b)||(b=[b]);for(var a=0,d;a<
b.length;a++){d=b[a];if(!d.name)throw Error("model must own a name attribute");this[d.name]=d}},registerMethods:function(b){var a=this,d;for(d in b)a[d]=function(b){return function(){for(var d,c=arguments,e=[],f=0,g;f<c.length;f++)g=c[f],h.isFunction(g)?e.push(function(a){return function(){d||a.apply(a,arguments)}}(g)):e.push(g);var j=b.apply(a,e);return{destroy:function(){d=!0;j&&j.destroy&&j.destroy()}}}}(b[d])},createModel:function(b){var a=this.getModelMeta(b),d=new this.$modelClass(q(a)),e=b.before||
a.before;this.fireBefore(a.name,[d]);h.isFunction(e)&&c(e,[d,a,b]);d._after=b.after||a.after;d._cacheKey=b.cacheKey||a.cacheKey;d._meta=a;d.set(q(b));d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);return d},getModelMeta:function(b){var a=this[b.name];if(!a)throw Error("Not found:"+b.name);return a},getModel:function(b){var a=this.getModelFromCache(b),d;a||(d=!0,a=this.createModel(b));return{entity:a,cacheKey:a._cacheKey,needUpdate:d}},
saveAll:function(b,a){return(new o(this)).saveAll(b,a)},fetchAll:function(b,a){return(new o(this)).fetchAll(b,a)},saveOrder:function(b,a){var d=new o(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(b,a){var d=new o(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(b,a){var d=new o(this);return d.saveOne.apply(d,arguments)},fetchOne:function(b,a){var d=new o(this);return d.fetchOne.apply(d,arguments)},clearCacheByKey:function(b){var a=this.$modelsCache;h.isString(b)&&
a.del(b)},clearCacheByName:function(b){for(var a=this.$modelsCache,d=a.c,c=0;c<d.length;c++){var e=d[c].v;(e&&e._meta.name)==b&&a.del(e._cacheKey)}},getModelUrl:function(b){return this.$modelClass.prototype.url((h.isString(b)?this[b]:b).uri)},listenBefore:function(b,a){r.on.call(this,b+"_before",a)},listenAfter:function(b,a){r.on.call(this,b+"_after",a)},unlistenBefore:function(b,a){r.un.call(this,b+"_before",a)},unlistenAfter:function(b,a){r.un.call(this,b+"_after",a)},fireBefore:function(b,a){r.fire.call(this,
b+"_before",a)},fireAfter:function(b,a){r.fire.call(this,b+"_after",a)},getModelFromCache:function(b){var a=this.$modelsCache,d=null,c;if(h.isString(b))c=b;else{var e=this.getModelMeta(b);c=b.cacheKey||e.cacheKey}if(c&&(d=a.get(c))){if(!e)e=d._meta;b=b.cacheTime||e.cacheTime||0;0<b&&h.now()-d._doneAt>b&&(this.clearCacheByKey(c),d=null)}return d}});return f},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(h,e){var r=function(c,j,f){for(var g in j)h.isObject(j[g])?(e.has(c,g)||(c[g]={}),r(c[g],j[g],!0)):f&&(c[g]=j[g])},k=function(c){c&&this.set(c);this.id=h.guid("m")};e.mix(k,{GET:"GET",POST:"POST",extend:function(c,j){var f=function(){f.superclass.constructor.apply(this,arguments);j&&e.safeExec(j,[],this)};e.mix(f,this,{prototype:!0});r(c,this.prototype);return h.extend(f,this,c)}});e.mix(k.prototype,{urlMap:{},sync:e.noop,parse:function(c){return c},getParamsObject:function(c){if(!c)c=
k.GET;return this["$"+c]||null},getUrlParamsObject:function(){return this.getParamsObject(k.GET)},getPostParamsObject:function(){return this.getParamsObject(k.POST)},getPostParams:function(){return this.getParams(k.POST)},getUrlParams:function(){return this.getParams(k.GET)},getParams:function(c){var c=c?c.toUpperCase():k.GET,c=this["$"+c],e=[],f;if(c)for(var g in c)if(f=c[g],h.isArray(f))for(var l=0;l<f.length;l++)e.push(g+"="+encodeURIComponent(f[l]));else e.push(g+"="+encodeURIComponent(f));return e.join("&")},
setUrlParamsIf:function(c,e){this.setParams(c,e,k.GET,!0)},setPostParamsIf:function(c,e){this.setParams(c,e,k.POST,!0)},setParams:function(c,e,f,g){f=f?f.toUpperCase():k.GET;if(!this.$types)this.$types={};this.$types[f]=!0;f="$"+f;this[f]||(this[f]={});if(h.isObject(c))for(var l in c){if(!g||!this[f][l])this[f][l]=c[l]}else if(c&&(!g||!this[f][c]))this[f][c]=e},setPostParams:function(c,e){this.setParams(c,e,k.POST)},setUrlParams:function(c,e){this.setParams(c,e,k.GET)},removeParamsObject:function(c){if(!c)c=
k.GET;delete this["$"+c]},removePostParamsObject:function(){this.removeParamsObject(k.POST)},removeUrlParamsObject:function(){this.removeParamsObject(k.GET)},reset:function(){var c=this.$types;if(c){for(var j in c)e.has(c,j)&&delete this["$"+j];delete this.$types}c=this.$keys;j=this.$attrs;if(c){for(var f=0;f<c.length;f++)delete j[c[f]];delete this.$keys}},url:function(c){var c=c||this.get("uri"),e;if(c){e=c.split(":");var f=this.urlMap;if(f){for(var g=0,h=e.length;g<h&&!(f=f[e[g]],!f);g++);c=f||
c}}else throw Error("model not set uri");return c},get:function(c){var e=this.$attrs;return e?e[c]:null},set:function(c,e,f){if(!this.$attrs)this.$attrs={};if(f&&!this.$keys)this.$keys=[];if(h.isObject(c))for(var g in c)f&&this.$keys.push(g),this.$attrs[g]=c[g];else c&&(f&&this.$keys.push(c),this.$attrs[c]=e)},load:function(c){this.request(c)},save:function(c){this.request(c)},request:function(c){c||(c={});var e=c.success,f=c.error,g=this;g.$abort=!1;c.success=function(c){if(!g.$abort){if(c){var f=
g.parse(c);h.isObject(f)||(f={data:f});g.set(f,null,!0)}e&&e.apply(this,arguments)}};c.error=function(){g.$abort||f&&f.apply(this,arguments)};g.$trans=g.sync(c)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=h.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return k},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(h,e,r,k){var c=window,j=function(a){c.clearTimeout(a);c.clearInterval(a)},f=function(a){l(a.destroy,[],a)},g=0,l=e.safeExec,q=e.has,m={},o=function(a){if(!o.d)o.d=1,a.on("add",function(a){var a=a.vframe,c=m[a.id];if(c){for(var e=0;e<c.length;e++)b(a,c[e]);delete m[a.id]}}),a.on("remove",function(a){delete m[a.vframe.id]}),a.root().on("childrenCreated",function(){m={}})},b=function(a,b){var c=a.view;if(c&&a.viewUsable)l(c.receiveMessage,b,c);else{var e=function(c){a.un("viewInteract",
e);l(c.view.receiveMessage,b,c.view)};a.on("viewInteract",e)}};return r.extend({mxViewCtor:e.noop,navigate:function(){k.navigate.apply(k,arguments)},manage:function(a,b){var c=!0;1==arguments.length&&(b=a,a="res_"+g++,c=!1);if(!this.$res)this.$res={};var e;h.isNumber(b)?e=j:b&&b.destroy&&(e=f);this.$res[a]={hasKey:c,res:b,destroy:e};return b},getManaged:function(a){var b=this.$res;return b&&q(b,a)?b[a].res:null},removeManaged:function(a){var b=null,c=this.$res;if(c)if(q(c,a))b=c[a].res,delete c[a];
else for(var e in c)if(c[e].res===a){b=c[e].res;delete c[e];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);a&&!e.hasKey&&delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}a||delete this.$res}},receiveMessage:e.noop,postMessageTo:function(a,c){var f=this.vom;o(f);e.isArray(a)||(a=[a]);c||(c={});for(var g=0,h;g<a.length;g++){h=a[g];var j=f.get(h);j?b(j,c):(m[h]||(m[h]=[]),m[h].push(c))}},destroyMRequest:function(){var a=
this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(h){var e=function(){};if(!h.console)h.console={log:e,info:e,error:e};var r,k={};if(!h.Magix)h.Magix={config:function(c){for(var e in c)k[e]=c[e]},start:function(c){r=c}},KISSY.use("magix/magix",function(c,e){h.Magix=e;e.config(k);r&&e.start(r)})})(this);