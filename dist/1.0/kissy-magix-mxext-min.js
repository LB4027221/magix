KISSY.add("magix/body",function(f,e,s,q){var c={},l=e.has,f=e.mix,g=e.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),h=document.body,m={},r={},n=65536,o=function(b,a,d){d?b.setAttribute(a,d):d=b.getAttribute(a);return d},e=f({processEvent:function(b){for(var a=b.target||b.srcElement;a&&1!=a.nodeType;)a=a.parentNode;var d=a,c=b.type,i=r[c]||(r[c]=RegExp("(?:^|,)"+c+"(?:,|$)"));if(!i.test(o(a,"mx-ie"))){for(var e="mx-"+c,p,g,f=[];d&&d!=h&&!(p=o(d,e),g=o(d,"mx-ie"),p||i.test(g));)f.push(d),
d=d.parentNode;if(p){c=o(d,"mx-owner");if(!c){i=d;for(g=this.VOM.all();i&&i!=h;)if(l(g,i.id)){o(d,"mx-owner",c=i.id);break}else i=i.parentNode}if(c)this.fire("event",{info:p,se:b,tId:a.id||(a.id="mx-e-"+n--),cId:d.id||(d.id="mx-e-"+n--),hld:c});else throw Error("miss mx-owner:"+p);}else for(;f.length;)b=f.shift(),g=o(b,"mx-ie"),i.test(g)||(g=g?g+","+c:c,o(b,"mx-ie",g))}},attachEvent:function(b){var a=this;if(m[b])m[b]++;else if(m[b]=1,g[b])a.onUnbubble(h,b);else h["on"+b]=function(b){(b=b||window.event)&&
a.processEvent(b)}},detachEvent:function(b){var a=m[b];0<a&&(a--,a||(g[b]?this.offUnbubble(h,b):h["on"+b]=null),m[b]=a)}},s);e.onUnbubble=function(b,a){var d=this;q.delegate(b,a,"*[mx-"+a+"]",c[a]=function(a){d.processEvent(a)})};e.offUnbubble=function(b,a){q.undelegate(b,a,"*[mx-"+a+"]",c[a]);delete c[a]};return e},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/event",function(f,e){var s=e.safeExec;return{fire:function(e,c,l,g){var h="~"+e,f=this[h];if(f){c||(c={});if(!c.type)c.type=e;for(var e=f.length,r=e-1,n,o;e--;)n=g?e:r-e,o=f[n],o.d&&(f.splice(n,1),r--),s(o,c,this)}l&&delete this[h]},on:function(f,c,l){f="~"+f;this[f]||(this[f]=[]);e.isNumeric(l)?this[f].splice(l,0,c):(c.d=l,this[f].push(c))},un:function(f,c){e.isArray(f)||(f=[f]);for(var l=0,g=f.length;l<g;l++){var h="~"+f[l],m=this[h];if(m)if(c)for(var h=0,r=m.length;h<r;h++){if(m[h]==
c){m.splice(h,1);break}}else delete this[h]}}}},{requires:["magix/magix"]});
KISSY.add("magix/magix",function(f){var e=[].slice,s=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,q=/[^\/]*$/,c=/[#?].*$/,l=/([^=&?\/#]+)=([^&=#?]*)/g,g=/^https?:\/\//i,h={},m=0,r={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},n=h.hasOwnProperty,o=function(a){return function(b,j,c){switch(arguments.length){case 0:c=a;break;case 1:c=v.isObject(b)?k(a,b):d(a,b)?a[b]:null;break;case 2:null===j?(delete a[b],c=j):a[b]=c=j}return c}},b=function(a){this.c=
[];this.x=a||20;this.b=this.x+5},a=function(a){return new b(a)},d=function(a,b){return a?n.call(a,b):0},k=function(a,b,j){for(var c in b)if(!j||!d(j,c))a[c]=b[c];return a};k(b.prototype,{get:function(a){var b=this.c,j,a="pathname"+a;if(d(b,a)&&(j=b[a],1<=j.f))j.f++,j.t=m++,j=j.v;return j},set:function(a,b){var j=this.c,a="pathname"+a,c=j[a];if(!d(j,a)){if(j.length>=this.b){j.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var i=this.b-this.x;i--;)c=j.pop(),delete j[c.k]}c={};j.push(c);j[a]=
c}c.k=a;c.v=b;c.f=1;c.t=m++;return c},del:function(a){var a="pathname"+a,b=this.c,j=b[a];if(j)j.f=-1E5,j.v="",delete b[a]},has:function(a){return d(this.c,"pathname"+a)}});var i=a(60),D=a(),p=function(a,b,j,c,d,i){v.isArray(a)||(a=[a]);if(!b||!v.isArray(b)&&!b.callee)b=[b];for(c=0;c<a.length;c++)try{i=a[c],d=v.isFunction(i)&&i.apply(j,b)}catch(p){}return d},y=function(){},v={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:k,has:d,safeExec:p,noop:y,config:o(r),start:function(a){var b=
this,a=k(r,a);b.libEnv(a);var j=a.iniFile.replace("~",a.appName);b.libRequire(j,function(j){r=k(a,j,a);var c=a.progress;b.libRequire(["magix/router","magix/vom"],function(j,d){j.on("changed",function(a){a.loc?d.locUpdated(a.loc):a.changed.isView()?d.mountRoot(a):d.locChanged(a)});d.on("progress",c||y);b.libRequire(a.extensions,function(){j.start()})})});a.ready&&(p(a.ready),delete a.ready)},keys:Object.keys||function(a){var b=[],j;for(j in a)d(a,j)&&b.push(j);return b},local:o({}),path:function(a,
b){var j=a+"\n"+b,d=D.get(j);if(!d){a=a.replace(c,"").replace(q,"");"/"==b.charAt(0)?(d=a.indexOf("://"),-1==d?d=b:(d=a.indexOf("/",d+3),d=-1==d?a+b:a.substring(0,d)+b)):d=a+b;for(;s.test(d);)d=d.replace(s,"$1/");D.set(j,d)}return d},pathToObject:function(a,b){var d=i.get(a);if(!d){var d={},p={},e="";c.test(a)?e=a.replace(c,""):~a.indexOf("=")||(e=a);if(e&&g.test(e))var k=e.indexOf("/",8),e=-1==k?"/":e.substring(k);a.replace(l,function(a,d,j){if(b)try{j=decodeURIComponent(j)}catch(c){}p[d]=j});d.pathname=
e;d.params=p;i.set(a,d)}return d},objectToPath:function(a,b){var d=a.pathname,c=[],i=a.params,e,p;for(p in i)e=i[p],b&&encodeURIComponent(e),c.push(p+"="+e);return d+(d&&c.length?"?":"")+c.join("&")},tmpl:function(a,b){return 1==arguments.length?{v:h[a],h:d(h,a)}:h[a]=b},listToMap:function(a,b){var d,c,i={},e;this.isString(a)&&(a=a.split(","));if(a&&(e=a.length))for(d=0;d<e;d++)c=a[d],i[b?c[b]:c]=b?c:1;return i},createCache:a};return k(v,{libRequire:function(a,b){if(a){var d=f.isFunction(b),c=f.isArray(a);
f.use(c?a.join(","):a,d?function(a){b.apply(a,e.call(arguments,1))}:f.noop)}else b()},libEnv:function(a){var b=a.appHome,d=location,c=d.protocol,i=a.appName;~b.indexOf(c)||(b=this.path(d.href,b));f.endsWith(b,"/")||(b+="/");a.appHome=b;var e=a.debug;e&&(e=0==b.indexOf(c+"//"+d.host));"~"==i.charAt(0)&&f.config({map:[[RegExp("/"+i+"/"),"/"]]});d="";(d=e?f.now():a.appTag)&&(d+=".js");c=a.appCombine;f.isUndefined(c)&&(c=f.config("combine"));f.config({packages:[{name:i,path:b,debug:a.debug=e,combine:c,
tag:d}]})},isArray:f.isArray,isFunction:f.isFunction,isObject:f.isObject,isRegExp:f.isRegExp,isString:f.isString,isNumber:f.isNumber})});
KISSY.add("magix/router",function(f,e,s,q){var c=window,l=e.has,g=e.mix,h=document,m=/^UTF-8$/i.test(h.charset||h.characterSet||"UTF-8"),r=e.config(),n=e.createCache(),o=e.createCache(),b,a,d,k=65536,i=/#.*$/,D=/^[^#]*#?!?/,p=r.nativeHistory,y,v,H=function(a,b,d){if(a){d=this.params;e.isArray(a)||(a=a.split(","));for(var c=0;c<a.length&&!(b=l(d,a[c]));c++);}return b},I=function(){return l(this,"pathname")},j=function(){return l(this,"view")},J=function(){return this.hash.pathname!=this.query.pathname},
w=function(a){return this.hash.params[a]!=this.query.params[a]},B=function(a){return l(this.hash.params,a)},C=function(a){return l(this.query.params,a)},E=function(a){return this.params[a]},f=g({getView:function(a){if(!d){d={routes:r.routes||{},e404:r.notFoundView};var b=r.defaultView;if(!b)throw Error("unset defaultView");d.home=b;var c=r.defaultPathname||"";d.routes[c]=b;d.pathname=c}a||(a=d.pathname);b=d.routes;b=e.isFunction(b)?b.call(r,a):b[a];return{view:b?b:d.e404||d.home,pathname:b?a:d.e404?
a:d.pathname}},start:function(){var a=c.history;y=p&&a.pushState;v=p&&!y;y?this.useState():this.useHash();this.route()},path:function(a){var a=e.pathToObject(a,m),b=a.pathname;b&&v&&(a.pathname=e.path(c.location.pathname,b));return a},parseQH:function(a,b){var a=a||c.location.href,d=n.get(a);if(!d){var d=a.replace(i,""),j=a.replace(D,""),e=this.path(d),k=this.path(j),f={};g(f,e.params);g(f,k.params);d={pathnameDiff:J,paramDiff:w,hashOwn:B,queryOwn:C,get:E,href:a,srcQuery:d,srcHash:j,query:e,hash:k,
params:f};n.set(a,d)}b&&!d.view&&(j=this.getView(p?d.hash.pathname||d.query.pathname:d.hash.pathname),g(d,j));return d},getChged:function(a,b){var d=b.href,c=a.href+"\n"+d,i=o.get(c);i||(c=d+"\n"+c,i=o.get(c));if(!i){var e,i={params:{}};if(a.pathname!=b.pathname)e=i.pathname=1;if(a.view!=b.view)e=i.view=1;var d=a.params,p=b.params,k;for(k in d)d[k]!=p[k]&&(e=1,i.params[k]=1);for(k in p)d[k]!=p[k]&&(e=1,i.params[k]=1);i.occur=e;i.isParam=H;i.isPathname=I;i.isView=j;o.set(c,i)}return i},route:function(){var d=
this.parseQH(0,1),c=a||{params:{},href:"~"},j=!a;a=d;c=this.getChged(c,d);c.occur&&(b=d,this.fire("changed",{location:d,changed:c,force:j}))},navigate:function(a,d){!d&&e.isObject(a)&&(d=a,a="");d&&(a=e.objectToPath({params:d,pathname:a},m));if(a){var c=this.path(a),j={};j.params=g({},c.params);j.pathname=c.pathname;if(j.pathname){if(v&&(c=b.query)&&(c=c.params))for(var i in c)l(c,i)&&!l(j.params,i)&&(j.params[i]="")}else i=g({},b.params),j.params=g(i,j.params),j.pathname=b.pathname;i=e.objectToPath(j);
if(y?i!=b.srcQuery:i!=b.srcHash)y?(this.popFired=1,history.pushState(k--,h.title,i),this.route()):(g(j,b,j),j.srcHash=i,j.hash={params:j.params,pathname:j.pathname},this.fire("changed",{loc:b=j}),location.hash="#!"+i)}}},s);f.useState=function(){var a=this,b=location.href;q.on(c,"popstate",function(){var d=location.href==b;if(a.popFired||!d)a.popFired=1,a.route()})};f.useHash=function(){var a=this;q.on(c,"hashchange",function(){a.route()})};return f},{requires:["magix/magix","magix/event","event"]});
KISSY.add("magix/vframe",function(f,e,s,q){var c=document,l=65536,g=window.CollectGarbage||e.noop,h=e.mix,f=e.config(),m=f.tagName,r=f.rootId,n=e.has,o,b,a=function(a){return"object"==typeof a?a:c.getElementById(a)};c.createElement(m);var d=/<script[^>]*>[\s\S]*?<\/script>/ig,k=function(a){this.id=a;this.vId=a+"_v";this.cM={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};h(k,{root:function(b){if(!o){var d=a(r);if(!d)d=c.createElement(m),d.id=r,c.body.insertBefore(d,c.body.firstChild);o=new k(r);
b.add(o)}return o}});h(h(k.prototype,s),{useAnimUpdate:e.noop,oldViewDestroy:e.noop,prepareNextView:e.noop,newViewCreated:e.noop,mountView:function(b,c){var p=this,k=a(p.id);k._bak?k._chgd=1:(k._bak=1,k._tmpl=k.innerHTML.replace(d,""));var f=p.viewUsable&&p.useAnimUpdate();p.unmountView(f,1);if(b){var g=e.pathToObject(b),l=g.pathname,j=--p.sign;e.libRequire(l,function(b){if(j==p.sign){var d=p.owner;q.prepare(b,{$:a,path:l,vom:d});var i;f?(i=p.vId,p.prepareNextView()):i=p.id;var e=new b({owner:p,id:i,
vId:p.vId,vfId:p.id,location:d.getLoc()});p.view=e;e.on("interact",function(a){p.fire("viewInteract",{view:e});p.viewUsable=1;f&&p.newViewCreated(1);if(!a.tmpl){if(!f&&k._chgd)k.innerHTML=k._tmpl;p.mountZoneVframes(0,0,1)}e.on("rendered",function(){p.mountZoneVframes(0,0,1)});e.on("prerender",function(a){p.unmountZoneVframes(0,a.anim)})},0);c=c||{};e.load(h(c,g.params,c))}})}},unmountView:function(d,c){if(this.view){b||(b={caused:this.id});this.unmountZoneVframes(0,d);this.childrenAlter(b);this.view.destroy();
var e=a(this.id);if(!d&&e._bak)e.innerHTML=e._tmpl;d&&c&&this.oldViewDestroy();delete this.view;delete this.viewUsable;b=0;this.fire("viewUnmounted");g()}this.un("viewInteract");this.sign--},mountVframe:function(a,b,d,c){var e=this.owner,f=e.get(a);if(!f)f=new k(a),f.pId=this.id,n(this.cM,a)||this.cC++,this.cM[a]=c,e.add(f);f.mountView(b,d);return f},mountZoneVframes:function(b,d,c){this.unmountZoneVframes(b);var b=b?b:a(this.vId)||a(this.id),b=a(b).getElementsByTagName(m),e=b.length,k={};if(e)for(var f=
0,g,j,h,w;f<e;f++){g=b[f];j=g.id||(g.id="magix_vf_"+l--);n(k,j)||(h=g.getAttribute("mx-view"),w=g.getAttribute("mx-defer"),(!w||h)&&this.mountVframe(j,h,d,c));g=a(g).getElementsByTagName(m);j=0;for(h=g.length;j<h;j++)k[g[j].id||(g[j].id="magix_vf_"+l--)]=1}this.cC==this.rC&&this.childrenCreated({})},unmountVframe:function(a,b){var a=a||this.id,d=this.owner,c=d.get(a);if(c){var e=c.fcc;c.unmountView(b);d.remove(a,e);if((d=d.get(c.pId))&&n(d.cM,a))delete d.cM[a],d.cC--}},unmountZoneVframes:function(b,
d){var c;if(b){c=a(b).getElementsByTagName(m);for(var e={},k=this.cM,f=c.length-1,g;0<=f;f--)g=c[f].id,n(k,g)&&(e[g]=1);c=e}else c=this.cM;for(var j in c)this.unmountVframe(j,d)},childrenCreated:function(a){var b=this.view;if(b&&!this.fcc)this.fcc=1,delete this.fca,b.fire("created",a),this.fire("created",a);var d=this.owner;d.childCreated();b=this.id;if((d=d.get(this.pId))&&!n(d.rM,b))d.rM[b]=d.cM[b],d.rC++,d.rC==d.cC&&d.childrenCreated(a)},childrenAlter:function(a){delete this.fcc;if(!this.fca){var b=
this.view,d=this.id;if(b)this.fca=1,b.fire("alter",a),this.fire("alter",a);if((b=this.owner.get(this.pId))&&n(b.rM,d)){var c=b.rM[d];b.rC--;delete b.rM[d];c&&b.childrenAlter(a)}}},locationChanged:function(a,b){var d=this.view;if(d&&d.sign&&(d.location=a,d.rendered)){var c=d.olChanged(b),k={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];e.isString(a)&&(a=a.split(","));this.cs=a}};c&&e.safeExec(d.locationChange,k,d);for(var d=k.cs||e.keys(this.cM),c=0,k=d.length,
f=this.owner,g;c<k;c++)(g=f.get(d[c]))&&g.locationChanged(a,b)}},locationUpdated:function(a){var b=this.view;if(b&&b.sign){b.location=a;var b=this.cM,d,c=this.owner,e;for(e in b)(d=c.get(e))&&d.locationUpdated(a)}}});return k},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(f,e,s,q,c){var l=f.Env.mods,g={wrapAsyn:1,extend:1},h=function(a,b,d){for(var c in b)f.isObject(b[c])?(e.has(a,c)||(a[c]={}),h(a[c],b[c],!0)):d&&(a[c]=b[c])},m=e.safeExec,r=e.has,n=[],o=e.config(),b=/^~[^\/]*/,a=e.mix,d=e.listToMap("render,renderUI"),k=function(a){return function(){var b;this.sign&&(this.sign++,this.fire("rendercall"),b=a.apply(this,arguments));return b}},i=function(b){a(this,b);this.sign=1};a(i,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var a=
this.prototype,b,c;for(c in a){b=a[c];var i=null;e.isFunction(b)&&b!=e.noop&&!b["~~"]&&r(d,c)&&(i=k(b),i["~~"]=b,a[c]=i)}}}});var D=i.prototype,p=window.CollectGarbage||e.noop,y=/\smx-[^ohv][a-z]+\s*=/g,v={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},H=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,I=/(\w+):([^,]+)/g;a(D,
s);a(D,{render:e.noop,locationChange:e.noop,init:e.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var a=this,b=a.hasTmpl,d=arguments,c=a.sign,e=function(){if(c==a.sign&&(a.delegateEvents(),a.fire("interact",{tmpl:b},1),m(a.init,d,a),m(a.render,n,a),!b&&!a.rendered))a.rendered=!0,a.fire("primed",null,1)};b&&!r(a,"template")?a.planTmpl(e):e()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var a=this.enableAnim;
this.fire("refresh",0,1);this.fire("prerender",{anim:a});var b=this.owner;a&&(m(b.oldViewDestroy,n,b),m(b.prepareNextView,n,b),this.updateViewId())}},endUpdateHTML:function(){if(this.sign){if(this.rendered&&this.enableAnim){var a=this.owner;m(a.newViewCreated,n,a)}this.rendered||this.fire("primed",null,1);this.rendered=!0;this.fire("rendered");p()}},wrapMxEvent:function(a){return a?(""+a).replace(y,' mx-owner="'+this.vfId+'"$&'):a},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=
this.wrapMxEvent(a);this.endUpdateHTML()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;var d=b.keys;if(e.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=d.concat(e.isString(a)?a.split(","):a)},olChanged:function(a){var b=this.$ol;if(b){var d=0;b.pn&&(d=a.isPathname());d||(d=a.isParam(b.keys));return d}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),
b=null;if(a&&a.viewUsable)b=a.view;return b},planTmpl:function(a){var d=this,c=e.tmpl(d.path);c.h?(d.template=c.v,a()):(c=d.home+d.path.replace(b,"")+".html",d.fetchTmpl(c,function(b){d.template=e.tmpl(d.path,b);a()},o.debug))},processEvent:function(b){if(this.enableEvent&&this.sign){var d=b.se,c=b.info.match(H),e=c[1],k=c[2],c=c[3],i=this.events;if(i){var f=i[d.type];if(v[k])v[k](d);if(f&&f[e]){var g={};c&&c.replace(I,function(a,b,d){g[b]=d});m(f[e],a({view:this,currentId:b.cId,targetId:b.tId,domEvent:d,
events:i,params:g},v),f)}}}},delegateEvents:function(a){var b=this.events,a=a?q.detachEvent:q.attachEvent,d;for(d in b)a.call(q,d)}});i.prototype.fetchTmpl=function(a,b,d){var k=h[a];k?k.push(b):(k=h[a]=[b],c({url:a+(d?"?_="+f.now():""),success:function(b){e.safeExec(k,b);delete h[a]},error:function(b,d){e.safeExec(k,d);delete h[a]}}))};i.extend=function(a,b){var d=function(){d.superclass.constructor.apply(this,arguments);b&&e.safeExec(b,arguments,this)};d.extend=this.extend;return f.extend(d,this,
a)};i.prepare=function(a,b){if(!a.wrapAsyn){for(var d in this)e.has(g,d)&&(a[d]=this[d]);d=a.prototype;for(var c=a;c.superclass;)c=c.superclass.constructor,h(d,c.prototype);b.home=l[b.path].packageInfo.getBase();e.mix(d,b)}a.wrapAsyn()};return i},{requires:["magix/magix","magix/event","magix/body","ajax"]});
KISSY.add("magix/vom",function(f,e,s,q,c){var l=s.has,g=0,h=0,m=0,r=0,n={},o,b=s.mix({all:function(){return n},add:function(a){if(!l(n,a.id))g++,n[a.id]=a,a.owner=b,b.fire("add",{vframe:a})},get:function(a){return n[a]},remove:function(a,d){var c=n[a];c&&(g--,d&&h--,delete n[a],b.fire("remove",{vframe:c}))},childCreated:function(){if(!r){h++;var a=h/g;m<a&&(b.fire("progress",{percent:m=a}),1==a&&(r=1,b.un("progress")))}},root:function(){return e.root(b)},mountRoot:function(a){var d=b.root();o=a.location;
d.mountView(o.view)},locChanged:function(a){o=a.location;b.root().locationChanged(o,a.changed)},locUpdated:function(a){o=a;b.root().locationUpdated(a)},getLoc:function(){return o}},q);c.VOM=b;c.on("event",function(a){var d=b.get(a.hld);(d=d&&d.view)&&d.processEvent(a)});return b},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(f,e,s){var q=e.has,c=e.safeExec,l=function(b){f.isArray(b)||(b=[b]);for(var a=0,d;a<b.length;a++)d=b[a],delete d.cacheKey;return b},g=function(b){this.$mClass=b;this.$mCache=e.createCache();this.$mCacheKeys={};this.$mMetas={}},h=[].slice,m={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},r=function(b){var a={},d;for(d in b)m[d]||(a[d]=b[d]);return a},n=function(b,a){var d=h.call(arguments,2);return function(){return b.apply(a,d.concat(h.call(arguments)))}};
e.mix(g,{create:function(b){if(!b)throw Error("MManager.create:modelClass ungiven");return new g(b)}});var o=function(b){this.$host=b;this.$doTask=!1;this.$reqModels={}};e.mix(o.prototype,{fetchModels:function(b,a,d){var e=this;if(e.$doTask)return e.next(function(c){c.fetchModels(b,a,d)}),e;e.$doTask=!0;var i=e.$host,g=i.$mCache,h=i.$mCacheKeys,l=e.$reqModels;f.isArray(b)||(b=[b]);var m=b.length,o=0,r,j,s=Array(m),w=[],B={},C=[],E=f.isArray(a);E&&(w=Array(a.length));for(var F=function(b,n,x,t){if(!e.$destroy){o++;
delete l[x.id];var u=x._cacheKey;s[b]=x;if(n)j=!0,r=t||r,B[b]=t;else if(x._doneAt=f.now(),u&&!g.has(u)){g.set(u,x);var A=x._after,z=x._meta;A&&c(A,[x,z]);i.fireAfter(z.name,[x])}if(2==d)(A=E?a[b]:a)&&(w[b]=c(A,[x,n?{msg:t}:null,j?B:null],e));else if(4==d){C[b]={m:x,e:n,s:t};for(b=C.i||0;A=C[b];b++)if(z=E?a[b]:a,w[b]=c(z,[A.m,A.e?{msg:A.s}:null,C.e?B:null,w],e),A.e)B[b]=A.s,C.e=1;C.i=b}u&&q(h,u)&&(b=h[u],delete h[u],c(b,[n,x,t],x));if(o>=m)B.msg=r,n=j?B:null,1==d?(s.push(n),w[0]=c(a,s,e),w[1]=n):w.push(n),
e.$ntId=setTimeout(function(){e.$doTask=!1;e.doNext(w)},30)}},u=0,t;u<b.length;u++)if(t=b[u]){var G;G=i.getModel(t);var z=G.cacheKey;z&&q(h,z)?h[z].push(n(F,e,u)):(t=G.entity,G.needUpdate?(l[t.id]=t,z&&(h[z]=[]),t.request({success:n(F,t,u,!1,t),error:n(F,t,u,!0,t)})):F(u,!1,t))}else throw Error("miss attrs:"+b);return e},fetchAll:function(b,a){return this.fetchModels(b,a,1)},saveAll:function(b,a){b=l(b);return this.fetchModels(b,a,1)},fetchOrder:function(b,a){var d=h.call(arguments,1);return this.fetchModels(b,
1<d.length?d:a,4)},saveOrder:function(b,a){var b=l(b),d=h.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,4)},saveOne:function(b,a){var b=l(b),d=h.call(arguments,1);return this.reqModels(b,1<d.length?d:a,2)},fetchOne:function(b,a){var d=h.call(arguments,1);return this.fetchModels(b,1<d.length?d:a,2)},abort:function(){clearTimeout(this.$ntId);var b=this.$reqModels,a=this.$host.$mCacheKeys;if(b)for(var d in b){var e=b[d],i=e._cacheKey;if(i&&q(a,i)){var f=a[i];delete a[i];c(f,[!0,e,"aborted"],
e)}e.abort()}this.$reqModels={};this.$queue=[];this.$doTask=!1},next:function(b){if(!this.$queue)this.$queue=[];this.$queue.push(b);this.$doTask||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(b){var a=this.$queue;a&&(a=a.shift())&&c(a,[this].concat(b),this);this.$latest=b},destroy:function(){this.$destroy=!0;this.abort()}});e.mix(g.prototype,{registerModels:function(b){var a=this.$mMetas;f.isArray(b)||(b=[b]);for(var d=0,c;d<b.length;d++){c=b[d];if(!c.name)throw Error("model must own a name attribute");
a[c.name]=c}},registerMethods:function(b){var a=this,d;for(d in b)a[d]=function(b){return function(){for(var d,c=arguments,e=[],g=0,h;g<c.length;g++)h=c[g],f.isFunction(h)?e.push(function(a){return function(){d||a.apply(a,arguments)}}(h)):e.push(h);var l=b.apply(a,e);return{destroy:function(){d=!0;l&&l.destroy&&l.destroy()}}}}(b[d])},createModel:function(b){var a=this.getModelMeta(b),d=new this.$mClass(r(a)),e=b.before||a.before;this.fireBefore(a.name,[d]);f.isFunction(e)&&c(e,[d,a,b]);d._after=b.after||
a.after;e=b.cacheKey||a.cacheKey;f.isFunction(e)&&(e=c(e,[a,b]));d._cacheKey=e;d._meta=a;d.set(r(b));d.setUrlParams(a.urlParams);d.setPostParams(a.postParams);d.setUrlParams(b.urlParams);d.setPostParams(b.postParams);return d},getModelMeta:function(b){var a=this.$mMetas,d;d=f.isString(b)?b:b.name;a=a[d];if(!a)throw Error("Not found:"+b.name);return a},getModel:function(b){var a=this.getCachedModel(b),d;a||(d=!0,a=this.createModel(b));return{entity:a,cacheKey:a._cacheKey,needUpdate:d}},saveAll:function(b,
a){return(new o(this)).saveAll(b,a)},fetchAll:function(b,a){return(new o(this)).fetchAll(b,a)},saveOrder:function(b,a){var d=new o(this);return d.saveOrder.apply(d,arguments)},fetchOrder:function(b,a){var d=new o(this);return d.fetchOrder.apply(d,arguments)},saveOne:function(b,a){var d=new o(this);return d.saveOne.apply(d,arguments)},fetchOne:function(b,a){var d=new o(this);return d.fetchOne.apply(d,arguments)},clearCacheByKey:function(b){var a=this.$mCache;f.isString(b)&&a.del(b)},clearCacheByName:function(b){for(var a=
this.$mCache,d=a.c,c=0;c<d.length;c++){var e=d[c].v;(e&&e._meta.name)==b&&a.del(e._cacheKey)}},getModelUrl:function(b){return this.$mClass.prototype.url(this.getModelMeta(b).uri)},listenBefore:function(b,a){s.on.call(this,b+"_before",a)},listenAfter:function(b,a){s.on.call(this,b+"_after",a)},unlistenBefore:function(b,a){s.un.call(this,b+"_before",a)},unlistenAfter:function(b,a){s.un.call(this,b+"_after",a)},fireBefore:function(b,a){s.fire.call(this,b+"_before",a)},fireAfter:function(b,a){s.fire.call(this,
b+"_after",a)},getCachedModel:function(b){var a=this.$mCache,d=null,e,i;f.isString(b)?e=b:(i=this.getModelMeta(b),e=b.cacheKey||i.cacheKey,f.isFunction(e)&&(e=c(e,[i,b])));if(e&&(d=a.get(e))){if(!i)i=d._meta;a=b.cacheTime||i.cacheTime||0;f.isFunction(a)&&(a=c(a,[i,b]));0<a&&f.now()-d._doneAt>a&&(this.clearCacheByKey(e),d=null)}return d}});return g},{requires:["magix/magix","magix/event"]});
KISSY.add("mxext/model",function(f,e){var s=function(c,l,g){for(var h in l)f.isObject(l[h])?(e.has(c,h)||(c[h]={}),s(c[h],l[h],!0)):g&&(c[h]=l[h])},q=function(c){c&&this.set(c);this.id=f.guid("m")};e.mix(q,{GET:"GET",POST:"POST",extend:function(c,l){var g=function(){g.superclass.constructor.apply(this,arguments);l&&e.safeExec(l,[],this)};e.mix(g,this,{prototype:!0});s(c,this.prototype);return f.extend(g,this,c)}});e.mix(q.prototype,{urlMap:{},sync:e.noop,parse:function(c){return c},getParamsObject:function(c){if(!c)c=
q.GET;return this["$"+c]||null},getUrlParamsObject:function(){return this.getParamsObject(q.GET)},getPostParamsObject:function(){return this.getParamsObject(q.POST)},getPostParams:function(){return this.getParams(q.POST)},getUrlParams:function(){return this.getParams(q.GET)},getParams:function(c){var c=c?c.toUpperCase():q.GET,c=this["$"+c],e=[],g;if(c)for(var h in c)if(g=c[h],f.isArray(g))for(var m=0;m<g.length;m++)e.push(h+"="+encodeURIComponent(g[m]));else e.push(h+"="+encodeURIComponent(g));return e.join("&")},
setUrlParamsIf:function(c,e){this.setParams(c,e,q.GET,!0)},setPostParamsIf:function(c,e){this.setParams(c,e,q.POST,!0)},setParams:function(c,e,g,h){g=g?g.toUpperCase():q.GET;if(!this.$types)this.$types={};this.$types[g]=!0;g="$"+g;this[g]||(this[g]={});if(f.isObject(c))for(var m in c){if(!h||!this[g][m])this[g][m]=c[m]}else if(c&&(!h||!this[g][c]))this[g][c]=e},setPostParams:function(c,e){this.setParams(c,e,q.POST)},setUrlParams:function(c,e){this.setParams(c,e,q.GET)},removeParamsObject:function(c){if(!c)c=
q.GET;delete this["$"+c]},removePostParamsObject:function(){this.removeParamsObject(q.POST)},removeUrlParamsObject:function(){this.removeParamsObject(q.GET)},reset:function(){var c=this.$types;if(c){for(var f in c)e.has(c,f)&&delete this["$"+f];delete this.$types}c=this.$keys;f=this.$attrs;if(c){for(var g=0;g<c.length;g++)delete f[c[g]];delete this.$keys}},url:function(c){var c=c||this.get("uri"),e;if(c){e=c.split(":");var f=this.urlMap;if(f){for(var h=0,m=e.length;h<m&&!(f=f[e[h]],!f);h++);c=f||
c}}else throw Error("model not set uri");return c},get:function(c){var e=this.$attrs;return e?e[c]:null},set:function(c,e,g){if(!this.$attrs)this.$attrs={};if(g&&!this.$keys)this.$keys=[];if(f.isObject(c))for(var h in c)g&&this.$keys.push(h),this.$attrs[h]=c[h];else c&&(g&&this.$keys.push(c),this.$attrs[c]=e)},load:function(c){this.request(c)},save:function(c){this.request(c)},request:function(c){c||(c={});var e=c.success,g=c.error,h=this;h.$abort=!1;c.success=function(c){if(!h.$abort){if(c){var g=
h.parse(c);f.isObject(g)||(g={data:g});h.set(g,null,!0)}e&&e.apply(this,arguments)}};c.error=function(){h.$abort||g&&g.apply(this,arguments)};h.$trans=h.sync(c)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=f.clone(this.$attrs)},rollbackTransaction:function(){var c=this.$bakAttrs;if(c)this.$attrs=c,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return q},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(f,e,s,q){var c=window,l=function(a){c.clearTimeout(a);c.clearInterval(a)},g=function(a){m(a.destroy,[],a)},h=0,m=e.safeExec,r=e.has,n={},o=function(a){if(!o.d)o.d=1,a.on("add",function(a){var a=a.vframe,c=n[a.id];if(c){for(var e=0;e<c.length;e++)b(a,c[e]);delete n[a.id]}}),a.on("remove",function(a){delete n[a.vframe.id]}),a.root().on("childrenCreated",function(){n={}})},b=function(a,b){var c=a.view;if(c&&a.viewUsable)m(c.receiveMessage,b,c);else{var e=function(c){a.un("viewInteract",
e);m(c.view.receiveMessage,b,c.view)};a.on("viewInteract",e)}};return s.extend({mxViewCtor:e.noop,navigate:function(){q.navigate.apply(q,arguments)},manage:function(a,b){var c=!0;1==arguments.length&&(b=a,a="res_"+h++,c=!1);if(!this.$res)this.$res={};var e;f.isNumber(b)?e=l:b&&b.destroy&&(e=g);this.$res[a]={hasKey:c,res:b,destroy:e};return b},getManaged:function(a){var b=this.$res;return b&&r(b,a)?b[a].res:null},removeManaged:function(a){var b=null,c=this.$res;if(c)if(r(c,a))b=c[a].res,delete c[a];
else for(var e in c)if(c[e].res===a){b=c[e].res;delete c[e];break}return b},destroyManaged:function(a){var b=this.$res;if(b){for(var c in b){var e=b[c],f=e.res,g=e.destroy,h=!1;g&&(g(f),h=!0);a&&!e.hasKey&&delete b[c];this.fire("destroyManaged",{resource:f,processed:h})}a||delete this.$res}},receiveMessage:e.noop,postMessageTo:function(a,c){var f=this.vom;o(f);e.isArray(a)||(a=[a]);c||(c={});for(var g=0,h;g<a.length;g++){h=a[g];var l=f.get(h);l?b(l,c):(n[h]||(n[h]=[]),n[h].push(c))}},destroyMRequest:function(){var a=
this.$res;if(a)for(var b in a){var c=a[b].res;c&&c.fetchOne&&c.fetchAll&&(c.destroy(),delete a[b])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(f){var e=function(){};if(!f.console)f.console={log:e,info:e,error:e};var s,q={};if(!f.Magix)f.Magix={config:function(c){for(var e in c)q[e]=c[e]},start:function(c){s=c}},KISSY.use("magix/magix",function(c,e){f.Magix=e;e.config(q);s&&e.start(s)})})(this);