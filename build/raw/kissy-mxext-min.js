KISSY.add("mxext/model",function(i,g){var e=function(a){a&&this.set(a);this.id=i.guid("m");this.hasLocker=this.locker=!1};g.mix(e,{GET:"GET",POST:"POST",extend:function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments);c&&g.safeExec(c,[],this)};g.mix(b,this,{prototype:!0});return i.extend(b,this,a)}});g.mix(e.prototype,{urlMap:{},sync:g.noop,parse:g.noop,getParamsObject:function(a){if(!a)a=e.GET;return this["$"+a]||null},getPostParamsObject:function(){return this.getPostParamsObject(e.POST)},
getPostParams:function(){return this.getParams(e.POST)},getParams:function(a){var a=a?a.toUpperCase():e.GET,a=this["$"+a],c=[],b;if(a)for(var d in a)if(b=a[d],i.isArray(b))for(var h=0;h<b.length;h++)c.push(d+"="+encodeURIComponent(b[h]));else c.push(d+"="+encodeURIComponent(b));return c.join("&")},setParamsIf:function(a,c){this.setParams(a,c,e.GET,!0)},setParams:function(a,c,b,d){b=b?b.toUpperCase():e.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[b]=!0;b="$"+b;this[b]||(this[b]={});if(i.isObject(a))for(var h in a){if(!d||
!this[b][h])this[b][h]=a[h]}else if(a&&c&&(!d||!this[b][a]))this[b][a]=c},setPostParams:function(a,c){this.setParams(a,c,e.POST)},setPostParamsIf:function(a,c){this.setParams(a,c,e.POST,!0)},removeParamsObject:function(a){if(!a)a=e.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(e.POST)},reset:function(){var a=this.$keysCache;if(a){for(var c in a)g.hasProp(a,c)&&delete this["$"+c];delete this.$keysCache}a=this.$keys;c=this.$attrs;if(a){for(var b=0;b<a.length;b++)delete c[a[b]];
delete this.$keys}},url:function(){var a=this.get("uri"),c;if(a){c=a.split(":");var b=this.urlMap;if(b)for(var d=0;d<c.length&&!(b=b[c[d]],void 0===b);d++)d==c.length-1&&(a=b)}else throw Error("model not set uri");return a},get:function(a){var c=this.$attrs;return c?c[a]:null},set:function(a,c,b){if(!this.$attrs)this.$attrs={};if(b&&!this.$keys)this.$keys=[];if(i.isObject(a))for(var d in a)b&&this.$keys.push(d),this.$attrs[d]=a[d];else a&&(b&&this.$keys.push(a),this.$attrs[a]=c)},load:function(a){this.request(a)},
save:function(a){this.request(a)},request:function(a){a||(a={});var c=a.success,b=a.error,d=this;if(!d.hasLocker||!d.locker)d.$abort=!1,d.locker=d.hasLocker,a.success=function(a){d.locker=!1;if(!d.$abort){if(a){var b=d.parse(a);b&&(i.isArray(b)&&(b={list:b}),d.set(b,null,!0))}c&&c.apply(this,arguments)}},a.error=function(){d.locker=!1;d.$abort||b&&b.apply(this,arguments)},d.$trans=d.sync(d,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},
beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=!!a}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(i,g){var e=function(c){this.$modelClass=c},a=function(c){if(c._wraped_)return c;var a=function(a){var b=a.success,f=this;f.get("~~ui")?(a.success=function(){f.set("~~ui",!1);f._after&&g.safeExec(f._after,f);b&&b.apply(a)},c.call(f,a)):b&&b.apply(a)};a._wraped_=!0;return a};g.mix(e,{mClsCache:{},create:function(a,b){if(!b)throw Error("Factory.create modelClass ungiven");var d=this.mClsCache;a||(a=i.guid());d[a]||(d[a]=new e(b));return d[a]}});g.mix(e.prototype,
{registerModels:function(a){g.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++){d=a[b];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},registerMethods:function(a){for(var b in a)g.hasProp(a,b)&&(this[b]=a[b])},callMethods:function(a,b,d){for(var h=[],f="",g=a.length,e=0,p,n=function(a,c,j){p||(e++,j?f=a:h[c]=a,g<=e&&(f?i.isFunction(d)&&d(f):i.isFunction(b)&&b.apply(b,h)))},q=function(a,b){return function(c){n(c,a,!b)}},o=0,j;o<a.length;o++){j=a[o];var s;if(s=i.isFunction(j.name)?
j.name:this[j.name]){if(!j.params)j.params=[];j.params.push(q(o,!0),q(o));s.apply(this,j.params)}else n("unfound:"+j.name,o,!0)}return{abort:function(){p=!0}}},fetchModels:function(a,b,d,h){var f=this;if(!f.$modelsCache)f.$modelsCache={};if(!f.$modelsCacheKeys)f.$modelsCacheKeys={};var e=f.$modelsCache,m=f.$modelsCacheKeys;g.isArray(a)||(a=[a]);for(var p=a.length,n=0,q,o=[],j=[],s,u=function(a,c,k,j){n++;if(c)q=j||"fetch data error";else{s=!0;k.set("~~ui",!1);o[a]=k;if((a=k._cacheKey)&&!g.hasProp(e,
a))e[k._cacheKey]=k,a=k._params,k._doneAt=i.now(),k._after&&g.safeExec(k._after,[k].concat(a));4==h&&b(k)}if((a=k._cacheKey)&&g.hasProp(m,a)){var l=m[a];delete m[a];g.safeExec(l,[c,k,j],k)}4!=h&&n>=p&&(2==h?s?b&&b.apply(f,o):d&&d(q):q?d&&d(q):b&&b.apply(f,o))},w=Array.prototype.slice,v=function(a,b){var c=w.call(arguments,2);return function(){return a.apply(b,c.concat(w.call(arguments)))}},r=0,l;r<a.length;r++){l=a[r];var t=l.cacheKey;t&&g.hasProp(m,t)?m[t].push(v(u,f,r)):(l=f.create(l,!0),l.get("~~ui")?
(j.push(l),t&&(m[t]=[]),l.request({success:v(u,l,r,!1,l),error:v(u,l,r,!0,l)})):u(r,!1,l))}return{abort:function(){for(var a=0,b;a<j.length;a++){b=j[a];var c=b._cacheKey;if(c&&g.hasProp(m,c)){var d=m[c];delete m[c];g.safeExec(d,[!0,b,"abort"],b)}b.abort()}}}},fetchAll:function(a,b,d){return this.fetchModels(a,b,d,1)},fetchAny:function(a,b,d){return this.fetchModels(a,b,d,2)},fetchOne:function(a,b){return this.fetchModels(a,b,g.noop,4)},getIf:function(a){var b=this.$modelsCache;return b&&g.hasProp(b,
a)?b[a]:null},setUpdateIdent:function(a){(a=this.getIf(a))&&a.set("~~ui",!0)},create:function(c,b){if(!c.type)throw Error('model must own a "type" attribute');var d=c.type,h=c.cacheKey||d.cacheKey,f,e=c.expires||d.expires||0;if(!this.$modelsCache)this.$modelsCache={};var m=this.$modelsCache,p=c.params||[];if(h&&g.hasProp(m,h)){f=m[h];var n=f.get("~~ui");!n&&0<e&&i.now()-f._doneAt>e&&(n=!0);n&&(delete m[h],f.set("~~ui",!0))}else f=new this.$modelClass(d.ops),f._after=d.after,f._cacheKey=h,f.set("~~ui",
!0);f._params=p;if(n=f.get("~~ui"))f.reset(),f.set(c.ops),f.setParams(d.gets),f.setPostParams(d.posts),f.setParams(c.gets),f.setPostParams(c.posts),g.isFunction(d.before)&&g.safeExec(d.before,[f].concat(p),d);if(!b)f.request=a(f.request);return f}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/vfanim",function(i,g,e){var a=e.config(),c=document,b=a.viewChange,d=e.isFunction(b),h=function(a){return"object"==typeof a?a:c.getElementById(a)};return e.mix(g.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=h(this.id),b=h(this.viewId),d=this.view;if(!b){for(b=c.createElement("div");a.firstChild;)b.appendChild(a.firstChild);a.appendChild(b)}b.id="";if(a=d.events)for(var g in a)e.hasProp(a,g)&&i.all("*[mx"+g+"]").removeAttr("mx"+g);
if(!e.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=b},prepareNextView:function(){var a=h(this.id),b=c.createElement("div");b.id=this.viewId;if(a._dataBak)b.innerHTML=a._dataTmpl;a.insertBefore(b,a.firstChild)},newViewCreated:function(a){var c=this,g=c.$oldViewNode,i=h(c.viewId);d&&e.safeExec(b,{vframeId:c.id,action:a?"viewChange":"viewRefresh",oldViewNode:g,newViewNode:i,collectGarbage:function(){c.$animCounter--;c.$animCounter||delete c.$oldViewNode;try{g.parentNode.removeChild(g)}catch(a){}}},
c)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(i,g,e){return g.extend({queryEvents:null,navigate:function(a){e.navigate(a)},attachQueryEvents:function(){var a=this,c=a.queryEvents;if(c){a.$queryEventsCache={};for(var b in c){var d=c[b],e;for(e in d)i.all("#"+a.id+" "+e).on(b,a.$queryEventsCache[b+"_"+e]=function(b){return function(d){var e=g.idIt(d.target),h=g.idIt(d.currentTarget);Magix.safeExec(b,{view:a,targetId:e,currentId:h,queryEvents:c,domEvent:d},c)}}(d[e]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var c in a){var b=a[c],d;for(d in b)i.all("#"+this.id+" "+d).detach(c,this.$queryEventsCache[c+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var c in a)a[c]&&a[c].toJSON&&(a[c]=a[c].toJSON());this.setRenderer()},setRenderer:function(){var a=this,c=this.renderer,b,d;if(c)for(b in c)for(d in c[b])(function(){var e=b,f=d,g=c[e][f];a.data[e+"_"+f]=function(){return g.call(this,a,e)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});