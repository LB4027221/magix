define("magix/ajax",["magix/impls/ajax","magix/base"],function(d){var e=d("magix/impls/ajax"),b=d("magix/base");return b.implement({defaultOptions:{dataType:"html",success:function(){},failure:function(){}},send:b.unimpl,processOptions:function(a){a||(a={});for(var c in this.defaultOptions)a[c]||(a[c]=this.defaultOptions[c]);return a},getTemplate:function(a,c,h){var f=this,d;if(!f.$cache)f.$cache={};(d=f.$cache[a])?d.succ&&b.isFunction(c)?c(d.content):!d.succ&&b.isFunction(h)&&h(d.content):f.send({url:a,
dataType:"html",success:function(h){f.$cache[a]={succ:!0,content:h};b.isFunction(c)&&c(h)},failure:function(c){f.$cache[a]={content:c};b.isFunction(h)&&h(c)}})}},e)});
define("magix/base",["magix/impls/base"],function(d){var d=d("magix/impls/base"),e={mix:function(b,a,c,h){if(!a||!b)return b;void 0===c&&(c=!0);var f,d,e;if(h&&(e=h.length))for(f=0;f<e;f++){if(d=h[f],d in a&&(c||!(d in b)))b[d]=a[d]}else for(d in a)if(c||!(d in b))b[d]=a[d];return b},include:function(b){var b=Magix.config.magixHome+"../"+b+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",b,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");
}};e.mix(e,{isFunction:e.unimpl,isArray:e.unimpl,isString:e.unimpl,isPlainObject:e.unimpl,requireAsync:e.unimpl,Events:e.unimpl,_idCounter:0,uniqueId:function(b){var a=this._idCounter++;return b?b+a:a},extend:function(b,a,c,d){if(!a||!b)return b;var f=Object.prototype,e=a.prototype,k=function(a){function c(){}c.prototype=a;return new c}(e);b.prototype=k;k.constructor=b;b.superclass=e;if(a!==Object&&e.constructor===f.constructor)e.constructor=a;c&&this.mix(k,c);d&&this.mix(b,d);return b},param:function(b){var a=
[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c+"="+b[c]);return a.join("&")},unParam:function(b){for(var b=b.split("&"),a,c={},d=0;d<b.length;d++)a=b[d].split("="),a[0]&&(c[a[0]]=a[1]||"");return c},mixClassStaticProps:function(b,a){for(var c in a)a.hasOwnProperty(c)&&"prototype"!=c&&(b[c]=a[c]);return b},mixClassProtoProps:function(b,a){for(var c in a)if(!b[c]||b[c]==e.unimpl)b[c]=a[c];return b},implement:function(b,a){if(e.isFunction(b)&&e.isFunction(a)){a.prototype.constructor=a;var c=function(){a.apply(this,
arguments);b.apply(this,arguments);b.prototype.initial&&b.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(c,b);this.mixClassStaticProps(c,a);this.mixClassProtoProps(c.prototype,b.prototype);this.mixClassProtoProps(c.prototype,a.prototype);return c.prototype.constructor=c}c={};e.mix(c,b);e.mix(c,a);return c}});e.mix(e,d);return e});
define("magix/impls/ajax",function(){var d={},e;KISSY.use("ajax",function(b,a){e=a});d.send=function(b){b=this.processOptions(b);e({url:b.url,dataType:b.dataType,success:function(a){b.success(a)},error:function(a){b.failure(a)}})};return d});
define("magix/impls/base",function(d){var e=Object.prototype.toString;return{isFunction:function(b){return"[object Function]"===e.call(b)},isArray:function(b){return"[object Array]"===e.call(b)},isString:function(b){return"[object String]"===e.call(b)},isPlainObject:function(b){return b&&"[object Object]"===e.call(b)&&!b.nodeType&&!b.setInterval},requireAsync:function(b,a){d.async(b,a)},Events:{bind:function(b,a,c){var d=this._callbacks||(this._callbacks={});(d[b]||(d[b]=[])).push([a,c]);return this},
unbind:function(b,a){var c;if(b){if(c=this._callbacks)if(a){c=c[b];if(!c)return this;for(var d=0,f=c.length;d<f;d++)if(c[d]&&a===c[d][0]){c[d]=null;break}}else c[b]=[]}else this._callbacks={};return this},trigger:function(b){var a,c,d,f,e=2;if(!(c=this._callbacks))return this;for(;e--;)if(a=e?b:"all",a=c[a])for(var k=0,m=a.length;k<m;k++)(d=a[k])?(f=e?Array.prototype.slice.call(arguments,1):arguments,d[0].apply(d[1]||this,f)):(a.splice(k,1),k--,m--);return this}}}});
define("magix/impls/model",["magix/base"],function(d){var e=KISSY,d=d("magix/base"),b;e.use("mvc",function(a,d){b=d.Model});e.mix(b.prototype,d.Events);var a=b.prototype.fire;b.prototype.fire=function(c,b){a(c,b);this.trigger(c,b)};return b});
define("magix/impls/router",["magix/base","magix/model","magix/vom","app/config/ini"],function(d){var e=d("magix/base"),b=d("magix/model"),a=d("magix/vom"),c=d("app/config/ini"),h;KISSY.use("mvc",function(a,c){h=c});return{getAppConfig:function(){var a=c.pathViewMap;if(c.defaultViewName)for(var b in a)if(!a[b])a[b]=c.defaultViewName;return c},setStateListener:function(){var a=this;(new h.Router).addRoutes({"*hash":function(c){KISSY.log(c.hash);a.route(c.hash)}});h.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},
parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var c={},b;c.pathName=this.appConfig.indexPath;c.paraObj={};c.referrer=this.state&&this.state.query||null;if(c.query=a)a=a.split("/"),b=a.pop(),c.pathName=a.join("/"),c.paraObj=e.unParam(b);return c},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},c=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(c)a.pathName=location.pathname.split(c)[1];a.query=a.pathName+location.search;
if(location.search)a.paraObj=e.unParam(location.search.substr(1));return a},getRootViewName:function(){var a=this.appConfig.pathViewMap,c;c=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath];this.query.__view__&&(c=this.query.__view__.split("-").join("/"));if(this.config.multipage)a=a[this.query["sch:pathname"]],"object"==typeof a?c=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",c=a||this.appConfig.defaultRootViewName);return c},createQueryModel:function(){return new b(this.query)},
changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},_fixQueryModel:function(a){if(this.queryModel){var c,b=this.queryModel.toJSON();for(c in b)c in a||this.queryModel.unset(c,{silent:!0})}},mountRootView:function(){a.root.mountView(this.rootViewName,{queryModel:this.queryModel})}}});
define("magix/impls/template",function(){var d={},e;KISSY.use("template",function(b,a){e=a});d.toHTML=function(b){b=this.processOptions(b);return e(b.template).render(b.data)};return d});
define("magix/impls/vframe",["magix/base","magix/router"],function(d){var e=d("magix/base"),b=d("magix/router"),a=function(){};e.mix(a,{tagName:"vframe"});e.mix(a.prototype,{getChildVframeNodes:function(){var a=document.getElementById(this.id).getElementsByTagName("vframe"),b,d=[];for(b=0;b<a.length;b++)d.push(this._idIt(a[b]));return d},getRouterObject:function(){return b},createFrame:function(){return document.createElement(a.tagName)}});return a});
define("magix/impls/view",["magix/vom","magix/ajax","magix/template","magix/base"],function(d){var e=d("magix/vom"),b=d("magix/base"),a=d("magix/ajax"),c=d("magix/template"),d=KISSY,h;d.use("mvc",function(a,c){h=c});var f=function(){f.superclass.constructor.apply(this,arguments)};d.extend(f,h.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return e},getAjaxObject:function(){return a},getTemplateObject:function(){return c},dispose:function(){f.superclass.destroy.apply(this,
arguments)}});d.mix(f.prototype,b.Events);var l=f.prototype.fire;f.prototype.fire=function(a,c){l(a,c);this.trigger(a,c)};return f});define("magix/impls/vom",["magix/base"],function(d){d("magix/base");return{setRootVframe:function(){var d=null;if("vf-root"==document.body.id)d=document.body;var b=this.createElement(d,"vf-root");d||document.body.insertBefore(b.getOnce(),document.body.firstChild);this.root=b}}});
Magix={init:function(d){this.config=d;this.setEnv();this.bootstrap()},setEnv:function(){var d={magix:this.config.magixHome,app:this.config.appHome};this.dev||delete d.magix;seajs.config({debug:2,alias:d})},bootstrap:function(){var d=this;KISSY.use(["mvc","ajax","template"],function(){seajs.use(["magix/router"],function(e){e.init(d.config)})})},implementBy:"seajs-kissy",version:"0.1.0",dev:""};
define("magix/model",["magix/impls/model","magix/base"],function(d){var e=d("magix/impls/model");return d("magix/base").implement(function(){},e)});
define("magix/router",["magix/impls/router","magix/base"],function(d){var e=d("magix/impls/router"),b=d("magix/base"),d={};b.mix(d,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:b.unimpl,setStateListener:b.unimpl,parseState:b.unimpl,parseSearch:b.unimpl,getRootViewName:b.unimpl,createQueryModel:b.unimpl,changeQueryModel:b.unimpl,mountRootView:b.unimpl,navigateTo:b.unimpl,goTo:b.unimpl,setPostData:b.unimpl,
init:function(a){this.config=a;this.appConfig=this.getAppConfig();this.setStateListener()},route:function(a){this.state=this.parseState(a);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;this.rootViewName=this.getRootViewName();this.rootViewName==this.oldRootViewName?this.changeQueryModel():(this.queryModel=this.createQueryModel(),this.mountRootView());this.postData=null},_spreadLocator:function(){var a=
{},c=this._locator;b.mix(a,c.state.paraObj);b.mix(a,{referrer:c.state.referrer,query:c.state.query,pathname:c.state.pathName,postdata:c.state.postData||null});var d={},e,l=c.search.paraObj;d["sch:pathname"]=c.search.pathName;d["sch:query"]=c.search.query;for(e in l)d["sch:"+e]=l[e];b.mix(a,d);return a}});return b.implement(d,e)});
define("magix/template",["magix/impls/template","magix/base"],function(d){var e=d("magix/impls/template"),d=d("magix/base");return d.implement({defaultOptions:{data:{},template:""},processOptions:function(b){for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},toHTML:d.unimpl},e)});
define("magix/vframe",["magix/impls/vframe","magix/base"],function(d){var e=d("magix/base"),d=d("magix/impls/vframe"),b;b=function(){};e.mix(b,{tagName:e.unimpl,uniqueId:function(){return e.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});e.mix(b.prototype,e.Events);e.mix(b.prototype,{getChildVframeNodes:e.unimpl,getRouterObject:e.unimpl,createFrame:e.unimpl,initial:function(a,c){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||
this.createFrame();this.id=this._idIt(this._domNode,c);if(a)this._domNode=null},_idIt:function(a,c){a.id=a&&a.id||c||b.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,c){return document.getElementById(this.id).setAttribute(a,c)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},
handelMounted:function(){this.view.rendered?(this.mounted=!0,this.trigger("mounted",this.view)):this.view.bind("rendered",function(){this.mounted=!0;this.trigger("mounted",this.view)})},mountView:function(a,c){if(a){this.view&&this.view.destroy();var b=this,d=this.getRouterObject(),c=c||{};if(!c.queryModel)c.queryModel=d.queryModel;e.requireAsync(a,function(d){c.vcid=b.id;c.viewName=a;b.view=new d(c);b.handelMounted()})}},unmountView:function(){this.view.trigger("unload");document.getElementById(this.view.vcid).innerHTML=
"";if(this.view.events){var a=document.getElementById(this.id),c;for(c in this.view.events)a["on"+c]=null}this.mounted=!1;this.view=null},removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var c,b,d=[];for(c=0;c<this.childNodes.length;c++)b=this.childNodes[c],
b==a?this._popFromVOM(b):d.push(b);this.childNodes=d},_popFromVOM:function(a){e.requireAsync("magix/vom",function(c){c.pop(a)})}});return e.implement(b,d).init()});
define("magix/view",["magix/impls/view","magix/base"],function(d){var e=d("magix/impls/view"),b=d("magix/base"),d=function(){};b.mix(d.prototype,{render:b.unimpl,getTemplate:b.unimpl,getVOMObject:b.unimpl,getTemplateObject:b.unimpl,getAjaxObject:b.unimpl,dispose:b.unimpl,queryModelChange:function(){},refresh:function(){},initial:function(a){var c=this,b=this.getVOMObject();this.subViewsChange=[];this.options=a;this.vcid=a.vcid;this.queryModel=a.queryModel;this.viewName=a.viewName;this.data=a.data||
{};a.message&&"function"==typeof a.message&&this.bind("message",a.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});this.bind("rendered",function(){this.trigger("beforeSubviewsRender");var a=b.getElementById(this.vcid),c=a.getElements(),d,e;for(d=0;d<c.length;d++)e=b.createElement(c[d]),a.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.queryModel})});b.getElementById(this.vcid)==b.root&&this.queryModel.bind("change",function(){var a=c.queryModelChange(this);
c._changeChain(a,this)});this.init&&this.init();this.getTemplate(function(a){c.template=a;!1!==c.render()&&c.trigger("rendered")})},_queryModelChange:function(a){this._changeChain(this.queryModelChange(a),a)},_changeChain:function(a,c){var d=[],e;e=this.getVOMObject().getElementById(this.vcid);if(!1!==a){!0===a||void 0===a?d=e.childNodes:b.isArray(a)&&(d=a);for(e=0;e<d.length;e++)d[e].view&&d[e].view._queryModelChange(c)}},destory:function(){this.destroy()},destroy:function(){var a,c,b=this.getVOMObject();
a=this.getDestoryQueue();for(c=a.length-1;0<c;c--)a[c].removeNode();b.getElementById(this.vcid).unmountView();this.dispose()},getDestoryQueue:function(){function a(b){var d;c.push(b);for(d=0;d<b.childNodes.length;d++)a(b.childNodes[d])}var c=[],b=this.getVOMObject().getElementById(this.vcid);a(b);return c},setData:function(a){this.data=a;for(var c in a)a[c].toJSON&&(a[c]=a[c].toJSON());a.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var a=this,c=this.renderer,b,d;if(c)for(b in c)for(d in c[b])(function(){var e=
b,k=d,m=c[e][k];a.data[e+"_"+k]=function(){return m.call(this,a,e)}})()},delegateEvents:function(){var a=this.events,b=this.eventsLevel,d=this.getVOMObject(),e=document.getElementById(this.options.vcid),l;for(l in a)(function(){var a=l,m="mx"+a;e["on"+a]=function(n){var n=n||window.event,g=n.target||n.srcElement;if(3===g.nodeType)g=g.parentNode;var j=g.getAttribute(m);if(b)var i=b[a];if(!j&&i)if(!isNaN(i)&&i)for(;i&&g!=e;){g=g.parentNode;if(j=g.getAttribute(m))break;i--}else if(i.split(".")[1])for(i=
i.split(".")[1];g!=e;){if(g=g.parentNode,0<=g.className.indexOf(i)){j=g.getAttribute(m);break}}else{if(i.split("#")[1])for(i=i.split("#")[1];g!=e;)if(g=g.parentNode,g.id==i){j=g.getAttribute(m);break}}else if(!j)g=g.parentNode,j=g.getAttribute(m);if(j)for(var i=j.split("|"),l,o=d.getElementById(this.id).view,q=0;q<i.length;q++){j=i[q].split(":");l=j.shift();var p=j[j.length-1],r=!1;if("_halt_"==p||"_preventDefault_"==p)n.preventDefault?n.preventDefault():n.returnValue=!1,r=!0;if("_halt_"==p||"_stop_"==
p)n.stopPropagation?n.stopPropagation():n.cancelBubble=!0,r=!0;r&&j.pop();if(o.events&&o.events[a]&&o.events[a][l])o.events[a][l](o,o.idIt(g),j)}}})()},render:function(){if(this.preventRender)return this.rendered=!0;var a=document.getElementById(this.vcid),b=this.getTemplateObject();a.innerHTML=b.toHTML({template:this.template,data:{data:this.data,queryModel:this.queryModel.toJSON()}});this.rendered=!0},getTemplate:function(a,b){if(this.preventRender)a();else{var d=Magix.config.appHome+this.viewName.split("app")[1];
this.getAjaxObject().getTemplate(b?d+".name.html":d+".html",function(b){a(b)},function(b){a(b)})}},idIt:function(a){var c="";if(!a.id)a.id=b.uniqueId("mxevt-");return c=a.id}});return b.implement(d,e)});
define("magix/vom",["magix/impls/vom","magix/base","magix/vframe"],function(d){var e=d("magix/impls/vom"),b=d("magix/base"),a=d("magix/vframe"),d={};b.mix(d,{_idMap:{},root:null,setRootVframe:b.unimpl,init:function(){this.setRootVframe();return this},push:function(a){this._idMap[a.id]=a},pop:function(a){delete this._idMap[a.id]},createElement:function(c,d){b.isString(c)&&(c=document.getElementById(c));var e=new a(c,d);this.push(e);return e},getElementById:function(a){return this._idMap[a]||null}});
return b.implement(d,e).init()});