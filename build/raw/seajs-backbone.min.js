define("magix/ajax",["magix/impls/ajax","magix/base"],function(a){var c=a("magix/impls/ajax"),e=a("magix/base");return e.implement({defaultOptions:{dataType:"html",success:function(){},failure:function(){}},send:e.unimpl,processOptions:function(b){b||(b={});for(var d in this.defaultOptions)b[d]||(b[d]=this.defaultOptions[d]);return b},getTemplate:function(b,d,a){var f=this,c;if(!f.$cache)f.$cache={};(c=f.$cache[b])?c.succ&&e.isFunction(d)?d(c.content):!c.succ&&e.isFunction(a)&&a(c.content):f.send({url:b,
dataType:"html",success:function(a){f.$cache[b]={succ:!0,content:a};e.isFunction(d)&&d(a)},failure:function(d){f.$cache[b]={content:d};e.isFunction(a)&&a(d)}})}},c)});
define("magix/base",["magix/impls/base"],function(a){var a=a("magix/impls/base"),c={mix:function(e,b,d,a){if(!b||!e)return e;void 0===d&&(d=!0);var f,c,h;if(a&&(h=a.length))for(f=0;f<h;f++){if(c=a[f],c in b&&(d||!(c in e)))e[c]=b[c]}else for(c in b)if(d||!(c in e))e[c]=b[c];return e},include:function(a){var a=Magix.config.magixHome+"../"+a+".js?r="+Math.random(),b=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");b.open("GET",a,!1);b.send(null);return b.responseText},unimpl:function(){throw Error("unimplement method");
}};c.mix(c,{isFunction:c.unimpl,isArray:c.unimpl,isString:c.unimpl,isPlainObject:c.unimpl,requireAsync:c.unimpl,Events:c.unimpl,_idCounter:0,uniqueId:function(a){var b=this._idCounter++;return a?a+b:b},extend:function(a,b,d,m){if(!b||!a)return a;var f=Object.prototype,c=b.prototype,h=function(b){function d(){}d.prototype=b;return new d}(c);a.prototype=h;h.constructor=a;a.superclass=c;if(b!==Object&&c.constructor===f.constructor)c.constructor=b;d&&this.mix(h,d);m&&this.mix(a,m);return a},param:function(a){var b=
[],d;for(d in a)a.hasOwnProperty(d)&&b.push(d+"="+a[d]);return b.join("&")},unParam:function(a){for(var a=a.split("&"),b,d={},m=0;m<a.length;m++)b=a[m].split("="),b[0]&&(d[b[0]]=b[1]||"");return d},mixClassStaticProps:function(a,b){for(var d in b)b.hasOwnProperty(d)&&"prototype"!=d&&(a[d]=b[d]);return a},mixClassProtoProps:function(a,b){for(var d in b)if(!a[d]||a[d]==c.unimpl)a[d]=b[d];return a},implement:function(a,b){if(c.isFunction(a)&&c.isFunction(b)){b.prototype.constructor=b;var d=function(){b.apply(this,
arguments);a.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments);b.prototype.initial&&b.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(d,a);this.mixClassStaticProps(d,b);this.mixClassProtoProps(d.prototype,a.prototype);this.mixClassProtoProps(d.prototype,b.prototype);return d.prototype.constructor=d}d={};c.mix(d,a);c.mix(d,b);return d}});c.mix(c,a);return c});
define("magix/impls/ajax",["jquery"],function(a){var c={},e=a("jquery");c.send=function(b){b=this.processOptions(b);e.ajax({url:b.url,dataType:b.dataType,success:function(a){b.success(a)},error:function(a,m){b.failure(m)}})};return c});
define("magix/impls/base",["backbone"],function(a){var c=a("backbone"),e=Object.prototype.toString;return{isFunction:function(b){return"[object Function]"===e.call(b)},isArray:function(b){return"[object Array]"===e.call(b)},isString:function(b){return"[object String]"===e.call(b)},isPlainObject:function(b){return b&&"[object Object]"===e.call(b)&&!b.nodeType&&!b.setInterval},requireAsync:function(b,d){a.async(b,d)},Events:c.Events}});define("magix/impls/model",["backbone"],function(a){return a("backbone").Model});
define("magix/impls/router",["magix/base","magix/model","magix/vom","app/config/ini"],function(a){var c=a("magix/base"),e=a("magix/model"),b=a("magix/vom"),d=a("app/config/ini");return{getAppConfig:function(){var b=d.pathViewMap;if(d.defaultViewName)for(var a in b)if(!b[a])b[a]=d.defaultViewName;return d},setStateListener:function(){var b=this;MxHistory.setHashListener(function(a){b.route(a)})},parseState:function(b){return this._parseHash(b)},_parseHash:function(b){var a={},d;a.pathName=this.appConfig.indexPath;
a.paraObj={};a.referrer=this.state&&this.state.query||null;if(a.query=b)b=b.split("/"),d=b.pop(),a.pathName=b.join("/"),a.paraObj=c.unParam(d);return a},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var b={},a=this.config.pathPrefix||null;b.pathName=location.pathname;b.paraObj={};if(a)b.pathName=location.pathname.split(a)[1];b.query=b.pathName+location.search;if(location.search)b.paraObj=c.unParam(location.search.substr(1));return b},getRootViewName:function(){var b=this.appConfig.pathViewMap,
a;a=b[this.query.pathname]?b[this.query.pathname]:b[this.appConfig.notFoundPath];this.query.__view__&&(a=this.query.__view__.split("-").join("/"));if(this.config.multipage)b=b[this.query["sch:pathname"]],"object"==typeof b?a=b[this.query.pathname]||b[this.appConfig.notFoundPath]:(document.body.id="vc-root",a=b||this.appConfig.defaultRootViewName);return a},createQueryModel:function(){return new e(this.query)},changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},
_fixQueryModel:function(b){if(this.queryModel){var a,d=this.queryModel.toJSON();for(a in d)a in b||this.queryModel.unset(a,{silent:!0})}},mountRootView:function(){b.root.mountView(this.rootViewName,{queryModel:this.queryModel})}}});define("magix/impls/template",["magix/mu"],function(a){var c={},e=a("magix/mu");c.toHTML=function(b){b=this.processOptions(b);return e.to_html(b.template,b.data)};return c});
define("magix/impls/vframe",["magix/base","magix/router"],function(a){var c=a("magix/base"),e=a("magix/router"),b=function(){};c.mix(b,{tagName:"vframe"});c.mix(b.prototype,{getChildVframeNodes:function(){var b=document.getElementById(this.id).getElementsByTagName("vframe"),a,c=[];for(a=0;a<b.length;a++)c.push(this._idIt(b[a]));return c},getRouterObject:function(){return e},createFrame:function(){return document.createElement(b.tagName)}});return b});
define("magix/impls/view",["backbone","magix/vom","magix/ajax","magix/template"],function(a){var c=a("magix/vom"),e=a("magix/ajax"),b=a("backbone"),d=a("magix/template");return b.View.extend({getVOMObject:function(){return c},getAjaxObject:function(){return e},getTemplateObject:function(){return d},dispose:function(){}})});
define("magix/impls/vom",["magix/base"],function(a){a("magix/base");return{setRootVframe:function(){var a=null;if("vf-root"==document.body.id)a=document.body;var e=this.createElement(a,"vf-root");a||document.body.insertBefore(e.getOnce(),document.body.firstChild);this.root=e}}});
Magix={init:function(a){this.config=a;this.setEnv();this.bootstrap()},setEnv:function(){var a={magix:this.config.magixHome,app:this.config.appHome};this.dev||delete a.magix;seajs.config({debug:2,alias:a});MxHistory&&MxHistory.init&&MxHistory.init(this.config)},bootstrap:function(){var a=this;seajs.use(["magix/router"],function(c){c.init(a.config)})},implementBy:"seajs-backbone-jquery",version:"0.3.0",dev:""};
define("magix/model",["magix/impls/model","magix/base"],function(a){var c=a("magix/impls/model");return a("magix/base").implement(function(){},c)});
define("magix/mu",["mustache"],function(a){function c(b){b=b.split("==");return function(){for(var a=b[0].split("."),c=b[1],e=a.length-1;-1<e;e--){var h=a.slice(e),k=this;try{for(var n=0;n<h.length-1;n++)k=k[h[n]];if(h[h.length-1]in k){if(k[h[h.length-1]].toString()===c)return!0;break}}catch(i){}}return!1}}function e(b,a){var c,g;for(c in b)if(g=b[c],g instanceof Array)for(var h=0;h<g.length;h++){if(o=g[h],"object"==typeof o)0===h?o.__first__=!0:h==g.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=
h}else"object"==typeof g&&5>a&&e(g,a+1)}var b=a("mustache");return{to_html:function(a,m){"object"==typeof m&&e(m,0);var f=m,g;g=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i;var h=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),k=[];if(h)for(var n=0;n<h.length;n++)k.push(h[n].match(g)[1]);g=k;h="";for(k=0;k<g.length;k++)h="if("+g[k]+")",f[h]||(f[h]=c(g[k]));return b.to_html.apply(this,arguments)}}});if(!window.console)window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};
MxHistory={config:{},hash:"",oldHash:null,showIframe:!1,isIE:!1,iframe:null,slient:!1,interval:50,intervalId:0,iframeSrc:"",ready:!1,hashListener:null,currentHash:"",init:function(a){a=a||{};this.iframeSrc=a.iframeSrc||"mxhistory.html";this.config=a;this.oldHash=this.hash=location.hash;this.isIE=-1<navigator.userAgent.toLowerCase().indexOf("msie");a=document.documentMode;this.showIframe=this.isIE&&(!a||8>a);this.wirteFrame(this.iframeSrc);this.regHashChange();this.showIframe||this.route(this.hash)},
regHashChange:function(){var a=this;"onhashchange"in window&&!this.showIframe?window.onhashchange=function(){a.hashChange.call(a)}:this.intervalId=window.setInterval(function(){location.hash!=a.oldHash&&a.hashChange.call(a)},this.interval)},hashChange:function(){this.oldHash=this.hash=location.hash;this.showIframe?this.iframe.src=this.iframeSrc+"?"+(this.hash?this.hash.substr(1):""):this.route(this.hash)},frameLoad:function(){var a=Magix.History;if(a.iframe){var c=a.iframe.contentWindow.location.search.substr(1);
a.hash=a.oldHash="#"+c;location.hash=c}this.route(this.hash)},route:function(a){0===a.indexOf("?")&&(a=a.substr(1));0===a.indexOf("#")&&(a=a.substr(1));0===a.indexOf("!")&&(a=a.substr(1));this.hashListener&&this.hashListener(a);this.ready=!0;this.currentHash=a},wirteFrame:function(){var a=this;this.showIframe&&document.write("<iframe onload='Magix.History.frameLoad();' id='MxHistory' src='"+this.iframeSrc+"?"+(this.hash?this.hash.substr(1):"")+"' style='z-index:99998;visibility:hidden;position:absolute;' border='0' frameborder='0' marginwidth='0' marginheight='0' scrolling='no' ></iframe>");
window.setTimeout(function(){a.iframe=document.getElementById("MxHistory")},0)},setHashListener:function(a){this.hashListener=a;this.ready&&a(this.currentHash)}};
define("magix/router",["magix/impls/router","magix/base"],function(a){var c=a("magix/impls/router"),e=a("magix/base"),a={};e.mix(a,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:e.unimpl,setStateListener:e.unimpl,parseState:e.unimpl,parseSearch:e.unimpl,getRootViewName:e.unimpl,createQueryModel:e.unimpl,changeQueryModel:e.unimpl,mountRootView:e.unimpl,navigateTo:e.unimpl,goTo:e.unimpl,setPostData:e.unimpl,
init:function(b){this.config=b;this.appConfig=this.getAppConfig();this.setStateListener()},route:function(b){this.state=this.parseState(b);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;this.rootViewName=this.getRootViewName();this.rootViewName==this.oldRootViewName?this.changeQueryModel():(this.queryModel=this.createQueryModel(),this.mountRootView());this.postData=null},_spreadLocator:function(){var b=
{},a=this._locator;e.mix(b,a.state.paraObj);e.mix(b,{referrer:a.state.referrer,query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var c={},f,g=a.search.paraObj;c["sch:pathname"]=a.search.pathName;c["sch:query"]=a.search.query;for(f in g)c["sch:"+f]=g[f];e.mix(b,c);return b}});return e.implement(a,c)});
define("magix/template",["magix/impls/template","magix/base"],function(a){var c=a("magix/impls/template"),a=a("magix/base");return a.implement({defaultOptions:{data:{},template:""},processOptions:function(a){for(var b in this.defaultOptions)a[b]||(a[b]=this.defaultOptions[b]);return a},toHTML:a.unimpl},c)});
define("magix/vframe",["magix/impls/vframe","magix/base"],function(a){var c=a("magix/base"),a=a("magix/impls/vframe"),e;e=function(){};c.mix(e,{tagName:c.unimpl,uniqueId:function(){return c.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});c.mix(e.prototype,c.Events);c.mix(e.prototype,{getChildVframeNodes:c.unimpl,getRouterObject:c.unimpl,createFrame:c.unimpl,initial:function(b,a){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=b||
this.createFrame();this.id=this._idIt(this._domNode,a);if(b)this._domNode=null},_idIt:function(b,a){b.id=b&&b.id||a||e.uniqueId();return b.id},getOnce:function(){var b=this._domNode;this._domNode=null;return b},getAttribute:function(b){return document.getElementById(this.id).getAttribute(b)||""},setAttribute:function(b,a){return document.getElementById(this.id).setAttribute(b,a)},appendChild:function(b){this.childNodes.push(b);b.parentNode=this},getElements:function(){return this.getChildVframeNodes()},
handelMounted:function(){this.view.rendered?(this.mounted=!0,this.trigger("mounted",this.view)):this.view.bind("rendered",function(){this.mounted=!0;this.trigger("mounted",this.view)})},mountView:function(b,a){if(b){this.view&&this.view.destroy();var e=this,f=this.getRouterObject(),a=a||{};if(!a.queryModel)a.queryModel=f.queryModel;c.requireAsync(b,function(c){a.vcid=e.id;a.viewName=b;e.view=new c(a);e.handelMounted()})}},unmountView:function(){this.view.trigger("unload");document.getElementById(this.view.vcid).innerHTML=
"";if(this.view.events){var a=document.getElementById(this.id),d;for(d in this.view.events)a["on"+d]=null}this.mounted=!1;this.view=null},removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var d,c,e=[];for(d=0;d<this.childNodes.length;d++)c=this.childNodes[d],
c==a?this._popFromVOM(c):e.push(c);this.childNodes=e},_popFromVOM:function(a){c.requireAsync("magix/vom",function(d){d.pop(a)})}});return c.implement(e,a).init()});
define("magix/view",["magix/impls/view","magix/base"],function(a){var c=a("magix/impls/view"),e=a("magix/base"),a=function(){};e.mix(a.prototype,{render:e.unimpl,getTemplate:e.unimpl,getVOMObject:e.unimpl,getTemplateObject:e.unimpl,getAjaxObject:e.unimpl,dispose:e.unimpl,queryModelChange:function(){},refresh:function(){},initial:function(a){var d=this,c=this.getVOMObject();this.subViewsChange=[];this.options=a;this.vcid=a.vcid;this.queryModel=a.queryModel;this.viewName=a.viewName;this.data=a.data||
{};a.message&&"function"==typeof a.message&&this.bind("message",a.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});this.bind("rendered",function(){this.trigger("beforeSubviewsRender");var a=c.getElementById(this.vcid),b=a.getElements(),d,e;for(d=0;d<b.length;d++)e=c.createElement(b[d]),a.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.queryModel})});c.getElementById(this.vcid)==c.root&&this.queryModel.bind("change",function(){var a=d.queryModelChange(this);
d._changeChain(a,this)});this.init&&this.init();this.getTemplate(function(a){d.template=a;!1!==d.render()&&d.trigger("rendered")})},_queryModelChange:function(a){this._changeChain(this.queryModelChange(a),a)},_changeChain:function(a,d){var c=[],f;f=this.getVOMObject().getElementById(this.vcid);if(!1!==a){!0===a||void 0===a?c=f.childNodes:e.isArray(a)&&(c=a);for(f=0;f<c.length;f++)c[f].view&&c[f].view._queryModelChange(d)}},destory:function(){this.destroy()},destroy:function(){var a,d,c=this.getVOMObject();
a=this.getDestoryQueue();for(d=a.length-1;0<d;d--)a[d].removeNode();c.getElementById(this.vcid).unmountView();this.dispose()},getDestoryQueue:function(){function a(c){var e;d.push(c);for(e=0;e<c.childNodes.length;e++)a(c.childNodes[e])}var d=[],c=this.getVOMObject().getElementById(this.vcid);a(c);return d},setData:function(a){this.data=a;for(var d in a)a[d].toJSON&&(a[d]=a[d].toJSON());a.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var a=this,d=this.renderer,c,e;if(d)for(c in d)for(e in d[c])(function(){var g=
c,h=e,k=d[g][h];a.data[g+"_"+h]=function(){return k.call(this,a,g)}})()},delegateEvents:function(){var a=this.events,c=this.eventsLevel,e=this.getVOMObject(),f=document.getElementById(this.options.vcid),g;for(g in a)(function(){var a=g,b="mx"+a;f["on"+a]=function(g){var g=g||window.event,i=g.target||g.srcElement;if(3===i.nodeType)i=i.parentNode;var l=i.getAttribute(b);if(c)var j=c[a];if(!l&&j)if(!isNaN(j)&&j)for(;j&&i!=f;){i=i.parentNode;if(l=i.getAttribute(b))break;j--}else if(j.split(".")[1])for(j=
j.split(".")[1];i!=f;){if(i=i.parentNode,0<=i.className.indexOf(j)){l=i.getAttribute(b);break}}else{if(j.split("#")[1])for(j=j.split("#")[1];i!=f;)if(i=i.parentNode,i.id==j){l=i.getAttribute(b);break}}else if(!l)i=i.parentNode,l=i.getAttribute(b);if(l)for(var j=l.split("|"),r,p=e.getElementById(this.id).view,s=0;s<j.length;s++){l=j[s].split(":");r=l.shift();var q=l[l.length-1],t=!1;if("_halt_"==q||"_preventDefault_"==q)g.preventDefault?g.preventDefault():g.returnValue=!1,t=!0;if("_halt_"==q||"_stop_"==
q)g.stopPropagation?g.stopPropagation():g.cancelBubble=!0,t=!0;t&&l.pop();if(p.events&&p.events[a]&&p.events[a][r])p.events[a][r](p,p.idIt(i),l)}}})()},render:function(){if(this.preventRender)return this.rendered=!0;var a=document.getElementById(this.vcid),c=this.getTemplateObject();a.innerHTML=c.toHTML({template:this.template,data:{data:this.data,queryModel:this.queryModel.toJSON()}});this.rendered=!0},getTemplate:function(a,c){if(this.preventRender)a();else{var e=Magix.config.appHome+this.viewName.split("app")[1];
this.getAjaxObject().getTemplate(c?e+".name.html":e+".html",function(c){a(c)},function(c){a(c)})}},idIt:function(a){var c="";if(!a.id)a.id=e.uniqueId("mxevt-");return c=a.id}});return e.implement(a,c)});
define("magix/vom",["magix/impls/vom","magix/base","magix/vframe"],function(a){var c=a("magix/impls/vom"),e=a("magix/base"),b=a("magix/vframe"),a={};e.mix(a,{_idMap:{},root:null,setRootVframe:e.unimpl,init:function(){this.setRootVframe();return this},push:function(a){this._idMap[a.id]=a},pop:function(a){delete this._idMap[a.id]},createElement:function(a,c){e.isString(a)&&(a=document.getElementById(a));var f=new b(a,c);this.push(f);return f},getElementById:function(a){return this._idMap[a]||null}});
return e.implement(a,c).init()});