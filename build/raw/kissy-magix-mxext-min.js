KISSY.add("magix/event",function(h,f){var e=f.safeExec;return{trigger:function(a,b,c,d){var l="~~"+a+"_list",g=this[l];if(g){b||(b={});if(!b.type)b.type=a;if(d)for(a=g.length-1;0<=a&&!(!1===e(g[a],b,this));a--);else{a=0;for(d=g.length;a<d&&!(!1===e(g[a],b,this));a++);}}c&&delete this[l]},bind:function(a,b){var c="~~"+a+"_list";this[c]||(this[c]=[]);this[c].push(b)},unbind:function(a,b){var c="~~"+a+"_list",d=this[c];if(d)if(b)for(var c=0,e=d.length;c<e;c++){if(d[c]==b){d.splice(c,1);break}}else delete this[c]}}},
{requires:["magix/magix"]});
KISSY.add("magix/impl/magix",function(h){return{include:function(f){var f=h.Config.packages.magix.path+f+".js?r="+Math.random()+".js",e=new (window.ActiveXObject||window.XMLHttpRequest)("Microsoft.XMLHTTP");e.open("GET",f,!1);e.send(null);return e.responseText},libRequire:function(f,e){h.use(f,function(a,b){e(b)})},libEnv:function(){var f=this.config(),e=f.appHome;if(!e)throw Error("please set appHome");e=e.replace(/(^|\/)app\/?/i,function(b,a){return a||"./"});f.appHome=e;if(!f.release&&/^https?:\/\//.test(e))f.release=
-1==e.indexOf(location.protocol+"//"+location.host);f.release||h.config({map:[[RegExp("("+e+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]});var a="";(a=f.release?f.appTag:h.now())&&(a+=".js");h.config({packages:[{name:"app",path:e,tag:a}]});f.viewChangeAnim&&h.Env.mods["mxext/vfanim"]&&h.use("mxext/vfanim")},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber}});
KISSY.add("magix/impl/router",function(h){return{useHistoryState:function(){var f=this,e=location.href;h.one(window).on("popstate",function(){var a=location.href==e;if(f.$canFirePopState||!a)f.$canFirePopState=!0,f.route()})},useLocationHash:function(){var f=this;h.one(window).on("hashchange",function(){f.suspend();f.route();f.resume()})}}});
KISSY.add("magix/impl/view",function(h,f,e,a){var e=function(){},b={idIt:1,wrapAsyncUpdate:1,registerAsyncUpdateName:1,extend:1};e.extend=function(c,d){var e=function(){e.superclass.constructor.apply(this,arguments);d&&a.safeExec(d,[],this)},g;for(g in this)a.hasProp(b,g)&&(e[g]=this[g]);return h.extend(e,this,c)};a.mix(e.prototype,{getTmplByXHR:function(b,a){f({url:b,dataType:"html",success:function(b){a(b)},error:function(b,c){a(c)}})},delegateUnbubble:function(b,a){var e=this;if(!e.$cacheEvents)e.$cacheEvents=
{};b=h.one(b);b.delegate(a,"*[mx"+a+"]",e.$cacheEvents[a]=function(b){e.processEvent(b)})},undelegateUnbubble:function(b,a){var e=this.$cacheEvents;e&&(b=h.one(b),b.undelegate(a,"*[mx"+a+"]",e[a]),delete e[a])}});return e},{requires:["ajax","sizzle","magix/magix"]});
KISSY.add("magix/magix",function(h,f){var e=function(b,a){return!b?!1:Object.prototype.hasOwnProperty.call(b,a)},a=function(b,a,c){for(var d in a)if(e(a,d)&&(!c||!e(c,d)))b[d]=a[d];return b},b=function(b,a,c,e,f,j){d.isArray(b)||(b=[b]);if(!a||!d.isArray(a)&&!a.callee)a=[a];for(e=0;e<b.length;e++)try{j=b[e],f=d.isFunction(j)&&j.apply(c,a)}catch(u){h.log(u,j)}return f},c=function(){throw Error("unimplement method");},d={isArray:c,isObject:c,isFunction:c,isRegExp:c,isString:c,isNumber:c,libRequire:c,
include:c,libEnv:c,mix:a,unimpl:c,hasProp:e,safeExec:b,noop:function(){},templates:{},cfg:{},locals:{},config:function(b){var c=this.cfg;if(b)this.cfg=a(c,b);return this.cfg},start:function(a){var c=this,a=c.config(a);c.libEnv();a.ready&&(b(a.ready),delete a.ready);c.libRequire("magix/router",function(b){c.libRequire("magix/vom",function(a){b.bind("locationChanged",function(b){b.changed.isViewPath()?a.remountRootVframe(b):a.notifyLocationChange(b)});b.bind("idle",function(){a.resume()});b.bind("busy",
function(){a.suspend()});b.start()})})},objectKeys:function(b){if(Object.keys)return Object.keys(b);var a=[],c;for(c in b)e(b,c)&&a.push(c);return a},local:function(b,c){var e=arguments,d=this.locals;if(0==e.length)return d;if(1==e.length)if(this.isObject(b))a(d,b);else return d[b];else d[b]=c}};return d.mix(d,f)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(h,f,e,a){var b=e.hasProp,c=e.mix,d=function(a){var n,A=this.params;e.isArray(a)||(a=(""+a).split(","));for(var i=0;i<a.length&&!(n=b(A,a[i]));i++);return n},l=function(){return b(this,k)},g=function(){return b(this,"viewPath")},t=function(){return this.hash[k]!=this.query[k]},m=function(b){return this.hash.params[b]!=this.query.params[b]},p=function(a){return b(this.hash.params,a)},j=function(a){return b(this.query.params,a)},u=function(b){return this.params[b]},
s=e.safeExec,o=window,v=encodeURIComponent,w=decodeURIComponent,x=/\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,y=/[^\/]*$/,r=/([#?]).*$/,q=/([^=&?\/#]+)=([^&=#?]*)/g,k="pathname",h=c({iQ:[],iC:0,qH:{},useHistoryState:e.unimpl,useLocationHash:e.unimpl,compareObject:function(b,n){for(var a=[],a=a.concat(e.objectKeys(b)),a=a.concat(e.objectKeys(n)),i=0;i<a.length;i++){var c=a[i];if(b[c]!=n[c])return!1}return!0},getPathnameRelations:function(){if(this.$pnr)return this.$pnr;var a={virtualToReal:{},virtualRegExpToReal:{}},
n=e.config().pathCfg,c=n.map,i=n.defaultView,d=n.defaultPathname||"";if(e.isObject(c))for(var g in c)if(b(c,g))for(var f=g,j=c[g],p=[],p=e.isArray(j)?j:e.isString(j)?j.split(","):[j],j=0;j<p.length;j++)e.isRegExp(p[j])?a.virtualRegExpToReal[f]=p[j]:(!d&&f==i&&(d=p[j]),a.virtualToReal[p[j]]=f);if(!i)throw Error("unset defaultView");a.virtualToReal[""]=i;a.home=i;a[k]=d;a.notFound=n.notFound;return this.$pnr=a},getViewPath:function(b){var a=this.getPathnameRelations();b||(b=a[k]);var c=a.virtualToReal[b];
if(!c)for(var i in a.virtualRegExpToReal)if(a.virtualRegExpToReal[i].test(b)){c=i;break}return{viewPath:c?c:a.notFound||a.home,pathname:c?b:a.notFound?b:a[k]}},start:function(){this.supportHistoryState()?this.useHistoryState():this.useLocationHash();this.route()},supportHistoryState:function(){var b=o.history;return e.config().useHistoryState&&b.pushState&&b.replaceState},pathToObject:function(b){var a={},c={},i=o.location.protocol,d="";r.test(b)?d=b.replace(r,""):~b.indexOf("=")||(d=b);if(d)if(0==
d.indexOf(i))i=d.indexOf("/",i.length+2),d=-1==i?"/":d.substring(i);else if("/"!=d.charAt(0)&&e.config().useHistoryState&&!this.supportHistoryState()){i=o.location[k].replace(y,"");for(i+=d;x.test(i);)i=i.replace(x,"$1/");d=i}b.replace(q,function(b,a,n){c[a]=n});a[k]=d;a.params=c;return a},objectToPath:function(a){var n=a[k],c=[],i;for(i in a.params)b(a.params,i)&&c.push(i+"="+a.params[i]);return n+(c.length?"?":"")+c.join("&")},parseQueryAndHash:function(){var a=o.location.href,n=this.qH;try{a=w(a)}catch(d){}if(b(n,
a))return n[a];var i=a.replace(/^[^?#]+/g,""),e=o.location[k]+i.replace(/^([^#]+).*$/g,"$1"),i=i.replace(/^[^#]*#?/g,""),g=this.pathToObject(e),f=this.pathToObject(i.replace(/^!?/,"")),h={};c(h,g.params);c(h,f.params);return n[a]={isPathnameDiff:t,isParamDiff:m,hashParamsOwn:p,queryParamsOwn:j,get:u,originalQuery:e,originalHash:i,query:g,hash:f,params:h}},parseLocation:function(){var b=this.parseQueryAndHash(),a=this.getViewPath(e.config().useHistoryState?b.hash[k]?b.hash[k]:b.query[k]:b.hash[k]);
return c(b,a)},getChangedLocation:function(b,a){var c={params:{}};b[k]!=a[k]&&(c[k]=!0);if(b.viewPath!=a.viewPath)c.viewPath=!0;for(var i=e.objectKeys(b.params),i=i.concat(e.objectKeys(a.params)),j=0;j<i.length;j++){var f=i[j];b.params[f]!==a.params[f]&&(c.params[f]=!0)}c.isParam=d;c.isPathname=l;c.isViewPath=g;return c},route:function(){var b=this.parseLocation(),a=this.$location||{params:{}},c=!this.$location,i;b.viewPath==(a.viewPath||"")?this.compareLocation(a,b)||(i=!0):i=!0;i&&(a=this.getChangedLocation(a,
b),this.trigger("locationChanged",{location:b,changed:a,firstFire:c}));this.$location=b;this.resume()},compareLocation:function(b,a){return b[k]!=a[k]?!1:this.compareObject(b.params,a.params)},navigate2:function(a){var n=this;a&&e.isString(a)&&n.idle(function(){n.trigger("busy");n.suspend();var d=n.pathToObject(a),i=c({},n.$location.params),i=c(i,d.params);if(d[k]){if(e.config().useHistoryState&&!n.supportHistoryState()&&(i=n.$location.query)&&(i=i.params))for(var j in i)b(i,j)&&!b(d.params,j)&&(d.params[j]=
"")}else d.params=i,d[k]=n.$location[k];n.compareLocation(d,n.$location)?n.resume():(d=n.objectToPath(d),n.supportHistoryState()?(n.$canFirePopState=!0,history.pushState(new Date,document.title,d),n.route()):location.hash="#!"+d)})},navigate:function(b,a){if(e.isObject(b)){var c=[],i;for(i in b)c.push(i+"="+v(b[i]));b=c.join("&");a&&(b=a+"?"+b)}this.navigate2(b)},idle:function(b){this.iC?this.iQ.push(b):s(b)},suspend:function(){this.iC++},resume:function(){0<this.iC&&(this.iC--,this.iC||(this.trigger("idle"),
this.iQ.length&&this.idle(this.iQ.shift())))}},a);return e.mix(h,f)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(h,f,e){var a=document,b=0,c=window.CollectGarbage||f.noop,d=f.safeExec,l=function(b){return"object"==typeof b?b:a.getElementById(b)},g=function(b){this.rC=0;this.rM={};this.notifyParentAlter();var a=this.view;d(a.trigger,"childrenAlter",a);this.unloadSubVframes(b)},t=/<script[^>]*>[\s\S]*?<\/script>/ig,m=function(b){this.id=m.idIt(b);this.viewId=this.id+"_view";this.children=[];this.view=null;this.rC=0;this.rM={}};f.mix(m,{tagName:"vframe",idIt:function(a){return a.id||
(a.id="magix_vf_"+b++)},createVframe:function(b,a){var b=l(b),c=new m(b);f.mix(c,a);return c},createVframeNode:function(b,c){var d=a.createElement(m.tagName);d.id=b;c.parentNode.insertBefore(d,c)}});a.createElement(m.tagName);f.mix(m.prototype,e);f.mix(m.prototype,{viewChangeUseAnim:function(){return!1},oldViewDestroy:f.noop,prepareNextView:f.noop,newViewCreated:f.noop,mountView:function(b){var a=this,c=l(a.id);if(!c._dataBak)c._dataBak=!0,c._dataTmpl=c.innerHTML.replace(t,"");var d=a.viewName&&a.viewChangeUseAnim();
a.unmountView(d,!0);if(b)a.viewName=b,f.libRequire(b,function(e){if(b==a.viewName){e.wrapAsyncUpdate();var f;d?(f=a.viewId,a.prepareNextView()):f=a.id;var h=new e({viewName:b,owner:a,ownerVOM:a.owner,id:f,vId:a.viewId,vfId:a.id});h.bind("interact",function(b){a.trigger("viewLoad",{view:h},a.vced=!0);d&&a.newViewCreated(!0);if(!b.tmpl){if(!d)c.innerHTML=c._dataTmpl;a.loadSubVframes()}h.bind("rendered",function(){a.loadSubVframes()});h.bind("prerender",function(b){g.call(a,b.anim)})});a.view=h;h.load()}})},
unmountView:function(b,a){if(this.view){g.call(this,b);this.view.destroy();this.vced=!1;var d=l(this.id);if(!b&&d._dataBak)d.innerHTML=d._dataTmpl,c();b&&a&&this.oldViewDestroy();delete this.view;delete this.viewName}else this.viewName&&(this.unbind("viewLoad"),delete this.viewName)},loadSubVframes:function(){this.owner.suspend();var b=(l(this.viewId)||l(this.id)).getElementsByTagName(m.tagName),a=b.length;if(a)for(var c=0,d;c<a;c++)d=b[c],d=m.createVframe(d,{owner:this.owner,parentId:this.id}),this.children.push(d.id),
this.owner.registerVframe(d),d.mountView(b[c].getAttribute("data-view"));else this.notifyChildrenCreated();this.owner.resume()},unloadSubVframes:function(b){for(var a=this.children,c,d=0,e=a.length,f;d<e;d++)f=a[d],c=this.owner.getVframe(f),c.unmountView(b),this.owner.unregisterVframe(c),l(f).id="";this.children=[]},postMessageTo:function(b,a){var c=this.owner;f.isArray(b)||(b=[b]);a||(a={});for(var e=0;e<b.length;e++){var g=c.getVframe(b[e]);if(g){var h=g.view;h&&g.vced?d(h.receiveMessage,a,h):g.viewName&&
g.bind("viewLoad",function(b){d(b.view.receiveMessage,a,b.view)})}}},notifyLocationChange:function(b){var a=this.view;if(a&&a.exist&&a.rendered){if(d(a.testOLChanged,b,a))var c=d(a.locationChange,b,a);if(!1!==c){if(!f.isArray(c))c=this.children;for(var a=0,e=c.length,g;a<e;a++)(g=this.owner.getVframe(c[a]))&&d(g.notifyLocationChange,b,g)}}},notifyChildrenCreated:function(){var b=this.view;b&&d(b.trigger,"childrenCreated",b);this.notifyParentAlter(!0)},notifyParentAlter:function(b){var a=this.parentId;
if(a)if(a=this.owner.getVframe(a),b)f.hasProp(a.rM,this.id)||(a.rM[this.id]=1,a.rC++,a.rC==a.children.length&&a.notifyChildrenCreated());else if(f.hasProp(a.rM,this.id))delete a.rM[this.id],a.rC--,b=a.view,d(b.trigger,"childrenAlter",b),a.notifyParentAlter()}});return m},{requires:["magix/magix","magix/event"]});
KISSY.add("magix/view",function(h,f,e,a){var b=1,c=e.safeExec,d=e.hasProp,l="render,renderUI,updateUI".split(","),g=function(a){e.mix(this,a);this.exist=!0;this.iQ=[];this.sign=this.iC=0},t=g.prototype,m=function(a,b){return function(){var c=this,d=arguments;c.idle(function(){b&&c.sign++;a.apply(c,d)},[],c,a)}},p=/(?:^|\s)return(?:(?:\s+[+\-\w$'"{\[\(\/])|[+\-{\[\(\/'"])/,j=/{([\s\S]+)}/,u=/\\[\s\S]/g,s=/\s*\/\s*/g,o=/^[\s\xa0\u3000\uFEFF]*$/,v=[/[^\w$_]\/[\s\S]*?\//,/(?:'[^']*')|(?:"[^"]*")/,/{[^{}]+}/],
w=function(a){if(a=(""+a).match(j)){a=a[1];if(o.test(a))return!0;for(var a=a.replace(u,"").replace(s,""),b=0,c;b<v.length;b++)for(c=v[b];c.test(a);)a=a.replace(c,"");return p.test(a)}return!1};e.mix(g,{idIt:function(a){return a.id||(a.id="magix_mxe_"+b++)},wrapAsyncUpdate:function(){if(!this["~~"]){this["~~"]=1;var a=this.prototype,b;this.registerAsyncUpdateName();for(var c in a){b=a[c];var g=null;e.isFunction(b)&&b!=e.noop&&!b["~~"]&&!w(b)&&(d(this.$ans,c)?g=m(b,!0):d(a,c)&&!d(t,c)&&(g=m(b)),g&&
(g["~~"]=b,a[c]=g))}}},registerAsyncUpdateName:function(a){if(!this.$ans){this.$ans={};for(var b=0;b<l.length;b++)this.$ans[l[b]]=!0}if(a){e.isArray(a)||(a=[a]);for(b=0;b<a.length;b++)this.$ans[a[b]]=!0}return this}});var x={submit:1,blur:1,focus:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,valuechange:1},h=g.prototype,y=document,r=window,q=r.CollectGarbage||e.noop,k="abort,stop,cancel,destroy,dispose".split(","),z=function(a){return"object"==typeof a?a:y.getElementById(a)};e.mix(h,
a);e.mix(h,{getTmplByXHR:e.unimpl,delegateUnbubble:e.unimpl,undelegateUnbubble:e.unimpl,render:e.noop,locationChange:e.noop,receiveMessage:e.noop,init:e.noop,hasTemplate:!0,enableEvent:!0,enableRefreshAnim:!1,load:function(){var a=this,b=a.hasTemplate,d=function(){a.suspend();c(a.render,[],a);a.delegateBubbleEvents();a.idle(function(){var d=!b&&!a.rendered;if(d)a.delegateUnbubbleEvents(),a.rendered=!0;c(a.init,[],a);d&&a.trigger("created",null,!0)});a.trigger("interact",{tmpl:b},!0);a.resume()};b?
a.getTemplate(a.manage(function(b){a.template=b;d()})):d()},updateViewId:function(){this.id=z(this.vId)?this.vId:this.vfId},setNodeHTML:function(a){z(this.id).innerHTML=a},setViewHTML:function(a){if(this.exist){var b=this.rendered;if(b){var d=e.config().viewChangeAnim&&this.enableRefreshAnim;this.trigger("refresh",null,!0,!0);this.trigger("prerender",{anim:d});this.destroyManaged(!0);this.undelegateUnBubbleEvents();var g=this.owner;d&&(c(g.oldViewDestroy,[],g),c(g.prepareNextView,[],g),this.updateViewId())}this.setNodeHTML(a);
q();d&&c(g.newViewCreated,[],g);this.delegateUnbubbleEvents();this.rendered=!0;this.trigger("rendered");b||this.trigger("created",null,!0)}},postMessageTo:function(a,b){this.idle(this.owner.postMessageTo,[a,b],this.owner)},idle:function(a,d,e,g){var f=this;g||(g=a);var h=g["~~_id_"],l=f.iQ;f.iC?(h?l[h]&&(l[h]["~~_id_"]="~~_id_"):h=g["~~_id_"]="~~"+b++,l.push([a,d,e,g]),l[h]=a):"~~_id_"!=a["~~_id_"]&&f.ownerVOM.idle(function(){f.exist&&(h&&delete l[h],c(a,d,e))})},getLocation:function(){return this.ownerVOM.$location},
observeLocation:function(a,b){var c=arguments.length;if(c)1==c&&(b=!1),this.$location={keys:e.isArray(a)?a:(""+a).split(","),pn:b}},testOLChanged:function(a){var b=this.$location,a=a.changed;if(b){var c=!1;b.pn&&(c=a.isPathname());c||(c=a.isParam(b.keys));return c}return!0},destroy:function(){this.trigger("refresh",null,!0,!0);this.trigger("destroy",null,!0,!0);this.destroyManaged();this.undelegateUnBubbleEvents();this.undelegateBubbleEvents();this.exist=!1;this.iQ=[];this.sign++},getTemplate:function(a){var b=
this;if(b.template)a(b.template);else{var c=e.templates[b.viewName];if(c)a(c);else{var c=e.config(),d=c.appHome+b.viewName+".html";c.release||(d+="?_="+(new Date).getTime()+".html");b.getTmplByXHR(d,function(c){a(e.templates[b.viewName]=c)})}}},processEvent:function(a){if(this.enableEvent&&this.exist){for(var b=a.target;b&&1!=b.nodeType;)b=b.parentNode;for(var d=b,e="mx"+a.type,f,h=z(this.vfId);d&&d!=h&&!(f=d.getAttribute(e));)d=d.parentNode;if(f)if(e=d.getAttribute("data-handler"))~[",",e,","].join().indexOf(","+
this.vfId+",")||(f=0);else{for(e=d;e&&e!=h;)if("VFRAME"==e.tagName.toUpperCase()){d.setAttribute("data-handler",e.id);f=0;break}else e=e.parentNode;f&&d.setAttribute("data-handler",this.vfId)}if(f){f=f.split(":");var h=f.shift(),e=f[f.length-1],l,d=g.idIt(d);if("_halt_"==e||"_stop_"==e)a.stopPropagation(),l=!0;if("_halt_"==e||"_prevent_"==e)a.preventDefault(),l=!0;l&&f.pop();l=this.events;for(var e=l[a.type],j=0,m;j<f.length;j++)m=f[j].lastIndexOf("@"),-1<m&&(f[f[j].substring(m+1)]=f[j].substring(0,
m));e[h]&&c(e[h],{view:this,currentId:d,targetId:g.idIt(b),domEvent:a,events:l,params:f},e)}}},fixedEvent:function(a){if(!a)a=r.event;if(a){if(!a.stopPropagation)a.stopPropagation=function(){a.cancelBubble=!0};if(!a.preventDefault)a.preventDefault=function(){a.returnValue=!1};if(a.srcElement&&!a.target)a.target=a.srcElement}return a},processDelegateEvents:function(a,b){var c=this;if(c.enableEvent){var e=c.events,f=z(c.vfId);if(c.$bubbleList&&c.$unbubbleList)for(var e=a?c.$bubbleList:c.$unbubbleList,
g=0;g<e.length;g++)a?f["on"+e[g]]=b?null:function(a){a=c.fixedEvent(a);c.processEvent(a)}:b?c.undelegateUnbubble(f,e[g]):c.delegateUnbubble(f,e[g]);else for(g in c.$bubbleList=[],c.$unbubbleList=[],e)d(e,g)&&(d(x,g)?(c.$unbubbleList.push(g),a||(b?c.undelegateUnbubble(f,g):c.delegateUnbubble(f,g))):(c.$bubbleList.push(g),a&&(f["on"+g]=b?null:function(a){a=c.fixedEvent(a);c.processEvent(a)})))}},delegateBubbleEvents:function(){this.processDelegateEvents(!0)},delegateUnbubbleEvents:function(){this.processDelegateEvents()},
undelegateUnBubbleEvents:function(){this.processDelegateEvents(!1,!0)},undelegateBubbleEvents:function(){this.processDelegateEvents(!0,!0)},manage:function(a,c){var d=!0;1==arguments.length&&(c=a,a="res_"+b++,d=!1);if(!this.$resCache)this.$resCache={};d={hasKey:d,res:c};e.isFunction(c)&&(c=this.wrapManagedFunction(c),d[this.sign]=c);this.$resCache[a]=d;return c},getManaged:function(a){var b=this.$resCache,c=this.sign;return b&&d(b,a)?(a=b[a],b=a.res,e.isFunction(b)&&(a[c]||(a[c]=this.wrapManagedFunction(b)),
b=a[c]),b):null},removeManaged:function(a){var b=null,c=this.$resCache;if(c)if(d(c,a))b=c[a].res,delete c[a];else for(var e in c)if(c[e].res===a){b=c[e].res;delete c[e];break}return b},destroyManaged:function(a){var b=this.$resCache;if(b){for(var d in b){var g=b[d],f=!1,h=g.res;if(e.isNumber(h))r.clearTimeout(h),r.clearInterval(h),f=!0;else if(h)for(var l=0;l<k.length;l++)e.isFunction(h[k[l]])&&(c(h[k[l]],[],h),f=!0);this.trigger("destroyResource",{resource:h,processed:f});a&&!g.hasKey&&delete b[d]}a||
(this.unbind("destroyResource"),delete this.$resCache)}},wrapManagedFunction:function(a){var b=this,d=b.sign;return function(){b.sign==d&&c(a,arguments,b)}},beginAsyncUpdate:function(){return this.sign++},signature:function(){return this.sign},endAsyncUpdate:function(){return this.sign},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var a=[].slice.call(this.iQ);for(this.iQ=[];a.length;)this.idle.apply(this,a.shift())}}});e.mix(g,f,{prototype:!0});e.mix(g.prototype,
f.prototype);return g},{requires:["magix/impl/view","magix/magix","magix/event"]});
KISSY.add("magix/vom",function(h,f,e){var a=document;return{iC:0,iQ:[],rootVframe:null,vframes:{},rootVframeId:"magix_vf_root",registerVframe:function(a){this.vframes[a.id]=a},getVframe:function(a){return this.vframes[a]},unregisterVframe:function(a){delete this.vframes[e.isString(a)?a:a.id]},buildRootVframe:function(){if(!this.rootVframe)a.getElementById(this.rootVframeId)||f.createVframeNode(this.rootVframeId,a.body.firstChild),this.rootVframe=f.createVframe(this.rootVframeId,{owner:this}),this.registerVframe(this.rootVframe)},
remountRootVframe:function(a){this.$location=a.location;this.buildRootVframe();this.rootVframe.mountView(a.location.viewPath)},notifyLocationChange:function(a){this.$location=a.location;this.rootVframe&&this.rootVframe.notifyLocationChange(a)},idle:function(a,c,d){this.iC?this.iQ.push([a,c,d]):e.safeExec(a,c,d)},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var a=this.iQ;if(a.length){a=[].slice.call(a);for(this.iQ=[];a.length;)this.idle.apply(this,a.shift())}}}}},
{requires:["magix/vframe","magix/magix"]});
KISSY.add("mxext/model",function(h,f){var e=function(a){a&&this.set(a);this.id=h.guid("m");this.hasLocker=this.locker=!1};f.mix(e,{GET:"GET",POST:"POST",extend:function(a,b){var c=function(){c.superclass.constructor.apply(this,arguments);b&&f.safeExec(b,[],this)};f.mix(c,this,{prototype:!0});return h.extend(c,this,a)}});f.mix(e.prototype,{urlMap:{},sync:f.noop,parse:f.noop,getParamsObject:function(a){if(!a)a=e.GET;return this["$"+a]||null},getPostParamsObject:function(){return this.getPostParamsObject(e.POST)},getPostParams:function(){return this.getParams(e.POST)},
getParams:function(a){var a=a?a.toUpperCase():e.GET,a=this["$"+a],b=[],c;if(a)for(var d in a)if(c=a[d],h.isArray(c))for(var f=0;f<c.length;f++)b.push(d+"="+encodeURIComponent(c[f]));else b.push(d+"="+encodeURIComponent(c));return b.join("&")},setParamsIf:function(a,b){this.setParams(a,b,e.GET,!0)},setParams:function(a,b,c,d){c=c?c.toUpperCase():e.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[c]=!0;c="$"+c;this[c]||(this[c]={});if(h.isObject(a))for(var f in a){if(!d||!this[c][f])this[c][f]=
a[f]}else if(a&&b&&(!d||!this[c][a]))this[c][a]=b},setPostParams:function(a,b){this.setParams(a,b,e.POST)},setPostParamsIf:function(a,b){this.setParams(a,b,e.POST,!0)},removeParamsObject:function(a){if(!a)a=e.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(e.POST)},reset:function(){var a=this.$keysCache;if(a){for(var b in a)f.hasProp(a,b)&&delete this["$"+b];delete this.$keysCache}a=this.$keys;b=this.$attrs;if(a){for(var c=0;c<a.length;c++)delete b[a[c]];delete this.$keys}},
url:function(){var a=this.get("uri"),b;if(a){b=a.split(":");var c=this.urlMap;if(c)for(var d=0;d<b.length&&!(c=c[b[d]],void 0===c);d++)d==b.length-1&&(a=c)}else throw Error("model not set uri");return a},get:function(a){var b=this.$attrs;return b?b[a]:null},set:function(a,b,c){if(!this.$attrs)this.$attrs={};if(c&&!this.$keys)this.$keys=[];if(h.isObject(a))for(var d in a)c&&this.$keys.push(d),this.$attrs[d]=a[d];else a&&(c&&this.$keys.push(a),this.$attrs[a]=b)},load:function(a){this.request(a)},save:function(a){this.request(a)},
request:function(a){a||(a={});var b=a.success,c=a.error,d=this;if(!d.hasLocker||!d.locker)d.$abort=!1,d.locker=d.hasLocker,a.success=function(a){d.locker=!1;if(!d.$abort){if(a){var c=d.parse(a);c&&(h.isArray(c)&&(c={list:c}),d.set(c,null,!0))}b&&b.apply(this,arguments)}},a.error=function(){d.locker=!1;d.$abort||c&&c.apply(this,arguments)},d.$trans=d.sync(d,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=
h.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=!!a}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(h,f){var e=function(a){this.$modelClass=a},a=function(a){if(a._wraped_)return a;var c=function(c){var e=c.success,g=this;g.get("updateIdent")?(c.success=function(){g.set("updateIdent",!1);g._after&&f.safeExec(g._after,g);e&&e.apply(c)},a.call(g,c)):e&&e.apply(c)};c._wraped_=!0;return c};f.mix(e,{mClsCache:{},create:function(a,c){if(!c)throw Error("Factory.create modelClass ungiven");var d=this.mClsCache;a||(a=h.guid());d[a]||(d[a]=new e(c));return d[a]}});f.mix(e.prototype,
{registerModels:function(a){f.isArray(a)||(a=[a]);for(var c=0,d;c<a.length;c++){d=a[c];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},registerMethods:function(a){for(var c in a)f.hasProp(a,c)&&(this[c]=a[c])},callMethods:function(a,c,d){for(var e=[],f="",t=a.length,m=0,p,j=function(a,b,j){p||(m++,j?f=a:e[b]=a,t<=m&&(f?h.isFunction(d)&&d(f):h.isFunction(c)&&c.apply(c,e)))},u=function(a,b){return function(c){j(c,a,!b)}},s=0,o;s<a.length;s++){o=a[s];var v;if(v=h.isFunction(o.name)?
o.name:this[o.name]){if(!o.params)o.params=[];o.params.push(u(s,!0),u(s));v.apply(this,o.params)}else j("unfound:"+o.name,s,!0)}return{abort:function(){p=!0}}},fetchModels:function(a,c,d,e){var g=this;if(!g.$modelsCache)g.$modelsCache={};if(!g.$modelsCacheKeys)g.$modelsCacheKeys={};var t=g.$modelsCache,m=g.$modelsCacheKeys;f.isArray(a)||(a=[a]);for(var p=a.length,j=0,u,s=[],o=[],v,w=function(a,b,k,i){j++;if(b)u=i||"fetch data error";else{v=!0;k.set("updateIdent",!1);s[a]=k;if((a=k._cacheKey)&&!f.hasProp(t,
a))t[k._cacheKey]=k,a=k._params,k._doneAt=h.now(),k._after&&f.safeExec(k._after,[k].concat(a));4==e&&c(k)}if((a=k._cacheKey)&&f.hasProp(m,a)){var o=m[a];delete m[a];f.safeExec(o,[b,k,i],k)}4!=e&&j>=p&&(2==e?v?c&&c.apply(g,s):d&&d(u):u?d&&d(u):c&&c.apply(g,s))},x=Array.prototype.slice,y=function(a,b){var c=x.call(arguments,2);return function(){return a.apply(b,c.concat(x.call(arguments)))}},r=0,q;r<a.length;r++){q=a[r];var k=q.cacheKey;k&&f.hasProp(m,k)?m[k].push(y(w,g,r)):(q=g.create(q,!0),q.get("updateIdent")?
(o.push(q),k&&(m[k]=[]),q.request({success:y(w,q,r,!1,q),error:y(w,q,r,!0,q)})):w(r,!1,q))}return{abort:function(){for(var a=0,b;a<o.length;a++){b=o[a];var c=b._cacheKey;if(c&&f.hasProp(m,c)){var d=m[c];delete m[c];f.safeExec(d,[!0,b,"abort"],b)}b.abort()}}}},fetchAll:function(a,c,d){return this.fetchModels(a,c,d,1)},fetchAny:function(a,c,d){return this.fetchModels(a,c,d,2)},fetchOne:function(a,c){return this.fetchModels(a,c,f.noop,4)},getIf:function(a){var c=this.$modelsCache;return c&&f.hasProp(c,
a)?c[a]:null},setUpdateIdent:function(a){(a=this.getIf(a))&&a.set("updateIdent",!0)},create:function(b,c){if(!b.type)throw Error('model must own a "type" attribute');var d=b.type,e=b.cacheKey||d.cacheKey,g,t=b.expires||d.expires||0;if(!this.$modelsCache)this.$modelsCache={};var m=this.$modelsCache,p=b.params||[];if(e&&f.hasProp(m,e)){g=m[e];var j=g.get("updateIdent");!j&&0<t&&h.now()-g._doneAt>t&&(j=!0);j&&(delete m[e],g.set("updateIdent",!0))}else g=new this.$modelClass(d.ops),g._after=d.after,g._cacheKey=
e,g.set("updateIdent",!0);g._params=p;if(j=g.get("updateIdent"))g.reset(),g.set(b.ops),g.setParams(d.gets),g.setPostParams(d.posts),g.setParams(b.gets),g.setPostParams(b.posts),f.isFunction(d.before)&&f.safeExec(d.before,[g].concat(p),d);if(!c)g.request=a(g.request);return g}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/vfanim",function(h,f,e){var a=e.config(),b=document,c=a.viewChange,d=e.isFunction(c),l=function(a){return"object"==typeof a?a:b.getElementById(a)};return e.mix(f.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=l(this.id),c=l(this.viewId),d=this.view;if(!c){for(c=b.createElement("div");a.firstChild;)c.appendChild(a.firstChild);a.appendChild(c)}c.id="";if(a=d.events)for(var f in a)e.hasProp(a,f)&&h.all("*[mx"+f+"]").removeAttr("mx"+f);
if(!e.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=c},prepareNextView:function(){var a=l(this.id),c=b.createElement("div");c.id=this.viewId;if(a._dataBak)c.innerHTML=a._dataTmpl;a.insertBefore(c,a.firstChild)},newViewCreated:function(a){var b=this,f=b.$oldViewNode,h=l(b.viewId);d&&e.safeExec(c,{vframeId:b.id,action:a?"viewChange":"viewRefresh",oldViewNode:f,newViewNode:h,collectGarbage:function(){b.$animCounter--;b.$animCounter||delete b.$oldViewNode;try{f.parentNode.removeChild(f)}catch(a){}}},
b)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(h,f,e){return f.extend({queryEvents:null,navigate:function(a){e.navigate(a)},attachQueryEvents:function(){var a=this,b=a.queryEvents;if(b){a.$queryEventsCache={};for(var c in b){var d=b[c],e;for(e in d)h.all("#"+a.id+" "+e).on(c,a.$queryEventsCache[c+"_"+e]=function(c){return function(d){var e=f.idIt(d.target),h=f.idIt(d.currentTarget);Magix.safeExec(c,{view:a,targetId:e,currentId:h,queryEvents:b,domEvent:d},b)}}(d[e]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var b in a){var c=a[b],d;for(d in c)h.all("#"+this.id+" "+d).detach(b,this.$queryEventsCache[b+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var b in a)a[b]&&a[b].toJSON&&(a[b]=a[b].toJSON());this.setRenderer()},setRenderer:function(){var a=this,b=this.renderer,c,d;if(b)for(c in b)for(d in b[c])(function(){var e=c,f=d,h=b[e][f];a.data[e+"_"+f]=function(){return h.call(this,a,e)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});(function(h){var f=function(){};if(!h.console)h.console={log:f,warn:f,error:f,debug:f};if(!h.Magix)h.Magix={start:function(e){this.$tempCfg=e}},KISSY.use("magix/magix",function(e,a){var b=h.Magix.$tempCfg;h.Magix=a;b&&a.start(b)})})(this);