KISSY.add("mxext/model",function(i,f){var e=function(a){a&&this.set(a);this.id=i.guid("m");this.hasLocker=this.locker=!1};f.mix(e,{GET:"GET",POST:"POST",extend:function(a,c){var b=function(){b.superclass.constructor.apply(this,arguments);c&&f.safeExec(c,[],this)};f.mix(b,this,{prototype:!0});return i.extend(b,this,a)}});f.mix(e.prototype,{urlMap:{},sync:f.noop,parse:f.noop,getParamsObject:function(a){if(!a)a=e.GET;return this["$"+a]||null},getPostParamsObject:function(){return this.getPostParamsObject(e.POST)},
getPostParams:function(){return this.getParams(e.POST)},getParams:function(a){var a=a?a.toUpperCase():e.GET,a=this["$"+a],c=[],b;if(a)for(var d in a)if(b=a[d],i.isArray(b))for(var h=0;h<b.length;h++)c.push(d+"="+encodeURIComponent(b[h]));else c.push(d+"="+encodeURIComponent(b));return c.join("&")},setParamsIf:function(a,c){this.setParams(a,c,e.GET,!0)},setParams:function(a,c,b,d){b=b?b.toUpperCase():e.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[b]=!0;b="$"+b;this[b]||(this[b]={});if(i.isObject(a))for(var h in a){if(!d||
!this[b][h])this[b][h]=a[h]}else if(a&&c&&(!d||!this[b][a]))this[b][a]=c},setPostParams:function(a,c){this.setParams(a,c,e.POST)},setPostParamsIf:function(a,c){this.setParams(a,c,e.POST,!0)},removeParamsObject:function(a){if(!a)a=e.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(e.POST)},reset:function(){var a=this.$keysCache;if(a){for(var c in a)f.hasProp(a,c)&&delete this["$"+c];delete this.$keysCache}a=this.$keys;c=this.$attrs;if(a){for(var b=0;b<a.length;b++)delete c[a[b]];
delete this.$keys}},url:function(){var a=this.get("uri"),c;if(a){c=a.split(":");var b=this.urlMap;if(b)for(var d=0;d<c.length&&!(b=b[c[d]],void 0===b);d++)d==c.length-1&&(a=b)}else throw Error("model not set uri");return a},get:function(a){var c=this.$attrs;return c?c[a]:null},set:function(a,c,b){if(!this.$attrs)this.$attrs={};if(b&&!this.$keys)this.$keys=[];if(i.isObject(a))for(var d in a)b&&this.$keys.push(d),this.$attrs[d]=a[d];else a&&(b&&this.$keys.push(a),this.$attrs[a]=c)},load:function(a){this.request(a)},
save:function(a){this.request(a)},request:function(a){a||(a={});var c=a.success,b=a.error,d=this;if(!d.hasLocker||!d.locker)d.$abort=!1,d.locker=d.hasLocker,a.success=function(a){d.locker=!1;if(!d.$abort){if(a){var b=d.parse(a);b&&(i.isArray(b)&&(b={list:b}),d.set(b,null,!0))}c&&c.apply(this,arguments)}},a.error=function(){d.locker=!1;d.$abort||b&&b.apply(this,arguments)},d.$trans=d.sync(d,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},
beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=!!a}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(i,f){var e=function(c){this.$modelClass=c},a=function(c){if(c._wraped_)return c;var a=function(a){var b=a.success,g=this;g.get("updateIdent")?(a.success=function(){g.set("updateIdent",!1);g._after&&f.safeExec(g._after,g);b&&b.apply(a)},c.call(g,a)):b&&b.apply(a)};a._wraped_=!0;return a};f.mix(e,{mClsCache:{},create:function(a,b){if(!b)throw Error("Factory.create modelClass ungiven");var d=this.mClsCache;a||(a=i.guid());d[a]||(d[a]=new e(b));return d[a]}});f.mix(e.prototype,
{registerModels:function(a){f.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++){d=a[b];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},registerMethods:function(a){for(var b in a)f.hasProp(a,b)&&(this[b]=a[b])},callMethods:function(a,b,d){for(var h=[],g="",f=a.length,e=0,v,q=function(a,c,j){v||(e++,j?g=a:h[c]=a,f<=e&&(g?i.isFunction(d)&&d(g):i.isFunction(b)&&b.apply(b,h)))},o=function(a,b){return function(c){q(c,a,!b)}},n=0,j;n<a.length;n++){j=a[n];var r;if(r=i.isFunction(j.name)?
j.name:this[j.name]){if(!j.params)j.params=[];j.params.push(o(n,!0),o(n));r.apply(this,j.params)}else q("unfound:"+j.name,n,!0)}return{abort:function(){v=!0}}},fetchModels:function(a,b,d,h){var g=this;if(!g.$modelsCache)g.$modelsCache={};if(!g.$modelsCacheKeys)g.$modelsCacheKeys={};var e=g.$modelsCache,m=g.$modelsCacheKeys;f.isArray(a)||(a=[a]);for(var i=a.length,q=0,o,n=[],j=[],r,t=function(a,c,l,j){q++;if(c)o=j||"fetch data error";else{r=!0;l.set("updateIdent",!1);n[a]=l;if((a=l._cacheKey)&&!f.hasProp(e,
a))e[l._cacheKey]=l,a=l._params,l._after&&f.safeExec(l._after,[l].concat(a));4==h&&b(l)}if((a=l._cacheKey)&&f.hasProp(m,a)){var k=m[a];delete m[a];f.safeExec(k,[c,l,j],l)}4!=h&&q>=i&&(2==h?r?b&&b.apply(g,n):d&&d(o):o?d&&d(o):b&&b.apply(g,n))},w=Array.prototype.slice,u=function(a,b){var c=w.call(arguments,2);return function(){return a.apply(b,c.concat(w.call(arguments)))}},p=0,k;p<a.length;p++){k=a[p];var s=k.cacheKey;s&&f.hasProp(m,s)?m[s].push(u(t,g,p)):(k=g.create(k,!0),k.get("updateIdent")?(j.push(k),
s&&(m[s]=[]),k.request({success:u(t,k,p,!1,k),error:u(t,k,p,!0,k)})):t(p,!1,k))}return{abort:function(){for(var a=0,b;a<j.length;a++){b=j[a];var c=b._cacheKey;if(c&&f.hasProp(m,c)){var d=m[c];delete m[c];f.safeExec(d,[!0,b,"abort"],b)}b.abort()}}}},fetchAll:function(a,b,d){return this.fetchModels(a,b,d,1)},fetchAny:function(a,b,d){return this.fetchModels(a,b,d,2)},fetchOne:function(a,b){return this.fetchModels(a,b,f.noop,4)},getIf:function(a){var b=this.$modelsCache;return b&&f.hasProp(b,a)?b[a]:
null},setUpdateIdent:function(a){(a=this.getIf(a))&&a.set("updateIdent",!0)},create:function(c,b){if(!c.type)throw Error('model must own a "type" attribute');var d=c.type,h=c.cacheKey||d.cacheKey,g;if(!this.$modelsCache)this.$modelsCache={};var e=this.$modelsCache,m=c.params||[];if(h&&f.hasProp(e,h)){g=e[h];var i=g.get("updateIdent");i&&delete e[h]}else g=new this.$modelClass(d.ops),g._after=d.after,g._cacheKey=h,g.set("updateIdent",!0);g._params=m;if(i=g.get("updateIdent"))g.reset(),g.set(c.ops),
g.setParams(d.gets),g.setPostParams(d.posts),g.setParams(c.gets),g.setPostParams(c.posts),f.isFunction(d.before)&&f.safeExec(d.before,[g].concat(m),d);if(!b)g.request=a(g.request);return g}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/vfanim",function(i,f,e){var a=e.config(),c=document,b=a.viewChange,d=e.isFunction(b),h=function(a){return"object"==typeof a?a:c.getElementById(a)};return e.mix(f.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=h(this.id),b=h(this.viewId),d=this.view;if(!b){for(b=c.createElement("div");a.firstChild;)b.appendChild(a.firstChild);a.appendChild(b)}b.id="";if(a=d.events)for(var f in a)e.hasProp(a,f)&&i.all("*[mx"+f+"]").removeAttr("mx"+f);
if(!e.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=b},prepareNextView:function(){var a=h(this.id),b=c.createElement("div");b.id=this.viewId;a.insertBefore(b,a.firstChild)},newViewCreated:function(a){var c=this,f=c.$oldViewNode,i=h(c.viewId);d&&e.safeExec(b,{vframeId:c.id,action:a?"viewChange":"viewRefresh",oldViewNode:f,newViewNode:i,collectGarbage:function(){c.$animCounter--;c.$animCounter||delete c.$oldViewNode;try{f.parentNode.removeChild(f)}catch(a){}}},
c)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(i,f,e){return f.extend({queryEvents:null,navigate:function(a){e.navigate(a)},attachQueryEvents:function(){var a=this,c=a.queryEvents;if(c){a.$queryEventsCache={};for(var b in c){var d=c[b],e;for(e in d)i.all("#"+a.id+" "+e).on(b,a.$queryEventsCache[b+"_"+e]=function(b){return function(d){var e=f.idIt(d.target),h=f.idIt(d.currentTarget);Magix.safeExec(b,{view:a,targetId:e,currentId:h,queryEvents:c,domEvent:d},c)}}(d[e]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var c in a){var b=a[c],d;for(d in b)i.all("#"+this.id+" "+d).detach(c,this.$queryEventsCache[c+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var c in a)a[c]&&a[c].toJSON&&(a[c]=a[c].toJSON());this.setRenderer()},setRenderer:function(){var a=this,c=this.renderer,b,d;if(c)for(b in c)for(d in c[b])(function(){var e=b,g=d,f=c[e][g];a.data[e+"_"+g]=function(){return f.call(this,a,e)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});