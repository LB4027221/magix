KISSY.add("mxext/model",function(i,b){var c=function(a){a&&this.set(a);this.id=i.guid("m");this.hasLocker=this.locker=!1};b.mix(c,{GET:"GET",POST:"POST",extend:function(a,e){var d=function(){d.superclass.constructor.apply(this,arguments);e&&b.safeExec(e,[],this)};b.mix(d,this,{prototype:!0});return i.extend(d,this,a)}});b.mix(c.prototype,{urlMap:{},sync:b.noop,parse:b.noop,getPostParams:function(){return this.getParams("POST")},getParams:function(a){var a=a?a.toUpperCase():c.GET,a=this["$"+a],e=[],
d;if(a)for(var b in a)if(d=a[b],i.isArray(d))for(var h=0;h<d.length;h++)e.push(b+"="+encodeURIComponent(d[h]));else e.push(b+"="+encodeURIComponent(d));return e.join("&")},setParamsIf:function(a,e){this.setParams(a,e,c.GET,!0)},setParams:function(a,e,d,b){d=d?d.toUpperCase():c.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[d]=!0;d="$"+d;this[d]||(this[d]={});if(i.isObject(a))for(var h in a){if(!b||!this[d][h])this[d][h]=a[h]}else if(a&&e&&(!b||!this[d][a]))this[d][a]=e},setPostParams:function(a,
e){this.setParams(a,e,c.POST)},setPostParamsIf:function(a,e){this.setParams(a,e,c.POST,!0)},reset:function(){var a=this.$keysCache;if(a){for(var e in a)b.hasProp(a,e)&&delete this["$"+e];delete this.$keysCache}a=this.$keys;e=this.$attrs;if(a){for(var d=0;d<a.length;d++)delete e[a[d]];delete this.$keys}},url:function(){var a=this.get("uri"),e;if(a){e=a.split(":");var d=this.urlMap;if(d)for(var b=0;b<e.length&&!(d=d[e[b]],void 0===d);b++)b==e.length-1&&(a=d)}else throw Error("model not set uri");return a},
get:function(a){var e=this.$attrs;return e?e[a]:null},set:function(a,e,d){if(!this.$attrs)this.$attrs={};if(d&&!this.$keys)this.$keys=[];if(i.isObject(a))for(var b in a)d&&this.$keys.push(b),this.$attrs[b]=a[b];else a&&(d&&this.$keys.push(a),this.$attrs[a]=e)},load:function(a){this.request(a)},save:function(a){this.request(a)},request:function(a){a||(a={});var e=a.success,b=a.error,f=this;if(!f.hasLocker||!f.locker)f.$abort=!1,f.locker=f.hasLocker,a.success=function(a){f.locker=!1;if(!f.$abort){if(a){var b=
f.parse(a);b&&(i.isArray(b)&&(b={list:b}),f.set(b,null,!0))}e&&e.apply(this,arguments)}},a.error=function(){f.locker=!1;f.$abort||b&&b.apply(this,arguments)},f.$trans=f.sync(f,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=
!!a}});return c},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(i,b){var c=function(a){this.$modelClass=a},a=function(a){if(a._wraped_)return a;var d=function(d){var c=d.success,g=this;g.get("updateIdent")?(d.success=function(){g.set("updateIdent",!1);g._after&&b.safeExec(g._after,g);c&&c.apply(d)},a.call(g,d)):c&&c.apply(d)};d._wraped_=!0;return d};b.mix(c,{mClsCache:{},create:function(a,b){if(!b)throw Error("Factory.create modelClass ungiven");var f=this.mClsCache;a||(a=i.guid());f[a]||(f[a]=new c(b));return f[a]}});b.mix(c.prototype,
{registerModels:function(a){b.isArray(a)||(a=[a]);for(var d=0,f;d<a.length;d++){f=a[d];if(!f.type)throw Error("model must own a type attribute");this[f.type]=f}},fetchModels:function(a,d,f,c){var g=this;if(!g.$modelsCache)g.$modelsCache={};if(!g.$modelsCacheKeys)g.$modelsCacheKeys={};var k=g.$modelsCache,j=g.$modelsCacheKeys;b.isArray(a)||(a=[a]);for(var m=a.length,i=0,p,s=[],t=[],v,r=function(a,e,n,l){i++;if(e)p=l||"fetch data error";else{v=!0;n.set("updateIdent",!1);s[a]=n;if((a=n._cacheKey)&&!b.hasProp(k,
a))k[n._cacheKey]=n,n._after&&b.safeExec(n._after,n);4==c&&d(n)}if((a=n._cacheKey)&&b.hasProp(j,a)){var o=j[a];delete j[a];b.safeExec(o,[e,n,l],n)}4!=c&&i>=m&&(2==c?v?d&&d.apply(g,s):f&&f(p):p?f&&f(p):d&&d.apply(g,s))},w=Array.prototype.slice,u=function(a,b){var d=w.call(arguments,2);return function(){return a.apply(b,d.concat(w.call(arguments)))}},o=0,l;o<a.length;o++){l=a[o];var q=l.cacheKey;q&&b.hasProp(j,q)?j[q].push(u(r,g,o)):(l=g.create(l,!0),l.get("updateIdent")?(t.push(l),q&&(j[q]=[]),l.request({success:u(r,
l,o,!1,l),error:u(r,l,o,!0,l)})):r(o,!1,l))}return{abort:function(){for(var a=0,d;a<t.length;a++){d=t[a];var e=d._cacheKey;if(e&&b.hasProp(j,e)){var f=j[e];delete j[e];b.safeExec(f,[!0,d,"abort"],d)}d.abort()}}}},fetchAll:function(a,b,f){return this.fetchModels(a,b,f,1)},fetchAny:function(a,b,f){return this.fetchModels(a,b,f,2)},fetchOne:function(a,d){return this.fetchModels(a,d,b.noop,4)},getIf:function(a){var d=this.$modelsCache;return d&&b.hasProp(d,a)?d[a]:null},setUpdateIdent:function(a){(a=
this.getIf(a))&&a.set("updateIdent",!0)},create:function(e,d){if(!e.type)throw Error('model must own a "type" attribute');var f=e.type,c=e.cacheKey||f.cacheKey,g;if(!this.$modelsCache)this.$modelsCache={};var k=this.$modelsCache;if(c&&b.hasProp(k,c)){g=k[c];var j=g.get("updateIdent");j&&delete k[c]}else g=new this.$modelClass(f.ops),g._after=f.after,g._cacheKey=c,g.set("updateIdent",!0);if(j=g.get("updateIdent"))g.reset(),g.set(e.ops),g.setParams(f.gets),g.setPostParams(f.posts),g.setParams(e.gets),
g.setPostParams(e.posts),b.isFunction(f.before)&&b.safeExec(f.before,g,f);if(!d)g.request=a(g.request);return g}});return c},{requires:["magix/magix"]});
KISSY.add("mxext/mu",function(i,b){function c(b,d){var e=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i,c=b.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),j=[];if(c)for(var m=0;m<c.length;m++)j.push(c[m].match(e)[1]);e="";for(c=0;c<j.length;c++)e="if("+j[c]+")",d[e]||(d[e]=a(j[c]))}function a(a){a=a.split("==");return function(){for(var b=a[0].split("."),d=a[1],e=b.length-1;-1<e;e--){var c=b.slice(e),m=this;try{for(var i=0;i<c.length-1;i++)m=m[c[i]];if(c[c.length-1]in m){if(m[c[c.length-1]].toString()===d)return!0;
break}}catch(p){}}return!1}}function e(a,b){var d,c;for(d in a)if(c=a[d],c instanceof Array)for(var j=0;j<c.length;j++){var i=c[j];if("object"==typeof i)0===j?i.__first__=!0:j==c.length-1?i.__last__=!0:i.__mid__=!0,i.__index__=j}else"object"==typeof c&&5>b&&e(c,b+1)}var d=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi;return{to_html:function(a,h){"object"==typeof h&&e(h,0);var g=a.match(d);if(g){a=a.replace(d,function(){return'<script type="text/tmpl"><\/script>'});
c(a,h);var a=b.to_html.apply(this,arguments),k=0,a=a.replace(d,function(){return g[k++]})}else c(a,h),a=b.to_html.apply(this,arguments);return a}}},{requires:["mxext/mustache"]});
KISSY.add("mxext/mustache",function(){return function(){var i=function(){};i.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(b,c,a,e){if(!e)this.context=c,this.buffer=[];if(this.includes("",b)){b=this.render_pragmas(b);b=this.render_section(b,c,a);if(e)return this.render_tags(b,c,a,e);this.render_tags(b,c,a,e)}else{if(e)return b;this.send(b)}},send:function(b){""!=b&&this.buffer.push(b)},render_pragmas:function(b){if(!this.includes("%",
b))return b;var c=this;return b.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(a,b,d){if(!c.pragmas_implemented[b])throw{message:"This implementation of mustache doesn't understand the '"+b+"' pragma"};c.pragmas[b]={};d&&(a=d.split("="),c.pragmas[b][a[0]]=a[1]);return""})},render_partial:function(b,c,a){b=this.trim(b);if(!a||void 0===a[b])throw{message:"unknown_partial '"+b+"'"};return"object"!=typeof c[b]?this.render(a[b],c,a,!0):this.render(a[b],c[b],a,!0)},render_section:function(b,
c,a){if(!this.includes("#",b)&&!this.includes("^",b))return b;var e=this;return b.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(b,f,h,g){b=e.find(h,c);if("^"==f)return!b||e.is_array(b)&&0===b.length?e.render(g,c,a,!0):"";if("#"==f)return e.is_array(b)?e.map(b,function(b){return e.render(g,e.create_context(b),a,!0)}).join(""):e.is_object(b)?e.render(g,e.create_context(b),a,!0):"function"===typeof b?b.call(c,g,
function(b){return e.render(b,c,a,!0)}):b?e.render(g,c,a,!0):""})},render_tags:function(b,c,a,e){for(var d=this,f=function(){return RegExp(d.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+d.ctag+"+","g")},h=f(),g=function(b,e,g){switch(e){case "!":return"";case "=":return d.set_delimiters(g),h=f(),"";case ">":return d.render_partial(g,c,a);case "{":return d.find(g,c);default:return d.escape(d.find(g,c))}},b=b.split("\n"),k=0;k<b.length;k++)b[k]=b[k].replace(h,g,this),e||this.send(b[k]);if(e)return b.join("\n")},
set_delimiters:function(b){b=b.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(b){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return b.replace(arguments.callee.sRE,"\\$1")},find:function(b,c){var b=this.trim(b),a;!1===c[b]||0===c[b]||c[b]?a=c[b]:(!1===this.context[b]||0===this.context[b]||this.context[b])&&(a=this.context[b]);return"function"===typeof a?a.apply(c):void 0!==
a?a:""},includes:function(b,c){return-1!=c.indexOf(this.otag+b)},escape:function(b){return(""+(null===b?"":b)).replace(/&(?!\w+;)|["'<>\\]/g,function(b){switch(b){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return b}})},create_context:function(b){if(this.is_object(b))return b;var c=".";if(this.pragmas["IMPLICIT-ITERATOR"])c=this.pragmas["IMPLICIT-ITERATOR"].iterator;var a={};a[c]=b;return a},is_object:function(b){return b&&
"object"==typeof b},is_array:function(b){return"[object Array]"===Object.prototype.toString.call(b)},trim:function(b){return b.replace(/^\s*|\s*$/g,"")},map:function(b,c){if("function"==typeof b.map)return b.map(c);for(var a=[],e=b.length,d=0;d<e;d++)a.push(c(b[d]));return a}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(b,c,a,e){var d=new i;if(e)d.send=e;d.render(b,c,a);if(!e)return d.buffer.join("\n")}}}()});
KISSY.add("mxext/tmpl",function(){var i={},b={},c="_"+(new Date).getTime(),a=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi,e=function(a,e){if(a){var h;h=b[a];h||(h=c+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,";"+c+".push('")+
"');return "+c+".join('')",b[a]=h);var g=[c],k=[[]],j;if(e)for(j in e)g.push(j.replace(/[:+\-*\/&^%#@!~]/g,"$")),k.push(e[j]);j=g.join("_")+"_"+h;if(!i[j])try{i[j]=new Function(g,h)}catch(m){return m.message}try{h=i[j].apply(e,k)}catch(x){h=x.message}return h}return a};return{toHTML:function(b,c){var h=b.match(a);if(h)var b=b.replace(a,function(){return'<script type="text/tmpl"><\/script>'}),b=e(b,c),g=0,b=b.replace(a,function(){return h[g++]});else b=e(b,c);return b}}});
KISSY.add("mxext/vfanim",function(i,b,c){var a=c.config(),e=document,d=a.viewChange,f=c.isFunction(d),h=function(a){return"object"==typeof a?a:e.getElementById(a)};return c.mix(b.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=h(this.id),b=h(this.viewId),d=this.view;if(!b){for(b=e.createElement("div");a.firstChild;)b.appendChild(a.firstChild);a.appendChild(b)}b.id="";if(a=d.events)for(var f in a)c.hasProp(a,f)&&i.all("*[mx"+f+"]").removeAttr("mx"+f);
if(!c.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=b},prepareNextView:function(){var a=h(this.id),b=e.createElement("div");b.id=this.viewId;a.insertBefore(b,a.firstChild)},newViewCreated:function(a){var b=this,e=b.$oldViewNode,i=h(b.viewId);f&&c.safeExec(d,{vframeId:b.id,action:a?"viewChange":"viewRefresh",oldViewNode:e,newViewNode:i,collectGarbage:function(){b.$animCounter--;b.$animCounter||delete b.$oldViewNode;try{e.parentNode.removeChild(e)}catch(a){}}},
b)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(i,b,c){return b.extend({queryEvents:null,navigate:function(a){c.navigate(a)},attachQueryEvents:function(){var a=this,e=a.queryEvents;if(e){a.$queryEventsCache={};for(var d in e){var c=e[d],h;for(h in c)i.all("#"+a.id+" "+h).on(d,a.$queryEventsCache[d+"_"+h]=function(d){return function(c){var f=b.idIt(c.target),h=b.idIt(c.currentTarget);Magix.safeExec(d,{view:a,targetId:f,currentId:h,queryEvents:e,domEvent:c},e)}}(c[h]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var b in a){var d=a[b],c;for(c in d)i.all("#"+this.id+" "+c).detach(b,this.$queryEventsCache[b+"_"+c])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var b in a)a[b]&&a[b].toJSON&&(a[b]=a[b].toJSON());this.setRenderer()},setRenderer:function(){var a=this,b=this.renderer,c,f;if(b)for(c in b)for(f in b[c])(function(){var h=c,g=f,i=b[h][g];a.data[h+"_"+g]=function(){return i.call(this,a,h)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});