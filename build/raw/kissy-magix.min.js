KISSY.add("magix/ajax",function(f,c,b){return b.implement({defaultOptions:{dataType:"html",type:"POST",success:function(){},error:function(){}},globalSetting:function(e){if(!this.$globalSetting)this.$globalSetting={};for(var a in e)this.$globalSetting[a]=e[a];return this.$globalSetting},fireGlobalSetting:function(e){var a=this.$globalSetting;if(a&&a.statusCode&&(a=a.statusCode,a[e.status]))try{a[e.status](e)}catch(d){}},send:b.unimpl,processOptions:function(e){e||(e={});for(var a in this.defaultOptions)e[a]||
(e[a]=this.defaultOptions[a]);return e},getTemplate:function(e,a,d,h){var k=Magix.templates,c=k[h];c?b.isFunction(a)&&a(c):this.send({url:e,dataType:"html",type:"GET",success:function(d){k[h]=d;b.isFunction(a)&&a(d)},error:function(a){b.isFunction(d)&&d(a)}})}},c)},{requires:["magix/impls/ajax","magix/base"]});
KISSY.add("magix/base",function(f,c){var b={mix:function(e,a,d,h){if(!a||!e)return e;void 0===d&&(d=!0);var b,c,j;if(h&&(j=h.length))for(b=0;b<j;b++){if(c=h[b],c in a&&(d||!(c in e)))e[c]=a[c]}else for(c in a)if(d||!(c in e))e[c]=a[c];return e},include:function(b){var b=Magix.config.magixHome+"../"+b+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",b,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");}};
b.mix(b,{isFunction:b.unimpl,isArray:b.unimpl,isString:b.unimpl,isPlainObject:b.unimpl,requireAsync:b.unimpl,Events:b.unimpl,_idCounter:0,uniqueId:function(b){var a=this._idCounter++;return b?b+a:a},extend:function(b,a,d,h){if(!a||!b)return b;var c=Object.prototype,g=a.prototype,j=function(a){function d(){}d.prototype=a;return new d}(g);b.prototype=j;j.constructor=b;b.superclass=g;if(a!==Object&&g.constructor===c.constructor)g.constructor=a;d&&this.mix(j,d);h&&this.mix(b,h);return b},param:function(b){var a=
[],d;for(d in b)b.hasOwnProperty(d)&&a.push(d+"="+b[d]);return a.join("&")},unParam:function(b){for(var b=b.split("&"),a,d={},h=0;h<b.length;h++)a=b[h].split("="),a[0]&&(d[a[0]]=a[1]||"");return d},mixClassStaticProps:function(b,a){for(var d in a)a.hasOwnProperty(d)&&"prototype"!=d&&(b[d]=a[d]);return b},mixClassProtoProps:function(c,a){for(var d in a)if(!c[d]||c[d]==b.unimpl)c[d]=a[d];return c},implement:function(c,a){if(b.isFunction(c)&&b.isFunction(a)){a.prototype.constructor=a;var d=function(){a.apply(this,
arguments);c.apply(this,arguments);c.prototype.initial&&c.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(d,c);this.mixClassStaticProps(d,a);this.mixClassProtoProps(d.prototype,c.prototype);this.mixClassProtoProps(d.prototype,a.prototype);return d.prototype.constructor=d}d={};b.mix(d,c);b.mix(d,a);return d}});b.mix(b,c);return b},{requires:["magix/impls/base"]});
KISSY.add("magix/impls/ajax",function(f,c){return{send:function(b){var e=this,b=this.processOptions(b),a=b.success,d=b.error;c(f.mix(b,{url:b.url,dataType:b.dataType,type:b.type,success:function(d,c,g){e.fireGlobalSetting(g);a.call(b,d)},error:function(a,c,g){e.fireGlobalSetting(g);d.call(b,c)}}))}}},{requires:["ajax"]});
KISSY.add("magix/impls/base",function(f){var c=Object.prototype.toString;return{isFunction:f.isFunction,isArray:f.isArray,isString:f.isString,isPlainObject:function(b){return b&&"[object Object]"===c.call(b)&&!b.nodeType&&!b.setInterval},requireAsync:function(b,c){f.use(b,function(a,d){c(d)})},Events:{bind:function(b,c,a){var d=this._callbacks||(this._callbacks={});(d[b]||(d[b]=[])).push([c,a]);return this},unbind:function(b,c){var a;if(b){if(a=this._callbacks)if(c){a=a[b];if(!a)return this;for(var d=
0,h=a.length;d<h;d++)if(a[d]&&c===a[d][0]){a[d]=null;break}}else a[b]=[]}else this._callbacks={};return this},trigger:function(b,c){var a,d,h,k,g=2;if(!(d=this._callbacks))return this;for(;g--;)if(a=g?b:"all",a=d[a])for(var j=0,f=a.length;j<f;j++)(h=a[j])?(k=g?Array.prototype.slice.call(arguments,1):arguments,h[0].apply(h[1]||this,k)):(a.splice(j,1),j--,f--);!0==c&&delete d[b];return this}}}},{requires:["ajax"]});
KISSY.add("magix/impls/model",function(f,c,b){c=c.Model;f.mix(c.prototype,b.Events);var e=c.prototype.fire;c.prototype.fire=function(a,d){e(a,d);if("*"==a.charAt(0)){var h=this,a=a.substring(1).replace(/[A-Z]/,function(a){return a.toLowerCase()});if(!h.__propCache)h.__propCache={};f.each(d.attrName,function(a){h.__propCache[a]=!0});this.trigger(a,d);delete this.__propCache}else this.trigger(a,d)};c.prototype.hasChanged=function(a){var d=this.__propCache;return d?d[a]:!1};c.prototype.unset=function(a){this.removeAttr(a)};
c.prototype.clear=function(){var a=this.toJSON(),d;for(d in a)this.removeAttr(d)};return c},{requires:["mvc","magix/base"]});
KISSY.add("magix/impls/router",function(f,c,b,e,a,d){return{getAppConfig:function(){var a=d.pathViewMap,b=d.defaultViewName;if(b&&a)for(var c in a)a[c]||(a[c]=b);return d},getVOMObject:function(){return e},setStateListener:function(){var d=this;e.__Router=d;(new a.Router).addRoutes({"*hash":function(a){f.log(a.hash);d.route(a.hash)}});a.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var d=
{},b;d.pathName=this.appConfig.indexPath;d.paraObj={};d.referrer=this.state&&this.state.query||null;if(d.query=a)a=a.split("/"),b=a.pop(),-1==b.indexOf("=")&&b&&(a.push(b),b=""),d.pathName=a.join("/"),d.paraObj=c.unParam(b);return d},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},d=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(d)a.pathName=location.pathname.split(d)[1];a.query=a.pathName+location.search;if(location.search)a.paraObj=
c.unParam(location.search.substr(1));return a},getRootViewName:function(){var a=this.appConfig.pathViewMap,d;if(a&&(d=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath],this.query.__view__&&(d=this.query.__view__.split("-").join("/")),this.config.multipage))a=a[this.query["sch:pathname"]],"object"==typeof a?d=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",d=a||this.appConfig.defaultRootViewName);return d},createQueryModel:function(){return new b(this.query)},
changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},_fixQueryModel:function(a){if(this.queryModel){var d,b=this.queryModel.toJSON();for(d in b)d in a||this.queryModel.unset(d,{silent:!0})}},navigateTo:function(a){var a=c.isPlainObject(a)?a:c.unParam(a),d=f.clone(this.state.paraObj);delete d.referrer;delete d.pathname;delete d.query;delete d.postdata;var a=c.mix(d,a),b;for(b in a)a[b]||delete a[b];this.goTo(this.state.pathName+"/"+c.param(a))}}},{requires:["magix/base",
"magix/model","magix/vom","mvc","app/config/ini"]});KISSY.add("magix/impls/template",function(f,c){return{toHTML:function(b){b=this.processOptions(b);return c.toHTML(b.template,b.data)}}},{requires:["magix/tmpl"]});
KISSY.add("magix/impls/vframe",function(f,c){var b=function(){};c.mix(b,{tagName:"vframe"});c.mix(b.prototype,{getChildVframeNodes:function(){var b=document.getElementById(this.id).getElementsByTagName("vframe"),a,d=[];for(a=0;a<b.length;a++)d.push(this._idIt(b[a]));return d},createFrame:function(){return document.createElement(b.tagName)}});return b},{requires:["magix/base"]});
KISSY.add("magix/impls/view",function(f,c,b,e,a,d){var h=function(){h.superclass.constructor.apply(this,arguments)},k=function(a,d){var b=function(){b.superclass.constructor.apply(this,arguments)};b.extend=k;return f.extend(b,this,a,d)};h.extend=k;f.extend(h,c.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return a},getAjaxObject:function(){return e},getTemplateObject:function(){return b},dispose:function(){h.superclass.destroy.apply(this,arguments)}});f.mix(h.prototype,d.Events);
var g=h.prototype.fire;h.prototype.fire=function(a,d){g(a,d);this.trigger(a,d)};return h},{requires:["mvc","magix/template","magix/ajax","magix/vom","magix/base"]});KISSY.add("magix/impls/vom",function(f,c,b){return{setRootVframe:function(){var b=document.getElementById("vf-root"),a=this.createElement(b,"vf-root");b||document.body.insertBefore(a.getOnce(),document.body.firstChild);this.root=a},getVframeClass:function(){return b}}},{requires:["magix/base","magix/vframe"]});
Magix={init:function(f){this.config=f||{};this.setEnv();this.bootstrap()},templates:{},setEnv:function(){var f=this.config.magixHome||"",c=this.config.appHome||"",b=KISSY,e=(new Date).getTime();if(f&&!/\/$/.test(f))f+="/",this.config.magixHome=f;if(c&&!/\/$/.test(c))c+="/",this.config.appHome=c;if(!this.config.release&&/^https?:\/\//.test(c))this.config.release=-1==c.indexOf(location.protocol+"//"+location.host);if(!this.config.release)b.config({map:[[RegExp("("+c+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]}),
this.dev=!0,b.config({debug:!0});if(!window.console)window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};b.config({packages:[{name:"magix",path:/\/magix\/$/.test(f)?f+"../":f,tag:this.dev?e:"20120214"},{name:"app",path:/\/app\/$/.test(c)?c+"../":c,tag:this.dev?e:"20120214"}]})},bootstrap:function(){var f=this;KISSY.use("magix/router",function(c,b){c.log(b);b.init(f.config)})},implementBy:"kissy",version:"0.1.0",dev:""};
KISSY.add("magix/model",function(f,c,b){f=function(){};b.mix(f.prototype,{unset:b.unimpl,clear:b.unimpl,load:b.unimpl});return b.implement(f,c)},{requires:["magix/impls/model","magix/base"]});
KISSY.add("magix/mu",function(f,c){function b(a){a=a.split("==");return function(){for(var d=a[0].split("."),b=a[1],c=d.length-1;-1<c;c--){var e=d.slice(c),f=this;try{for(var i=0;i<e.length-1;i++)f=f[e[i]];if(e[e.length-1]in f){if(f[e[e.length-1]].toString()===b)return!0;break}}catch(l){}}return!1}}function e(a,d){var b,c;for(b in a)if(c=a[b],c instanceof Array)for(var g=0;g<c.length;g++){if(o=c[g],"object"==typeof o)0===g?o.__first__=!0:g==c.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=g}else"object"==
typeof c&&5>d&&e(c,d+1)}return{to_html:function(a,d){"object"==typeof d&&e(d,0);var h=d,k;k=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i;var g=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),f=[];if(g)for(var i=0;i<g.length;i++)f.push(g[i].match(k)[1]);k=f;g="";for(f=0;f<k.length;f++)g="if("+k[f]+")",h[g]||(h[g]=b(k[f]));return c.to_html.apply(this,arguments)}}},{requires:["magix/mustache"]});
KISSY.add("magix/mustache",function(){return function(){var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(c,b,e,a){if(!a)this.context=b,this.buffer=[];if(this.includes("",c)){c=this.render_pragmas(c);c=this.render_section(c,b,e);if(a)return this.render_tags(c,b,e,a);this.render_tags(c,b,e,a)}else{if(a)return c;this.send(c)}},send:function(c){""!=c&&this.buffer.push(c)},render_pragmas:function(c){if(!this.includes("%",
c))return c;var b=this;return c.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(c,a,d){if(!b.pragmas_implemented[a])throw{message:"This implementation of mustache doesn't understand the '"+a+"' pragma"};b.pragmas[a]={};d&&(c=d.split("="),b.pragmas[a][c[0]]=c[1]);return""})},render_partial:function(c,b,e){c=this.trim(c);if(!e||void 0===e[c])throw{message:"unknown_partial '"+c+"'"};return"object"!=typeof b[c]?this.render(e[c],b,e,!0):this.render(e[c],b[c],e,!0)},render_section:function(c,
b,e){if(!this.includes("#",c)&&!this.includes("^",c))return c;var a=this;return c.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(d,c,k,g){d=a.find(k,b);if("^"==c)return!d||a.is_array(d)&&0===d.length?a.render(g,b,e,!0):"";if("#"==c)return a.is_array(d)?a.map(d,function(d){return a.render(g,a.create_context(d),e,!0)}).join(""):a.is_object(d)?a.render(g,a.create_context(d),e,!0):"function"===typeof d?d.call(b,g,
function(d){return a.render(d,b,e,!0)}):d?a.render(g,b,e,!0):""})},render_tags:function(c,b,e,a){for(var d=this,h=function(){return RegExp(d.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+d.ctag+"+","g")},k=h(),g=function(a,c,g){switch(c){case "!":return"";case "=":return d.set_delimiters(g),k=h(),"";case ">":return d.render_partial(g,b,e);case "{":return d.find(g,b);default:return d.escape(d.find(g,b))}},c=c.split("\n"),f=0;f<c.length;f++)c[f]=c[f].replace(k,g,this),a||this.send(c[f]);if(a)return c.join("\n")},
set_delimiters:function(c){c=c.split(" ");this.otag=this.escape_regex(c[0]);this.ctag=this.escape_regex(c[1])},escape_regex:function(c){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,b){var c=this.trim(c),e;!1===b[c]||0===b[c]||b[c]?e=b[c]:(!1===this.context[c]||0===this.context[c]||this.context[c])&&(e=this.context[c]);return"function"===typeof e?e.apply(b):void 0!==
e?e:""},includes:function(c,b){return-1!=b.indexOf(this.otag+c)},escape:function(c){return(""+(null===c?"":c)).replace(/&(?!\w+;)|["'<>\\]/g,function(b){switch(b){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return b}})},create_context:function(c){if(this.is_object(c))return c;var b=".";if(this.pragmas["IMPLICIT-ITERATOR"])b=this.pragmas["IMPLICIT-ITERATOR"].iterator;var e={};e[b]=c;return e},is_object:function(c){return c&&
"object"==typeof c},is_array:function(c){return"[object Array]"===Object.prototype.toString.call(c)},trim:function(c){return c.replace(/^\s*|\s*$/g,"")},map:function(c,b){if("function"==typeof c.map)return c.map(b);for(var e=[],a=c.length,d=0;d<a;d++)e.push(b(c[d]));return e}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(c,b,e,a){var d=new f;if(a)d.send=a;d.render(c,b,e);if(!a)return d.buffer.join("\n")}}}()});
KISSY.add("magix/router",function(f,c,b){f={};b.mix(f,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:b.unimpl,setStateListener:b.unimpl,parseState:b.unimpl,parseSearch:b.unimpl,getRootViewName:b.unimpl,createQueryModel:b.unimpl,changeQueryModel:b.unimpl,navigateTo:b.unimpl,setPostData:b.unimpl,getVOMObject:b.unimpl,init:function(b){this.config=b;this.appConfig=this.getAppConfig();this.setStateListener()},
goTo:function(b){location.hash="!"+b},route:function(b){this.state=this.parseState(b);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;if(this.rootViewName=this.getRootViewName())if(this.rootViewName==this.oldRootViewName)this.changeQueryModel();else{var a=this.getVOMObject();this.queryModel=this.createQueryModel();this.queryModel.bind("change",function(){a.notifyQueryModelChange(this)});a.mountRootView(this.rootViewName,
this.queryModel)}this.postData=null},_spreadLocator:function(){var c={},a=this._locator;b.mix(c,a.state.paraObj);b.mix(c,{referrer:a.state.referrer,query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var d={},h,k=a.search.paraObj;d["sch:pathname"]=a.search.pathName;d["sch:query"]=a.search.query;for(h in k)d["sch:"+h]=k[h];b.mix(c,d);return c}});b.mix(f,c);return f},{requires:["magix/impls/router","magix/base"]});
KISSY.add("magix/template",function(f,c,b){return b.implement({defaultOptions:{data:{},template:""},processOptions:function(b){for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},toHTML:b.unimpl},c)},{requires:["magix/impls/template","magix/base"]});
KISSY.add("magix/tmpl",function(){var f={},c={},b="_"+(new Date).getTime(),e=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/notRenderTemplate\1[^>]*>([\s\S]*?)<\/script>\s*/gi,a=function(a,h){if(a){var e;e=c[a];e||(e=b+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,
";"+b+".push('")+"');return "+b+".join('')",c[a]=e);var g=[b],j=[[]],i;if(h)for(i in h)g.push(i.replace(/[:+\-*\/&^%#@!~]/g,"$")),j.push(h[i]);i=g.join("_")+"_"+e;if(!f[i])try{f[i]=new Function(g,e)}catch(l){return l.message}try{e=f[i].apply(h,j)}catch(m){e=m.message}return e}return a};return{toHTML:function(d,b){var c=d.match(e);if(c)var d=d.replace(e,function(){return'<script type="text/notRenderTemplate"><\/script>'}),d=a(d,b),g=0,d=d.replace(e,function(){return c[g++]});else d=a(d,b);return d}}});
KISSY.add("magix/vframe",function(f,c,b){var e;e=function(){};b.mix(e,{tagName:b.unimpl,uniqueId:function(){return b.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});b.mix(e.prototype,b.Events);b.mix(e.prototype,{getChildVframeNodes:b.unimpl,getRouterObject:function(){return this.__Router},createFrame:b.unimpl,getVOMObject:function(){return this.__VOM},initial:function(a,d){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||this.createFrame();
this.id=this._idIt(this._domNode,d);if(a)this._domNode=null;this.exist=!0},_idIt:function(a,d){a.id=a&&a.id||d||e.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,d){return document.getElementById(this.id).setAttribute(a,d)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},
handelMounted:function(){var a=this;a.view.rendered?(a.mounted=!0,a.trigger("mounted",a.view),a.mountSubFrames()):a.view.bind("rendered",function(){a.mounted=!0;a.trigger("mounted",a.view);a.mountSubFrames()});a.view.bind("prerender",function(){a.destroySubFrames()})},mountSubFrames:function(){var a=this.getVOMObject(),d=a.getElementById(this.view.vcid),b=d.getElements(),c,e;for(c=0;c<b.length;c++)e=a.createElement(b[c]),d.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.view.queryModel})},
mountView:function(a,d){if(a){d=d||{};this.unmountView(d);var c=this,e=this.getRouterObject();if(!d.queryModel)d.queryModel=e.queryModel;b.requireAsync(a,function(b){if(c.exist)d.vcid=c.id,d.viewName=a,c.view=new b(d),c.__viewLoaded=!0,c.trigger("viewLoaded",!0),c.handelMounted()})}},unmountView:function(a){if(this.view&&this.mounted){a=a||{};this.destroySubFrames();this.view.beforeDestroy();this.view.trigger("unload",!0);this.view.trigger("beforeRebuild",!0);this.view.destroy();this.view.afterDestroy();
for(var d=document.getElementById(this.view.vcid),b=d.getElementsByTagName("iframe"),c,e;b.length;)c=b[0],e=c.parentNode,c.src="",e.removeChild(c),e.parentNode.removeChild(e);d.innerHTML=a.unmountPlaceholder||"";delete a.unmountPlaceholder;this.mounted=!1;this.view=null}},destroySubFrames:function(){function a(b){d.push(b);for(var c=0;c<b.childNodes.length;c++)a(b.childNodes[c])}var d=[],b=this.getVOMObject().getElementById(this.id);a(b);for(b=d.length-1;0<b;b--)d[b].removeNode()},removeNode:function(){this.mounted&&
this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var d,b,c=[];for(d=0;d<this.childNodes.length;d++)b=this.childNodes[d],b==a?this._popFromVOM(b):c.push(b);this.childNodes=c},_popFromVOM:function(a){this.getVOMObject().pop(a);a.exist=!1},postMessage:function(a,d){var b=this;if(b.exist)a||(a={}),
a.from=d,b.__viewLoaded?b.view._receiveMessage(a):(b.unbind("viewLoaded"),b.bind("viewLoaded",function(){b.view._receiveMessage(a)}))}});return b.implement(e,c).init()},{requires:["magix/impls/vframe","magix/base"]});
KISSY.add("magix/view",function(f,c,b){var e;e=function(){};b.mix(e.prototype,{getVOMObject:b.unimpl,getTemplateObject:b.unimpl,getAjaxObject:b.unimpl,dispose:b.unimpl,queryModelChange:function(){},initial:function(a){var d=this;this.getVOMObject();this.options=a;this.vcid=a.vcid;this.queryModel=a.queryModel;this.viewName=a.viewName;this.data=a.data||{};a.message&&"function"==typeof a.message&&this.bind("message",a.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});this.init&&setTimeout(function(){d.exist&&
d.init()},0);this.preventRender||this.getTemplate(function(a){d.template=a;setTimeout(function(){if(d.exist)!1!==d.render()&&!d.__isStartMountSubs&&d.trigger("rendered"),d.__rendered=!0,d.trigger("renderComplete",!0)},0)})},_queryModelChange:function(a){try{if(this.hashHasChanged())var d=this.queryModelChange(a)}catch(b){}this.observeHash();this.__isStartMountSubs&&(d=!1);this._changeChain(d,a)},_changeChain:function(a,d){var c=[],e;e=this.getVOMObject().getElementById(this.vcid);if(!1!==a){!0===
a||void 0===a?c=e.childNodes:b.isArray(a)&&(c=a);for(e=0;e<c.length;e++)c[e].view&&c[e].view._queryModelChange(d)}},destory:function(){this.destroy()},beforeDestroy:function(){},afterDestroy:function(){},destroy:function(){if(this.events){var a=document.getElementById(this.vcid),d;for(d in this.events)a["on"+d]=null}this.dispose()},setData:function(a){this.data=a;for(var d in a)a[d]&&a[d].toJSON&&(a[d]=a[d].toJSON());a.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var a=
this,d=this.renderer,b,c;if(d)for(b in d)for(c in d[b])(function(){var e=b,f=c,i=d[e][f];a.data[e+"_"+f]=function(){return i.call(this,a,e)}})()},getEventInfo:function(a,d){for(var b=a.target||a.srcElement,c=a.type,e="mx"+c,f=this.eventsLevel;3===b.nodeType;)b=b.parentNode;var i=b.getAttribute(e);if(f)var l=f[c];if(!i&&l)if(!isNaN(l)&&l)for(;l&&b!=d;){b=b.parentNode;if(i=b.getAttribute(e))break;l--}else if(l.split(".")[1])for(l=l.split(".")[1];b!=d;){if(b=b.parentNode,0<=b.className.indexOf(l)){i=
b.getAttribute(e);break}}else{if(l.split("#")[1])for(l=l.split("#")[1];b!=d;)if(b=b.parentNode,b.id==l){i=b.getAttribute(e);break}}else if(!i)b=b.parentNode,i=b.getAttribute(e);return{info:i,target:b}},processEvent:function(a,b){var c=a||window.event,e=this.getEventInfo(c,b||document.getElementById(this.vcid)),f=c.type,j={},i=e.target,e=e.info,j={target:i,originEvent:c};if(e)for(var e=e.split("|"),l,m,p=0;p<e.length;p++){l=e[p].split(":");m=l.shift();var n=l[l.length-1],q=!1;if("_halt_"==n||"_preventDefault_"==
n)c.preventDefault?c.preventDefault():c.returnValue=!1,q=j.isPreventDefault=!0;if("_halt_"==n||"_stop_"==n)c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,q=j.isStopPropagation=!0;q&&l.pop();this.trigger("beforeEventCall",j);if(this.events&&this.events[f]&&this.events[f][m])this.events[f][m](this,this.idIt(i),l,c)}this.trigger("delegateEventsFire",j)},delegateEvents:function(){var a=this,b=document.getElementById(a.vcid),c=this.events,e;for(e in c)b["on"+e]=function(c){a.processEvent(c,b)}},
setViewHTML:function(a){var b=this;return b.exist?(b.trigger("beforeRebuild",!0),b.trigger("prerender"),document.getElementById(b.vcid).innerHTML=a,b.trigger("rendered"),b.__isStartMountSubs=!0,setTimeout(function(){delete b.__isStartMountSubs},0),!0):!1},render:function(){},getTemplate:function(a,b){if(this.template)a(this.template);else{var c=Magix.config.appHome,c=/\/app\/$/.test(c)?c+this.viewName.split("app")[1]:c+this.viewName,c=(b?c+".name.html":c+".html").replace(/([^:\/])\/+/g,"$1/"),e=this.getAjaxObject();
if(Magix.dev||!Magix.config.release)c+="?t="+(new Date).getTime();e.getTemplate(c,function(b){a(b)},function(b){a(b)},this.viewName)}},idIt:function(a){var c="";if(!a.id)a.id=b.uniqueId("mxevt-");return c=a.id},receiveMessage:function(){},_receiveMessage:function(a){var b=this;try{b.exist&&b.__rendered?b.receiveMessage(a):(b.unbind("renderComplete"),b.bind("renderComplete",function(){b.receiveMessage(a)}))}catch(c){}},postMessageTo:function(a,c){var e=this.getVOMObject();b.isArray(a)||(a=[a]);for(var f=
0;f<a.length;f++){var g=e.get(a[f]);g&&g.postMessage(c,this)}},observeHash:function(a,c){if(a){b.isArray(a)||(a=[a]);this.$observeHashKeys=a;this.$observeHashCache={};for(var e=0;e<a.length;e++)this.$observeHashCache[a[e]]=this.queryModel.get(a[e])}else c||this.observeHash(this.$observeHashKeys,!0)},hashHasChanged:function(a){var b=this.$observeHashCache,c=this.$realUsingCache,e;if(!a)a=this.$observeHashKeys;if(a){if(b){e=!1;for(var f=0,j,i;f<a.length&&!(j=a[f],b.hasOwnProperty(j)&&(i=this.queryModel.get(j),
(e=b[j]!=i)&&c&&c.hasOwnProperty(j)&&(e=c[j]!=i),e));f++);return e}for(f=0;f<a.length;f++)if(this.queryModel.hasChanged(a[f]))return!0;return!1}return!0},hashHasChangedExcept:function(a){var b=[],c={},e=this.$observeHashKeys;if(a&&e){f.isArray(a)||(a=[a]);for(var g=0;g<a.length;g++)c[a[g]]=1;for(g=0;g<e.length;g++)c[e[g]]||b.push(e[g])}else b=e;return this.hashHasChanged(b)},hashRealUsing:function(a){if(a){if(!this.$realUsingCache)this.$realUsingCache={};for(var b in a)this.$realUsingCache[b]=a[b]}}});
return b.implement(e,c)},{requires:["magix/impls/view","magix/base"]});
KISSY.add("magix/vom",function(f,c,b){f={};b.mix(f,{_idMap:{},root:null,setRootVframe:b.unimpl,getVframeClass:b.unimpl,init:function(){if(!this.inited)this.setRootVframe(),this.inited=!0;return this},push:function(b){this._idMap[b.id]=b},pop:function(b){delete this._idMap[b.id]},createElement:function(c,a){b.isString(c)&&(c=document.getElementById(c));var d=new (this.getVframeClass())(c,a);d.__VOM=this;d.__Router=this.__Router;this.push(d);return d},getElementById:function(b){return this._idMap[b]||
null},get:function(b){return this.getElementById(b)},broadcaseMessage:function(b,a){var c=this._idMap,f;for(f in c)c[f].postMessage(b,a||this)},notifyQueryModelChange:function(b){this.root&&this.root.view&&this.root.view._queryModelChange(b)},mountRootView:function(b,a){this.root&&this.root.mountView(b,{queryModel:a})}});b.mix(f,c);return f.init()},{requires:["magix/impls/vom","magix/base"]});