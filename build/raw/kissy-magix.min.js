KISSY.add("magix/ajax",function(f,e,d){return d.implement({defaultOptions:{dataType:"html",method:"POST",success:function(){},error:function(){}},globalSetting:function(c){if(!this.$globalSetting)this.$globalSetting={};for(var a in c)this.$globalSetting[a]=c[a];return this.$globalSetting},fireGlobalSetting:function(c){var a=this.$globalSetting;if(a&&a.statusCode&&(a=a.statusCode,a[c.status]))try{a[c.status](c)}catch(b){}},send:d.unimpl,processOptions:function(c){c||(c={});for(var a in this.defaultOptions)c[a]||
(c[a]=this.defaultOptions[a]);return c},getTemplate:function(c,a,b,k){var e=Magix.templates,g=e[k];g?d.isFunction(a)&&a(g):this.send({url:c,dataType:"html",method:"GET",success:function(b){e[k]=b;d.isFunction(a)&&a(b)},error:function(a){d.isFunction(b)&&b(a)}})}},e)},{requires:["magix/impls/ajax","magix/base"]});
KISSY.add("magix/base",function(f,e){var d={mix:function(c,a,b,d){if(!a||!c)return c;void 0===b&&(b=!0);var e,g,f;if(d&&(f=d.length))for(e=0;e<f;e++){if(g=d[e],g in a&&(b||!(g in c)))c[g]=a[g]}else for(g in a)if(b||!(g in c))c[g]=a[g];return c},include:function(c){var c=Magix.config.magixHome+"../"+c+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",c,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");}};
d.mix(d,{isFunction:d.unimpl,isArray:d.unimpl,isString:d.unimpl,isPlainObject:d.unimpl,requireAsync:d.unimpl,Events:d.unimpl,_idCounter:0,uniqueId:function(c){var a=this._idCounter++;return c?c+a:a},extend:function(c,a,b,d){if(!a||!c)return c;var e=Object.prototype,g=a.prototype,f=function(a){function b(){}b.prototype=a;return new b}(g);c.prototype=f;f.constructor=c;c.superclass=g;if(a!==Object&&g.constructor===e.constructor)g.constructor=a;b&&this.mix(f,b);d&&this.mix(c,d);return c},param:function(c){var a=
[],b;for(b in c)c.hasOwnProperty(b)&&a.push(b+"="+c[b]);return a.join("&")},unParam:function(c){for(var c=c.split("&"),a,b={},d=0;d<c.length;d++)a=c[d].split("="),a[0]&&(b[a[0]]=a[1]||"");return b},mixClassStaticProps:function(c,a){for(var b in a)a.hasOwnProperty(b)&&"prototype"!=b&&(c[b]=a[b]);return c},mixClassProtoProps:function(c,a){for(var b in a)if(!c[b]||c[b]==d.unimpl)c[b]=a[b];return c},implement:function(c,a){if(d.isFunction(c)&&d.isFunction(a)){a.prototype.constructor=a;var b=function(){a.apply(this,
arguments);c.apply(this,arguments);c.prototype.initial&&c.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(b,c);this.mixClassStaticProps(b,a);this.mixClassProtoProps(b.prototype,c.prototype);this.mixClassProtoProps(b.prototype,a.prototype);return b.prototype.constructor=b}b={};d.mix(b,c);d.mix(b,a);return b}});d.mix(d,e);return d},{requires:["magix/impls/base"]});
KISSY.add("magix/impls/ajax",function(f,e){return{send:function(d){var c=this,d=this.processOptions(d),a=d.success,b=d.error;e(f.mix(d,{url:d.url,dataType:d.dataType,type:d.method,success:function(b,e,g){c.fireGlobalSetting(g);a.call(d,b)},error:function(a,e,g){c.fireGlobalSetting(g);b.call(d,e)}}))}}},{requires:["ajax"]});
KISSY.add("magix/impls/base",function(f){var e=Object.prototype.toString;return{isFunction:f.isFunction,isArray:f.isArray,isString:f.isString,isPlainObject:function(d){return d&&"[object Object]"===e.call(d)&&!d.nodeType&&!d.setInterval},requireAsync:function(d,c){f.use(d,function(a,b){c(b)})},Events:{bind:function(d,c,a){var b=this._callbacks||(this._callbacks={});(b[d]||(b[d]=[])).push([c,a]);return this},unbind:function(d,c){var a;if(d){if(a=this._callbacks)if(c){a=a[d];if(!a)return this;for(var b=
0,e=a.length;b<e;b++)if(a[b]&&c===a[b][0]){a[b]=null;break}}else a[d]=[]}else this._callbacks={};return this},trigger:function(d){var c,a,b,e,j=2;if(!(a=this._callbacks))return this;for(;j--;)if(c=j?d:"all",c=a[c])for(var g=0,f=c.length;g<f;g++)(b=c[g])?(e=j?Array.prototype.slice.call(arguments,1):arguments,b[0].apply(b[1]||this,e)):(c.splice(g,1),g--,f--);return this}}}},{requires:["ajax"]});
KISSY.add("magix/impls/model",function(f,e,d){e=e.Model;f.mix(e.prototype,d.Events);var c=e.prototype.fire;e.prototype.fire=function(a,b){c(a,b);"*"==a.charAt(0)&&(a=a.substring(1).replace(/[A-Z]/,function(a){return a.toLowerCase()}));this.trigger(a,b)};e.prototype.unset=function(a){this.removeAttr(a)};e.prototype.clear=function(){var a=this.toJSON(),b;for(b in a)this.removeAttr(b)};return e},{requires:["mvc","magix/base"]});
KISSY.add("magix/impls/router",function(f,e,d,c,a,b){return{getAppConfig:function(){var a=b.pathViewMap,c=b.defaultViewName;if(c&&a)for(var d in a)a[d]||(a[d]=c);return b},getVOMObject:function(){return c},setStateListener:function(){var b=this;(new a.Router).addRoutes({"*hash":function(a){f.log(a.hash);b.route(a.hash)}});a.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var b={},c;
b.pathName=this.appConfig.indexPath;b.paraObj={};b.referrer=this.state&&this.state.query||null;if(b.query=a)a=a.split("/"),c=a.pop(),b.pathName=a.join("/"),b.paraObj=e.unParam(c);return b},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},b=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(b)a.pathName=location.pathname.split(b)[1];a.query=a.pathName+location.search;if(location.search)a.paraObj=e.unParam(location.search.substr(1));return a},
getRootViewName:function(){var a=this.appConfig.pathViewMap,b;b=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath];this.query.__view__&&(b=this.query.__view__.split("-").join("/"));if(this.config.multipage)a=a[this.query["sch:pathname"]],"object"==typeof a?b=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",b=a||this.appConfig.defaultRootViewName);return b},createQueryModel:function(){return new d(this.query)},changeQueryModel:function(){this._fixQueryModel(this.query);
this.queryModel.set(this.query)},_fixQueryModel:function(a){if(this.queryModel){var b,c=this.queryModel.toJSON();for(b in c)b in a||this.queryModel.unset(b,{silent:!0})}},navigateTo:function(a){var a=e.unParam(a),b=f.clone(this.state.paraObj);delete b.referrer;delete b.pathname;delete b.query;delete b.postdata;var a=e.mix(b,a),c;for(c in a)a[c]||delete a[c];this.goTo(this.state.pathName+"/"+e.param(a))}}},{requires:["magix/base","magix/model","magix/vom","mvc","app/config/ini"]});
KISSY.add("magix/impls/template",function(f,e){return{toHTML:function(d){d=this.processOptions(d);return e.toHTML(d.template,d.data)}}},{requires:["magix/tmpl"]});
KISSY.add("magix/impls/vframe",function(f,e){var d=function(){};e.mix(d,{tagName:"vframe"});e.mix(d.prototype,{getChildVframeNodes:function(){var c=document.getElementById(this.id).getElementsByTagName("vframe"),a,b=[];for(a=0;a<c.length;a++)b.push(this._idIt(c[a]));return b},getRouterObject:function(){var c;KISSY.use("magix/router",function(a,b){c=b});return c},getVOMObject:function(){var c;f.use("magix/vom",function(a,b){c=b});return c},createFrame:function(){return document.createElement(d.tagName)}});
return d},{requires:["magix/base"]});
KISSY.add("magix/impls/view",function(f,e,d,c,a,b){var k=function(){k.superclass.constructor.apply(this,arguments)};f.extend(k,e.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return a},getAjaxObject:function(){return c},getTemplateObject:function(){return d},dispose:function(){k.superclass.destroy.apply(this,arguments)}});f.mix(k.prototype,b.Events);var j=k.prototype.fire;k.prototype.fire=function(a,b){j(a,b);this.trigger(a,b)};return k},{requires:["mvc","magix/template",
"magix/ajax","magix/vom","magix/base"]});KISSY.add("magix/impls/vom",function(){return{setRootVframe:function(){var f=null;if("vf-root"==document.body.id)f=document.body;var e=this.createElement(f,"vf-root");f||document.body.insertBefore(e.getOnce(),document.body.firstChild);this.root=e}}},{requires:["magix/base"]});
Magix={init:function(f){this.config=f||{};this.setEnv();this.bootstrap()},templates:{},setEnv:function(){var f=this.config.magixHome||"",e=this.config.appHome||"",d=KISSY,c=(new Date).getTime();if(this.config.debug&&(this.dev=!0,d.config({debug:!0}),!window.console))window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};if(f&&!/\/$/.test(f))f+="/",this.config.magixHome=f;if(e&&!/\/$/.test(e))e+="/",this.config.appHome=e;d.config({packages:[{name:"magix",path:/\/magix\/$/.test(f)?
f+"../":f,tag:this.dev?c:"20120214"},{name:"app",path:/\/app\/$/.test(e)?e+"../":e,tag:this.dev?c:"20120214"}]})},bootstrap:function(){var f=this;KISSY.use("magix/router",function(e,d){e.log(d);d.init(f.config)})},implementBy:"kissy",version:"0.1.0",dev:""};KISSY.add("magix/model",function(f,e,d){f=function(){};d.mix(f.prototype,{unset:d.unimpl,clear:d.unimpl,load:d.unimpl});return d.implement(f,e)},{requires:["magix/impls/model","magix/base"]});
KISSY.add("magix/mu",function(f,e){function d(a){a=a.split("==");return function(){for(var b=a[0].split("."),c=a[1],d=b.length-1;-1<d;d--){var e=b.slice(d),f=this;try{for(var h=0;h<e.length-1;h++)f=f[e[h]];if(e[e.length-1]in f){if(f[e[e.length-1]].toString()===c)return!0;break}}catch(l){}}return!1}}function c(a,b){var d,e;for(d in a)if(e=a[d],e instanceof Array)for(var f=0;f<e.length;f++){if(o=e[f],"object"==typeof o)0===f?o.__first__=!0:f==e.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=f}else"object"==
typeof e&&5>b&&c(e,b+1)}return{to_html:function(a,b){"object"==typeof b&&c(b,0);var k=b,f;f=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i;var g=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),i=[];if(g)for(var h=0;h<g.length;h++)i.push(g[h].match(f)[1]);f=i;g="";for(i=0;i<f.length;i++)g="if("+f[i]+")",k[g]||(k[g]=d(f[i]));return e.to_html.apply(this,arguments)}}},{requires:["magix/mustache"]});
KISSY.add("magix/mustache",function(){return function(){var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(e,d,c,a){if(!a)this.context=d,this.buffer=[];if(this.includes("",e)){e=this.render_pragmas(e);e=this.render_section(e,d,c);if(a)return this.render_tags(e,d,c,a);this.render_tags(e,d,c,a)}else{if(a)return e;this.send(e)}},send:function(e){""!=e&&this.buffer.push(e)},render_pragmas:function(e){if(!this.includes("%",
e))return e;var d=this;return e.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(c,a,b){if(!d.pragmas_implemented[a])throw{message:"This implementation of mustache doesn't understand the '"+a+"' pragma"};d.pragmas[a]={};b&&(c=b.split("="),d.pragmas[a][c[0]]=c[1]);return""})},render_partial:function(e,d,c){e=this.trim(e);if(!c||void 0===c[e])throw{message:"unknown_partial '"+e+"'"};return"object"!=typeof d[e]?this.render(c[e],d,c,!0):this.render(c[e],d[e],c,!0)},render_section:function(e,
d,c){if(!this.includes("#",e)&&!this.includes("^",e))return e;var a=this;return e.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(b,e,f,g){b=a.find(f,d);if("^"==e)return!b||a.is_array(b)&&0===b.length?a.render(g,d,c,!0):"";if("#"==e)return a.is_array(b)?a.map(b,function(b){return a.render(g,a.create_context(b),c,!0)}).join(""):a.is_object(b)?a.render(g,a.create_context(b),c,!0):"function"===typeof b?b.call(d,g,
function(b){return a.render(b,d,c,!0)}):b?a.render(g,d,c,!0):""})},render_tags:function(e,d,c,a){for(var b=this,f=function(){return RegExp(b.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+b.ctag+"+","g")},j=f(),g=function(a,e,g){switch(e){case "!":return"";case "=":return b.set_delimiters(g),j=f(),"";case ">":return b.render_partial(g,d,c);case "{":return b.find(g,d);default:return b.escape(b.find(g,d))}},e=e.split("\n"),i=0;i<e.length;i++)e[i]=e[i].replace(j,g,this),a||this.send(e[i]);if(a)return e.join("\n")},
set_delimiters:function(e){e=e.split(" ");this.otag=this.escape_regex(e[0]);this.ctag=this.escape_regex(e[1])},escape_regex:function(e){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,d){var e=this.trim(e),c;!1===d[e]||0===d[e]||d[e]?c=d[e]:(!1===this.context[e]||0===this.context[e]||this.context[e])&&(c=this.context[e]);return"function"===typeof c?c.apply(d):void 0!==
c?c:""},includes:function(e,d){return-1!=d.indexOf(this.otag+e)},escape:function(e){return(""+(null===e?"":e)).replace(/&(?!\w+;)|["'<>\\]/g,function(d){switch(d){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return d}})},create_context:function(e){if(this.is_object(e))return e;var d=".";if(this.pragmas["IMPLICIT-ITERATOR"])d=this.pragmas["IMPLICIT-ITERATOR"].iterator;var c={};c[d]=e;return c},is_object:function(e){return e&&
"object"==typeof e},is_array:function(e){return"[object Array]"===Object.prototype.toString.call(e)},trim:function(e){return e.replace(/^\s*|\s*$/g,"")},map:function(e,d){if("function"==typeof e.map)return e.map(d);for(var c=[],a=e.length,b=0;b<a;b++)c.push(d(e[b]));return c}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(e,d,c,a){var b=new f;if(a)b.send=a;b.render(e,d,c);if(!a)return b.buffer.join("\n")}}}()});
KISSY.add("magix/router",function(f,e,d){f={};d.mix(f,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:d.unimpl,setStateListener:d.unimpl,parseState:d.unimpl,parseSearch:d.unimpl,getRootViewName:d.unimpl,createQueryModel:d.unimpl,changeQueryModel:d.unimpl,navigateTo:d.unimpl,setPostData:d.unimpl,getVOMObject:d.unimpl,init:function(c){this.config=c;this.appConfig=this.getAppConfig();this.setStateListener()},
goTo:function(c){location.hash="!"+c},route:function(c){this.state=this.parseState(c);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;this.rootViewName=this.getRootViewName();if(this.rootViewName==this.oldRootViewName)this.changeQueryModel();else{var a=this.getVOMObject();this.queryModel=this.createQueryModel();this.queryModel.bind("change",function(){if(a.root.view){var b=a.root.view.queryModelChange(this);
a.root.view._changeChain(b,this)}});this.mountRootView()}this.postData=null},_spreadLocator:function(){var c={},a=this._locator;d.mix(c,a.state.paraObj);d.mix(c,{referrer:a.state.referrer,query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var b={},e,f=a.search.paraObj;b["sch:pathname"]=a.search.pathName;b["sch:query"]=a.search.query;for(e in f)b["sch:"+e]=f[e];d.mix(c,b);return c},mountRootView:function(){this.getVOMObject().root.mountView(this.rootViewName,{queryModel:this.queryModel})}});
d.mix(f,e);return f},{requires:["magix/impls/router","magix/base"]});KISSY.add("magix/template",function(f,e,d){return d.implement({defaultOptions:{data:{},template:""},processOptions:function(c){for(var a in this.defaultOptions)c[a]||(c[a]=this.defaultOptions[a]);return c},toHTML:d.unimpl},e)},{requires:["magix/impls/template","magix/base"]});
KISSY.add("magix/tmpl",function(){var f={},e={},d="_"+(new Date).getTime(),c=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/notRenderTemplate\1[^>]*>([\s\S]*?)<\/script>\s*/gi,a=function(a,c){if(a){var j;j=e[a];j||(j=d+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,
";"+d+".push('")+"');return "+d+".join('')",e[a]=j);var g=[d],i=[[]],h;if(c)for(h in c)g.push(h.replace(/[:+\-*\/&^%#@!~]/g,"$")),i.push(c[h]);h=g.join("_")+"_"+j;f[h]||(f[h]=new Function(g,j));return j=f[h].apply(c,i)}return a};return{toHTML:function(b,d){var e=b.match(c);if(e)var b=b.replace(c,function(){return'<script type="text/notRenderTemplate"><\/script>'}),b=a(b,d),f=0,b=b.replace(c,function(){return e[f++]});else b=a(b,d);return b}}});
KISSY.add("magix/vframe",function(f,e,d){var c;c=function(){};d.mix(c,{tagName:d.unimpl,uniqueId:function(){return d.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});d.mix(c.prototype,d.Events);d.mix(c.prototype,{getChildVframeNodes:d.unimpl,getRouterObject:d.unimpl,createFrame:d.unimpl,getVOMObject:d.unimpl,initial:function(a,b){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||this.createFrame();this.id=this._idIt(this._domNode,
b);if(a)this._domNode=null;this.exist=!0},_idIt:function(a,b){a.id=a&&a.id||b||c.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,b){return document.getElementById(this.id).setAttribute(a,b)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},handelMounted:function(){var a=
this;a.view.rendered?(a.mounted=!0,a.trigger("mounted",a.view),a.mountSubFrames()):a.view.bind("rendered",function(){a.mounted=!0;a.trigger("mounted",a.view);a.mountSubFrames()})},mountSubFrames:function(){var a=this.getVOMObject(),b=a.getElementById(this.view.vcid),c=b.getElements(),d,e;for(d=0;d<c.length;d++)e=a.createElement(c[d]),b.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.view.queryModel})},mountView:function(a,b){if(a){this.unmountView();var c=this,e=this.getRouterObject(),
b=b||{};if(!b.queryModel)b.queryModel=e.queryModel;d.requireAsync(a,function(d){if(c.exist)b.vcid=c.id,b.viewName=a,c.view=new d(b),c.handelMounted()})}},unmountView:function(){if(this.view&&this.mounted)this.destroySubFrames(),this.view.trigger("unload"),this.view.destroy(),document.getElementById(this.view.vcid).innerHTML="",this.mounted=!1,this.view=null},destroySubFrames:function(){function a(c){b.push(c);for(var d=0;d<c.childNodes.length;d++)a(c.childNodes[d])}var b=[],c=this.getVOMObject().getElementById(this.view.vcid);
a(c);for(c=b.length-1;0<c;c--)b[c].removeNode();for(c=Things.length-1;0<=c;c--);},removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var b,c,d=[];for(b=0;b<this.childNodes.length;b++)c=this.childNodes[b],c==a?this._popFromVOM(c):d.push(c);this.childNodes=d},_popFromVOM:function(a){d.requireAsync("magix/vom",
function(b){b.pop(a);a.exist=!1})},postMessage:function(a){a||(a={});if(!a.msgFrom)a.msgFrom="view";this.view.receiveMessage(a)},receiveMessage:function(a){a||(a={});if(!a.msgFrom)a.msgFrom="broadcast";this.view.receiveMessage(a)}});return d.implement(c,e).init()},{requires:["magix/impls/vframe","magix/base"]});
KISSY.add("magix/view",function(f,e,d){f=function(){};d.mix(f.prototype,{getVOMObject:d.unimpl,getTemplateObject:d.unimpl,getAjaxObject:d.unimpl,dispose:d.unimpl,queryModelChange:function(){},refresh:function(){},initial:function(c){var a=this;this.getVOMObject();this.options=c;this.vcid=c.vcid;this.queryModel=c.queryModel;this.viewName=c.viewName;this.data=c.data||{};c.message&&"function"==typeof c.message&&this.bind("message",c.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});
this.init&&setTimeout(function(){a.init()},0);this.preventRender||this.getTemplate(function(b){a.template=b;setTimeout(function(){a.exist&&!1!==a.render()&&a.trigger("rendered")},0)})},_queryModelChange:function(c){this._changeChain(this.queryModelChange(c),c)},_changeChain:function(c,a){var b=[],e;e=this.getVOMObject().getElementById(this.vcid);if(!1!==c){!0===c||void 0===c?b=e.childNodes:d.isArray(c)&&(b=c);for(e=0;e<b.length;e++)b[e].view&&b[e].view._queryModelChange(a)}},destory:function(){this.destroy()},
destroy:function(){if(this.events){var c=document.getElementById(this.vcid),a;for(a in this.events)c["on"+a]=null}this.dispose()},setData:function(c){this.data=c;for(var a in c)c[a]&&c[a].toJSON&&(c[a]=c[a].toJSON());c.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var c=this,a=this.renderer,b,d;if(a)for(b in a)for(d in a[b])(function(){var e=b,f=d,i=a[e][f];c.data[e+"_"+f]=function(){return i.call(this,c,e)}})()},getEventInfo:function(c,a){for(var b=c.target||c.srcElement,
d=c.type,e="mx"+d,f=this.eventsLevel;3===b.nodeType;)b=b.parentNode;var i=b.getAttribute(e);if(f)var h=f[d];if(!i&&h)if(!isNaN(h)&&h)for(;h&&b!=a;){b=b.parentNode;if(i=b.getAttribute(e))break;h--}else if(h.split(".")[1])for(h=h.split(".")[1];b!=a;){if(b=b.parentNode,0<=b.className.indexOf(h)){i=b.getAttribute(e);break}}else{if(h.split("#")[1])for(h=h.split("#")[1];b!=a;)if(b=b.parentNode,b.id==h){i=b.getAttribute(e);break}}else if(!i)b=b.parentNode,i=b.getAttribute(e);return{info:i,target:b}},processEvent:function(c,
a){var b=c||window.event,d=this.getEventInfo(b,a),e=b.type,f={},i=d.target,d=d.info,f={target:i,originEvent:b};if(d)for(var d=d.split("|"),h,l,n=0;n<d.length;n++){h=d[n].split(":");l=h.shift();var m=h[h.length-1],p=!1;if("_halt_"==m||"_preventDefault_"==m)b.preventDefault?b.preventDefault():b.returnValue=!1,p=f.isPreventDefault=!0;if("_halt_"==m||"_stop_"==m)b.stopPropagation?b.stopPropagation():b.cancelBubble=!0,p=f.isStopPropagation=!0;p&&h.pop();this.trigger("beforeEventCall",f);if(this.events&&
this.events[e]&&this.events[e][l])this.events[e][l](this,this.idIt(i),h,b)}this.trigger("delegateEventsFire",f)},delegateEvents:function(){var c=this,a=document.getElementById(c.vcid),b=this.events,d;for(d in b)a["on"+d]=function(b){c.processEvent(b,a)}},render:function(){if(this.preventRender)return this.rendered=!0;var c=document.getElementById(this.vcid),a=this.getTemplateObject();this.setData({});c.innerHTML=a.toHTML({template:this.template,data:this.data});this.rendered=!0},getTemplate:function(c,
a){if(this.template)c(this.template);else{var b=Magix.config.appHome,b=/\/app\/$/.test(b)?b+this.viewName.split("app")[1]:b+this.viewName,b=(a?b+".name.html":b+".html").replace(/([^:\/])\/+/g,"$1/"),d=this.getAjaxObject();if(Magix.dev||Magix.config.debug)b+="?="+(new Date).getTime();d.getTemplate(b,function(a){c(a)},function(a){c(a)},this.viewName)}},idIt:function(c){var a="";if(!c.id)c.id=d.uniqueId("mxevt-");return a=c.id},receiveMessage:function(){},postMessageTo:function(c,a){var b=this.getVOMObject().get(c);
b&&b.postMessage(a)}});return d.implement(f,e)},{requires:["magix/impls/view","magix/base"]});
KISSY.add("magix/vom",function(f,e,d,c){f={};d.mix(f,{_idMap:{},root:null,setRootVframe:d.unimpl,init:function(){if(!this.inited)this.setRootVframe(),this.inited=!0;return this},push:function(a){this._idMap[a.id]=a},pop:function(a){delete this._idMap[a.id]},createElement:function(a,b){d.isString(a)&&(a=document.getElementById(a));var e=new c(a,b);this.push(e);return e},getElementById:function(a){return this._idMap[a]||null},get:function(a){return this.getElementById(a)},broadcaseMessage:function(a){var b=
this._idMap,c;for(c in b)b[c].receiveMessage(a)}});d.mix(f,e);return f.init()},{requires:["magix/impls/vom","magix/base","magix/vframe"]});