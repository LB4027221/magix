KISSY.add("magix/ajax",function(f,e,d){return d.implement({defaultOptions:{dataType:"html",type:"POST",success:function(){},error:function(){}},globalSetting:function(b){if(!this.$globalSetting)this.$globalSetting={};for(var a in b)this.$globalSetting[a]=b[a];return this.$globalSetting},fireGlobalSetting:function(b){var a=this.$globalSetting;if(a&&a.statusCode&&(a=a.statusCode,a[b.status]))try{a[b.status](b)}catch(c){}},send:d.unimpl,processOptions:function(b){b||(b={});for(var a in this.defaultOptions)b[a]||
(b[a]=this.defaultOptions[a]);return b},getTemplate:function(b,a,c,k){var e=Magix.templates,g=e[k];g?d.isFunction(a)&&a(g):this.send({url:b,dataType:"html",type:"GET",success:function(c){e[k]=c;d.isFunction(a)&&a(c)},error:function(a){d.isFunction(c)&&c(a)}})}},e)},{requires:["magix/impls/ajax","magix/base"]});
KISSY.add("magix/base",function(f,e){var d={mix:function(b,a,c,d){if(!a||!b)return b;void 0===c&&(c=!0);var e,g,f;if(d&&(f=d.length))for(e=0;e<f;e++){if(g=d[e],g in a&&(c||!(g in b)))b[g]=a[g]}else for(g in a)if(c||!(g in b))b[g]=a[g];return b},include:function(b){var b=Magix.config.magixHome+"../"+b+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",b,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");}};
d.mix(d,{isFunction:d.unimpl,isArray:d.unimpl,isString:d.unimpl,isPlainObject:d.unimpl,requireAsync:d.unimpl,Events:d.unimpl,_idCounter:0,uniqueId:function(b){var a=this._idCounter++;return b?b+a:a},extend:function(b,a,c,d){if(!a||!b)return b;var e=Object.prototype,g=a.prototype,f=function(a){function c(){}c.prototype=a;return new c}(g);b.prototype=f;f.constructor=b;b.superclass=g;if(a!==Object&&g.constructor===e.constructor)g.constructor=a;c&&this.mix(f,c);d&&this.mix(b,d);return b},param:function(b){var a=
[],c;for(c in b)b.hasOwnProperty(c)&&a.push(c+"="+b[c]);return a.join("&")},unParam:function(b){for(var b=b.split("&"),a,c={},d=0;d<b.length;d++)a=b[d].split("="),a[0]&&(c[a[0]]=a[1]||"");return c},mixClassStaticProps:function(b,a){for(var c in a)a.hasOwnProperty(c)&&"prototype"!=c&&(b[c]=a[c]);return b},mixClassProtoProps:function(b,a){for(var c in a)if(!b[c]||b[c]==d.unimpl)b[c]=a[c];return b},implement:function(b,a){if(d.isFunction(b)&&d.isFunction(a)){a.prototype.constructor=a;var c=function(){a.apply(this,
arguments);b.apply(this,arguments);b.prototype.initial&&b.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(c,b);this.mixClassStaticProps(c,a);this.mixClassProtoProps(c.prototype,b.prototype);this.mixClassProtoProps(c.prototype,a.prototype);return c.prototype.constructor=c}c={};d.mix(c,b);d.mix(c,a);return c}});d.mix(d,e);return d},{requires:["magix/impls/base"]});
KISSY.add("magix/impls/ajax",function(f,e){return{send:function(d){var b=this,d=this.processOptions(d),a=d.success,c=d.error;e(f.mix(d,{url:d.url,dataType:d.dataType,type:d.type,success:function(c,e,g){b.fireGlobalSetting(g);a.call(d,c)},error:function(a,e,g){b.fireGlobalSetting(g);c.call(d,e)}}))}}},{requires:["ajax"]});
KISSY.add("magix/impls/base",function(f){var e=Object.prototype.toString;return{isFunction:f.isFunction,isArray:f.isArray,isString:f.isString,isPlainObject:function(d){return d&&"[object Object]"===e.call(d)&&!d.nodeType&&!d.setInterval},requireAsync:function(d,b){f.use(d,function(a,c){b(c)})},Events:{bind:function(d,b,a){var c=this._callbacks||(this._callbacks={});(c[d]||(c[d]=[])).push([b,a]);return this},unbind:function(d,b){var a;if(d){if(a=this._callbacks)if(b){a=a[d];if(!a)return this;for(var c=
0,e=a.length;c<e;c++)if(a[c]&&b===a[c][0]){a[c]=null;break}}else a[d]=[]}else this._callbacks={};return this},trigger:function(d,b){var a,c,e,j,g=2;if(!(c=this._callbacks))return this;for(;g--;)if(a=g?d:"all",a=c[a])for(var f=0,h=a.length;f<h;f++)(e=a[f])?(j=g?Array.prototype.slice.call(arguments,1):arguments,e[0].apply(e[1]||this,j)):(a.splice(f,1),f--,h--);!0==b&&delete c[d];return this}}}},{requires:["ajax"]});
KISSY.add("magix/impls/model",function(f,e,d){e=e.Model;f.mix(e.prototype,d.Events);var b=e.prototype.fire;e.prototype.fire=function(a,c){b(a,c);if("*"==a.charAt(0)){var d=this,a=a.substring(1).replace(/[A-Z]/,function(a){return a.toLowerCase()});if(!d.__propCache)d.__propCache={};f.each(c.attrName,function(a){d.__propCache[a]=!0});this.trigger(a,c);delete this.__propCache}else this.trigger(a,c)};e.prototype.hasChanged=function(a){var c=this.__propCache;return c?c[a]:!1};e.prototype.unset=function(a){this.removeAttr(a)};
e.prototype.clear=function(){var a=this.toJSON(),c;for(c in a)this.removeAttr(c)};return e},{requires:["mvc","magix/base"]});
KISSY.add("magix/impls/router",function(f,e,d,b,a,c){return{getAppConfig:function(){var a=c.pathViewMap,b=c.defaultViewName;if(b&&a)for(var d in a)a[d]||(a[d]=b);return c},getVOMObject:function(){return b},setStateListener:function(){var c=this;b.__Router=c;(new a.Router).addRoutes({"*hash":function(a){f.log(a.hash);c.route(a.hash)}});a.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var c=
{},b;c.pathName=this.appConfig.indexPath;c.paraObj={};c.referrer=this.state&&this.state.query||null;if(c.query=a)a=a.split("/"),b=a.pop(),-1==b.indexOf("=")&&b&&(a.push(b),b=""),c.pathName=a.join("/"),c.paraObj=e.unParam(b);return c},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},c=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(c)a.pathName=location.pathname.split(c)[1];a.query=a.pathName+location.search;if(location.search)a.paraObj=
e.unParam(location.search.substr(1));return a},getRootViewName:function(){var a=this.appConfig.pathViewMap,c;c=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath];this.query.__view__&&(c=this.query.__view__.split("-").join("/"));if(this.config.multipage)a=a[this.query["sch:pathname"]],"object"==typeof a?c=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",c=a||this.appConfig.defaultRootViewName);return c},createQueryModel:function(){return new d(this.query)},
changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},_fixQueryModel:function(a){if(this.queryModel){var c,b=this.queryModel.toJSON();for(c in b)c in a||this.queryModel.unset(c,{silent:!0})}},navigateTo:function(a){var a=e.unParam(a),c=f.clone(this.state.paraObj);delete c.referrer;delete c.pathname;delete c.query;delete c.postdata;var a=e.mix(c,a),b;for(b in a)a[b]||delete a[b];this.goTo(this.state.pathName+"/"+e.param(a))}}},{requires:["magix/base","magix/model",
"magix/vom","mvc","app/config/ini"]});KISSY.add("magix/impls/template",function(f,e){return{toHTML:function(d){d=this.processOptions(d);return e.toHTML(d.template,d.data)}}},{requires:["magix/tmpl"]});
KISSY.add("magix/impls/vframe",function(f,e){var d=function(){};e.mix(d,{tagName:"vframe"});e.mix(d.prototype,{getChildVframeNodes:function(){var b=document.getElementById(this.id).getElementsByTagName("vframe"),a,c=[];for(a=0;a<b.length;a++)c.push(this._idIt(b[a]));return c},createFrame:function(){return document.createElement(d.tagName)}});return d},{requires:["magix/base"]});
KISSY.add("magix/impls/view",function(f,e,d,b,a,c){var k=function(){k.superclass.constructor.apply(this,arguments)};f.extend(k,e.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return a},getAjaxObject:function(){return b},getTemplateObject:function(){return d},dispose:function(){k.superclass.destroy.apply(this,arguments)}});f.mix(k.prototype,c.Events);var j=k.prototype.fire;k.prototype.fire=function(a,c){j(a,c);this.trigger(a,c)};return k},{requires:["mvc","magix/template",
"magix/ajax","magix/vom","magix/base"]});KISSY.add("magix/impls/vom",function(f,e,d){return{setRootVframe:function(){var b=document.getElementById("vf-root"),a=this.createElement(b,"vf-root");b||document.body.insertBefore(a.getOnce(),document.body.firstChild);this.root=a},getVframeClass:function(){return d}}},{requires:["magix/base","magix/vframe"]});
Magix={init:function(f){this.config=f||{};this.setEnv();this.bootstrap()},templates:{},setEnv:function(){var f=this.config.magixHome||"",e=this.config.appHome||"",d=KISSY,b=(new Date).getTime();if(f&&!/\/$/.test(f))f+="/",this.config.magixHome=f;if(e&&!/\/$/.test(e))e+="/",this.config.appHome=e;if(!this.config.release&&/^https?:\/\//.test(e))this.config.release=-1==e.indexOf(location.protocol+"//"+location.host);if(!this.config.release)d.config({map:[[RegExp("("+e+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]}),
this.dev=!0,d.config({debug:!0});if(!window.console)window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};d.config({packages:[{name:"magix",path:/\/magix\/$/.test(f)?f+"../":f,tag:this.dev?b:"20120214"},{name:"app",path:/\/app\/$/.test(e)?e+"../":e,tag:this.dev?b:"20120214"}]})},bootstrap:function(){var f=this;KISSY.use("magix/router",function(e,d){e.log(d);d.init(f.config)})},implementBy:"kissy",version:"0.1.0",dev:""};
KISSY.add("magix/model",function(f,e,d){f=function(){};d.mix(f.prototype,{unset:d.unimpl,clear:d.unimpl,load:d.unimpl});return d.implement(f,e)},{requires:["magix/impls/model","magix/base"]});
KISSY.add("magix/mu",function(f,e){function d(a){a=a.split("==");return function(){for(var c=a[0].split("."),b=a[1],d=c.length-1;-1<d;d--){var e=c.slice(d),f=this;try{for(var h=0;h<e.length-1;h++)f=f[e[h]];if(e[e.length-1]in f){if(f[e[e.length-1]].toString()===b)return!0;break}}catch(l){}}return!1}}function b(a,c){var d,e;for(d in a)if(e=a[d],e instanceof Array)for(var f=0;f<e.length;f++){if(o=e[f],"object"==typeof o)0===f?o.__first__=!0:f==e.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=f}else"object"==
typeof e&&5>c&&b(e,c+1)}return{to_html:function(a,c){"object"==typeof c&&b(c,0);var k=c,f;f=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i;var g=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),i=[];if(g)for(var h=0;h<g.length;h++)i.push(g[h].match(f)[1]);f=i;g="";for(i=0;i<f.length;i++)g="if("+f[i]+")",k[g]||(k[g]=d(f[i]));return e.to_html.apply(this,arguments)}}},{requires:["magix/mustache"]});
KISSY.add("magix/mustache",function(){return function(){var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(e,d,b,a){if(!a)this.context=d,this.buffer=[];if(this.includes("",e)){e=this.render_pragmas(e);e=this.render_section(e,d,b);if(a)return this.render_tags(e,d,b,a);this.render_tags(e,d,b,a)}else{if(a)return e;this.send(e)}},send:function(e){""!=e&&this.buffer.push(e)},render_pragmas:function(e){if(!this.includes("%",
e))return e;var d=this;return e.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(b,a,c){if(!d.pragmas_implemented[a])throw{message:"This implementation of mustache doesn't understand the '"+a+"' pragma"};d.pragmas[a]={};c&&(b=c.split("="),d.pragmas[a][b[0]]=b[1]);return""})},render_partial:function(e,d,b){e=this.trim(e);if(!b||void 0===b[e])throw{message:"unknown_partial '"+e+"'"};return"object"!=typeof d[e]?this.render(b[e],d,b,!0):this.render(b[e],d[e],b,!0)},render_section:function(e,
d,b){if(!this.includes("#",e)&&!this.includes("^",e))return e;var a=this;return e.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(c,e,f,g){c=a.find(f,d);if("^"==e)return!c||a.is_array(c)&&0===c.length?a.render(g,d,b,!0):"";if("#"==e)return a.is_array(c)?a.map(c,function(c){return a.render(g,a.create_context(c),b,!0)}).join(""):a.is_object(c)?a.render(g,a.create_context(c),b,!0):"function"===typeof c?c.call(d,g,
function(c){return a.render(c,d,b,!0)}):c?a.render(g,d,b,!0):""})},render_tags:function(e,d,b,a){for(var c=this,f=function(){return RegExp(c.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+c.ctag+"+","g")},j=f(),g=function(a,e,g){switch(e){case "!":return"";case "=":return c.set_delimiters(g),j=f(),"";case ">":return c.render_partial(g,d,b);case "{":return c.find(g,d);default:return c.escape(c.find(g,d))}},e=e.split("\n"),i=0;i<e.length;i++)e[i]=e[i].replace(j,g,this),a||this.send(e[i]);if(a)return e.join("\n")},
set_delimiters:function(e){e=e.split(" ");this.otag=this.escape_regex(e[0]);this.ctag=this.escape_regex(e[1])},escape_regex:function(e){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return e.replace(arguments.callee.sRE,"\\$1")},find:function(e,d){var e=this.trim(e),b;!1===d[e]||0===d[e]||d[e]?b=d[e]:(!1===this.context[e]||0===this.context[e]||this.context[e])&&(b=this.context[e]);return"function"===typeof b?b.apply(d):void 0!==
b?b:""},includes:function(e,d){return-1!=d.indexOf(this.otag+e)},escape:function(e){return(""+(null===e?"":e)).replace(/&(?!\w+;)|["'<>\\]/g,function(d){switch(d){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return d}})},create_context:function(e){if(this.is_object(e))return e;var d=".";if(this.pragmas["IMPLICIT-ITERATOR"])d=this.pragmas["IMPLICIT-ITERATOR"].iterator;var b={};b[d]=e;return b},is_object:function(e){return e&&
"object"==typeof e},is_array:function(e){return"[object Array]"===Object.prototype.toString.call(e)},trim:function(e){return e.replace(/^\s*|\s*$/g,"")},map:function(e,d){if("function"==typeof e.map)return e.map(d);for(var b=[],a=e.length,c=0;c<a;c++)b.push(d(e[c]));return b}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(e,d,b,a){var c=new f;if(a)c.send=a;c.render(e,d,b);if(!a)return c.buffer.join("\n")}}}()});
KISSY.add("magix/router",function(f,e,d){f={};d.mix(f,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:d.unimpl,setStateListener:d.unimpl,parseState:d.unimpl,parseSearch:d.unimpl,getRootViewName:d.unimpl,createQueryModel:d.unimpl,changeQueryModel:d.unimpl,navigateTo:d.unimpl,setPostData:d.unimpl,getVOMObject:d.unimpl,init:function(b){this.config=b;this.appConfig=this.getAppConfig();this.setStateListener()},
goTo:function(b){location.hash="!"+b},route:function(b){this.state=this.parseState(b);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;this.rootViewName=this.getRootViewName();if(this.rootViewName==this.oldRootViewName)this.changeQueryModel();else{var a=this.getVOMObject();this.queryModel=this.createQueryModel();this.queryModel.bind("change",function(){a.root.view&&a.root.view._queryModelChange(this)});
this.mountRootView()}this.postData=null},_spreadLocator:function(){var b={},a=this._locator;d.mix(b,a.state.paraObj);d.mix(b,{referrer:a.state.referrer,query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var c={},e,f=a.search.paraObj;c["sch:pathname"]=a.search.pathName;c["sch:query"]=a.search.query;for(e in f)c["sch:"+e]=f[e];d.mix(b,c);return b},mountRootView:function(){this.getVOMObject().root.mountView(this.rootViewName,{queryModel:this.queryModel})}});d.mix(f,e);return f},
{requires:["magix/impls/router","magix/base"]});KISSY.add("magix/template",function(f,e,d){return d.implement({defaultOptions:{data:{},template:""},processOptions:function(b){for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},toHTML:d.unimpl},e)},{requires:["magix/impls/template","magix/base"]});
KISSY.add("magix/tmpl",function(){var f={},e={},d="_"+(new Date).getTime(),b=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/notRenderTemplate\1[^>]*>([\s\S]*?)<\/script>\s*/gi,a=function(a,b){if(a){var j;j=e[a];j||(j=d+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,
";"+d+".push('")+"');return "+d+".join('')",e[a]=j);var g=[d],i=[[]],h;if(b)for(h in b)g.push(h.replace(/[:+\-*\/&^%#@!~]/g,"$")),i.push(b[h]);h=g.join("_")+"_"+j;if(!f[h])try{f[h]=new Function(g,j)}catch(l){return l.message}try{j=f[h].apply(b,i)}catch(m){j=m.message}return j}return a};return{toHTML:function(c,d){var e=c.match(b);if(e)var c=c.replace(b,function(){return'<script type="text/notRenderTemplate"><\/script>'}),c=a(c,d),f=0,c=c.replace(b,function(){return e[f++]});else c=a(c,d);return c}}});
KISSY.add("magix/vframe",function(f,e,d){var b;b=function(){};d.mix(b,{tagName:d.unimpl,uniqueId:function(){return d.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});d.mix(b.prototype,d.Events);d.mix(b.prototype,{getChildVframeNodes:d.unimpl,getRouterObject:function(){return this.__Router},createFrame:d.unimpl,getVOMObject:function(){return this.__VOM},initial:function(a,c){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||this.createFrame();
this.id=this._idIt(this._domNode,c);if(a)this._domNode=null;this.exist=!0},_idIt:function(a,c){a.id=a&&a.id||c||b.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,c){return document.getElementById(this.id).setAttribute(a,c)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},
handelMounted:function(){var a=this;a.view.rendered?(a.mounted=!0,a.trigger("mounted",a.view),a.mountSubFrames()):a.view.bind("rendered",function(){a.mounted=!0;a.trigger("mounted",a.view);a.mountSubFrames()});a.view.bind("prerender",function(){a.destroySubFrames()})},mountSubFrames:function(){var a=this.getVOMObject(),c=a.getElementById(this.view.vcid),b=c.getElements(),d,e;for(d=0;d<b.length;d++)e=a.createElement(b[d]),c.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.view.queryModel})},
mountView:function(a,c){if(a){c=c||{};this.unmountView(c);var b=this,e=this.getRouterObject();if(!c.queryModel)c.queryModel=e.queryModel;d.requireAsync(a,function(d){if(b.exist)c.vcid=b.id,c.viewName=a,b.view=new d(c),b.__viewLoaded=!0,b.trigger("viewLoaded",!0),b.handelMounted()})}},unmountView:function(a){if(this.view&&this.mounted)a=a||{},this.destroySubFrames(),this.view.beforeDestroy(),this.view.trigger("unload",!0),this.view.trigger("beforeRebuild",!0),this.view.destroy(),this.view.afterDestroy(),
document.getElementById(this.view.vcid).innerHTML=a.unmountPlaceholder||"",delete a.unmountPlaceholder,this.mounted=!1,this.view=null},destroySubFrames:function(){function a(b){c.push(b);for(var d=0;d<b.childNodes.length;d++)a(b.childNodes[d])}var c=[],b=this.getVOMObject().getElementById(this.id);a(b);for(b=c.length-1;0<b;b--)c[b].removeNode()},removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&
(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var c,b,d=[];for(c=0;c<this.childNodes.length;c++)b=this.childNodes[c],b==a?this._popFromVOM(b):d.push(b);this.childNodes=d},_popFromVOM:function(a){this.getVOMObject().pop(a);a.exist=!1},postMessage:function(a,b){var d=this;if(d.exist)a||(a={}),a.from=b,d.__viewLoaded?d.view._receiveMessage(a):(d.unbind("viewLoaded"),d.bind("viewLoaded",function(){d.view._receiveMessage(a)}))}});
return d.implement(b,e).init()},{requires:["magix/impls/vframe","magix/base"]});
KISSY.add("magix/view",function(f,e,d){f=function(){};d.mix(f.prototype,{getVOMObject:d.unimpl,getTemplateObject:d.unimpl,getAjaxObject:d.unimpl,dispose:d.unimpl,queryModelChange:function(){},initial:function(b){var a=this;this.getVOMObject();this.options=b;this.vcid=b.vcid;this.queryModel=b.queryModel;this.viewName=b.viewName;this.data=b.data||{};b.message&&"function"==typeof b.message&&this.bind("message",b.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});this.init&&setTimeout(function(){a.exist&&
a.init()},0);this.preventRender||this.getTemplate(function(b){a.template=b;setTimeout(function(){if(a.exist)!1!==a.render()&&!a.__isStartMountSubs&&a.trigger("rendered"),a.__rendered=!0,a.trigger("renderComplete",!0)},0)})},_queryModelChange:function(b){try{var a=this.queryModelChange(b)}catch(c){}this.__isStartMountSubs&&(a=!1);this._changeChain(a,b)},_changeChain:function(b,a){var c=[],e;e=this.getVOMObject().getElementById(this.vcid);if(!1!==b){!0===b||void 0===b?c=e.childNodes:d.isArray(b)&&(c=
b);for(e=0;e<c.length;e++)c[e].view&&c[e].view._queryModelChange(a)}},destory:function(){this.destroy()},beforeDestroy:function(){},afterDestroy:function(){},destroy:function(){if(this.events){var b=document.getElementById(this.vcid),a;for(a in this.events)b["on"+a]=null}this.dispose()},setData:function(b){this.data=b;for(var a in b)b[a]&&b[a].toJSON&&(b[a]=b[a].toJSON());b.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var b=this,a=this.renderer,c,d;if(a)for(c in a)for(d in a[c])(function(){var e=
c,f=d,i=a[e][f];b.data[e+"_"+f]=function(){return i.call(this,b,e)}})()},getEventInfo:function(b,a){for(var c=b.target||b.srcElement,d=b.type,e="mx"+d,f=this.eventsLevel;3===c.nodeType;)c=c.parentNode;var i=c.getAttribute(e);if(f)var h=f[d];if(!i&&h)if(!isNaN(h)&&h)for(;h&&c!=a;){c=c.parentNode;if(i=c.getAttribute(e))break;h--}else if(h.split(".")[1])for(h=h.split(".")[1];c!=a;){if(c=c.parentNode,0<=c.className.indexOf(h)){i=c.getAttribute(e);break}}else{if(h.split("#")[1])for(h=h.split("#")[1];c!=
a;)if(c=c.parentNode,c.id==h){i=c.getAttribute(e);break}}else if(!i)c=c.parentNode,i=c.getAttribute(e);return{info:i,target:c}},processEvent:function(b,a){var c=b||window.event,d=this.getEventInfo(c,a||document.getElementById(this.vcid)),e=c.type,f={},i=d.target,d=d.info,f={target:i,originEvent:c};if(d)for(var d=d.split("|"),h,l,m=0;m<d.length;m++){h=d[m].split(":");l=h.shift();var n=h[h.length-1],p=!1;if("_halt_"==n||"_preventDefault_"==n)c.preventDefault?c.preventDefault():c.returnValue=!1,p=f.isPreventDefault=
!0;if("_halt_"==n||"_stop_"==n)c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,p=f.isStopPropagation=!0;p&&h.pop();this.trigger("beforeEventCall",f);if(this.events&&this.events[e]&&this.events[e][l])this.events[e][l](this,this.idIt(i),h,c)}this.trigger("delegateEventsFire",f)},delegateEvents:function(){var b=this,a=document.getElementById(b.vcid),c=this.events,d;for(d in c)a["on"+d]=function(c){b.processEvent(c,a)}},setViewHTML:function(b){var a=this;return a.exist?(a.trigger("beforeRebuild",
!0),a.trigger("prerender"),document.getElementById(a.vcid).innerHTML=b,a.trigger("rendered"),a.__isStartMountSubs=!0,setTimeout(function(){delete a.__isStartMountSubs},0),!0):!1},render:function(){},getTemplate:function(b,a){if(this.template)b(this.template);else{var c=Magix.config.appHome,c=/\/app\/$/.test(c)?c+this.viewName.split("app")[1]:c+this.viewName,c=(a?c+".name.html":c+".html").replace(/([^:\/])\/+/g,"$1/"),d=this.getAjaxObject();if(Magix.dev||!Magix.config.release)c+="?t="+(new Date).getTime();
d.getTemplate(c,function(a){b(a)},function(a){b(a)},this.viewName)}},idIt:function(b){var a="";if(!b.id)b.id=d.uniqueId("mxevt-");return a=b.id},receiveMessage:function(){},_receiveMessage:function(b){var a=this;try{a.exist&&a.__rendered?a.receiveMessage(b):(a.unbind("renderComplete"),a.bind("renderComplete",function(){a.receiveMessage(b)}))}catch(c){}},postMessageTo:function(b,a){var c=this.getVOMObject();d.isArray(b)||(b=[b]);for(var e=0;e<b.length;e++){var f=c.get(b[e]);f&&f.postMessage(a,this)}}});
return d.implement(f,e)},{requires:["magix/impls/view","magix/base"]});
KISSY.add("magix/vom",function(f,e,d){f={};d.mix(f,{_idMap:{},root:null,setRootVframe:d.unimpl,getVframeClass:d.unimpl,init:function(){if(!this.inited)this.setRootVframe(),this.inited=!0;return this},push:function(b){this._idMap[b.id]=b},pop:function(b){delete this._idMap[b.id]},createElement:function(b,a){d.isString(b)&&(b=document.getElementById(b));var c=new (this.getVframeClass())(b,a);c.__VOM=this;c.__Router=this.__Router;this.push(c);return c},getElementById:function(b){return this._idMap[b]||
null},get:function(b){return this.getElementById(b)},broadcaseMessage:function(b,a){var c=this._idMap,d;for(d in c)c[d].postMessage(b,a||this)}});d.mix(f,e);return f.init()},{requires:["magix/impls/vom","magix/base"]});