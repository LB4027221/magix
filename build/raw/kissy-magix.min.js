KISSY.add("magix/ajax",function(d,e,c){return c.implement({defaultOptions:{dataType:"html",success:function(){},failure:function(){}},send:c.unimpl,processOptions:function(b){b||(b={});for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},getTemplate:function(b,a,f){var h=this,d;if(!h.$cache)h.$cache={};(d=h.$cache[b])?d.succ&&c.isFunction(a)?a(d.content):!d.succ&&c.isFunction(f)&&f(d.content):h.send({url:b,dataType:"html",success:function(f){h.$cache[b]={succ:!0,content:f};
c.isFunction(a)&&a(f)},failure:function(a){h.$cache[b]={content:a};c.isFunction(f)&&f(a)}})}},e)},{requires:["magix/impls/ajax","magix/base"]});
KISSY.add("magix/base",function(d,e){var c={mix:function(b,a,f,c){if(!a||!b)return b;void 0===f&&(f=!0);var d,e,i;if(c&&(i=c.length))for(d=0;d<i;d++){if(e=c[d],e in a&&(f||!(e in b)))b[e]=a[e]}else for(e in a)if(f||!(e in b))b[e]=a[e];return b},include:function(b){var b=Magix.config.magixHome+"../"+b+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",b,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");}};
c.mix(c,{isFunction:c.unimpl,isArray:c.unimpl,isString:c.unimpl,isPlainObject:c.unimpl,requireAsync:c.unimpl,Events:c.unimpl,_idCounter:0,uniqueId:function(b){var a=this._idCounter++;return b?b+a:a},extend:function(b,a,f,c){if(!a||!b)return b;var d=Object.prototype,e=a.prototype,i=function(a){function b(){}b.prototype=a;return new b}(e);b.prototype=i;i.constructor=b;b.superclass=e;if(a!==Object&&e.constructor===d.constructor)e.constructor=a;f&&this.mix(i,f);c&&this.mix(b,c);return b},param:function(b){var a=
[],f;for(f in b)b.hasOwnProperty(f)&&a.push(f+"="+b[f]);return a.join("&")},unParam:function(b){for(var b=b.split("&"),a,f={},c=0;c<b.length;c++)a=b[c].split("="),a[0]&&(f[a[0]]=a[1]||"");return f},mixClassStaticProps:function(b,a){for(var c in a)a.hasOwnProperty(c)&&"prototype"!=c&&(b[c]=a[c]);return b},mixClassProtoProps:function(b,a){for(var f in a)if(!b[f]||b[f]==c.unimpl)b[f]=a[f];return b},implement:function(b,a){if(c.isFunction(b)&&c.isFunction(a)){a.prototype.constructor=a;var f=function(){a.apply(this,
arguments);b.apply(this,arguments);b.prototype.initial&&b.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(f,b);this.mixClassStaticProps(f,a);this.mixClassProtoProps(f.prototype,b.prototype);this.mixClassProtoProps(f.prototype,a.prototype);return f.prototype.constructor=f}f={};c.mix(f,b);c.mix(f,a);return f}});c.mix(c,e);return c},{requires:["magix/impls/base"]});
KISSY.add("magix/impls/ajax",function(d,e){return{send:function(c){c=this.processOptions(c);e({url:c.url,dataType:c.dataType,success:function(b){c.success(b)},error:function(b){c.failure(b)}})}}},{requires:["ajax"]});
KISSY.add("magix/impls/base",function(d){var e=Object.prototype.toString;return{isFunction:d.isFunction,isArray:d.isArray,isString:d.isString,isPlainObject:function(c){return c&&"[object Object]"===e.call(c)&&!c.nodeType&&!c.setInterval},requireAsync:function(c,b){d.use(c,function(a,c){b(c)})},Events:{bind:function(c,b,a){var f=this._callbacks||(this._callbacks={});(f[c]||(f[c]=[])).push([b,a]);return this},unbind:function(c,b){var a;if(c){if(a=this._callbacks)if(b){a=a[c];if(!a)return this;for(var f=
0,h=a.length;f<h;f++)if(a[f]&&b===a[f][0]){a[f]=null;break}}else a[c]=[]}else this._callbacks={};return this},trigger:function(c){var b,a,f,h,d=2;if(!(a=this._callbacks))return this;for(;d--;)if(b=d?c:"all",b=a[b])for(var e=0,i=b.length;e<i;e++)(f=b[e])?(h=d?Array.prototype.slice.call(arguments,1):arguments,f[0].apply(f[1]||this,h)):(b.splice(e,1),e--,i--);return this}}}},{requires:["ajax"]});
KISSY.add("magix/impls/model",function(d,e,c){e=e.Model;d.mix(e.prototype,c.Events);var b=e.prototype.fire;e.prototype.fire=function(a,c){b(a,c);this.trigger(a,c)};return e},{requires:["mvc","magix/base"]});
KISSY.add("magix/impls/router",function(d,e,c,b,a,f){return{getAppConfig:function(){var a=f.pathViewMap,b=f.defaultViewName;if(b&&a)for(var c in a)a[c]||(a[c]=b);return f},setStateListener:function(){var b=this;(new a.Router).addRoutes({"*hash":function(a){d.log(a.hash);b.route(a.hash)}});a.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var b={},c;b.pathName=this.appConfig.indexPath;
b.paraObj={};b.referrer=this.state&&this.state.query||null;if(b.query=a)a=a.split("/"),c=a.pop(),b.pathName=a.join("/"),b.paraObj=e.unParam(c);return b},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},b=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(b)a.pathName=location.pathname.split(b)[1];a.query=a.pathName+location.search;if(location.search)a.paraObj=e.unParam(location.search.substr(1));return a},getRootViewName:function(){var a=this.appConfig.pathViewMap,
b;b=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath];this.query.__view__&&(b=this.query.__view__.split("-").join("/"));if(this.config.multipage)a=a[this.query["sch:pathname"]],"object"==typeof a?b=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",b=a||this.appConfig.defaultRootViewName);return b},createQueryModel:function(){return new c(this.query)},changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},
_fixQueryModel:function(a){if(this.queryModel){var b,c=this.queryModel.toJSON();for(b in c)b in a||this.queryModel.unset(b,{silent:!0})}},mountRootView:function(){b.root.mountView(this.rootViewName,{queryModel:this.queryModel})}}},{requires:["magix/base","magix/model","magix/vom","mvc","app/config/ini"]});KISSY.add("magix/impls/template",function(d,e){return{toHTML:function(c){c=this.processOptions(c);return e(c.template).render(c.data)}}},{requires:["template"]});
KISSY.add("magix/impls/vframe",function(d,e){var c=function(){};e.mix(c,{tagName:"vframe"});e.mix(c.prototype,{getChildVframeNodes:function(){var b=document.getElementById(this.id).getElementsByTagName("vframe"),a,c=[];for(a=0;a<b.length;a++)c.push(this._idIt(b[a]));return c},createFrame:function(){return document.createElement(c.tagName)}});return c},{requires:["magix/base"]});
KISSY.add("magix/impls/view",function(d,e,c,b,a,f){var h=function(){h.superclass.constructor.apply(this,arguments)};d.extend(h,e.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return a},getAjaxObject:function(){return b},getTemplateObject:function(){return c},dispose:function(){h.superclass.destroy.apply(this,arguments)}});d.mix(h.prototype,f.Events);var r=h.prototype.fire;h.prototype.fire=function(a,b){r(a,b);this.trigger(a,b)};return h},{requires:["mvc","magix/template",
"magix/ajax","magix/vom","magix/base"]});KISSY.add("magix/impls/vom",function(){return{setRootVframe:function(){var d=null;if("vf-root"==document.body.id)d=document.body;var e=this.createElement(d,"vf-root");d||document.body.insertBefore(e.getOnce(),document.body.firstChild);this.root=e}}},{requires:["magix/base"]});
Magix={init:function(d){this.config=d||{};this.setEnv();this.bootstrap()},setEnv:function(){var d=this.config.magixHome||"",e=this.config.appHome||"";this.dev&&KISSY.config({packages:[{name:"magix",path:d+"../",tag:(new Date).getTime()},{name:"app",path:e+"../",tag:(new Date).getTime()}]})},bootstrap:function(){var d=this;KISSY.use("magix/router",function(e,c){e.log(c);c.init(d.config)})},implementBy:"kissy",version:"0.1.0",dev:""};
KISSY.add("magix/model",function(d,e,c){return c.implement(function(){},e)},{requires:["magix/impls/model","magix/base"]});if(!window.console)window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};
MxHistory={config:{},hash:"",oldHash:null,showIframe:!1,isIE:!1,iframe:null,slient:!1,interval:50,intervalId:0,iframeSrc:"",ready:!1,hashListener:null,currentHash:"",init:function(d){d=d||{};this.iframeSrc=d.iframeSrc||"mxhistory.html";this.config=d;this.oldHash=this.hash=location.hash;this.isIE=-1<navigator.userAgent.toLowerCase().indexOf("msie");d=document.documentMode;this.showIframe=this.isIE&&(!d||8>d);this.wirteFrame(this.iframeSrc);this.regHashChange();this.showIframe||this.route(this.hash)},
regHashChange:function(){var d=this;"onhashchange"in window&&!this.showIframe?window.onhashchange=function(){d.hashChange.call(d)}:this.intervalId=window.setInterval(function(){location.hash!=d.oldHash&&d.hashChange.call(d)},this.interval)},hashChange:function(){this.oldHash=this.hash=location.hash;this.showIframe?this.iframe.src=this.iframeSrc+"?"+(this.hash?this.hash.substr(1):""):this.route(this.hash)},frameLoad:function(){var d=Magix.History;if(d.iframe){var e=d.iframe.contentWindow.location.search.substr(1);
d.hash=d.oldHash="#"+e;location.hash=e}this.route(this.hash)},route:function(d){0===d.indexOf("?")&&(d=d.substr(1));0===d.indexOf("#")&&(d=d.substr(1));0===d.indexOf("!")&&(d=d.substr(1));this.hashListener&&this.hashListener(d);this.ready=!0;this.currentHash=d},wirteFrame:function(){var d=this;this.showIframe&&document.write("<iframe onload='Magix.History.frameLoad();' id='MxHistory' src='"+this.iframeSrc+"?"+(this.hash?this.hash.substr(1):"")+"' style='z-index:99998;visibility:hidden;position:absolute;' border='0' frameborder='0' marginwidth='0' marginheight='0' scrolling='no' ></iframe>");
window.setTimeout(function(){d.iframe=document.getElementById("MxHistory")},0)},setHashListener:function(d){this.hashListener=d;this.ready&&d(this.currentHash)}};
KISSY.add("magix/router",function(d,e,c){d={};c.mix(d,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:c.unimpl,setStateListener:c.unimpl,parseState:c.unimpl,parseSearch:c.unimpl,getRootViewName:c.unimpl,createQueryModel:c.unimpl,changeQueryModel:c.unimpl,mountRootView:c.unimpl,navigateTo:c.unimpl,goTo:c.unimpl,setPostData:c.unimpl,init:function(b){this.config=b;this.appConfig=this.getAppConfig();
this.setStateListener()},route:function(b){this.state=this.parseState(b);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;this.rootViewName=this.getRootViewName();this.rootViewName==this.oldRootViewName?this.changeQueryModel():(this.queryModel=this.createQueryModel(),this.mountRootView());this.postData=null},_spreadLocator:function(){var b={},a=this._locator;c.mix(b,a.state.paraObj);c.mix(b,{referrer:a.state.referrer,
query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var f={},d,e=a.search.paraObj;f["sch:pathname"]=a.search.pathName;f["sch:query"]=a.search.query;for(d in e)f["sch:"+d]=e[d];c.mix(b,f);return b}});c.mix(d,e);return d},{requires:["magix/impls/router","magix/base"]});
KISSY.add("magix/template",function(d,e,c){return c.implement({defaultOptions:{data:{},template:""},processOptions:function(b){for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},toHTML:c.unimpl},e)},{requires:["magix/impls/template","magix/base"]});
KISSY.add("magix/vframe",function(d,e,c){var b;b=function(){};c.mix(b,{tagName:c.unimpl,uniqueId:function(){return c.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});c.mix(b.prototype,c.Events);c.mix(b.prototype,{getChildVframeNodes:c.unimpl,createFrame:c.unimpl,initial:function(a,b){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||this.createFrame();this.id=this._idIt(this._domNode,b);if(a)this._domNode=null},_idIt:function(a,
c){a.id=a&&a.id||c||b.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,b){return document.getElementById(this.id).setAttribute(a,b)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},handelMounted:function(){this.view.rendered?(this.mounted=!0,this.trigger("mounted",this.view)):
this.view.bind("rendered",function(){this.mounted=!0;this.trigger("mounted",this.view)})},mountView:function(a,b){if(a){this.view&&this.view.destroy();var d=this,b=b||{};c.requireAsync(a,function(c){b.vcid=d.id;b.viewName=a;d.view=new c(b);d.handelMounted()})}},unmountView:function(){this.view.trigger("unload");document.getElementById(this.view.vcid).innerHTML="";if(this.view.events){var a=document.getElementById(this.id),b;for(b in this.view.events)a["on"+b]=null}this.mounted=!1;this.view=null},
removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var b,c,d=[];for(b=0;b<this.childNodes.length;b++)c=this.childNodes[b],c==a?this._popFromVOM(c):d.push(c);this.childNodes=d},_popFromVOM:function(a){c.requireAsync("magix/vom",function(b){b.pop(a)})}});return c.implement(b,
e).init()},{requires:["magix/impls/vframe","magix/base"]});
KISSY.add("magix/view",function(d,e,c){d=function(){};c.mix(d.prototype,{render:c.unimpl,getTemplate:c.unimpl,getVOMObject:c.unimpl,getTemplateObject:c.unimpl,getAjaxObject:c.unimpl,dispose:c.unimpl,queryModelChange:function(){},refresh:function(){},initial:function(b){var a=this,c=this.getVOMObject();this.subViewsChange=[];this.options=b;this.vcid=b.vcid;this.queryModel=b.queryModel;this.viewName=b.viewName;this.data=b.data||{};b.message&&"function"==typeof b.message&&this.bind("message",b.message);
this.exist=!0;this.bind("unload",function(){this.exist=!1});this.bind("rendered",function(){this.trigger("beforeSubviewsRender");var a=c.getElementById(this.vcid),b=a.getElements(),d,e;for(d=0;d<b.length;d++)e=c.createElement(b[d]),a.appendChild(e),e.mountView(e.getAttribute("view_name"),{queryModel:this.queryModel})});c.getElementById(this.vcid)==c.root&&this.queryModel.bind("change",function(){var b=a.queryModelChange(this);a._changeChain(b,this)});this.init&&this.init();this.getTemplate(function(b){a.template=
b;!1!==a.render()&&a.trigger("rendered")})},_queryModelChange:function(b){this._changeChain(this.queryModelChange(b),b)},_changeChain:function(b,a){var d=[],e;e=this.getVOMObject().getElementById(this.vcid);if(!1!==b){!0===b||void 0===b?d=e.childNodes:c.isArray(b)&&(d=b);for(e=0;e<d.length;e++)d[e].view&&d[e].view._queryModelChange(a)}},destory:function(){this.destroy()},destroy:function(){var b,a,c=this.getVOMObject();b=this.getDestoryQueue();for(a=b.length-1;0<a;a--)b[a].removeNode();c.getElementById(this.vcid).unmountView();
this.dispose()},getDestoryQueue:function(){function b(c){var d;a.push(c);for(d=0;d<c.childNodes.length;d++)b(c.childNodes[d])}var a=[],c=this.getVOMObject().getElementById(this.vcid);b(c);return a},setData:function(b){this.data=b;for(var a in b)b[a].toJSON&&(b[a]=b[a].toJSON());b.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var b=this,a=this.renderer,c,d;if(a)for(c in a)for(d in a[c])(function(){var e=c,q=d,i=a[e][q];b.data[e+"_"+q]=function(){return i.call(this,b,e)}})()},
delegateEvents:function(){var b=this.events,a=this.eventsLevel,c=this.getVOMObject(),d=document.getElementById(this.options.vcid),e;for(e in b)(function(){var b=e,i="mx"+b;d["on"+b]=function(e){var e=e||window.event,g=e.target||e.srcElement;if(3===g.nodeType)g=g.parentNode;var k=g.getAttribute(i);if(a)var j=a[b];if(!k&&j)if(!isNaN(j)&&j)for(;j&&g!=d;){g=g.parentNode;if(k=g.getAttribute(i))break;j--}else if(j.split(".")[1])for(j=j.split(".")[1];g!=d;){if(g=g.parentNode,0<=g.className.indexOf(j)){k=
g.getAttribute(i);break}}else{if(j.split("#")[1])for(j=j.split("#")[1];g!=d;)if(g=g.parentNode,g.id==j){k=g.getAttribute(i);break}}else if(!k)g=g.parentNode,k=g.getAttribute(i);if(k)for(var j=k.split("|"),n,l=c.getElementById(this.id).view,o=0;o<j.length;o++){k=j[o].split(":");n=k.shift();var m=k[k.length-1],p=!1;if("_halt_"==m||"_preventDefault_"==m)e.preventDefault?e.preventDefault():e.returnValue=!1,p=!0;if("_halt_"==m||"_stop_"==m)e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,p=!0;p&&
k.pop();if(l.events&&l.events[b]&&l.events[b][n])l.events[b][n](l,l.idIt(g),k)}}})()},render:function(){if(this.preventRender)return this.rendered=!0;var b=document.getElementById(this.vcid),a=this.getTemplateObject();b.innerHTML=a.toHTML({template:this.template,data:{data:this.data,queryModel:this.queryModel.toJSON()}});this.rendered=!0},getTemplate:function(b,a){if(this.preventRender)b();else{var c=Magix.config.appHome+this.viewName.split("app")[1];this.getAjaxObject().getTemplate(a?c+".name.html":
c+".html",function(a){b(a)},function(a){b(a)})}},idIt:function(b){var a="";if(!b.id)b.id=c.uniqueId("mxevt-");return a=b.id}});return c.implement(d,e)},{requires:["magix/impls/view","magix/base"]});
KISSY.add("magix/vom",function(d,e,c,b){d={};c.mix(d,{_idMap:{},root:null,setRootVframe:c.unimpl,init:function(){this.setRootVframe();return this},push:function(a){this._idMap[a.id]=a},pop:function(a){delete this._idMap[a.id]},createElement:function(a,d){c.isString(a)&&(a=document.getElementById(a));var e=new b(a,d);this.push(e);return e},getElementById:function(a){return this._idMap[a]||null}});c.mix(d,e);return d.init()},{requires:["magix/impls/vom","magix/base","magix/vframe"]});