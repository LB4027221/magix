KISSY.add("magix/ajax",function(f,d,c){return c.implement({defaultOptions:{dataType:"html",type:"POST",success:function(){},error:function(){}},globalSetting:function(b){if(!this.$globalSetting)this.$globalSetting={};for(var a in b)this.$globalSetting[a]=b[a];return this.$globalSetting},fireGlobalSetting:function(b){var a=this.$globalSetting;if(a&&a.statusCode&&(a=a.statusCode,a[b.status]))try{a[b.status](b)}catch(e){}},send:c.unimpl,processOptions:function(b){b||(b={});for(var a in this.defaultOptions)b[a]||
(b[a]=this.defaultOptions[a]);return b},getTemplate:function(b,a,e,k){var d=Magix.templates,g=d[k];g?c.isFunction(a)&&a(g):this.send({url:b,dataType:"html",type:"GET",success:function(b){d[k]=b;c.isFunction(a)&&a(b)},error:function(a){c.isFunction(e)&&e(a)}})}},d)},{requires:["magix/impls/ajax","magix/base"]});
KISSY.add("magix/base",function(f,d){var c={mix:function(b,a,e,c){if(!a||!b)return b;void 0===e&&(e=!0);var d,g,f;if(c&&(f=c.length))for(d=0;d<f;d++){if(g=c[d],g in a&&(e||!(g in b)))b[g]=a[g]}else for(g in a)if(e||!(g in b))b[g]=a[g];return b},include:function(b){var b=Magix.config.magixHome+"../"+b+".js?r="+Math.random(),a=new (window.ActiveXObject||XMLHttpRequest)("Microsoft.XMLHTTP");a.open("GET",b,!1);a.send(null);return a.responseText},unimpl:function(){throw Error("unimplement method");}};
c.mix(c,{isFunction:c.unimpl,isArray:c.unimpl,isString:c.unimpl,isPlainObject:c.unimpl,requireAsync:c.unimpl,Events:c.unimpl,_idCounter:0,uniqueId:function(b){var a=this._idCounter++;return b?b+a:a},extend:function(b,a,e,c){if(!a||!b)return b;var d=Object.prototype,g=a.prototype,f=function(a){function b(){}b.prototype=a;return new b}(g);b.prototype=f;f.constructor=b;b.superclass=g;if(a!==Object&&g.constructor===d.constructor)g.constructor=a;e&&this.mix(f,e);c&&this.mix(b,c);return b},param:function(b){var a=
[],e;for(e in b)b.hasOwnProperty(e)&&a.push(e+"="+b[e]);return a.join("&")},unParam:function(b){for(var b=b.split("&"),a,e={},c=0;c<b.length;c++)a=b[c].split("="),a[0]&&(e[a[0]]=a[1]||"");return e},mixClassStaticProps:function(b,a){for(var e in a)a.hasOwnProperty(e)&&"prototype"!=e&&(b[e]=a[e]);return b},mixClassProtoProps:function(b,a){for(var e in a)if(!b[e]||b[e]==c.unimpl)b[e]=a[e];return b},implement:function(b,a){if(c.isFunction(b)&&c.isFunction(a)){a.prototype.constructor=a;var e=function(){a.apply(this,
arguments);b.apply(this,arguments);b.prototype.initial&&b.prototype.initial.apply(this,arguments);a.prototype.initial&&a.prototype.initial.apply(this,arguments)};this.mixClassStaticProps(e,b);this.mixClassStaticProps(e,a);this.mixClassProtoProps(e.prototype,b.prototype);this.mixClassProtoProps(e.prototype,a.prototype);return e.prototype.constructor=e}e={};c.mix(e,b);c.mix(e,a);return e}});c.mix(c,d);return c},{requires:["magix/impls/base"]});
KISSY.add("magix/impls/ajax",function(f,d){return{send:function(c){var b=this,c=this.processOptions(c),a=c.success,e=c.error;d(f.mix(c,{url:c.url,dataType:c.dataType,type:c.type,success:function(e,d,g){b.fireGlobalSetting(g);a.call(c,e)},error:function(a,d,g){b.fireGlobalSetting(g);e.call(c,d)}}))}}},{requires:["ajax"]});
KISSY.add("magix/impls/base",function(f){var d=Object.prototype.toString;return{isFunction:f.isFunction,isArray:f.isArray,isString:f.isString,isPlainObject:function(c){return c&&"[object Object]"===d.call(c)&&!c.nodeType&&!c.setInterval},requireAsync:function(c,b){f.use(c,function(a,e){b(e)})},Events:{bind:function(c,b,a){var e=this._callbacks||(this._callbacks={});(e[c]||(e[c]=[])).push([b,a]);return this},unbind:function(c,b){var a;if(c){if(a=this._callbacks)if(b){a=a[c];if(!a)return this;for(var e=
0,k=a.length;e<k;e++)if(a[e]&&b===a[e][0]){a[e]=null;break}}else a[c]=[]}else this._callbacks={};return this},trigger:function(c,b){var a,e,k,d,g=2;if(!(e=this._callbacks))return this;for(;g--;)if(a=g?c:"all",a=e[a])for(var f=0,h=a.length;f<h;f++)(k=a[f])?(d=g?Array.prototype.slice.call(arguments,1):arguments,k[0].apply(k[1]||this,d)):(a.splice(f,1),f--,h--);!0==b&&delete e[c];return this}}}},{requires:["ajax"]});
KISSY.add("magix/impls/model",function(f,d,c){d=d.Model;f.mix(d.prototype,c.Events);var b=d.prototype.fire;d.prototype.fire=function(a,e){b(a,e);if("*"==a.charAt(0)){var c=this,a=a.substring(1).replace(/[A-Z]/,function(a){return a.toLowerCase()});if(!c.__propCache)c.__propCache={};f.each(e.attrName,function(a){c.__propCache[a]=!0});this.trigger(a,e);delete this.__propCache}else this.trigger(a,e)};d.prototype.hasChanged=function(a){var b=this.__propCache;return b?b[a]:!1};d.prototype.unset=function(a){this.removeAttr(a)};
d.prototype.clear=function(){var a=this.toJSON(),b;for(b in a)this.removeAttr(b)};return d},{requires:["mvc","magix/base"]});
KISSY.add("magix/impls/router",function(f,d,c,b,a,e){return{getAppConfig:function(){var a=e.pathViewMap,b=e.defaultViewName;if(b&&a)for(var c in a)a[c]||(a[c]=b);return e},getVOMObject:function(){return b},setStateListener:function(){var e=this;b.__Router=e;(new a.Router).addRoutes({"*hash":function(a){f.log(a.hash);e.route(a.hash)}});a.Router.start({triggerRoute:1,urlRoot:location.href.split("#")[0].split("index.html")[0]})},parseState:function(a){return this._parseHash(a)},_parseHash:function(a){var b=
{},e;b.pathName=this.appConfig.indexPath;b.paraObj={};b.referrer=this.state&&this.state.query||null;if(b.query=a)a=a.split("/"),e=a.pop(),-1==e.indexOf("=")&&e&&(a.push(e),e=""),b.pathName=a.join("/"),b.paraObj=d.unParam(e);return b},parseSearch:function(){return this._parseSearch()},_parseSearch:function(){var a={},b=this.config.pathPrefix||null;a.pathName=location.pathname;a.paraObj={};if(b)a.pathName=location.pathname.split(b)[1];a.query=a.pathName+location.search;if(location.search)a.paraObj=
d.unParam(location.search.substr(1));return a},getRootViewName:function(){var a=this.appConfig.pathViewMap,b;if(a&&(b=a[this.query.pathname]?a[this.query.pathname]:a[this.appConfig.notFoundPath],this.query.__view__&&(b=this.query.__view__.split("-").join("/")),this.config.multipage))a=a[this.query["sch:pathname"]],"object"==typeof a?b=a[this.query.pathname]||a[this.appConfig.notFoundPath]:(document.body.id="vc-root",b=a||this.appConfig.defaultRootViewName);return b},createQueryModel:function(){return new c(this.query)},
changeQueryModel:function(){this._fixQueryModel(this.query);this.queryModel.set(this.query)},_fixQueryModel:function(a){if(this.queryModel){var b,e=this.queryModel.toJSON();for(b in e)b in a||this.queryModel.unset(b,{silent:!0})}},navigateTo:function(a){var a=d.isPlainObject(a)?a:d.unParam(a),b=f.clone(this.state.paraObj);delete b.referrer;delete b.pathname;delete b.query;delete b.postdata;var a=d.mix(b,a),e;for(e in a)a[e]||delete a[e];this.goTo(this.state.pathName+"/"+d.param(a))}}},{requires:["magix/base",
"magix/model","magix/vom","mvc","app/config/ini"]});KISSY.add("magix/impls/template",function(f,d){return{toHTML:function(c){c=this.processOptions(c);return d.toHTML(c.template,c.data)}}},{requires:["magix/tmpl"]});
KISSY.add("magix/impls/vframe",function(f,d){var c=function(){};d.mix(c,{tagName:"vframe"});d.mix(c.prototype,{getChildVframeNodes:function(){var b=document.getElementById(this.id).getElementsByTagName("vframe"),a,e=[];for(a=0;a<b.length;a++)e.push(this._idIt(b[a]));return e},createFrame:function(){return document.createElement(c.tagName)}});return c},{requires:["magix/base"]});
KISSY.add("magix/impls/view",function(f,d,c,b,a,e){var k=function(){k.superclass.constructor.apply(this,arguments)},j=function(a,b){var e=function(){e.superclass.constructor.apply(this,arguments)};e.extend=j;return f.extend(e,this,a,b)};k.extend=j;f.extend(k,d.View,{initial:function(){this.delegateEvents()},getVOMObject:function(){return a},getAjaxObject:function(){return b},getTemplateObject:function(){return c},dispose:function(){k.superclass.destroy.apply(this,arguments)}});f.mix(k.prototype,e.Events);
var g=k.prototype.fire;k.prototype.fire=function(a,b){g(a,b);this.trigger(a,b)};return k},{requires:["mvc","magix/template","magix/ajax","magix/vom","magix/base"]});KISSY.add("magix/impls/vom",function(f,d,c){return{setRootVframe:function(){var b=document.getElementById("vf-root"),a=this.createElement(b,"vf-root");b||document.body.insertBefore(a.getOnce(),document.body.firstChild);this.root=a},getVframeClass:function(){return c}}},{requires:["magix/base","magix/vframe"]});
Magix={init:function(f){this.config=f||{};this.setEnv();this.bootstrap()},_fireGlobalListen:function(f,d,c){var b=this.$globalList;if(b&&b.length)for(var a=0;a<b.length;a++)try{b[a]({key:f,from:d,to:c})}catch(e){}},setGlobal:function(f,d){if(!this.$global)this.$global={};var c=this.$global[f];this.$global[f]=d;this._fireGlobalListen(f,c,d)},delGlobal:function(f){if(this.$global){var d=this.$global[f];delete this.$global[f];this._fireGlobalListen(f,d)}},getGlobal:function(f){return this.$global?this.$global[f]:
null},listenGlobal:function(f){if(!this.$globalList)this.$globalList=[];this.$globalList.push(f)},unlistenGlobal:function(f){var d=this.$globalList;if(d&&d.length)for(var c=0;c<d.length;c++)if(d[c]==f){d.splice(c,1);break}},templates:{},setEnv:function(){var f=this.config.magixHome||"",d=this.config.appHome||"",c=KISSY,b=(new Date).getTime();if(f&&!/\/$/.test(f))f+="/",this.config.magixHome=f;if(d&&!/\/$/.test(d))d+="/",this.config.appHome=d;if(!this.config.release&&/^https?:\/\//.test(d))this.config.release=
-1==d.indexOf(location.protocol+"//"+location.host);if(!this.config.release)c.config({map:[[RegExp("("+d+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]}),this.dev=!0,c.config({debug:!0});if(!window.console)window.console={log:function(){},dir:function(){},warn:function(){},error:function(){}};c.config({packages:[{name:"magix",path:/\/magix\/$/.test(f)?f+"../":f,tag:this.dev?b:"20120214"},{name:"app",path:/\/app\/$/.test(d)?d+"../":d,tag:this.dev?b:"20120214"}]})},bootstrap:function(){var f=this;KISSY.use("magix/router",
function(d,c){d.log(c);c.init(f.config)})},implementBy:"kissy",version:"0.1.0",dev:""};KISSY.add("magix/model",function(f,d,c){f=function(){};c.mix(f.prototype,{unset:c.unimpl,clear:c.unimpl,load:c.unimpl});return c.implement(f,d)},{requires:["magix/impls/model","magix/base"]});
KISSY.add("magix/mu",function(f,d){function c(a){a=a.split("==");return function(){for(var b=a[0].split("."),c=a[1],d=b.length-1;-1<d;d--){var g=b.slice(d),f=this;try{for(var h=0;h<g.length-1;h++)f=f[g[h]];if(g[g.length-1]in f){if(f[g[g.length-1]].toString()===c)return!0;break}}catch(l){}}return!1}}function b(a,e){var c,d;for(c in a)if(d=a[c],d instanceof Array)for(var g=0;g<d.length;g++){if(o=d[g],"object"==typeof o)0===g?o.__first__=!0:g==d.length-1?o.__last__=!0:o.__mid__=!0,o.__index__=g}else"object"==
typeof d&&5>e&&b(d,e+1)}return{to_html:function(a,e){"object"==typeof e&&b(e,0);var k=e,f;f=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i;var g=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),i=[];if(g)for(var h=0;h<g.length;h++)i.push(g[h].match(f)[1]);f=i;g="";for(i=0;i<f.length;i++)g="if("+f[i]+")",k[g]||(k[g]=c(f[i]));return d.to_html.apply(this,arguments)}}},{requires:["magix/mustache"]});
KISSY.add("magix/mustache",function(){return function(){var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(d,c,b,a){if(!a)this.context=c,this.buffer=[];if(this.includes("",d)){d=this.render_pragmas(d);d=this.render_section(d,c,b);if(a)return this.render_tags(d,c,b,a);this.render_tags(d,c,b,a)}else{if(a)return d;this.send(d)}},send:function(d){""!=d&&this.buffer.push(d)},render_pragmas:function(d){if(!this.includes("%",
d))return d;var c=this;return d.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(b,a,e){if(!c.pragmas_implemented[a])throw{message:"This implementation of mustache doesn't understand the '"+a+"' pragma"};c.pragmas[a]={};e&&(b=e.split("="),c.pragmas[a][b[0]]=b[1]);return""})},render_partial:function(d,c,b){d=this.trim(d);if(!b||void 0===b[d])throw{message:"unknown_partial '"+d+"'"};return"object"!=typeof c[d]?this.render(b[d],c,b,!0):this.render(b[d],c[d],b,!0)},render_section:function(d,
c,b){if(!this.includes("#",d)&&!this.includes("^",d))return d;var a=this;return d.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(e,d,f,g){e=a.find(f,c);if("^"==d)return!e||a.is_array(e)&&0===e.length?a.render(g,c,b,!0):"";if("#"==d)return a.is_array(e)?a.map(e,function(e){return a.render(g,a.create_context(e),b,!0)}).join(""):a.is_object(e)?a.render(g,a.create_context(e),b,!0):"function"===typeof e?e.call(c,g,
function(e){return a.render(e,c,b,!0)}):e?a.render(g,c,b,!0):""})},render_tags:function(d,c,b,a){for(var e=this,k=function(){return RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},f=k(),g=function(a,d,g){switch(d){case "!":return"";case "=":return e.set_delimiters(g),f=k(),"";case ">":return e.render_partial(g,c,b);case "{":return e.find(g,c);default:return e.escape(e.find(g,c))}},d=d.split("\n"),i=0;i<d.length;i++)d[i]=d[i].replace(f,g,this),a||this.send(d[i]);if(a)return d.join("\n")},
set_delimiters:function(d){d=d.split(" ");this.otag=this.escape_regex(d[0]);this.ctag=this.escape_regex(d[1])},escape_regex:function(d){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return d.replace(arguments.callee.sRE,"\\$1")},find:function(d,c){var d=this.trim(d),b;!1===c[d]||0===c[d]||c[d]?b=c[d]:(!1===this.context[d]||0===this.context[d]||this.context[d])&&(b=this.context[d]);return"function"===typeof b?b.apply(c):void 0!==
b?b:""},includes:function(d,c){return-1!=c.indexOf(this.otag+d)},escape:function(d){return(""+(null===d?"":d)).replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(d){if(this.is_object(d))return d;var c=".";if(this.pragmas["IMPLICIT-ITERATOR"])c=this.pragmas["IMPLICIT-ITERATOR"].iterator;var b={};b[c]=d;return b},is_object:function(d){return d&&
"object"==typeof d},is_array:function(d){return"[object Array]"===Object.prototype.toString.call(d)},trim:function(d){return d.replace(/^\s*|\s*$/g,"")},map:function(d,c){if("function"==typeof d.map)return d.map(c);for(var b=[],a=d.length,e=0;e<a;e++)b.push(c(d[e]));return b}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(d,c,b,a){var e=new f;if(a)e.send=a;e.render(d,c,b);if(!a)return e.buffer.join("\n")}}}()});
KISSY.add("magix/router",function(f,d,c){f={};c.mix(f,{config:null,appConfig:null,state:null,search:null,query:null,queryModel:null,rootViewName:null,oldRootViewName:null,postData:null,_locator:null,getAppConfig:c.unimpl,setStateListener:c.unimpl,parseState:c.unimpl,parseSearch:c.unimpl,getRootViewName:c.unimpl,createQueryModel:c.unimpl,changeQueryModel:c.unimpl,navigateTo:c.unimpl,setPostData:c.unimpl,getVOMObject:c.unimpl,init:function(b){this.config=b;this.appConfig=this.getAppConfig();this.setStateListener()},
goTo:function(b){location.hash="!"+b},route:function(b){this.state=this.parseState(b);this.search=this.parseSearch();this._locator={state:this.state,search:this.search};this.query=this._spreadLocator();this.oldRootViewName=this.rootViewName;if(this.rootViewName=this.getRootViewName())if(this.rootViewName==this.oldRootViewName)this.changeQueryModel();else{var a=this.getVOMObject();this.queryModel=this.createQueryModel();this.queryModel.bind("change",function(){a.notifyQueryModelChange(this)});a.mountRootView(this.rootViewName,
this.queryModel)}this.postData=null},_spreadLocator:function(){var b={},a=this._locator;c.mix(b,a.state.paraObj);c.mix(b,{referrer:a.state.referrer,query:a.state.query,pathname:a.state.pathName,postdata:a.state.postData||null});var e={},d,f=a.search.paraObj;e["sch:pathname"]=a.search.pathName;e["sch:query"]=a.search.query;for(d in f)e["sch:"+d]=f[d];c.mix(b,e);return b}});c.mix(f,d);return f},{requires:["magix/impls/router","magix/base"]});
KISSY.add("magix/template",function(f,d,c){return c.implement({defaultOptions:{data:{},template:""},processOptions:function(b){for(var a in this.defaultOptions)b[a]||(b[a]=this.defaultOptions[a]);return b},toHTML:c.unimpl},d)},{requires:["magix/impls/template","magix/base"]});
KISSY.add("magix/tmpl",function(){var f={},d={},c="_"+(new Date).getTime(),b=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/notRenderTemplate\1[^>]*>([\s\S]*?)<\/script>\s*/gi,a=function(a,b){if(a){var j;j=d[a];j||(j=c+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,
";"+c+".push('")+"');return "+c+".join('')",d[a]=j);var g=[c],i=[[]],h;if(b)for(h in b)g.push(h.replace(/[:+\-*\/&^%#@!~]/g,"$")),i.push(b[h]);h=g.join("_")+"_"+j;if(!f[h])try{f[h]=new Function(g,j)}catch(l){return l.message}try{j=f[h].apply(b,i)}catch(m){j=m.message}return j}return a};return{toHTML:function(e,c){var d=e.match(b);if(d)var e=e.replace(b,function(){return'<script type="text/notRenderTemplate"><\/script>'}),e=a(e,c),f=0,e=e.replace(b,function(){return d[f++]});else e=a(e,c);return e}}});
KISSY.add("magix/vframe",function(f,d,c){var b;b=function(){};c.mix(b,{tagName:c.unimpl,uniqueId:function(){return c.uniqueId("vf-")},init:function(){document.createElement(this.tagName);return this}});c.mix(b.prototype,c.Events);c.mix(b.prototype,{getChildVframeNodes:c.unimpl,getRouterObject:function(){return this.__Router},createFrame:c.unimpl,getVOMObject:function(){return this.__VOM},initial:function(a,b){this.id="";this.parentNode=null;this.childNodes=[];this.mounted=!1;this._domNode=a||this.createFrame();
this.id=this._idIt(this._domNode,b);if(a)this._domNode=null;this.exist=!0},_idIt:function(a,e){a.id=a&&a.id||e||b.uniqueId();return a.id},getOnce:function(){var a=this._domNode;this._domNode=null;return a},getAttribute:function(a){return document.getElementById(this.id).getAttribute(a)||""},setAttribute:function(a,b){return document.getElementById(this.id).setAttribute(a,b)},appendChild:function(a){this.childNodes.push(a);a.parentNode=this},getElements:function(){return this.getChildVframeNodes()},
handelMounted:function(){var a=this;a.view.rendered?(a.mounted=!0,a.trigger("mounted",a.view),a.mountSubFrames()):a.view.bind("rendered",function(){a.mounted=!0;a.trigger("mounted",a.view);a.mountSubFrames()});a.view.bind("prerender",function(){a.destroySubFrames()})},mountSubFrames:function(){var a=this.getVOMObject(),b=a.getElementById(this.view.vcid),c=b.getElements(),d,f;for(d=0;d<c.length;d++)f=a.createElement(c[d]),b.appendChild(f),f.mountView(f.getAttribute("view_name"),{queryModel:this.view.queryModel})},
mountView:function(a,b){if(a){b=b||{};this.unmountView(b);var d=this,f=this.getRouterObject();if(!b.queryModel)b.queryModel=f.queryModel;c.requireAsync(a,function(c){if(d.exist)b.vcid=d.id,b.viewName=a,d.view=new c(b),d.__viewLoaded=!0,d.trigger("viewLoaded",!0),d.handelMounted()})}},unmountView:function(a){if(this.view&&this.mounted){a=a||{};this.destroySubFrames();this.view.trigger("unload",!0);this.view.trigger("beforeRebuild",!0);this.view.destroy();for(var b=document.getElementById(this.view.vcid),
c=b.getElementsByTagName("iframe"),d,f;c.length;)d=c[0],f=d.parentNode,d.src="",f.removeChild(d),f.parentNode.removeChild(f);b.innerHTML=a.unmountPlaceholder||"";delete a.unmountPlaceholder;this.mounted=!1;this.view=null}},destroySubFrames:function(){function a(c){b.push(c);for(var d=0;d<c.childNodes.length;d++)a(c.childNodes[d])}var b=[],c=this.getVOMObject().getElementById(this.id);a(c);for(c=b.length-1;0<c;c--)b[c].removeNode()},removeNode:function(){this.mounted&&this.unmountView();this.trigger("unload");
var a=document.getElementById(this.id);a&&(a.parentNode.removeChild(a),this.linkid&&(a=document.getElementById(this.linkid),a.parentNode.removeChild(a)));this.parentNode._removeChild(this)},_removeChild:function(a){var b,c,d=[];for(b=0;b<this.childNodes.length;b++)c=this.childNodes[b],c==a?this._popFromVOM(c):d.push(c);this.childNodes=d},_popFromVOM:function(a){this.getVOMObject().pop(a);a.exist=!1},postMessage:function(a,b){var c=this;if(c.exist)a||(a={}),a.from=b,c.__viewLoaded?c.view._receiveMessage(a):
(c.unbind("viewLoaded"),c.bind("viewLoaded",function(){c.view._receiveMessage(a)}))}});return c.implement(b,d).init()},{requires:["magix/impls/vframe","magix/base"]});
KISSY.add("magix/view",function(f,d,c){f=function(){};c.mix(f.prototype,{getVOMObject:c.unimpl,getTemplateObject:c.unimpl,getAjaxObject:c.unimpl,dispose:c.unimpl,queryModelChange:function(){},initial:function(b){var a=this;this.getVOMObject();this.options=b;this.vcid=b.vcid;this.queryModel=b.queryModel;this.viewName=b.viewName;this.data=b.data||{};b.message&&"function"==typeof b.message&&this.bind("message",b.message);this.exist=!0;this.bind("unload",function(){this.exist=!1});this.init&&setTimeout(function(){a.exist&&
a.init()},0);this.preventRender||this.getTemplate(function(b){a.template=b;setTimeout(function(){if(a.exist)!1!==a.render()&&!a.__isStartMountSubs&&a.trigger("rendered"),a.__rendered=!0,a.trigger("renderComplete",!0)},0)})},_queryModelChange:function(b){try{if(this.hashHasChanged())var a=this.queryModelChange(b)}catch(c){}this.__isStartMountSubs&&(a=!1);this._changeChain(a,b)},_changeChain:function(b,a){var e=[],d;d=this.getVOMObject().getElementById(this.vcid);if(!1!==b){!0===b||void 0===b?e=d.childNodes:
c.isArray(b)&&(e=b);for(d=0;d<e.length;d++)e[d].view&&e[d].view._queryModelChange(a)}},destory:function(){this.destroy()},destroy:function(){if(this.events){var b=document.getElementById(this.vcid),a;for(a in this.events)b["on"+a]=null}this.dispose()},setData:function(b){this.data=b;for(var a in b)b[a]&&b[a].toJSON&&(b[a]=b[a].toJSON());b.query=this.queryModel.toJSON();this.setRenderer()},setRenderer:function(){var b=this,a=this.renderer,c,d;if(a)for(c in a)for(d in a[c])(function(){var f=c,g=d,i=
a[f][g];b.data[f+"_"+g]=function(){return i.call(this,b,f)}})()},getEventInfo:function(b,a){for(var c=b.target||b.srcElement,d=b.type,f="mx"+d,g=this.eventsLevel;3===c.nodeType;)c=c.parentNode;var i=c.getAttribute(f);if(g)var h=g[d];if(!i&&h)if(!isNaN(h)&&h)for(;h&&c!=a;){c=c.parentNode;if(i=c.getAttribute(f))break;h--}else if(h.split(".")[1])for(h=h.split(".")[1];c!=a;){if(c=c.parentNode,0<=c.className.indexOf(h)){i=c.getAttribute(f);break}}else{if(h.split("#")[1])for(h=h.split("#")[1];c!=a;)if(c=
c.parentNode,c.id==h){i=c.getAttribute(f);break}}else if(!i)c=c.parentNode,i=c.getAttribute(f);return{info:i,target:c}},processEvent:function(b,a){var c=b||window.event,d=this.getEventInfo(c,a||document.getElementById(this.vcid)),f=c.type,g={},i=d.target,d=d.info,g={target:i,originEvent:c};if(d)for(var d=d.split("|"),h,l,m=0;m<d.length;m++){h=d[m].split(":");l=h.shift();var n=h[h.length-1],p=!1;if("_halt_"==n||"_preventDefault_"==n)c.preventDefault?c.preventDefault():c.returnValue=!1,p=g.isPreventDefault=
!0;if("_halt_"==n||"_stop_"==n)c.stopPropagation?c.stopPropagation():c.cancelBubble=!0,p=g.isStopPropagation=!0;p&&h.pop();this.trigger("beforeEventCall",g);if(this.events&&this.events[f]&&this.events[f][l])this.events[f][l](this,this.idIt(i),h,c)}this.trigger("delegateEventsFire",g)},delegateEvents:function(){var b=this,a=document.getElementById(b.vcid),c=this.events,d;for(d in c)a["on"+d]=function(c){b.processEvent(c,a)}},setViewHTML:function(b){var a=this;return a.exist?(a.trigger("beforeRebuild",
!0),a.trigger("prerender"),document.getElementById(a.vcid).innerHTML=b,a.trigger("rendered"),a.__isStartMountSubs=!0,setTimeout(function(){delete a.__isStartMountSubs},0),!0):!1},render:function(){},getTemplate:function(b,a){if(this.template)b(this.template);else{var c=Magix.config.appHome,c=/\/app\/$/.test(c)?c+this.viewName.split("app")[1]:c+this.viewName,c=(a?c+".name.html":c+".html").replace(/([^:\/])\/+/g,"$1/"),d=this.getAjaxObject();if(Magix.dev||!Magix.config.release)c+="?t="+(new Date).getTime();
d.getTemplate(c,function(a){b(a)},function(a){b(a)},this.viewName)}},idIt:function(b){var a="";if(!b.id)b.id=c.uniqueId("mxevt-");return a=b.id},receiveMessage:function(){},hashChange:function(){},_hashChange:function(b){!this.__isStartMountSubs&&this.hashHasChanged()&&(this.hashChange(b),this.observeHash())},_receiveMessage:function(b){var a=this;try{a.exist&&a.__rendered?a.receiveMessage(b):(a.unbind("renderComplete"),a.bind("renderComplete",function(){a.receiveMessage(b)}))}catch(c){}},postMessageTo:function(b,
a){var d=this.getVOMObject();c.isArray(b)||(b=[b]);for(var f=0;f<b.length;f++){var j=d.get(b[f]);j&&j.postMessage(a,this)}},observeHash:function(b,a){if(b){c.isString(b)?b=b.split(","):c.isArray(b)||(b=[b]);this.$observeHashKeys=b;this.$observeHashCache={};for(var d=0;d<b.length;d++)this.$observeHashCache[b[d]]=this.queryModel.get(b[d])}else a||this.observeHash(this.$observeHashKeys,!0)},hashHasChanged:function(b){var a=this.$observeHashCache,d=this.$realUsingCache,f;if(!b)b=this.$observeHashKeys;
if(b){c.isString(b)?b=b.split(","):c.isArray(b)||(b=[b]);if(a){f=!1;for(var j=0,g,i;j<b.length&&!(g=b[j],a.hasOwnProperty(g)&&(i=this.queryModel.get(g),(f=a[g]!=i)&&d&&d.hasOwnProperty(g)&&(f=d[g]!=i),f));j++);return f}for(j=0;j<b.length;j++)if(this.queryModel.hasChanged(b[j]))return!0;return!1}return!0},hashHasChangedExcept:function(b){var a=[],d={},f=this.$observeHashKeys;if(b&&f){c.isString(b)?b=b.split(","):c.isArray(b)||(b=[b]);for(var j=0;j<b.length;j++)d[b[j]]=1;for(j=0;j<f.length;j++)d[f[j]]||
a.push(f[j])}else a=f;return this.hashHasChanged(a)},hashRealUsing:function(b){if(b){if(!this.$realUsingCache)this.$realUsingCache={};for(var a in b)this.$realUsingCache[a]=b[a]}}});return c.implement(f,d)},{requires:["magix/impls/view","magix/base"]});
KISSY.add("magix/vom",function(f,d,c){f={};c.mix(f,{_idMap:{},root:null,setRootVframe:c.unimpl,getVframeClass:c.unimpl,init:function(){if(!this.inited)this.setRootVframe(),this.inited=!0;return this},push:function(b){this._idMap[b.id]=b},pop:function(b){delete this._idMap[b.id]},createElement:function(b,a){c.isString(b)&&(b=document.getElementById(b));var d=new (this.getVframeClass())(b,a);d.__VOM=this;d.__Router=this.__Router;this.push(d);return d},getElementById:function(b){return this._idMap[b]||
null},get:function(b){return this.getElementById(b)},broadcaseMessage:function(b,a){var c=this._idMap,d;for(d in c)c[d].postMessage(b,a||this)},notifyQueryModelChange:function(b){this.root&&this.root.view&&this.root.view._queryModelChange(b);for(var a in this._idMap)try{var c=this._idMap[a].view;c&&c.exist&&c._hashChange(b)}catch(d){}},mountRootView:function(b,a){this.root&&this.root.mountView(b,{queryModel:a})}});c.mix(f,d);return f.init()},{requires:["magix/impls/vom","magix/base"]});