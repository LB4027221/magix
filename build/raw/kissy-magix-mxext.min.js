KISSY.add("magix/event",function(f,c){var d=c.safeExec;return{trigger:function(b,a,e,c){var h="~~"+b+"_list",g=this[h];if(g){a||(a={});if(!a.type)a.type=b;if(c)for(b=g.length-1;0<=b&&!(!1===d(g[b],a,this));b--);else{b=0;for(c=g.length;b<c&&!(!1===d(g[b],a,this));b++);}}e&&delete this[h]},bind:function(b,a){var e="~~"+b+"_list";this[e]||(this[e]=[]);this[e].push(a)},unbind:function(b,a){var e="~~"+b+"_list",c=this[e];if(c)if(a)for(var e=0,d=c.length;e<d;e++){if(c[e]==a){c.splice(e,1);break}}else delete this[e]}}},
{requires:["magix/magix"]});
KISSY.add("magix/impl/magix",function(f){return{include:function(c){var c=f.Config.packages.magix.path+c+".js?r="+Math.random(),d=new (window.ActiveXObject||window.XMLHttpRequest)("Microsoft.XMLHTTP");d.open("GET",c,!1);d.send(null);return d.responseText},libRequire:function(c,d){f.use(c,function(b,a){d(a)})},libEnv:function(){var c=this.config(),d=c.appHome;if(!d)throw Error("please set appHome");d=d.replace(/(^|\/)app\/?/i,function(b,a){return a||"./"});c.appHome=d;if(!c.release&&/^https?:\/\//.test(d))c.release=
-1==d.indexOf(location.protocol+"//"+location.host);c.release||f.config({map:[[RegExp("("+d+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]});f.config({packages:[{name:"app",path:d,tag:c.release?"":f.now()}]});c.viewChangeAnim&&f.use("mxext/vfanim")},isArray:f.isArray,isFunction:f.isFunction,isObject:f.isObject,isRegExp:f.isRegExp,isString:f.isString,isNumber:f.isNumber}});
KISSY.add("magix/impl/router",function(f){return{useHistoryState:function(){var c=this,d=location.href;f.one(window).on("popstate",function(){var b=location.href==d;if(c.$canFirePopState||!b)c.$canFirePopState=!0,c.route()})},useLocationHash:function(){var c=this;f.one(window).on("hashchange",function(){c.suspend();c.route();c.resume()})}}});
KISSY.add("magix/impl/view",function(f,c,d,b){var d=function(){},a={idIt:1,wrapAsyncUpdate:1,registerAsyncUpdateName:1,extend:1};d.extend=function(e,c){var d=function(){d.superclass.constructor.apply(this,arguments);c&&b.safeExec(c,[],this)},g;for(g in this)b.hasProp(a,g)&&(d[g]=this[g]);return f.extend(d,this,e)};b.mix(d.prototype,{getTmplByXHR:function(a,b){c({url:a,dataType:"html",success:function(a){b(a)},error:function(a,g){b(g)}})},delegateUnbubble:function(a,b){var c=this;if(!c.$cacheEvents)c.$cacheEvents=
{};a=f.one(a);a.delegate(b,"*[mx"+b+"]",c.$cacheEvents[b]=function(a){c.processEvent(a)})},undelegateUnbubble:function(a,b){var c=this.$cacheEvents;c&&(a=f.one(a),a.undelegate(b,"*[mx"+b+"]",c[b]),delete c[b])}});return d},{requires:["ajax","sizzle","magix/magix"]});
KISSY.add("magix/magix",function(f,c){var d=function(a,b){return!a?!1:Object.prototype.hasOwnProperty.call(a,b)},b=function(a,b,c){for(var e in b)if(d(b,e)&&(!c||!d(c,e)))a[e]=b[e];return a},a=function(a,b,c,e,d,f){i.isArray(a)||(a=[a]);if(!b||!i.isArray(b)&&!b.callee)b=[b];for(e=0;e<a.length;e++)try{f=a[e],d=i.isFunction(f)&&f.apply(c,b)}catch(s){}return d},e=function(){throw Error("unimplement method");},i={isArray:e,isObject:e,isFunction:e,isRegExp:e,isString:e,isNumber:e,libRequire:e,include:e,
libEnv:e,mix:b,unimpl:e,hasProp:d,safeExec:a,noop:function(){},templates:{},cfg:{},locals:{},config:function(a){var c=this.cfg;if(a)this.cfg=b(c,a);return this.cfg},start:function(b){var c=this,b=c.config(b);c.libEnv();b.ready&&(a(b.ready),delete b.ready);c.libRequire("magix/router",function(a){c.libRequire("magix/vom",function(b){a.bind("locationChanged",function(a){a.changed.isViewPathChanged()?b.remountRootVframe(a):b.notifyLocationChange(a)});a.bind("idle",function(){b.resume()});a.bind("busy",
function(){b.suspend()});a.start()})})},objectKeys:function(a){if(Object.keys)return Object.keys(a);var b=[],c;for(c in a)d(a,c)&&b.push(c);return b},local:function(a,b){var c=arguments,e=this.locals;if(0==c.length)return e;if(1==c.length)if(this.isObject(a))for(var i in a)d(a,i)&&(e[i]=a[i]);else return e[a];else e[a]=b}};return i.mix(i,c)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(f,c,d,b){var a=d.hasProp,e=function(b){return a(this.params,b)},i=function(){return a(this,k)},h=function(){return a(this,"viewPath")},g=function(){return this.hash[k]!=this.query[k]},l=function(a){return this.hash.params[a]!=this.query.params[a]},j=function(b){return a(this.hash.params,b)},n=function(b){return a(this.query.params,b)},p=function(a){return this.params[a]},s=d.safeExec,q=window,w=encodeURIComponent,u=decodeURIComponent,t=/\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,
x=/[^\/]*$/,v=/([#?]).*$/,m=/([^=&?\/#]+)=([^&=#?]*)/g,k="pathname",f=d.mix({iQ:[],iC:0,useHistoryState:d.unimpl,useLocationHash:d.unimpl,compareObject:function(a,b){if(d.isObject(a)&&d.isObject(b)){for(var c=[],c=c.concat(d.objectKeys(a)),c=c.concat(d.objectKeys(b)),e=0;e<c.length;e++){var g=c[e];if(a[g]!=b[g])return!1}return!0}return a==b},getPathnameRelations:function(){if(this.$pnr)return this.$pnr;var b={virtualToReal:{},virtualRegExpToReal:{}},c=d.config().pathCfg,e=c.map,g=c.defaultView,i=
c.defaultPathname;if(d.isObject(e)){for(var l in e)if(a(e,l)){var h=l;"/"==h.charAt(h.length-1)&&(h+="index");for(var j=e[l],f=[],f=d.isArray(j)?j:d.isString(j)?j.split(","):[j],j=0;j<f.length;j++)d.isRegExp(f[j])?b.virtualRegExpToReal[h]=f[j]:(!i&&h==g&&(i=f[j]),b.virtualToReal[f[j]]=h)}g&&"/"==g.charAt(g.length-1)&&(g+="index")}if(!g||!i)throw Error("unset defaultPathname or defaultView attribute for pathCfg");b.home=g;b[k]=i;b.hasNotFound=a(c,"notFound");b.notFound=c.notFound;return this.$pnr=
b},getViewPath:function(a){var b=this.getPathnameRelations();a||(a=b[k]);var c=b.virtualToReal[a];if(!c)for(var e in b.virtualRegExpToReal)if(b.virtualRegExpToReal[e].test(a)){c=e;break}return{viewPath:c?c:b.hasNotFound?b.notFound:b.home,pathname:c?a:b.hasNotFound?a:b[k]}},start:function(){this.supportHistoryState()?this.useHistoryState():this.useLocationHash();this.route()},supportHistoryState:function(){var a=q.history;return d.config().useHistoryState&&a.pushState&&a.replaceState},pathToObject:function(a){var b=
{},c={},e=q.location.protocol,g="";v.test(a)?g=a.replace(v,""):~a.indexOf("=")||(g=a);if(g)if(0==g.indexOf(e))e=g.indexOf("/",e.length+2),g=-1==e?"/":g.substring(e);else if("/"!=g.charAt(0)&&d.config().useHistoryState&&!this.supportHistoryState()){e=q.location[k].replace(x,"");for(e+=g;t.test(e);)e=e.replace(t,"$1/");g=e}a.replace(m,function(a,b,e){c[b]=e});b[k]=g;b.params=c;return b},objectToPath:function(b){var c=b[k],e=[],g;for(g in b.params)a(b.params,g)&&e.push(g+"="+b.params[g]);return c+(e.length?
"?":"")+e.join("&")},parseQueryAndHash:function(){var a=u(q.location.href).replace(/^[^?#]+/g,""),b=q.location[k]+a.replace(/^([^#]+).*$/g,"$1"),a=a.replace(/^[^#]*#?/g,""),c=this.pathToObject(b),e=this.pathToObject(a.replace(/^!?/,"")),i={};d.mix(i,c.params);d.mix(i,e.params);return{isPathnameDiff:g,isParamDiff:l,hashParamsHas:j,queryParamsHas:n,get:p,originalQuery:b,originalHash:a,query:c,hash:e,params:i}},parseLocation:function(){var a=this.parseQueryAndHash(),b=this.getViewPath(d.config().useHistoryState?
a.hash[k]?a.hash[k]:a.query[k]:a.hash[k]);return d.mix(a,b)},getChangedLocation:function(a,b){var c={params:{}};a[k]!=b[k]&&(c[k]=!0);if(a.viewPath!=b.viewPath)c.viewPath=!0;for(var g=d.objectKeys(a.params),g=g.concat(d.objectKeys(b.params)),l=0;l<g.length;l++){var j=g[l];a.params[j]!=b.params[j]&&(c.params[j]=!0)}c.isParamChanged=e;c.isPathnameChanged=i;c.isViewPathChanged=h;return c},route:function(){var a=this.parseLocation(),b=this.$location||{params:{}},c=!this.$location,e;a.viewPath==(b.viewPath||
"")?this.compareLocation(b,a)||(e=!0):e=!0;e&&(b=this.getChangedLocation(b,a),this.trigger("locationChanged",{location:a,changed:b,isFirstFired:c}));this.$location=a;this.$referrer=u(q.location.href);this.resume()},compareLocation:function(a,b){return a[k]!=b[k]?!1:this.compareObject(a.params,b.params)},navigate2:function(b){var c=this;b&&d.isString(b)&&c.idle(function(){c.suspend();c.trigger("busy");var e=c.pathToObject(b),g=d.mix({},c.$location.params),g=d.mix(g,e.params);if(e[k]){if(d.config().useHistoryState&&
!c.supportHistoryState()&&(g=c.$location.query)&&(g=g.params))for(var i in g)a(g,i)&&!a(e.params,i)&&(e.params[i]="")}else e.params=g,e[k]=c.$location[k];c.compareLocation(e,c.$location)?c.resume():(e=c.objectToPath(e),c.supportHistoryState()?(c.$canFirePopState=!0,history.pushState(new Date,document.title,e),c.route()):location.hash="#!"+e)})},navigate:function(a,b){if(d.isObject(a)){var c=[],e;for(e in a)c.push(e+"="+w(a[e]));a=c.join("&");b&&(a=b+"?"+a)}this.navigate2(a)},idle:function(a){this.iC?
this.iQ.push(a):s(a)},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC)if(this.iQ.length){var a=[].slice.call(this.iQ);for(this.iQ=[];a.length;)this.idle(a.shift())}else this.trigger("idle")}},b);return d.mix(f,c)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(f,c,d){var b=document,a=0,e=c.safeExec,i=function(a){return"object"==typeof a?a:b.getElementById(a)},h=function(a){this.id=h.idIt(a);this.viewId=this.id+"_view";this.children=[];this.view=null;this.ready={o:{},c:0}};c.mix(h,{tagName:"vframe",idIt:function(b){return b.id||(b.id="magix_vf_"+a++)},createVframe:function(a,b){var a=i(a),e=new h(a);c.mix(e,b);return e},createVframeNode:function(a,c){var e=b.createElement(h.tagName);e.id=a;c.parentNode.insertBefore(e,c)}});
b.createElement(h.tagName);c.mix(h.prototype,d);c.mix(h.prototype,{viewChangeUseAnim:function(){return!1},oldViewDestroy:c.noop,prepareNextView:c.noop,newViewCreated:c.noop,mountView:function(a){var b=this,e=b.viewName&&b.viewChangeUseAnim();b.unmountView(e,!0);if(a)b.viewName=a,c.libRequire(a,function(c){if(a!=b.viewName)b.unbind("viewLoad");else{c.wrapAsyncUpdate();var d;e?(d=b.viewId,b.prepareNextView()):d=b.id;var i=new c({viewName:a,owner:b,ownerVOM:b.owner,id:d,vId:b.viewId,vfId:b.id});i.bind("ready",
function(a){i.bind("created",function(){b.trigger("viewLoad",{view:i},!0);b.viewCreated=!0});e&&b.newViewCreated(!0);a.tmpl||b.loadSubVframes();i.bind("rendered",function(){b.loadSubVframes()});i.bind("prerender",function(a){b.unloadSubVframes(a.anim)})});b.view=i;i.load()}})},unmountView:function(a,b){this.view?(this.unloadSubVframes(a),this.view.destroy(a),a&&b&&this.oldViewDestroy(),delete this.view,delete this.viewName):this.viewName&&(this.unbind("viewLoad"),this.unbind("childrenCreated"),delete this.viewName)},
loadSubVframes:function(){var a=this;a.owner.suspend();var b=(i(a.viewId)||i(a.id)).getElementsByTagName(h.tagName),e=b.length;if(e)for(var d=0,f;d<e;d++)f=b[d],f=h.createVframe(f,{owner:a.owner,parentId:a.id}),a.children.push(f.id),a.owner.registerVframe(f),f.bind("childrenCreated",function(){var b=a.ready,e=this.id;c.hasProp(b.o,e)||(b.o[e]=1,b.c++);if(b.c==a.children.length)a.ready={o:{},c:0},a.notifyChildrenCreated()}),f.mountView(b[d].getAttribute("data-view"));else a.notifyChildrenCreated();
a.owner.resume()},unloadSubVframes:function(a){for(var b=this.children,c,e=0,d=b.length,h;e<d;e++)h=b[e],c=this.owner.getVframe(h),c.unmountView(a),this.owner.unregisterVframe(c),i(h).id="";this.children=[]},postMessageTo:function(a,b){var d=this.owner;c.isArray(a)||(a=[a]);b||(b={});for(var i=0;i<a.length;i++){var h=d.getVframe(a[i]);if(h){var f=h.view;f?f.rendered?e(f.receiveMessage,b,f):f.bind("created",function(){e(this.receiveMessage,b,this)}):h.viewName&&h.bind("viewLoad",function(a){e(a.view.receiveMessage,
b,a.view)})}}},notifyLocationChange:function(a){var b=this.view;if(b&&b.exist&&b.rendered){if(e(b.testObserveLocationChanged,a,b))var d=e(b.locationChange,a,b);if(!1!==d){if(!c.isArray(d))d=this.children;for(var b=0,i=d.length,h;b<i;b++)(h=this.owner.getVframe(d[b]))&&e(h.notifyLocationChange,a,h)}}},notifyChildrenCreated:function(){var a=this,b=function(){var b=a.view;b&&e(b.trigger,"childrenCreated",b);a.trigger("childrenCreated")};a.viewCreated?b():a.bind("viewLoad",b)}});return h},{requires:["magix/magix",
"magix/event"]});
KISSY.add("magix/view",function(f,c,d,b){var a=1,e=d.safeExec,i=d.hasProp,h=["render","renderUI","updateUI"],g=function(a){d.mix(this,a);this.exist=!0;this.iQ=[];this.sign=this.iC=0},l=g.prototype,j=function(a,b){return function(){var c=this,e=arguments;c.idle(function(){b&&c.sign++;a.apply(c,e)})}},n=/(?:^|\s)return(?:(?:\s+[+\-\w$'"{\[\(\/])|[+\-{\[\(\/'"])/,p=/{([\s\S]+)}/,s=/\\[\s\S]/g,q=/\s*\/\s*/g,w=/^[\s\xa0\u3000\uFEFF]*$/,u=[/[^\w$_]\/[\s\S]*?\//,/(?:'[^']*')|(?:"[^"]*")/,/{[^{}]+}/],t=function(a){if(a=
(""+a).match(p)){a=a[1];if(w.test(a))return!0;for(var a=a.replace(s,"").replace(q,""),b=0,c;b<u.length;b++)for(c=u[b];c.test(a);)a=a.replace(c,"");return n.test(a)}return!1};d.mix(g,{idIt:function(b){return b.id||(b.id="magix_mxe_"+a++)},wrapAsyncUpdate:function(){if(!this["~~"]){this["~~"]=1;var a=this.prototype,b;this.registerAsyncUpdateName();for(var c in a){b=a[c];var e=null;d.isFunction(b)&&b!=d.noop&&!b["~~"]&&!t(b)&&(i(this.$ans,c)?e=j(b,!0):i(a,c)&&!i(l,c)&&(e=j(b)),e&&(e["~~"]=b,a[c]=e))}}},
registerAsyncUpdateName:function(a){if(!this.$ans){this.$ans={};for(var b=0;b<h.length;b++)this.$ans[h[b]]=!0}if(a){d.isArray(a)||(a=[a]);for(b=0;b<a.length;b++)this.$ans[a[b]]=!0}return this}});var x={blur:1,focus:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,valuechange:1},f=g.prototype,v=document,m=window,k=["abort","stop","cancel","destroy","dispose"],o=function(a){return"object"==typeof a?a:v.getElementById(a)};d.mix(f,b);d.mix(f,{getTmplByXHR:d.unimpl,delegateUnbubble:d.unimpl,
undelegateUnbubble:d.unimpl,render:d.noop,locationChange:d.noop,receiveMessage:d.noop,init:d.noop,hasTemplate:!0,enableEvent:!0,enableRefreshAnim:!1,load:function(){var a=this,b=function(){a.suspend();e(a.render,[],a);a.delegateBubbleEvents();a.idle(function(){if(!a.rendered)a.delegateUnbubbleEvents(),a.rendered=!0;e(a.init,[],a);a.trigger("created",null,!0);var b=d.config().viewLoad;d.isFunction(b)&&e(b,{name:a.viewName,location:a.getLocation()})});a.trigger("ready",{tmpl:a.hasTemplate},!0);a.resume()};
a.hasTemplate?a.getTemplate(a.manage(function(c){a.template=c;b()})):b()},updateViewId:function(){this.id=o(this.vId)?this.vId:this.vfId},setNodeHTML:function(a){o(this.id).innerHTML=a},setViewHTML:function(a){if(this.exist){this.trigger("refresh",null,!0,!0);var b=d.config().viewChangeAnim&&this.rendered&&this.enableRefreshAnim;this.trigger("prerender",{anim:b});this.destroyManaged(!0);this.undelegateUnBubbleEvents();this.destroyFrames();var c=this.owner;b&&(e(c.oldViewDestroy,[],c),e(c.prepareNextView,
[],c),this.updateViewId());if(!this.rendered)this.$bakHTML=o(this.id).innerHTML;this.setNodeHTML(a);b&&e(c.newViewCreated,[],c);this.delegateUnbubbleEvents();this.rendered=!0;this.trigger("rendered")}},postMessageTo:function(a,b){this.idle(this.owner.postMessageTo,[a,b],this.owner)},idle:function(a,b,c){var i=this;i.iC?i.iQ.push([a,b,c]):i.ownerVOM.idle(function(){i.exist&&d.isFunction(a)&&e(a,b,c)})},getLocation:function(){return this.ownerVOM.$location},observeLocation:function(a,b){var c=arguments;
1==c.length&&(b=!1);if(c.length)this.$location={keys:d.isArray(a)?a:(""+a).split(","),pathname:b}},testObserveLocationChanged:function(a){var b=this.$location,a=a.changed;if(b){var c=!1;b.pathname&&(c=a.isPathnameChanged(b.pathname));if(!c)for(var b=b.keys,e=0;e<b.length;e++)if(a.isParamChanged(b[e])){c=!0;break}return c}return!0},destroyFrames:function(){for(var a=o(this.id).getElementsByTagName("iframe"),b,c;a.length;)b=a[0],c=b.parentNode,b.src="",c.removeChild(b);m.CollectGarbage&&m.CollectGarbage()},
destroy:function(a){this.trigger("refresh",null,!0,!0);this.trigger("destroy",null,!0,!0);this.destroyManaged();this.undelegateUnBubbleEvents();this.undelegateBubbleEvents();if(this.hasTemplate&&!a)this.destroyFrames(),o(this.vfId).innerHTML=this.$bakHTML||"";this.exist=!1;this.iQ=[];this.sign++},getTemplate:function(a){var b=this;if(b.template)a(b.template);else{var c=d.templates[b.viewName];if(c)a(c);else{var c=d.config(),e=c.appHome+b.viewName+".html";c.release||(e+="?_="+(new Date).getTime());
b.getTmplByXHR(e,function(c){a(d.templates[b.viewName]=c)})}}},processEvent:function(a){if(this.enableEvent&&this.exist){for(var b=a.target,c=b;1!=c.nodeType;)c=c.parentNode;for(var d="mx"+a.type,i=c.getAttribute(d),h=o(this.vfId);!i&&c!=h;)c=c.parentNode,i=c.getAttribute(d);if(i){var d=i.split(":"),i=d.shift(),h=d[d.length-1],f,c=g.idIt(c);if("_halt_"==h||"_stop_"==h)a.stopPropagation(),f=!0;if("_halt_"==h||"_prevent_"==h)a.preventDefault(),f=!0;f&&d.pop();f=this.events;for(var h=f[a.type],l=0,j;l<
d.length;l++)j=d[l].lastIndexOf("@"),-1<j&&(d[d[l].substring(j+1)]=d[l].substring(0,j));h[i]&&e(h[i],{view:this,currentId:c,targetId:g.idIt(b),domEvent:a,events:f,params:d},h)}}},fixedEvent:function(a){if(!a)a=m.event;if(a){if(!a.stopPropagation)a.stopPropagation=function(){a.cancelBubble=!0};if(!a.preventDefault)a.preventDefault=function(){a.returnValue=!1};if(a.srcElement&&!a.target)a.target=a.srcElement}return a},processDelegateEvents:function(a,b){var c=this;if(c.enableEvent){var e=c.events,d=
o(c.vfId);if(c.$bubbleList&&c.$unbubbleList)for(var e=a?c.$bubbleList:c.$unbubbleList,g=0;g<e.length;g++)a?d["on"+e[g]]=b?null:function(a){a=c.fixedEvent(a);c.processEvent(a)}:b?c.undelegateUnbubble(d,e[g]):c.delegateUnbubble(d,e[g]);else for(g in c.$bubbleList=[],c.$unbubbleList=[],e)i(e,g)&&(i(x,g)?(c.$unbubbleList.push(g),a||(b?c.undelegateUnbubble(d,g):c.delegateUnbubble(d,g))):(c.$bubbleList.push(g),a&&(d["on"+g]=b?null:function(a){a=c.fixedEvent(a);c.processEvent(a)})))}},delegateBubbleEvents:function(){this.processDelegateEvents(!0)},
delegateUnbubbleEvents:function(){this.processDelegateEvents()},undelegateUnBubbleEvents:function(){this.processDelegateEvents(!1,!0)},undelegateBubbleEvents:function(){this.processDelegateEvents(!0,!0)},manage:function(b,c){var e=!0;1==arguments.length&&(c=b,b="res_"+a++,e=!1);if(!this.$resCache)this.$resCache={};e={hasKey:e,res:c};d.isFunction(c)&&(c=this.wrapManagedFunction(c),e[this.sign]=c);this.$resCache[b]=e;return c},getManaged:function(a){var b=this.$resCache,c=this.sign;return b&&i(b,a)?
(a=b[a],b=a.res,d.isFunction(b)&&(a[c]||(a[c]=this.wrapManagedFunction(b)),b=a[c]),b):null},removeManaged:function(a){var b=this.$resCache;if(b)if(i(b,a))delete b[a];else for(var c in b)if(b[c].res===a){delete b[c];break}},destroyManaged:function(a){var b=this.$resCache;if(b){for(var c in b){var i=b[c],g=!1,h=i.res;if(d.isNumber(h))m.clearTimeout(h),m.clearInterval(h),g=!0;else if(h)for(var f=0;f<k.length;f++)d.isFunction(h[k[f]])&&(e(h[k[f]],[],h),g=!0);this.trigger("destroyResource",{resource:h,
processed:g});a&&!i.hasKey&&delete b[c]}a||(this.unbind("destroyResource"),delete this.$resCache)}},wrapManagedFunction:function(a){var b=this,c=b.sign;return function(){b.sign==c&&e(a,arguments,b)}},beginAsyncUpdate:function(){return this.sign++},signature:function(){return this.sign},endAsyncUpdate:function(){return this.sign},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var a=[].slice.call(this.iQ);for(this.iQ=[];a.length;)this.idle.apply(this,a.shift())}}});
d.mix(g,c,{prototype:!0});d.mix(g.prototype,c.prototype);return g},{requires:["magix/impl/view","magix/magix","magix/event"]});
KISSY.add("magix/vom",function(f,c,d){var b=document;return{iC:0,iQ:[],rootVframe:null,vframes:{},rootVframeId:"magix_vf_root",registerVframe:function(a){this.vframes[a.id]=a},getVframe:function(a){return this.vframes[a]},unregisterVframe:function(a){delete this.vframes[d.isString(a)?a:a.id]},buildRootVframe:function(){if(!this.rootVframe)b.getElementById(this.rootVframeId)||c.createVframeNode(this.rootVframeId,b.body.firstChild),this.rootVframe=c.createVframe(this.rootVframeId,{owner:this}),this.registerVframe(this.rootVframe)},
remountRootVframe:function(a){this.$location=a.location;this.buildRootVframe();this.rootVframe.mountView(a.location.viewPath)},notifyLocationChange:function(a){this.$location=a.location;this.rootVframe&&this.rootVframe.notifyLocationChange(a)},idle:function(a,b,c){this.iC?this.iQ.push([a,b,c]):d.safeExec(a,b,c)},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var a=this.iQ;if(a.length){a=[].slice.call(a);for(this.iQ=[];a.length;)this.idle.apply(this,a.shift())}}}}},
{requires:["magix/vframe","magix/magix"]});
KISSY.add("mxext/model",function(f,c){var d=function(b){b&&this.set(b);this.id=f.guid("m");this.hasLocker=this.locker=!1};c.mix(d,{GET:"GET",POST:"POST",extend:function(b,a){var e=function(){e.superclass.constructor.apply(this,arguments);a&&c.safeExec(a,[],this)};c.mix(e,this,{prototype:!0});return f.extend(e,this,b)}});c.mix(d.prototype,{urlMap:{},sync:c.noop,parse:c.noop,getPostParams:function(){return this.getParams("POST")},getParams:function(b){var b=b?b.toUpperCase():d.GET,b=this["$"+b],a=[],
c;if(b)for(var i in b)if(c=b[i],f.isArray(c))for(var h=0;h<c.length;h++)a.push(i+"="+encodeURIComponent(c[h]));else a.push(i+"="+encodeURIComponent(c));return a.join("&")},setParamsIf:function(b,a){this.setParams(b,a,d.GET,!0)},setParams:function(b,a,c,i){c=c?c.toUpperCase():d.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[c]=!0;c="$"+c;this[c]||(this[c]={});if(f.isObject(b))for(var h in b){if(!i||!this[c][h])this[c][h]=b[h]}else if(b&&a&&(!i||!this[c][b]))this[c][b]=a},setPostParams:function(b,
a){this.setParams(b,a,d.POST)},setPostParamsIf:function(b,a){this.setParams(b,a,d.POST,!0)},reset:function(){var b=this.$keysCache;if(b){for(var a in b)c.hasProp(b,a)&&delete this["$"+a];delete this.$keysCache}b=this.$keys;a=this.$attrs;if(b){for(var e=0;e<b.length;e++)delete a[b[e]];delete this.$keys}},url:function(){var b=this.get("uri"),a;if(b){a=b.split(":");var c=this.urlMap;if(c)for(var d=0;d<a.length&&!(c=c[a[d]],void 0===c);d++)d==a.length-1&&(b=c)}else throw Error("model not set uri");return b},
get:function(b){var a=this.$attrs;return a?a[b]:null},set:function(b,a,c){if(!this.$attrs)this.$attrs={};if(c&&!this.$keys)this.$keys=[];if(f.isObject(b))for(var d in b)c&&this.$keys.push(d),this.$attrs[d]=b[d];else b&&(c&&this.$keys.push(b),this.$attrs[b]=a)},load:function(b){this.request(b)},save:function(b){this.request(b)},request:function(b){b||(b={});var a=b.success,c=b.error,d=this;if(!d.hasLocker||!d.locker)d.$abort=!1,d.locker=d.hasLocker,b.success=function(b){d.locker=!1;if(!d.$abort){if(b){var c=
d.parse(b);c&&(f.isArray(c)&&(c={list:c}),d.set(c,null,!0))}a&&a.apply(this,arguments)}},b.error=function(){d.locker=!1;d.$abort||c&&c.apply(this,arguments)},d.$trans=d.sync(d,b)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=f.clone(this.$attrs)},rollbackTransaction:function(){var b=this.$bakAttrs;if(b)this.$attrs=b,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(b){this.hasLocker=
!!b}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(f,c){var d=function(a){this.$modelClass=a},b=function(a){if(a._wraped_)return a;var b=function(b){var e=b.success,d=this;d.get("updateIdent")?(b.success=function(){d.set("updateIdent",!1);d._after&&c.safeExec(d._after,d);e&&e.apply(b)},a.call(d,b)):e&&e.apply(b)};b._wraped_=!0;return b};c.mix(d,{mClsCache:{},create:function(a,b){if(!b)throw Error("Factory.create modelClass ungiven");var c=this.mClsCache;a||(a=f.guid());c[a]||(c[a]=new d(b));return c[a]}});c.mix(d.prototype,
{registerModels:function(a){c.isArray(a)||(a=[a]);for(var b=0,d;b<a.length;b++){d=a[b];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},fetchModels:function(a,b,d,h){var g=this;if(!g.$modelsCache)g.$modelsCache={};if(!g.$modelsCacheKeys)g.$modelsCacheKeys={};var f=g.$modelsCache,j=g.$modelsCacheKeys;c.isArray(a)||(a=[a]);for(var n=a.length,p=0,s,q=[],w=[],u,t=function(a,k,r,m){p++;if(k)s=m||"fetch data error";else{u=!0;r.set("updateIdent",!1);q[a]=r;if((a=r._cacheKey)&&!c.hasProp(f,
a))f[r._cacheKey]=r,r._after&&c.safeExec(r._after,r);4==h&&b(r)}if((a=r._cacheKey)&&c.hasProp(j,a)){var o=j[a];delete j[a];c.safeExec(o,[k,r,m],r)}4!=h&&p>=n&&(2==h?u?b&&b.apply(g,q):d&&d(s):s?d&&d(s):b&&b.apply(g,q))},x=Array.prototype.slice,v=function(a,b){var c=x.call(arguments,2);return function(){return a.apply(b,c.concat(x.call(arguments)))}},m=0,k;m<a.length;m++){k=a[m];var o=k.cacheKey;o&&c.hasProp(j,o)?j[o].push(v(t,g,m)):(k=g.create(k,!0),k.get("updateIdent")?(w.push(k),o&&(j[o]=[]),k.request({success:v(t,
k,m,!1,k),error:v(t,k,m,!0,k)})):t(m,!1,k))}return{abort:function(){for(var a=0,b;a<w.length;a++){b=w[a];var d=b._cacheKey;if(d&&c.hasProp(j,d)){var e=j[d];delete j[d];c.safeExec(e,[!0,b,"abort"],b)}b.abort()}}}},fetchAll:function(a,b,c){return this.fetchModels(a,b,c,1)},fetchAny:function(a,b,c){return this.fetchModels(a,b,c,2)},fetchOne:function(a,b){return this.fetchModels(a,b,c.noop,4)},getIf:function(a){var b=this.$modelsCache;return b&&c.hasProp(b,a)?b[a]:null},setUpdateIdent:function(a){(a=
this.getIf(a))&&a.set("updateIdent",!0)},create:function(a,d){if(!a.type)throw Error('model must own a "type" attribute');var i=a.type,h=a.cacheKey||i.cacheKey,g;if(!this.$modelsCache)this.$modelsCache={};var f=this.$modelsCache;if(h&&c.hasProp(f,h)){g=f[h];var j=g.get("updateIdent");j&&delete f[h]}else g=new this.$modelClass(i.ops),g._after=i.after,g._cacheKey=h,g.set("updateIdent",!0);if(j=g.get("updateIdent"))g.reset(),g.set(a.ops),g.setParams(i.gets),g.setPostParams(i.posts),g.setParams(a.gets),
g.setPostParams(a.posts),c.isFunction(i.before)&&c.safeExec(i.before,g,i);if(!d)g.request=b(g.request);return g}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/mu",function(f,c){function d(a,c){var d=/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/i,e=a.match(/\{{2,3}[\^#]?if\((.*?)\)\}{2,3}?/ig),f=[];if(e)for(var n=0;n<e.length;n++)f.push(e[n].match(d)[1]);d="";for(e=0;e<f.length;e++)d="if("+f[e]+")",c[d]||(c[d]=b(f[e]))}function b(a){a=a.split("==");return function(){for(var b=a[0].split("."),c=a[1],d=b.length-1;-1<d;d--){var e=b.slice(d),f=this;try{for(var p=0;p<e.length-1;p++)f=f[e[p]];if(e[e.length-1]in f){if(f[e[e.length-1]].toString()===c)return!0;
break}}catch(s){}}return!1}}function a(b,c){var d,e;for(d in b)if(e=b[d],e instanceof Array)for(var f=0;f<e.length;f++){var n=e[f];if("object"==typeof n)0===f?n.__first__=!0:f==e.length-1?n.__last__=!0:n.__mid__=!0,n.__index__=f}else"object"==typeof e&&5>c&&a(e,c+1)}var e=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi;return{to_html:function(b,f){"object"==typeof f&&a(f,0);var g=b.match(e);if(g){b=b.replace(e,function(){return'<script type="text/tmpl"><\/script>'});
d(b,f);var b=c.to_html.apply(this,arguments),l=0,b=b.replace(e,function(){return g[l++]})}else d(b,f),b=c.to_html.apply(this,arguments);return b}}},{requires:["mxext/mustache"]});
KISSY.add("mxext/mustache",function(){return function(){var f=function(){};f.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":!0},context:{},render:function(c,d,b,a){if(!a)this.context=d,this.buffer=[];if(this.includes("",c)){c=this.render_pragmas(c);c=this.render_section(c,d,b);if(a)return this.render_tags(c,d,b,a);this.render_tags(c,d,b,a)}else{if(a)return c;this.send(c)}},send:function(c){""!=c&&this.buffer.push(c)},render_pragmas:function(c){if(!this.includes("%",
c))return c;var d=this;return c.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(b,a,c){if(!d.pragmas_implemented[a])throw{message:"This implementation of mustache doesn't understand the '"+a+"' pragma"};d.pragmas[a]={};c&&(b=c.split("="),d.pragmas[a][b[0]]=b[1]);return""})},render_partial:function(c,d,b){c=this.trim(c);if(!b||void 0===b[c])throw{message:"unknown_partial '"+c+"'"};return"object"!=typeof d[c]?this.render(b[c],d,b,!0):this.render(b[c],d[c],b,!0)},render_section:function(c,
d,b){if(!this.includes("#",c)&&!this.includes("^",c))return c;var a=this;return c.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(c,f,h,g){c=a.find(h,d);if("^"==f)return!c||a.is_array(c)&&0===c.length?a.render(g,d,b,!0):"";if("#"==f)return a.is_array(c)?a.map(c,function(c){return a.render(g,a.create_context(c),b,!0)}).join(""):a.is_object(c)?a.render(g,a.create_context(c),b,!0):"function"===typeof c?c.call(d,g,
function(c){return a.render(c,d,b,!0)}):c?a.render(g,d,b,!0):""})},render_tags:function(c,d,b,a){for(var e=this,f=function(){return RegExp(e.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+e.ctag+"+","g")},h=f(),g=function(a,c,g){switch(c){case "!":return"";case "=":return e.set_delimiters(g),h=f(),"";case ">":return e.render_partial(g,d,b);case "{":return e.find(g,d);default:return e.escape(e.find(g,d))}},c=c.split("\n"),l=0;l<c.length;l++)c[l]=c[l].replace(h,g,this),a||this.send(c[l]);if(a)return c.join("\n")},
set_delimiters:function(c){c=c.split(" ");this.otag=this.escape_regex(c[0]);this.ctag=this.escape_regex(c[1])},escape_regex:function(c){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return c.replace(arguments.callee.sRE,"\\$1")},find:function(c,d){var c=this.trim(c),b;!1===d[c]||0===d[c]||d[c]?b=d[c]:(!1===this.context[c]||0===this.context[c]||this.context[c])&&(b=this.context[c]);return"function"===typeof b?b.apply(d):void 0!==
b?b:""},includes:function(c,d){return-1!=d.indexOf(this.otag+c)},escape:function(c){return(""+(null===c?"":c)).replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(c){if(this.is_object(c))return c;var d=".";if(this.pragmas["IMPLICIT-ITERATOR"])d=this.pragmas["IMPLICIT-ITERATOR"].iterator;var b={};b[d]=c;return b},is_object:function(c){return c&&
"object"==typeof c},is_array:function(c){return"[object Array]"===Object.prototype.toString.call(c)},trim:function(c){return c.replace(/^\s*|\s*$/g,"")},map:function(c,d){if("function"==typeof c.map)return c.map(d);for(var b=[],a=c.length,e=0;e<a;e++)b.push(d(c[e]));return b}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(c,d,b,a){var e=new f;if(a)e.send=a;e.render(c,d,b);if(!a)return e.buffer.join("\n")}}}()});
KISSY.add("mxext/tmpl",function(){var f={},c={},d="_"+(new Date).getTime(),b=/\s*<script[^>]+type\s*=\s*(['"])\s*text\/tmpl\1[^>]*>([\s\S]*?)<\/script>\s*/gi,a=function(a,b){if(a){var h;h=c[a];h||(h=d+".push('"+a.replace(/\s+/g," ").replace(/<#/g,"\r").replace(/;*#>/g,"\n").replace(/\\(?=[^\r\n]*\n)/g,"\t").replace(/\\/g,"\\\\").replace(/\t/g,"\\").replace(/'(?=[^\r\n]*\n)/g,"\t").replace(/'/g,"\\'").replace(/\t/g,"'").replace(/\r=([^\n]+)\n/g,"',$1,'").replace(/\r/g,"');").replace(/\n/g,";"+d+".push('")+
"');return "+d+".join('')",c[a]=h);var g=[d],l=[[]],j;if(b)for(j in b)g.push(j.replace(/[:+\-*\/&^%#@!~]/g,"$")),l.push(b[j]);j=g.join("_")+"_"+h;if(!f[j])try{f[j]=new Function(g,h)}catch(n){return n.message}try{h=f[j].apply(b,l)}catch(p){h=p.message}return h}return a};return{toHTML:function(c,d){var f=c.match(b);if(f)var c=c.replace(b,function(){return'<script type="text/tmpl"><\/script>'}),c=a(c,d),g=0,c=c.replace(b,function(){return f[g++]});else c=a(c,d);return c}}});
KISSY.add("mxext/vfanim",function(f,c,d){var b=d.config(),a=document,e=b.viewChange,i=d.isFunction(e),h=function(b){return"object"==typeof b?b:a.getElementById(b)};return d.mix(c.prototype,{viewChangeUseAnim:function(){return b.viewChangeAnim},oldViewDestroy:function(){var b=h(this.id),c=h(this.viewId),e=this.view;if(!c){for(c=a.createElement("div");b.firstChild;)c.appendChild(b.firstChild);b.appendChild(c)}c.id="";if(b=e.events)for(var i in b)d.hasProp(b,i)&&f.all("*[mx"+i+"]").removeAttr("mx"+i);
if(!d.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=c},prepareNextView:function(){var b=h(this.id),c=a.createElement("div");c.id=this.viewId;b.insertBefore(c,b.firstChild)},newViewCreated:function(a){var b=this,c=b.$oldViewNode,f=h(b.viewId);i&&d.safeExec(e,{vframeId:b.id,action:a?"viewChange":"viewRefresh",oldViewNode:c,newViewNode:f,collectGarbage:function(){b.$animCounter--;b.$animCounter||delete b.$oldViewNode;try{c.parentNode.removeChild(c)}catch(a){}}},
b)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(f,c,d){return c.extend({queryEvents:null,navigate:function(b){d.navigate(b)},attachQueryEvents:function(){var b=this,a=b.queryEvents;if(a){b.$queryEventsCache={};for(var d in a){var i=a[d],h;for(h in i)f.all("#"+b.id+" "+h).on(d,b.$queryEventsCache[d+"_"+h]=function(d){return function(e){var f=c.idIt(e.target),h=c.idIt(e.currentTarget);Magix.safeExec(d,{view:b,targetId:f,currentId:h,queryEvents:a,domEvent:e},a)}}(i[h]))}}},detachQueryEvents:function(){var b=this.queryEvents;
if(b){for(var a in b){var c=b[a],d;for(d in c)f.all("#"+this.id+" "+d).detach(a,this.$queryEventsCache[a+"_"+d])}delete this.$queryEventsCache}},setData:function(b){this.data=b;for(var a in b)b[a]&&b[a].toJSON&&(b[a]=b[a].toJSON());this.setRenderer()},setRenderer:function(){var b=this,a=this.renderer,c,d;if(a)for(c in a)for(d in a[c])(function(){var f=c,g=d,l=a[f][g];b.data[f+"_"+g]=function(){return l.call(this,b,f)}})()}},function(){var b=this;b.bind("created",function(){b.attachQueryEvents();b.bind("prerender",
function(){b.detachQueryEvents()});b.bind("rendered",function(){b.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});(function(f){var c=function(){};if(!f.console)f.console={log:c,warn:c,error:c,debug:c};if(!f.Magix)f.Magix={start:function(c){this.$tempCfg=c}},KISSY.use("magix/magix",function(c,b){var a=f.Magix.$tempCfg;f.Magix=b;a&&b.start(a)})})(this);