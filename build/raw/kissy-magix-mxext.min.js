KISSY.add("magix/event",function(h,e){var d=e.safeExec;return{trigger:function(a,b,c,g){var n="~~"+a+"_list",f=this[n];if(f){b||(b={});if(!b.type)b.type=a;if(g)for(a=f.length-1;0<=a&&!(!1===d(f[a],b,this));a--);else{a=0;for(g=f.length;a<g&&!(!1===d(f[a],b,this));a++);}}c&&delete this[n]},bind:function(a,b){var c="~~"+a+"_list";this[c]||(this[c]=[]);this[c].push(b)},unbind:function(a,b){var c="~~"+a+"_list",g=this[c];if(g)if(b)for(var c=0,d=g.length;c<d;c++){if(g[c]==b){g.splice(c,1);break}}else delete this[c]}}},
{requires:["magix/magix"]});
KISSY.add("magix/impl/magix",function(h){return{libRequire:function(e,d){h.use(e,function(a,b){d(b)})},libEnv:function(){var e=this.config(),d=e.appHome;if(!d)throw Error("please set appHome");d=d.replace(/(^|\/)app\/?/i,function(b,a){return a||"./"});e.appHome=d;if(!e.release&&/^https?:\/\//.test(d))e.release=-1==d.indexOf(location.protocol+"//"+location.host);e.release||h.config({map:[[RegExp("("+d+".+)-min\\.js(\\?[^?]+)?"),"$1.js$2"]]});var a="";(a=e.release?e.appTag:h.now())&&(a+=".js");h.config({packages:[{name:"app",
path:d,tag:a}]});e.viewChangeAnim&&h.use("mxext/vfanim")},isArray:h.isArray,isFunction:h.isFunction,isObject:h.isObject,isRegExp:h.isRegExp,isString:h.isString,isNumber:h.isNumber}});
KISSY.add("magix/impl/router",function(h){return{useHistoryState:function(){var e=this,d=location.href;h.one(window).on("popstate",function(){var a=location.href==d;if(e.$canFirePopState||!a)e.$canFirePopState=!0,e.route()})},useLocationHash:function(){var e=this;h.one(window).on("hashchange",function(){e.suspend();e.route();e.resume()})}}});
KISSY.add("magix/impl/view",function(h,e,d,a){var d=function(){},b={idIt:1,wrapAsyncUpdate:1,registerAsyncUpdateName:1,extend:1};d.extend=function(c,g){var d=function(){d.superclass.constructor.apply(this,arguments);g&&a.safeExec(g,[],this)},f;for(f in this)a.hasProp(b,f)&&(d[f]=this[f]);return h.extend(d,this,c)};a.mix(d.prototype,{getTmplByXHR:function(b,a){e({url:b,dataType:"html",success:function(b){a(b)},error:function(b,c){a(c)}})},delegateUnbubble:function(b,a){var d=this;if(!d.$cacheEvents)d.$cacheEvents=
{};b=h.one(b);b.delegate(a,"*[mx"+a+"]",d.$cacheEvents[a]=function(b){d.processEvent(b)})},undelegateUnbubble:function(b,a){var d=this.$cacheEvents;d&&(b=h.one(b),b.undelegate(a,"*[mx"+a+"]",d[a]),delete d[a])}});return d},{requires:["ajax","sizzle","magix/magix"]});
KISSY.add("magix/magix",function(h,e){var d=function(b,a){return!b?!1:Object.prototype.hasOwnProperty.call(b,a)},a=function(b,a,c){for(var j in a)if(d(a,j)&&(!c||!d(c,j)))b[j]=a[j];return b},b=function(b,a,d,j,l,e){c.isArray(b)||(b=[b]);if(!a||!c.isArray(a)&&!a.callee)a=[a];for(j=0;j<b.length;j++)try{e=b[j],l=c.isFunction(e)&&e.apply(d,a)}catch(t){h.log(t,e)}return l},c={mix:a,hasProp:d,safeExec:b,noop:function(){},templates:{},cfg:{},locals:{},config:function(b){var c=this.cfg;if(b)this.cfg=a(c,
b);return this.cfg},start:function(a){var c=this,a=c.config(a);c.libEnv();a.ready&&(b(a.ready),delete a.ready);c.libRequire("magix/router",function(b){c.libRequire("magix/vom",function(a){b.bind("locationChanged",function(b){b.changed.isViewPath()?a.remountRootVframe(b):a.notifyLocationChange(b)});b.bind("idle",function(){a.resume()});b.bind("busy",function(){a.suspend()});b.start()})})},objectKeys:function(b){if(Object.keys)return Object.keys(b);var a=[],c;for(c in b)d(b,c)&&a.push(c);return a},
local:function(b,a){var c=arguments,j=this.locals;if(0==c.length)return j;if(1==c.length)if(this.isObject(b))for(var l in b)d(b,l)&&(j[l]=b[l]);else return j[b];else j[b]=a}};return c.mix(c,e)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(h,e,d,a){var b=d.hasProp,c=function(a){return b(this.params,a)},g=function(){return b(this,k)},n=function(){return b(this,"viewPath")},f=function(){return this.hash[k]!=this.query[k]},j=function(b){return this.hash.params[b]!=this.query.params[b]},l=function(a){return b(this.hash.params,a)},s=function(a){return b(this.query.params,a)},t=function(b){return this.params[b]},u=d.safeExec,p=window,o=encodeURIComponent,v=decodeURIComponent,w=/\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,
z=/[^\/]*$/,x=/([#?]).*$/,q=/([^=&?\/#]+)=([^&=#?]*)/g,k="pathname",h=d.mix({iQ:[],iC:0,qH:{},compareObject:function(b,m){if(d.isObject(b)&&d.isObject(m)){for(var a=[],a=a.concat(d.objectKeys(b)),a=a.concat(d.objectKeys(m)),i=0;i<a.length;i++){var c=a[i];if(b[c]!=m[c])return!1}return!0}return b==m},getPathnameRelations:function(){if(this.$pnr)return this.$pnr;var a={virtualToReal:{},virtualRegExpToReal:{}},m=d.config().pathCfg,c=m.map,i=m.defaultView,g=m.defaultPathname||"";if(d.isObject(c))for(var j in c)if(b(c,
j))for(var l=j,f=c[j],e=[],e=d.isArray(f)?f:d.isString(f)?f.split(","):[f],f=0;f<e.length;f++)d.isRegExp(e[f])?a.virtualRegExpToReal[l]=e[f]:(!g&&l==i&&(g=e[f]),a.virtualToReal[e[f]]=l);if(!i)throw Error("unset defaultView");a.virtualToReal[""]=i;a.home=i;a[k]=g;a.notFound=m.notFound;return this.$pnr=a},getViewPath:function(b){var a=this.getPathnameRelations();b||(b=a[k]);var c=a.virtualToReal[b];if(!c)for(var i in a.virtualRegExpToReal)if(a.virtualRegExpToReal[i].test(b)){c=i;break}return{viewPath:c?
c:a.notFound||a.home,pathname:c?b:a.notFound?b:a[k]}},start:function(){this.supportHistoryState()?this.useHistoryState():this.useLocationHash();this.route()},supportHistoryState:function(){var b=p.history;return d.config().useHistoryState&&b.pushState&&b.replaceState},pathToObject:function(b){var a={},c={},i=p.location.protocol,f="";x.test(b)?f=b.replace(x,""):~b.indexOf("=")||(f=b);if(f)if(0==f.indexOf(i))i=f.indexOf("/",i.length+2),f=-1==i?"/":f.substring(i);else if("/"!=f.charAt(0)&&d.config().useHistoryState&&
!this.supportHistoryState()){i=p.location[k].replace(z,"");for(i+=f;w.test(i);)i=i.replace(w,"$1/");f=i}b.replace(q,function(b,a,m){c[a]=m});a[k]=f;a.params=c;return a},objectToPath:function(a){var m=a[k],c=[],i;for(i in a.params)b(a.params,i)&&c.push(i+"="+a.params[i]);return m+(c.length?"?":"")+c.join("&")},parseQueryAndHash:function(){var a=p.location.href,m=this.qH;try{a=v(a)}catch(c){}if(b(m,a))return m[a];var i=a.replace(/^[^?#]+/g,""),g=p.location[k]+i.replace(/^([^#]+).*$/g,"$1"),i=i.replace(/^[^#]*#?/g,
""),e=this.pathToObject(g),h=this.pathToObject(i.replace(/^!?/,"")),n={};d.mix(n,e.params);d.mix(n,h.params);return m[a]={isPathnameDiff:f,isParamDiff:j,hashParamsOwn:l,queryParamsOwn:s,get:t,originalQuery:g,originalHash:i,query:e,hash:h,params:n}},parseLocation:function(){var b=this.parseQueryAndHash(),a=this.getViewPath(d.config().useHistoryState?b.hash[k]?b.hash[k]:b.query[k]:b.hash[k]);return d.mix(b,a)},getChangedLocation:function(b,a){var y={params:{}};b[k]!=a[k]&&(y[k]=!0);if(b.viewPath!=a.viewPath)y.viewPath=
!0;for(var i=d.objectKeys(b.params),i=i.concat(d.objectKeys(a.params)),f=0;f<i.length;f++){var j=i[f];b.params[j]!=a.params[j]&&(y.params[j]=!0)}y.isParam=c;y.isPathname=g;y.isViewPath=n;return y},route:function(){var b=this.parseLocation(),a=this.$location||{params:{}},c=!this.$location,i;b.viewPath==(a.viewPath||"")?this.compareLocation(a,b)||(i=!0):i=!0;i&&(a=this.getChangedLocation(a,b),this.trigger("locationChanged",{location:b,changed:a,firstFire:c}));this.$location=b;this.resume()},compareLocation:function(b,
a){return b[k]!=a[k]?!1:this.compareObject(b.params,a.params)},navigate2:function(a){var m=this;a&&d.isString(a)&&m.idle(function(){m.trigger("busy");m.suspend();var c=m.pathToObject(a),i=d.mix({},m.$location.params),i=d.mix(i,c.params);if(c[k]){if(d.config().useHistoryState&&!m.supportHistoryState()&&(i=m.$location.query)&&(i=i.params))for(var f in i)b(i,f)&&!b(c.params,f)&&(c.params[f]="")}else c.params=i,c[k]=m.$location[k];m.compareLocation(c,m.$location)?m.resume():(c=m.objectToPath(c),m.supportHistoryState()?
(m.$canFirePopState=!0,history.pushState(new Date,document.title,c),m.route()):location.hash="#!"+c)})},navigate:function(b,a){if(d.isObject(b)){var c=[],i;for(i in b)c.push(i+"="+o(b[i]));b=c.join("&");a&&(b=a+"?"+b)}this.navigate2(b)},idle:function(b){this.iC?this.iQ.push(b):u(b)},suspend:function(){this.iC++},resume:function(){0<this.iC&&(this.iC--,this.iC||(this.trigger("idle"),this.iQ.length&&this.idle(this.iQ.shift())))}},a);return d.mix(h,e)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(h,e,d){var a=document,b=0,c=e.safeExec,g=function(b){return"object"==typeof b?b:a.getElementById(b)},n=function(b){this.rC=0;this.rM={};this.notifyParentAlter();var a=this.view;c(a.trigger,"childrenAlter",a);this.unloadSubVframes(b)},f=function(b){this.id=f.idIt(b);this.viewId=this.id+"_view";this.children=[];this.view=null;this.rC=0;this.rM={}};e.mix(f,{tagName:"vframe",idIt:function(a){return a.id||(a.id="magix_vf_"+b++)},createVframe:function(b,a){var b=g(b),c=
new f(b);e.mix(c,a);return c},createVframeNode:function(b,c){var d=a.createElement(f.tagName);d.id=b;c.parentNode.insertBefore(d,c)}});a.createElement(f.tagName);e.mix(f.prototype,d);e.mix(f.prototype,{viewChangeUseAnim:function(){return!1},oldViewDestroy:e.noop,prepareNextView:e.noop,newViewCreated:e.noop,mountView:function(b){var a=this,c=a.viewName&&a.viewChangeUseAnim();a.unmountView(c,!0);if(b)a.viewName=b,e.libRequire(b,function(d){if(b==a.viewName){d.wrapAsyncUpdate();var f;c?(f=a.viewId,a.prepareNextView()):
f=a.id;var g=new d({viewName:b,owner:a,ownerVOM:a.owner,id:f,vId:a.viewId,vfId:a.id});g.bind("interact",function(b){a.trigger("viewLoad",{view:g},a.vced=!0);c&&a.newViewCreated(!0);b.tmpl||a.loadSubVframes();g.bind("rendered",function(){a.loadSubVframes()});g.bind("prerender",function(b){n.call(a,b.anim)})});a.view=g;g.load()}})},unmountView:function(b,a){this.view?(n.call(this,b),this.view.destroy(b),this.vced=!1,b&&a&&this.oldViewDestroy(),delete this.view,delete this.viewName):this.viewName&&(this.unbind("viewLoad"),
delete this.viewName)},loadSubVframes:function(){this.owner.suspend();var b=(g(this.viewId)||g(this.id)).getElementsByTagName(f.tagName),a=b.length;if(a)for(var c=0,d;c<a;c++)d=b[c],d=f.createVframe(d,{owner:this.owner,parentId:this.id}),this.children.push(d.id),this.owner.registerVframe(d),d.mountView(b[c].getAttribute("data-view"));else this.notifyChildrenCreated();this.owner.resume()},unloadSubVframes:function(b){for(var a=this.children,c,d=0,f=a.length,e;d<f;d++)e=a[d],c=this.owner.getVframe(e),
c.unmountView(b),this.owner.unregisterVframe(c),g(e).id="";this.children=[]},postMessageTo:function(b,a){var d=this.owner;e.isArray(b)||(b=[b]);a||(a={});for(var f=0;f<b.length;f++){var g=d.getVframe(b[f]);if(g){var h=g.view;h&&g.vced?c(h.receiveMessage,a,h):g.viewName&&g.bind("viewLoad",function(b){c(b.view.receiveMessage,a,b.view)})}}},notifyLocationChange:function(b){var a=this.view;if(a&&a.exist&&a.rendered){if(c(a.testOLChanged,b,a))var d=c(a.locationChange,b,a);if(!1!==d){if(!e.isArray(d))d=
this.children;for(var a=0,f=d.length,g;a<f;a++)(g=this.owner.getVframe(d[a]))&&c(g.notifyLocationChange,b,g)}}},notifyChildrenCreated:function(){var b=this.view;b&&c(b.trigger,"childrenCreated",b);this.notifyParentAlter(!0)},notifyParentAlter:function(b){var a=this.parentId;if(a)if(a=this.owner.getVframe(a),b)e.hasProp(a.rM,this.id)||(a.rM[this.id]=1,a.rC++,a.rC==a.children.length&&a.notifyChildrenCreated());else if(e.hasProp(a.rM,this.id))delete a.rM[this.id],a.rC--,b=a.view,c(b.trigger,"childrenAlter",
b),a.notifyParentAlter()}});return f},{requires:["magix/magix","magix/event"]});
KISSY.add("magix/view",function(h,e,d,a){var b=1,c=d.safeExec,g=d.hasProp,n="render,renderUI,updateUI".split(","),f=function(b){d.mix(this,b);this.exist=!0;this.iQ=[];this.sign=this.iC=0},j=f.prototype,l=function(b,a){return function(){var c=this,d=arguments;c.idle(function(){a&&c.sign++;b.apply(c,d)})}},s=/(?:^|\s)return(?:(?:\s+[+\-\w$'"{\[\(\/])|[+\-{\[\(\/'"])/,t=/{([\s\S]+)}/,u=/\\[\s\S]/g,p=/\s*\/\s*/g,o=/^[\s\xa0\u3000\uFEFF]*$/,v=[/[^\w$_]\/[\s\S]*?\//,/(?:'[^']*')|(?:"[^"]*")/,/{[^{}]+}/],
w=function(b){if(b=(""+b).match(t)){b=b[1];if(o.test(b))return!0;for(var b=b.replace(u,"").replace(p,""),a=0,c;a<v.length;a++)for(c=v[a];c.test(b);)b=b.replace(c,"");return s.test(b)}return!1};d.mix(f,{idIt:function(a){return a.id||(a.id="magix_mxe_"+b++)},wrapAsyncUpdate:function(){if(!this["~~"]){this["~~"]=1;var b=this.prototype,a;this.registerAsyncUpdateName();for(var c in b){a=b[c];var f=null;d.isFunction(a)&&a!=d.noop&&!a["~~"]&&!w(a)&&(g(this.$ans,c)?f=l(a,!0):g(b,c)&&!g(j,c)&&(f=l(a)),f&&
(f["~~"]=a,b[c]=f))}}},registerAsyncUpdateName:function(b){if(!this.$ans){this.$ans={};for(var a=0;a<n.length;a++)this.$ans[n[a]]=!0}if(b){d.isArray(b)||(b=[b]);for(a=0;a<b.length;a++)this.$ans[b[a]]=!0}return this}});var z={submit:1,blur:1,focus:1,focusin:1,focusout:1,mouseenter:1,mouseleave:1,mousewheel:1,valuechange:1},h=f.prototype,x=document,q=window,k="abort,stop,cancel,destroy,dispose".split(","),r=function(b){return"object"==typeof b?b:x.getElementById(b)};d.mix(h,a);d.mix(h,{render:d.noop,
locationChange:d.noop,receiveMessage:d.noop,init:d.noop,hasTemplate:!0,enableEvent:!0,enableRefreshAnim:!1,load:function(){var b=this,a=b.hasTemplate,d=function(){b.suspend();c(b.render,[],b);b.delegateBubbleEvents();b.idle(function(){var d=!a&&!b.rendered;if(d)b.delegateUnbubbleEvents(),b.rendered=!0;c(b.init,[],b);d&&b.trigger("created",null,!0)});b.trigger("interact",{tmpl:a},!0);b.resume()};a?b.getTemplate(b.manage(function(a){b.template=a;d()})):d()},updateViewId:function(){this.id=r(this.vId)?
this.vId:this.vfId},setNodeHTML:function(b){r(this.id).innerHTML=b},setViewHTML:function(b){if(this.exist){var a=this.rendered;if(a){var i=d.config().viewChangeAnim&&this.enableRefreshAnim;this.trigger("refresh",null,!0,!0);this.trigger("prerender",{anim:i});this.destroyManaged(!0);this.undelegateUnBubbleEvents();this.destroyFrames();var f=this.owner;i&&(c(f.oldViewDestroy,[],f),c(f.prepareNextView,[],f),this.updateViewId())}else this.$bakHTML=r(this.id).innerHTML;this.setNodeHTML(b);i&&c(f.newViewCreated,
[],f);this.delegateUnbubbleEvents();this.rendered=!0;this.trigger("rendered");a||this.trigger("created",null,!0)}},postMessageTo:function(b,a){this.idle(this.owner.postMessageTo,[b,a],this.owner)},idle:function(b,a,f){var g=this;g.iC?g.iQ.push([b,a,f]):g.ownerVOM.idle(function(){g.exist&&d.isFunction(b)&&c(b,a,f)})},getLocation:function(){return this.ownerVOM.$location},observeLocation:function(b,a){var c=arguments;1==c.length&&(a=!1);if(c.length)this.$location={keys:d.isArray(b)?b:(""+b).split(","),
pn:a}},testOLChanged:function(b){var a=this.$location,b=b.changed;if(a){var c=!1;a.pn&&(c=b.isPathname());if(!c)for(var a=a.keys,d=0;d<a.length;d++)if(b.isParam(a[d])){c=!0;break}return c}return!0},destroyFrames:function(){for(var b=r(this.id).getElementsByTagName("iframe"),a,c;b.length;)a=b[0],c=a.parentNode,a.src="",c.removeChild(a);q.CollectGarbage&&q.CollectGarbage()},destroy:function(b){this.trigger("refresh",null,!0,!0);this.trigger("destroy",null,!0,!0);this.destroyManaged();this.undelegateUnBubbleEvents();
this.undelegateBubbleEvents();if(this.hasTemplate&&!b)this.destroyFrames(),r(this.vfId).innerHTML=this.$bakHTML||"";this.exist=!1;this.iQ=[];this.sign++},getTemplate:function(b){var a=this;if(a.template)b(a.template);else{var c=d.templates[a.viewName];if(c)b(c);else{var c=d.config(),f=c.appHome+a.viewName+".html";c.release||(f+="?_="+(new Date).getTime()+".html");a.getTmplByXHR(f,function(c){b(d.templates[a.viewName]=c)})}}},processEvent:function(b){if(this.enableEvent&&this.exist){for(var a=b.target;a&&
1!=a.nodeType;)a=a.parentNode;for(var d=a,g="mx"+b.type,e,h=r(this.vfId);d&&d!=h&&!(e=d.getAttribute(g));)d=d.parentNode;if(e)if(g=d.getAttribute("data-handler"))~[",",g,","].join().indexOf(","+this.vfId+",")||(e=0);else{for(g=d;g&&g!=h;)if("VFRAME"==g.tagName.toUpperCase()){d.setAttribute("data-handler",g.id);e=0;break}else g=g.parentNode;e&&d.setAttribute("data-handler",this.vfId)}if(e){e=e.split(":");var h=e.shift(),g=e[e.length-1],j,d=f.idIt(d);if("_halt_"==g||"_stop_"==g)b.stopPropagation(),
j=!0;if("_halt_"==g||"_prevent_"==g)b.preventDefault(),j=!0;j&&e.pop();j=this.events;for(var g=j[b.type],n=0,l;n<e.length;n++)l=e[n].lastIndexOf("@"),-1<l&&(e[e[n].substring(l+1)]=e[n].substring(0,l));g[h]&&c(g[h],{view:this,currentId:d,targetId:f.idIt(a),domEvent:b,events:j,params:e},g)}}},fixedEvent:function(b){if(!b)b=q.event;if(b){if(!b.stopPropagation)b.stopPropagation=function(){b.cancelBubble=!0};if(!b.preventDefault)b.preventDefault=function(){b.returnValue=!1};if(b.srcElement&&!b.target)b.target=
b.srcElement}return b},processDelegateEvents:function(b,a){var c=this;if(c.enableEvent){var d=c.events,f=r(c.vfId);if(c.$bubbleList&&c.$unbubbleList)for(var d=b?c.$bubbleList:c.$unbubbleList,e=0;e<d.length;e++)b?f["on"+d[e]]=a?null:function(b){b=c.fixedEvent(b);c.processEvent(b)}:a?c.undelegateUnbubble(f,d[e]):c.delegateUnbubble(f,d[e]);else for(e in c.$bubbleList=[],c.$unbubbleList=[],d)g(d,e)&&(g(z,e)?(c.$unbubbleList.push(e),b||(a?c.undelegateUnbubble(f,e):c.delegateUnbubble(f,e))):(c.$bubbleList.push(e),
b&&(f["on"+e]=a?null:function(b){b=c.fixedEvent(b);c.processEvent(b)})))}},delegateBubbleEvents:function(){this.processDelegateEvents(!0)},delegateUnbubbleEvents:function(){this.processDelegateEvents()},undelegateUnBubbleEvents:function(){this.processDelegateEvents(!1,!0)},undelegateBubbleEvents:function(){this.processDelegateEvents(!0,!0)},manage:function(a,c){var f=!0;1==arguments.length&&(c=a,a="res_"+b++,f=!1);if(!this.$resCache)this.$resCache={};f={hasKey:f,res:c};d.isFunction(c)&&(c=this.wrapManagedFunction(c),
f[this.sign]=c);this.$resCache[a]=f;return c},getManaged:function(b){var a=this.$resCache,c=this.sign;return a&&g(a,b)?(b=a[b],a=b.res,d.isFunction(a)&&(b[c]||(b[c]=this.wrapManagedFunction(a)),a=b[c]),a):null},removeManaged:function(b){var a=this.$resCache;if(a)if(g(a,b))delete a[b];else for(var c in a)if(a[c].res===b){delete a[c];break}},destroyManaged:function(b){var a=this.$resCache;if(a){for(var f in a){var g=a[f],e=!1,h=g.res;if(d.isNumber(h))q.clearTimeout(h),q.clearInterval(h),e=!0;else if(h)for(var j=
0;j<k.length;j++)d.isFunction(h[k[j]])&&(c(h[k[j]],[],h),e=!0);this.trigger("destroyResource",{resource:h,processed:e});b&&!g.hasKey&&delete a[f]}b||(this.unbind("destroyResource"),delete this.$resCache)}},wrapManagedFunction:function(b){var a=this,d=a.sign;return function(){a.sign==d&&c(b,arguments,a)}},beginAsyncUpdate:function(){return this.sign++},signature:function(){return this.sign},endAsyncUpdate:function(){return this.sign},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;
if(!this.iC){var b=[].slice.call(this.iQ);for(this.iQ=[];b.length;)this.idle.apply(this,b.shift())}}});d.mix(f,e,{prototype:!0});d.mix(f.prototype,e.prototype);return f},{requires:["magix/impl/view","magix/magix","magix/event"]});
KISSY.add("magix/vom",function(h,e,d){var a=document;return{iC:0,iQ:[],rootVframe:null,vframes:{},rootVframeId:"magix_vf_root",registerVframe:function(b){this.vframes[b.id]=b},getVframe:function(b){return this.vframes[b]},unregisterVframe:function(b){delete this.vframes[d.isString(b)?b:b.id]},buildRootVframe:function(){if(!this.rootVframe)a.getElementById(this.rootVframeId)||e.createVframeNode(this.rootVframeId,a.body.firstChild),this.rootVframe=e.createVframe(this.rootVframeId,{owner:this}),this.registerVframe(this.rootVframe)},
remountRootVframe:function(b){this.$location=b.location;this.buildRootVframe();this.rootVframe.mountView(b.location.viewPath)},notifyLocationChange:function(b){this.$location=b.location;this.rootVframe&&this.rootVframe.notifyLocationChange(b)},idle:function(b,a,g){this.iC?this.iQ.push([b,a,g]):d.safeExec(b,a,g)},suspend:function(){this.iC++},resume:function(){0<this.iC&&this.iC--;if(!this.iC){var b=this.iQ;if(b.length){b=[].slice.call(b);for(this.iQ=[];b.length;)this.idle.apply(this,b.shift())}}}}},
{requires:["magix/vframe","magix/magix"]});
KISSY.add("mxext/model",function(h,e){var d=function(a){a&&this.set(a);this.id=h.guid("m");this.hasLocker=this.locker=!1};e.mix(d,{GET:"GET",POST:"POST",extend:function(a,b){var c=function(){c.superclass.constructor.apply(this,arguments);b&&e.safeExec(b,[],this)};e.mix(c,this,{prototype:!0});return h.extend(c,this,a)}});e.mix(d.prototype,{urlMap:{},sync:e.noop,parse:e.noop,getParamsObject:function(a){if(!a)a=d.GET;return this["$"+a]||null},getPostParamsObject:function(){return this.getPostParamsObject(d.POST)},getPostParams:function(){return this.getParams(d.POST)},
getParams:function(a){var a=a?a.toUpperCase():d.GET,a=this["$"+a],b=[],c;if(a)for(var g in a)if(c=a[g],h.isArray(c))for(var e=0;e<c.length;e++)b.push(g+"="+encodeURIComponent(c[e]));else b.push(g+"="+encodeURIComponent(c));return b.join("&")},setParamsIf:function(a,b){this.setParams(a,b,d.GET,!0)},setParams:function(a,b,c,g){c=c?c.toUpperCase():d.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[c]=!0;c="$"+c;this[c]||(this[c]={});if(h.isObject(a))for(var e in a){if(!g||!this[c][e])this[c][e]=
a[e]}else if(a&&b&&(!g||!this[c][a]))this[c][a]=b},setPostParams:function(a,b){this.setParams(a,b,d.POST)},setPostParamsIf:function(a,b){this.setParams(a,b,d.POST,!0)},removeParamsObject:function(a){if(!a)a=d.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(d.POST)},reset:function(){var a=this.$keysCache;if(a){for(var b in a)e.hasProp(a,b)&&delete this["$"+b];delete this.$keysCache}a=this.$keys;b=this.$attrs;if(a){for(var c=0;c<a.length;c++)delete b[a[c]];delete this.$keys}},
url:function(){var a=this.get("uri"),b;if(a){b=a.split(":");var c=this.urlMap;if(c)for(var d=0;d<b.length&&!(c=c[b[d]],void 0===c);d++)d==b.length-1&&(a=c)}else throw Error("model not set uri");return a},get:function(a){var b=this.$attrs;return b?b[a]:null},set:function(a,b,c){if(!this.$attrs)this.$attrs={};if(c&&!this.$keys)this.$keys=[];if(h.isObject(a))for(var d in a)c&&this.$keys.push(d),this.$attrs[d]=a[d];else a&&(c&&this.$keys.push(a),this.$attrs[a]=b)},load:function(a){this.request(a)},save:function(a){this.request(a)},
request:function(a){a||(a={});var b=a.success,c=a.error,d=this;if(!d.hasLocker||!d.locker)d.$abort=!1,d.locker=d.hasLocker,a.success=function(a){d.locker=!1;if(!d.$abort){if(a){var c=d.parse(a);c&&(h.isArray(c)&&(c={list:c}),d.set(c,null,!0))}b&&b.apply(this,arguments)}},a.error=function(){d.locker=!1;d.$abort||c&&c.apply(this,arguments)},d.$trans=d.sync(d,a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},beginTransaction:function(){this.$bakAttrs=
h.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs},lock:function(a){this.hasLocker=!!a}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/modelfactory",function(h,e){var d=function(b){this.$modelClass=b},a=function(b){if(b._wraped_)return b;var a=function(a){var c=a.success,d=this;d.get("updateIdent")?(a.success=function(){d.set("updateIdent",!1);d._after&&e.safeExec(d._after,d);c&&c.apply(a)},b.call(d,a)):c&&c.apply(a)};a._wraped_=!0;return a};e.mix(d,{mClsCache:{},create:function(b,a){if(!a)throw Error("Factory.create modelClass ungiven");var e=this.mClsCache;b||(b=h.guid());e[b]||(e[b]=new d(a));return e[b]}});e.mix(d.prototype,
{registerModels:function(b){e.isArray(b)||(b=[b]);for(var a=0,d;a<b.length;a++){d=b[a];if(!d.type)throw Error("model must own a type attribute");this[d.type]=d}},registerMethods:function(b){for(var a in b)e.hasProp(b,a)&&(this[a]=b[a])},callMethods:function(b,a,d){for(var e=[],f="",j=b.length,l=0,s,t=function(b,p,o){s||(l++,o?f=b:e[p]=b,j<=l&&(f?h.isFunction(d)&&d(f):h.isFunction(a)&&a.apply(a,e)))},u=function(b,a){return function(c){t(c,b,!a)}},p=0,o;p<b.length;p++){o=b[p];var v;if(v=h.isFunction(o.name)?
o.name:this[o.name]){if(!o.params)o.params=[];o.params.push(u(p,!0),u(p));v.apply(this,o.params)}else t("unfound:"+o.name,p,!0)}return{abort:function(){s=!0}}},fetchModels:function(b,a,d,h){var f=this;if(!f.$modelsCache)f.$modelsCache={};if(!f.$modelsCacheKeys)f.$modelsCacheKeys={};var j=f.$modelsCache,l=f.$modelsCacheKeys;e.isArray(b)||(b=[b]);for(var s=b.length,t=0,u,p=[],o=[],v,w=function(b,k,i,o){t++;if(k)u=o||"fetch data error";else{v=!0;i.set("updateIdent",!1);p[b]=i;if((b=i._cacheKey)&&!e.hasProp(j,
b))j[i._cacheKey]=i,b=i._params,i._after&&e.safeExec(i._after,[i].concat(b));4==h&&a(i)}if((b=i._cacheKey)&&e.hasProp(l,b)){var q=l[b];delete l[b];e.safeExec(q,[k,i,o],i)}4!=h&&t>=s&&(2==h?v?a&&a.apply(f,p):d&&d(u):u?d&&d(u):a&&a.apply(f,p))},z=Array.prototype.slice,x=function(b,a){var c=z.call(arguments,2);return function(){return b.apply(a,c.concat(z.call(arguments)))}},q=0,k;q<b.length;q++){k=b[q];var r=k.cacheKey;r&&e.hasProp(l,r)?l[r].push(x(w,f,q)):(k=f.create(k,!0),k.get("updateIdent")?(o.push(k),
r&&(l[r]=[]),k.request({success:x(w,k,q,!1,k),error:x(w,k,q,!0,k)})):w(q,!1,k))}return{abort:function(){for(var b=0,a;b<o.length;b++){a=o[b];var c=a._cacheKey;if(c&&e.hasProp(l,c)){var d=l[c];delete l[c];e.safeExec(d,[!0,a,"abort"],a)}a.abort()}}}},fetchAll:function(b,a,d){return this.fetchModels(b,a,d,1)},fetchAny:function(b,a,d){return this.fetchModels(b,a,d,2)},fetchOne:function(b,a){return this.fetchModels(b,a,e.noop,4)},getIf:function(b){var a=this.$modelsCache;return a&&e.hasProp(a,b)?a[b]:
null},setUpdateIdent:function(a){(a=this.getIf(a))&&a.set("updateIdent",!0)},create:function(b,c){if(!b.type)throw Error('model must own a "type" attribute');var d=b.type,h=b.cacheKey||d.cacheKey,f;if(!this.$modelsCache)this.$modelsCache={};var j=this.$modelsCache,l=b.params||[];if(h&&e.hasProp(j,h)){f=j[h];var s=f.get("updateIdent");s&&delete j[h]}else f=new this.$modelClass(d.ops),f._after=d.after,f._cacheKey=h,f.set("updateIdent",!0);f._params=l;if(s=f.get("updateIdent"))f.reset(),f.set(b.ops),
f.setParams(d.gets),f.setPostParams(d.posts),f.setParams(b.gets),f.setPostParams(b.posts),e.isFunction(d.before)&&e.safeExec(d.before,[f].concat(l),d);if(!c)f.request=a(f.request);return f}});return d},{requires:["magix/magix"]});
KISSY.add("mxext/vfanim",function(h,e,d){var a=d.config(),b=document,c=a.viewChange,g=d.isFunction(c),n=function(a){return"object"==typeof a?a:b.getElementById(a)};return d.mix(e.prototype,{viewChangeUseAnim:function(){return a.viewChangeAnim},oldViewDestroy:function(){var a=n(this.id),c=n(this.viewId),e=this.view;if(!c){for(c=b.createElement("div");a.firstChild;)c.appendChild(a.firstChild);a.appendChild(c)}c.id="";if(a=e.events)for(var g in a)d.hasProp(a,g)&&h.all("*[mx"+g+"]").removeAttr("mx"+g);
if(!d.hasProp(this,"$animCounter"))this.$animCounter=0;this.$animCounter++;this.$oldViewNode=c},prepareNextView:function(){var a=n(this.id),c=b.createElement("div");c.id=this.viewId;a.insertBefore(c,a.firstChild)},newViewCreated:function(a){var b=this,e=b.$oldViewNode,h=n(b.viewId);g&&d.safeExec(c,{vframeId:b.id,action:a?"viewChange":"viewRefresh",oldViewNode:e,newViewNode:h,collectGarbage:function(){b.$animCounter--;b.$animCounter||delete b.$oldViewNode;try{e.parentNode.removeChild(e)}catch(a){}}},
b)}})},{requires:["magix/vframe","magix/magix","sizzle"]});
KISSY.add("mxext/view",function(h,e,d){return e.extend({queryEvents:null,navigate:function(a){d.navigate(a)},attachQueryEvents:function(){var a=this,b=a.queryEvents;if(b){a.$queryEventsCache={};for(var c in b){var d=b[c],n;for(n in d)h.all("#"+a.id+" "+n).on(c,a.$queryEventsCache[c+"_"+n]=function(c){return function(d){var g=e.idIt(d.target),h=e.idIt(d.currentTarget);Magix.safeExec(c,{view:a,targetId:g,currentId:h,queryEvents:b,domEvent:d},b)}}(d[n]))}}},detachQueryEvents:function(){var a=this.queryEvents;
if(a){for(var b in a){var c=a[b],d;for(d in c)h.all("#"+this.id+" "+d).detach(b,this.$queryEventsCache[b+"_"+d])}delete this.$queryEventsCache}},setData:function(a){this.data=a;for(var b in a)a[b]&&a[b].toJSON&&(a[b]=a[b].toJSON());this.setRenderer()},setRenderer:function(){var a=this,b=this.renderer,c,d;if(b)for(c in b)for(d in b[c])(function(){var e=c,f=d,h=b[e][f];a.data[e+"_"+f]=function(){return h.call(this,a,e)}})()}},function(){var a=this;a.bind("created",function(){a.attachQueryEvents();a.bind("prerender",
function(){a.detachQueryEvents()});a.bind("rendered",function(){a.attachQueryEvents()})})})},{requires:["magix/view","magix/router"]});(function(h){var e=function(){};if(!h.console)h.console={log:e,warn:e,error:e,debug:e};if(!h.Magix)h.Magix={start:function(d){this.$tempCfg=d}},KISSY.use("magix/magix",function(d,a){var b=h.Magix.$tempCfg;h.Magix=a;b&&a.start(b)})})(this);