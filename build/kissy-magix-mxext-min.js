KISSY.add("magix/body",function(i,g,h,d){var i=h.mix,a=h.listToMap("submit,focusin,focusout,mouseenter,mouseleave,mousewheel,change"),e=document.body,j={},k={},o=65536,n=function(a,f,b){b?a.setAttribute(f,b):b=a.getAttribute(f);return b},d=i({processEvent:function(a){for(var f=a.target||a.srcElement;f&&1!=f.nodeType;)f=f.parentNode;var b=f,c=a.type,m=k[c]||(k[c]=RegExp("(?:^|,)"+c+"(?:,|$)"));if(!m.test(n(f,"mx-ie"))){for(var q="mx-"+c,d,s,h=[];b&&b!=e&&!(d=n(b,q),s=n(b,"mx-ie"),d||m.test(s));)h.push(b),
b=b.parentNode;if(d){c=n(b,"mx-owner");if(!c){m=b;for(s=this.VOM.all();m&&m!=e;)if(Has(s,m.id)){n(b,"mx-owner",c=m.id);break}else m=m.parentNode}if(c)this.fire("event",{info:d,se:a,tId:f.id||(f.id="mx-e-"+o--),cId:b.id||(b.id="mx-e-"+o--),hld:c});else throw Error("miss mx-owner:"+d);}else for(;h.length;)a=h.shift(),s=n(a,"mx-ie"),m.test(s)||(s=s?s+","+c:c,n(a,"mx-ie",s))}},attachEvent:function(d){var f=this;if(j[d])j[d]++;else if(j[d]=1,a[d])f.onUnbubble(e,d);else e["on"+d]=function(b){(b=b||window.event)&&
f.processEvent(b)}},detachEvent:function(d){var f=j[d];0<f&&(f--,f||(a[d]?this.offUnbubble(e,d):e["on"+d]=null),j[d]=f)}},d);return h.mix(d,g)},{requires:["magix/impl/body","magix/magix","magix/event"]});
KISSY.add("magix/event",function(i,g){var h=g.safeExec;return{fire:function(d,a,e,j){var k="~"+d,g=this[k];if(g){a||(a={});if(!a.type)a.type=d;for(var d=g.length,i=d-1,l,f;d--;)l=j?d:i-d,f=g[l],f.d&&(g.splice(l,1),i--),h(f,a,this)}e&&delete this[k]},on:function(d,a,e){d="~"+d;this[d]||(this[d]=[]);g.isNumeric(e)?this[d].splice(e,0,a):(a.d=e,this[d].push(a))},un:function(d,a){g.isArray(d)||(d=[d]);for(var e=0,h=d.length;e<h;e++){var k="~"+d[e],i=this[k];if(i)if(a)for(var k=0,n=i.length;k<n;k++){if(i[k]==
a){i.splice(k,1);break}}else delete this[k]}}}},{requires:["magix/magix"]});KISSY.add("magix/impl/body",function(i,g){var h={};return{onUnbubble:function(d,a){var e=this;g.delegate(d,a,"*[mx-"+a+"]",h[a]=function(a){e.processEvent(a)})},offUnbubble:function(d,a){g.undelegate(d,a,"*[mx-"+a+"]",h[a]);delete h[a]}}},{requires:["event"]});
KISSY.add("magix/impl/magix",function(i,g){g=[].slice;return{libRequire:function(h,d){if(h){var a=this.isFunction(d),e=this.isArray(h);i.use(e?h.join(","):h,a?function(a){d.apply(a,g.call(arguments,1))}:this.noop)}else d()},libEnv:function(h){var d=h.appHome,a=location,e=a.protocol,j=h.appName;~d.indexOf(e)||(d=this.path(a.href,d));i.endsWith(d,"/")||(d+="/");h.appHome=d;var k=h.debug;k&&(k=0==d.indexOf(e+"//"+a.host));"~"==j.charAt(0)&&i.config({map:[[RegExp("/"+j+"/"),"/"]]});a="";(a=k?i.now():
h.appTag)&&(a+=".js");e=h.appCombine;i.isUndefined(e)&&(e=i.config("combine"));i.config({packages:[{name:j,path:d,debug:h.debug=k,combine:e,tag:a}]})},isArray:i.isArray,isFunction:i.isFunction,isObject:i.isObject,isRegExp:i.isRegExp,isString:i.isString,isNumber:i.isNumber}});
KISSY.add("magix/impl/router",function(i,g){var h=window;return{useState:function(){var d=this,a=location.href;g.on(h,"popstate",function(){var e=location.href==a;if(d.$firedPop||!e)d.$firedPop=!0,d.route()})},useHash:function(){var d=this;g.on(h,"hashchange",function(){d.route()})}}},{requires:["event"]});
KISSY.add("magix/impl/view",function(i,g,h){var d=function(){},a=i.Env.mods,e={wrapAsyn:1,extend:1},j=function(a,d,e){for(var g in d)i.isObject(d[g])?(h.has(a,g)||(a[g]={}),j(a[g],d[g],!0)):e&&(a[g]=d[g])};d.extend=function(a,e){var g=function(){g.superclass.constructor.apply(this,arguments);e&&h.safeExec(e,arguments,this)};g.extend=d.extend;return i.extend(g,this,a)};d.prepare=function(d,g){if(!d.wrapAsyn){for(var i in this)h.has(e,i)&&(d[i]=this[i]);i=d.prototype;for(var l=d;l.superclass;)l=l.superclass.constructor,
j(i,l.prototype);g.home=a[g.path].packageInfo.getBase();h.mix(i,g)}d.wrapAsyn()};h.mix(d.prototype,{fetchTmpl:function(a,d,e){g({url:a+(e?"?_="+i.now():""),success:d,error:function(a,f){d(f)}})}});return d},{requires:["ajax","magix/magix"]});
KISSY.add("magix/magix",function(i,g){var h=/\/\.\/|\/[^\/]+?\/\.{2}\/|([^:\/])\/\/+/,d=/[^\/]*$/,a=/[#?].*$/,e=/([^=&?\/#]+)=([^&=#?]*)/g,j=/^https?:\/\//i,k={},o=0,n={},l={debug:false,iniFile:"~/ini",appName:"app",appHome:"./",tagName:"vframe",rootId:"magix_vf_root"},f=n.hasOwnProperty,b=function(a){return function(b,c,f){switch(arguments.length){case 0:f=a;break;case 1:f=t.isObject(b)?u(a,b):q(a,b)?a[b]:null;break;case 2:null===c?(delete a[b],f=c):a[b]=f=c}return f}},c=function(a){this.c=[];
this.x=a||20;this.b=this.x+5},m=function(a){return new c(a)},q=function(a,b){return a?f.call(a,b):0},u=function(a,b,c){for(var f in b)if(!0===c)a[f]=b[f];else if(q(b,f)&&(!c||!q(c,f)))a[f]=b[f];return a};u(c.prototype,{get:function(a){var b=this.c,c,a="pathname"+a;if(q(b,a)&&(c=b[a],1<=c.f))c.f++,c.t=o++,c=c.v;return c},set:function(a,b){var c=this.c,a="pathname"+a,f=c[a];if(!q(c,a)){if(c.length>=this.b){c.sort(function(a,b){return b.f==a.f?b.t-a.t:b.f-a.f});for(var d=this.b-this.x;d--;)f=c.pop(),
delete c[f.k]}f={};c.push(f);c[a]=f}f.k=a;f.v=b;f.f=1;f.t=o++;return f},del:function(a){var a="pathname"+a,b=this.c,c=b[a];if(c)c.f=-1E5,delete b[a]}});var s=m(60),v=m(),r=function(a,b,c,f,d,e){t.isArray(a)||(a=[a]);if(!b||!t.isArray(b)&&!b.callee)b=[b];for(f=0;f<a.length;f++)try{e=a[f],d=t.isFunction(e)&&e.apply(c,b)}catch(q){}return d},B=function(){},t={isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},mix:u,has:q,safeExec:r,noop:B,config:b(l),start:function(a){var b=this,a=u(l,a);
b.libEnv(a);var c=a.iniFile.replace("~",a.appName);b.libRequire(c,function(c){l=u(a,c,a);var f=a.progress;b.libRequire(["magix/router","magix/vom"],function(c,d){c.on("changed",function(a){a.loc?d.locationUpdated(a.loc):a.changed.isView()?d.remountRoot(a):d.locationChanged(a)});d.on("progress",f||B);b.libRequire(a.extensions,function(){c.start()})})});a.ready&&(r(a.ready),delete a.ready)},keys:Object.keys||function(a){var b=[],c;for(c in a)q(a,c)&&b.push(c);return b},local:b(n),path:function(b,c){var f=
b+"\n"+c,e=v.get(f);if(!e){b=b.replace(a,"").replace(d,"");"/"==c.charAt(0)?(e=b.indexOf("://"),-1==e?e=c:(e=b.indexOf("/",e+3),e=-1==e?b+c:b.substring(0,e)+c)):e=b+c;for(;h.test(e);)e=e.replace(h,"$1/");v.set(f,e)}return e},pathToObject:function(b){var c=s.get(b);if(!c){var c={},f={},d="";a.test(b)?d=b.replace(a,""):~b.indexOf("=")||(d=b);if(d&&j.test(d))var q=d.indexOf("/",8),d=-1==q?"/":d.substring(q);b.replace(e,function(a,b,c){f[b]=c});c.pathname=d;c.params=f;s.set(b,c)}return c},objectToPath:function(a,
b){var c=a.pathname,f=[],d=a.params,e;for(e in d)f.push(e+"="+(b?encodeURIComponent(d[e]):d[e]));return c+(c&&f.length?"?":"")+f.join("&")},tmpl:function(a,b){return 1==arguments.length?k[a]:k[a]=b},listToMap:function(a,b){var c,f,d={},e;this.isString(a)&&(a=a.split(","));if(a&&(e=a.length))for(c=0;c<e;c++)f=a[c],d[b?f[b]:f]=b?f:1;return d},createCache:m};return t.mix(t,g)},{requires:["magix/impl/magix"]});
KISSY.add("magix/router",function(i,g,h,d){var a=h.has,e=h.mix,j=document,k=/^UTF-8$/i.test(j.charset||j.characterSet||"UTF-8"),o=h.config(),n=h.createCache(),l=h.createCache(),f,b,c,m=65536,q=/#.*$/,u=/^[^#]*#?!?/,s=o.nativeHistory,v,r,B=function(b,c,f){if(b){f=this.params;h.isArray(b)||(b=b.split(","));for(var d=0;d<b.length&&!(c=a(f,b[d]));d++);}return c},t=function(){return a(this,p)},C=function(){return a(this,"view")},D=function(){return this.hash[p]!=this.query[p]},w=function(a){return this.hash.params[a]!=
this.query.params[a]},y=function(b){return a(this.hash.params,b)},A=function(b){return a(this.query.params,b)},E=function(a){return this.params[a]},z=window,x=decodeURIComponent,p="pathname",i=e({getView:function(a){if(!c){c={routes:o.routes||{},e404:o.notFoundView};var b=o.defaultView;if(!b)throw Error("unset defaultView");c.home=b;var f=o.defaultPathname||"";c.routes[f]=b;c[p]=f}a||(a=c[p]);b=c.routes;b=h.isFunction(b)?b.call(o,a):b[a];return{view:b?b:c.e404||c.home,pathname:b?a:c.e404?a:c[p]}},
start:function(){var a=z.history;v=s&&a.pushState;r=s&&!v;v?this.useState():this.useHash();this.route()},parsePath:function(a){var a=h.pathToObject(a),b=a[p];b&&"/"!=b.charAt(0)&&r&&(a[p]=h.path(z.location[p],b));return a},parseQH:function(a){a=a||z.location.href;if(k)try{a=x(a)}catch(b){}var c=n.get(a);if(!c){var c=a.replace(q,""),f=a.replace(u,""),d=this.parsePath(c),m=this.parsePath(f),r={};e(r,d.params);e(r,m.params);c={pathnameDiff:D,paramDiff:w,hashOwn:y,queryOwn:A,get:E,href:a,srcQuery:c,srcHash:f,
query:d,hash:m,params:r};n.set(a,c)}return c},parseLoc:function(a){a=this.parseQH(a);if(!a.view){var b=this.getView(s?a.hash[p]||a.query[p]:a.hash[p]);e(a,b)}return a},getChged:function(a,b){var c=b.href,f=a.href+"\n"+c,d=l.get(f);d||(f=c+"\n"+f,d=l.get(f));if(!d){var e,d={params:{}};a[p]!=b[p]&&(e=d[p]=1);if(a.view!=b.view)e=d.view=1;var c=a.params,q=b.params,r;for(r in c)c[r]!=q[r]&&(e=1,d.params[r]=1);for(r in q)c[r]!=q[r]&&(e=1,d.params[r]=1);d.occur=e;d.isParam=B;d.isPathname=t;d.isView=C;l.set(f,
d)}return d},route:function(){var a=this.parseLoc(),c=b||{params:{},href:"~"},d=!b;b=a;c=this.getChged(c,a);c.occur&&(f=a,this.fire("changed",{location:a,changed:c,firstFire:d}))},navigate2:function(b){if(b&&h.isString(b)){var c=this.parsePath(b),b={};b.params=e({},c.params);b[p]=c[p];if(b[p]){if(r&&(c=f.query)&&(c=c.params))for(var d in c)a(c,d)&&!a(b.params,d)&&(b.params[d]="")}else d=e({},f.params),b.params=e(d,b.params),b[p]=f[p];d=h.objectToPath(b);if(v?d!=f.srcQuery:d!=f.srcHash)v?(this.$firedPop=
1,history.pushState(m--,j.title,d),this.route()):(e(b,f,b),b.srcHash=d,b.hash={params:b.params,pathname:b[p]},this.fire("changed",{loc:f=b}),location.hash="#!"+d)}},navigate:function(a,b){!b&&h.isObject(a)&&(b=a,a="");b&&(a=h.objectToPath({params:b,pathname:a},k));this.navigate2(a)}},d);return h.mix(i,g)},{requires:["magix/impl/router","magix/magix","magix/event"]});
KISSY.add("magix/vframe",function(i,g,h,d){var a=document,e=65536,j=window.CollectGarbage||g.noop,k=g.mix,i=g.config(),o=i.tagName,n=i.rootId,l=g.has,f,b=function(b){return"object"==typeof b?b:a.getElementById(b)};a.createElement(o);var c=/<script[^>]*>[\s\S]*?<\/script>/ig,m=function(a){this.id=a;this.vId=a+"_v";this.cS={};this.rC=this.cC=0;this.sign=-2147483648;this.rM={}};k(m,{root:function(c){if(!f){var d=b(n);if(!d)d=a.createElement(o),d.id=n,a.body.insertBefore(d,a.body.firstChild);f=new m(n);
c.add(f)}return f}});k(k(m.prototype,h),{useAnimUpdate:g.noop,oldViewDestroy:g.noop,prepareNextView:g.noop,newViewCreated:g.noop,mountView:function(a,f){var e=this,m=b(e.id);m._bak?m._chgd=1:(m._bak=1,m._tmpl=m.innerHTML.replace(c,""));var r=e.vN&&e.useAnimUpdate();e.unmountView(r,1);if(a){var h=g.pathToObject(a),i=h.pathname,j=--e.sign;g.libRequire(i,function(a){if(j==e.sign){var c=e.owner;d.prepare(a,{$:b,path:i,vom:c});var q;r?(q=e.vId,e.prepareNextView()):q=e.id;var g=new a({owner:e,id:q,vId:e.vId,
vfId:e.id,location:c.getLocation()});e.view=g;g.on("interact",function(a){e.fire("viewInteract",{view:g});e.viewUsable=1;r&&e.newViewCreated(1);if(!a.tmpl){if(!r&&m._chgd)m.innerHTML=m._tmpl;e.mountZoneVframes(0,0,1)}g.on("rendered",function(){e.mountZoneVframes(0,0,1)});g.on("prerender",function(a){e.unmountZoneVframes(0,a.anim)})},0);g.load(k(h.params,f,!0))}})}},unmountView:function(a,c){if(this.view){this.childrenAlter();this.unmountZoneVframes(0,a);this.fire("viewUnmount");this.view.destroy();
var f=b(this.id);if(!a&&f._bak)f.innerHTML=f._tmpl;a&&c&&this.oldViewDestroy();delete this.view;delete this.viewUsable;j()}this.un("viewInteract");this.sign--},mountVframe:function(a,b,c,f){var d=this.owner,e=d.get(a);if(!e)e=new m(a),e.pId=this.id,l(this.cS,a)||this.cC++,this.cS[a]=f,d.add(e);e.mountView(b,c);return e},mountZoneVframes:function(a,c,f){this.unmountZoneVframes(a);var a=a?a:b(this.vId)||b(this.id),a=b(a).getElementsByTagName(o),d=a.length,m={};if(d)for(var g=0,h,i;g<d;g++){h=a[g];i=
h.id||(h.id="magix_vf_"+e--);l(m,i)||this.mountVframe(i,h.getAttribute("mx-view"),c,f);h=b(h).getElementsByTagName(o);i=0;for(var j=h.length;i<j;i++)m[h[i].id||(h[i].id="magix_vf_"+e--)]=1}else this.childrenCreated()},unmountVframe:function(a,b){var c=this.owner,f=c.get(a);f&&(f.unmountView(b),c.remove(a),delete this.cS[a],this.cC--)},unmountZoneVframes:function(a){var c;if(a){c=b(a).getElementsByTagName(o);for(var f={},d=this.cS,e=c.length-1,m;0<=e;e--)m=c[e].id,l(d,m)&&(f[m]=1);c=f}else c=this.cS;
for(var h in c)this.unmountVframe(h);if(!a)this.cS={},this.cC=0},childrenCreated:function(){var a=this.view;if(a&&!this.fcc)this.fcc=1,delete this.fca,a.fire("created"),this.fire("created");a=this.owner;a.childCreated();if(a=a.get(this.pId)){var b=this.id,c=a.rM;l(c,b)||(c[b]=a.cS[b],a.rC++,a.rC==a.cC&&a.childrenCreated())}},childrenAlter:function(){delete this.fcc;var a=this.view,b=this.id;if(a&&!this.fca)this.fca=1,a.fire("alter"),this.fire("alter");if(a=this.owner.get(this.pId)){var b=this.id,
c=a.rM,f=c[b];l(c,b)&&(a.rC--,delete c[b],f&&a.childrenAlter())}},locationChanged:function(a,b){var c=this.view;if(c&&c.sign&&(c.location=a,c.rendered)){var f=c.olChanged(b),d={location:a,changed:b,prevent:function(){this.cs=[]},toChildren:function(a){a=a||[];g.isString(a)&&(a=a.split(","));this.cs=a}};f&&g.safeExec(c.locationChange,d,c);for(var c=d.cs||g.keys(this.cS),f=0,d=c.length,e=this.owner,m;f<d;f++)(m=e.get(c[f]))&&m.locationChanged(a,b)}},locationUpdated:function(a){var b=this.view;if(b&&
b.sign){b.location=a;var b=this.cS,c,f=this.owner,d;for(d in b)(c=f.get(d))&&c.locationUpdated(a)}}});return m},{requires:["magix/magix","magix/event","magix/view"]});
KISSY.add("magix/view",function(i,g,h,d,a){var e=h.safeExec,j=h.has,k=[],o=h.config(),n=/^~[^\/]*/,l=h.mix,f=h.listToMap("render,renderUI"),b=function(a){return function(){var b;this.sign&&(this.sign++,this.fire("rendercall"),b=a.apply(this,arguments));return b}},i=function(a){l(this,a);this.sign=1};l(i,{wrapAsyn:function(){if(!this["~~"]){this["~~"]=1;var a=this.prototype,c,d;for(d in a){c=a[d];var e=null;h.isFunction(c)&&c!=h.noop&&!c["~~"]&&j(f,d)&&(e=b(c),e["~~"]=c,a[d]=e)}}}});var c=i.prototype,
m=window.CollectGarbage||h.noop,q=/\smx-[^ohv][a-z]+\s*=/g,u={prevent:function(a){a=a||this.domEvent;a.preventDefault?a.preventDefault():a.returnValue=!1},stop:function(a){a=a||this.domEvent;a.stopPropagation?a.stopPropagation():a.cancelBubble=!0},halt:function(a){this.prevent(a);this.stop(a)}},s=/(\w+)(?:<(\w+)>)?(?:{([\s\S]*)})?/,v=/(\w+):([^,]+)/g;l(c,d);l(c,{render:h.noop,locationChange:h.noop,init:h.noop,hasTmpl:!0,enableEvent:!0,enableAnim:!1,load:function(){var a=this,b=a.hasTmpl,c=arguments,
f=function(){a.delegateEvents();a.fire("interact",{tmpl:b},1);e(a.init,c,a);e(a.render,k,a);if(!b&&!a.rendered)a.rendered=!0,a.fire("primed",null,1)};if(b&&!a.template){var d=a.sign;a.planTmpl(function(){d==a.sign&&f()})}else f()},updateViewId:function(){this.id=this.$(this.vId)?this.vId:this.vfId},beginUpdateHTML:function(){if(this.sign&&this.rendered){var a=this.enableAnim;this.fire("refresh",0,1);this.fire("prerender",{anim:a});var b=this.owner;a&&(e(b.oldViewDestroy,k,b),e(b.prepareNextView,k,
b),this.updateViewId())}},endUpdateHTML:function(){if(this.sign)this.rendered&&this.enableAnim&&e(owner.newViewCreated,k,owner),this.rendered||this.fire("primed",null,1),this.rendered=!0,this.fire("rendered"),m()},wrapMxEvent:function(a){return a?(""+a).replace(q,' mx-owner="'+this.vfId+'"$&'):a},setViewHTML:function(a){this.beginUpdateHTML();if(this.sign)this.$(this.id).innerHTML=this.wrapMxEvent(a);this.endUpdateHTML()},observeLocation:function(a){var b;if(!this.$ol)this.$ol={keys:[]};b=this.$ol;
var c=b.keys;if(h.isObject(a))b.pn=a.pathname,a=a.keys;if(a)b.keys=c.concat(h.isString(a)?a.split(","):a)},olChanged:function(a){var b=this.$ol;if(b){var c=0;b.pn&&(c=a.isPathname());c||(c=a.isParam(b.keys));return c}return 1},destroy:function(){this.fire("refresh",0,1);this.fire("destroy",0,1,1);this.delegateEvents(1);this.sign=0},parentView:function(){var a=this.vom.get(this.owner.pId),b=null;if(a&&a.viewUsable)b=a.view;return b},planTmpl:function(a){var b=this,c=h.tmpl(b.path);if(void 0===c){var c=
o.debug,f=b.home+b.path.replace(n,"")+".html";b.fetchTmpl(f,function(c){b.template=h.tmpl(b.path,c);a()},c)}else b.template=c,a()},processEvent:function(a){if(this.enableEvent&&this.sign){var b=a.se,c=a.info.match(s),f=c[1],d=c[2],c=c[3],m=this.events;if(m){var h=m[b.type];if(u[d])u[d](b);if(h&&h[f]){var g={};c&&c.replace(v,function(a,b,c){g[b]=c});e(h[f],l({view:this,currentId:a.cId,targetId:a.tId,domEvent:b,events:m,params:g},u),h)}}}},delegateEvents:function(b){var c=this.events,b=b?a.detachEvent:
a.attachEvent,f;for(f in c)b.call(a,f)}});h.mix(i,g,{prototype:!0});h.mix(i.prototype,g.prototype);return i},{requires:["magix/impl/view","magix/magix","magix/event","magix/body"]});
KISSY.add("magix/vom",function(i,g,h,d,a){var e=h.has,j=0,k=0,o=0,n=0,l={},f,b=h.mix({all:function(){return l},add:function(a){if(!e(l,a.id))j++,l[a.id]=a,a.owner=b,b.fire("add",{vframe:a})},get:function(a){return l[a]},remove:function(a){var f=l[a];f&&(j--,f.fcc&&k--,delete l[a],b.fire("remove",{vframe:f}))},childCreated:function(){if(!n){k++;var a=k/j;o<a&&(b.fire("progress",{percent:o=a}),1==a&&(n=1,b.un("progress")))}},root:function(){return g.root(b)},remountRoot:function(a){var d=b.root();f=
a.location;d.mountView(f.view)},locationChanged:function(a){f=a.location;b.root().locationChanged(f,a.changed)},locationUpdated:function(a){f=a;b.root().locationUpdated(a)},getLocation:function(){return f}},d);a.VOM=b;a.on("event",function(a){var f=b.get(a.hld);(f=f&&f.view)&&f.processEvent(a)});return b},{requires:["magix/vframe","magix/magix","magix/event","magix/body"]});
KISSY.add("mxext/mmanager",function(i,g){var h=g.has,d=g.safeExec,a=function(a){g.isArray(a)||(a=[a]);for(var b=0,c;b<a.length;b++)c=a[b],delete c.cacheKey;return a},e=function(a){this.$modelClass=a;this.$modelsCache=g.createCache();this.$modelsCacheKeys={}},j=[].slice,k={urlParams:1,postParams:1,cacheKey:1,cacheTime:1,before:1,after:1},o=function(a){var b={},c;for(c in a)k[c]||(b[c]=a[c]);return b},n=function(a,b){var c=j.call(arguments,2);return function(){return a.apply(b,c.concat(j.call(arguments)))}};
g.mix(e,{create:function(a){if(!a)throw Error("MManager.create modelClass ungiven");return new e(a)}});var l=function(a){this.$host=a;this.$task=!1};g.mix(l.prototype,{fetchModels:function(a,b,c){var e=this;if(e.$task)return e.next(function(d){d.fetchModels(a,b,error,c)}),e;e.$task=!0;var j=e.$host;if(!e.$reqModels)e.$reqModels={};var k=j.$modelsCache,l=j.$modelsCacheKeys,o=e.$reqModels;g.isArray(a)||(a=[a]);var r=a.length,B=0,t,C,D=Array(r),w=[],y={},A=[],E=i.isArray(b);E&&(w=Array(b.length));for(var z=
function(a,f,g,j){if(!e.$destroy){B++;delete o[g.id];var q=g._cacheKey;D[a]=g;if(f)C=!0,t=j||t,y[a]=j;else{q&&!k.get(q)&&k.set(q,g);var n=g.metaParams;g._doneAt=i.now();var p=g._context;p&&d(p.after,[g].concat(n),p)}if(2==c)(n=E?b[a]:b)&&(w[a]=d(n,[g,f?{msg:j}:null,C?y:null],e));else if(4==c){A[a]={m:g,e:f,s:j};for(a=A.i||0;n=A[a];a++)if(p=E?b[a]:b,w[a]=d(p,[n.m,n.e?{msg:n.s}:null,A.e?y:null,w],e),n.e)y[a]=n.s,A.e=1;A.i=a}q&&h(l,q)&&(a=l[q],delete l[q],d(a,[f,g,j],g));if(B>=r)y.msg=t,f=C?y:null,1==
c?(D.push(f),w[0]=d(b,D,e),w[1]=f):w.push(f),e.$ntId=setTimeout(function(){e.$task=!1;e.doNext(w)},30)}},x=0,p;x<a.length;x++)if(p=a[x]){var G;G=j.getModel(p);var F=G.cacheKey;F&&h(l,F)?l[F].push(n(z,e,x)):(p=G.entity,G.needUpdate?(o[p.id]=p,F&&(l[F]=[]),p.request({success:n(z,p,x,!1,p),error:n(z,p,x,!0,p)})):z(x,!1,p))}else throw Error("miss attrs:"+a);return e},fetchAll:function(a,b){return this.fetchModels(a,b,1)},saveAll:function(f,b){f=a(f);return this.fetchModels(f,b,1)},fetchOrder:function(a,
b){var c=j.call(arguments,1);return this.fetchModels(a,1<c.length?c:b,4)},saveOrder:function(f,b){var f=a(f),c=j.call(arguments,1);return this.fetchModels(f,1<c.length?c:b,4)},saveOne:function(f,b){var f=a(f),c=j.call(arguments,1);return this.reqModels(f,1<c.length?c:b,2)},fetchOne:function(a,b){var c=j.call(arguments,1);return this.fetchModels(a,1<c.length?c:b,2)},abort:function(){clearTimeout(this.$ntId);var a=this.$reqModels,b=this.$host.$modelsCacheKeys;if(a)for(var c in a){var e=a[c],g=e._cacheKey;
if(g&&h(b,g)){var j=b[g];delete b[g];d(j,[!0,e,"aborted"],e)}e.abort()}this.$reqModels={};this.$queue=[];this.$task=!1},next:function(a){if(!this.$queue)this.$queue=[];this.$queue.push(a);this.$task||this.doNext.apply(this,[this].concat(this.$latest||[]));return this},doNext:function(a){var b=this.$queue;b&&(b=b.shift())&&d(b,[this].concat(a),this);this.$latest=a},destroy:function(){this.$destroy=!0;this.abort()}});g.mix(e.prototype,{registerModels:function(a){g.isArray(a)||(a=[a]);for(var b=0,c;b<
a.length;b++){c=a[b];if(!c.name)throw Error("model must own a name attribute");this[c.name]=c}},registerMethods:function(a){var b=this,c;for(c in a)h(a,c)&&(b[c]=function(a){return function(){for(var c,f=arguments,e=[],h=0,j;h<f.length;h++)j=f[h],g.isFunction(j)?e.push(function(a){return function(){c||a.apply(a,arguments)}}(j)):e.push(j);var i=a.apply(b,e);return{abort:function(){i&&i.abort&&d(i.abort,["aborted"],i);c=!0}}}}(a[c]))},createModel:function(a){var b=this.getModelMeta(a),c=new this.$modelClass(o(b)),
e=a;e.after||(e=b);if(e.after)c._context=e;c._cacheKey=a.cacheKey||b.cacheKey;c._meta=b;c.set(o(a));c.setUrlParams(b.urlParams);c.setPostParams(b.postParams);c.setUrlParams(a.urlParams);c.setPostParams(a.postParams);e=a;e.before||(e=b);a=a.metaParams||[];i.isFunction(e.before)&&d(e.before,[c].concat(a),e);c.metaParams=a;return c},getModelMeta:function(a){var b=this[a.name];if(!b)throw Error("Not found:"+a.name);return b},getModel:function(a){var b=this.getModelFromCache(a),c;b||(c=!0,b=this.createModel(a));
return{entity:b,cacheKey:b._cacheKey,needUpdate:c}},saveAll:function(a,b){return(new l(this)).saveAll(a,b)},fetchAll:function(a,b){return(new l(this)).fetchAll(a,b)},saveOrder:function(a,b){var c=new l(this);return c.saveOrder.apply(c,arguments)},fetchOrder:function(a,b){var c=new l(this);return c.fetchOrder.apply(c,arguments)},saveOne:function(a,b){var c=new l(this);return c.saveOne.apply(c,arguments)},fetchOne:function(a,b){var c=new l(this);return c.fetchOne.apply(c,arguments)},clearCacheByKey:function(a){var b=
this.$modelsCache;i.isString(a)&&b.del(a)},clearCacheByName:function(a){for(var b=this.$modelsCache.c,c=0;c<b.length;c++){var d=b[c];d.v&&d.v._meta.name==a&&delete b[d.k]}},getModelUrl:function(a){return this.$modelClass.prototype.url((i.isString(a)?this[a]:a).uri)},getModelFromCache:function(a){var b=this.$modelsCache,c=null,d;if(i.isString(a))d=a;else{var e=this.getModelMeta(a);d=a.cacheKey||e.cacheKey}if(d&&(c=b.get(d))){if(!e)e=c._meta;a=a.cacheTime||e.cacheTime||0;0<a&&i.now()-c._doneAt>a&&(this.clearCacheByKey(d),
c=null)}return c}});return e},{requires:["magix/magix"]});
KISSY.add("mxext/model",function(i,g){var h=function(a,d,j){for(var k in d)i.isObject(d[k])?(g.has(a,k)||(a[k]={}),h(a[k],d[k],!0)):j&&(a[k]=d[k])},d=function(a){a&&this.set(a);this.id=i.guid("m")};g.mix(d,{GET:"GET",POST:"POST",extend:function(a,d){var j=function(){j.superclass.constructor.apply(this,arguments);d&&g.safeExec(d,[],this)};g.mix(j,this,{prototype:!0});h(a,this.prototype);return i.extend(j,this,a)}});g.mix(d.prototype,{urlMap:{},sync:g.noop,parse:function(a){return a},getParamsObject:function(a){if(!a)a=
d.GET;return this["$"+a]||null},getUrlParamsObject:function(){return this.getParamsObject(d.GET)},getPostParamsObject:function(){return this.getParamsObject(d.POST)},getPostParams:function(){return this.getParams(d.POST)},getUrlParams:function(){return this.getParams(d.GET)},getParams:function(a){var a=a?a.toUpperCase():d.GET,a=this["$"+a],e=[],g;if(a)for(var h in a)if(g=a[h],i.isArray(g))for(var o=0;o<g.length;o++)e.push(h+"="+encodeURIComponent(g[o]));else e.push(h+"="+encodeURIComponent(g));return e.join("&")},
setUrlParamsIf:function(a,e){this.setParams(a,e,d.GET,!0)},setPostParamsIf:function(a,e){this.setParams(a,e,d.POST,!0)},setParams:function(a,e,g,h){g=g?g.toUpperCase():d.GET;if(!this.$keysCache)this.$keysCache={};this.$keysCache[g]=!0;g="$"+g;this[g]||(this[g]={});if(i.isObject(a))for(var o in a){if(!h||!this[g][o])this[g][o]=a[o]}else if(a&&(!h||!this[g][a]))this[g][a]=e},setPostParams:function(a,e){this.setParams(a,e,d.POST)},setUrlParams:function(a,e){this.setParams(a,e,d.GET)},removeParamsObject:function(a){if(!a)a=
d.GET;delete this["$"+a]},removePostParamsObject:function(){this.removeParamsObject(d.POST)},removeUrlParamsObject:function(){this.removeParamsObject(d.GET)},reset:function(){var a=this.$keysCache;if(a){for(var d in a)g.has(a,d)&&delete this["$"+d];delete this.$keysCache}a=this.$keys;d=this.$attrs;if(a){for(var h=0;h<a.length;h++)delete d[a[h]];delete this.$keys}},url:function(a){var a=a||this.get("uri"),d;if(a){d=a.split(":");var g=this.urlMap;if(g)for(var h=0,i=d.length;h<i&&!(g=g[d[h]],void 0===
g);h++)h==i-1&&(a=g)}else throw Error("model not set uri");return a},get:function(a){var d=this.$attrs;return d?d[a]:null},set:function(a,d,g){if(!this.$attrs)this.$attrs={};if(g&&!this.$keys)this.$keys=[];if(i.isObject(a))for(var h in a)g&&this.$keys.push(h),this.$attrs[h]=a[h];else a&&(g&&this.$keys.push(a),this.$attrs[a]=d)},load:function(a){this.request(a)},save:function(a){this.request(a)},request:function(a){a||(a={});var d=a.success,g=a.error,h=this;h.$abort=!1;a.success=function(a){if(!h.$abort){if(a){var g=
h.parse(a);g&&(i.isArray(g)&&(g={list:g}),h.set(g,null,!0))}d&&d.apply(this,arguments)}};a.error=function(){h.$abort||g&&g.apply(this,arguments)};h.$trans=h.sync(a)},abort:function(){this.$trans&&this.$trans.abort&&this.$trans.abort();delete this.$trans;this.$abort=!0},isAborted:function(){return this.$abort},beginTransaction:function(){this.$bakAttrs=i.clone(this.$attrs)},rollbackTransaction:function(){var a=this.$bakAttrs;if(a)this.$attrs=a,delete this.$bakAttrs},endTransaction:function(){delete this.$bakAttrs}});
return d},{requires:["magix/magix"]});
KISSY.add("mxext/view",function(i,g,h,d){var a=window,e="destroy,abort,stop,cancel,remove".split(","),j=0,k=g.safeExec,o=g.has,n={},l=function(a){if(!l.d)l.d=1,a.on("add",function(a){var a=a.vframe,b=n[a.id];if(b){for(var d=0;d<b.length;d++)f(a,b[d]);delete n[a.id]}}),a.on("remove",function(a){delete n[a.vframe.id]}),a.root().on("childrenCreated",function(){n={}})},f=function(a,c){var d=a.view;if(d&&a.viewUsable)k(d.receiveMessage,c,d);else{var e=function(d){a.un("viewInteract",e);k(d.view.receiveMessage,
c,d.view)};a.on("viewInteract",e)}};return h.extend({mxViewCtor:g.noop,navigate:function(a){d.navigate.apply(d,arguments)},manage:function(a,c){var d=!0;1==arguments.length&&(c=a,a="res_"+j++,d=!1);if(!this.$resCache)this.$resCache={};this.$resCache[a]={hasKey:d,res:c};return c},getManaged:function(a){var c=this.$resCache;return c&&o(c,a)?c[a].res:null},removeManaged:function(a){var c=null,d=this.$resCache;if(d)if(o(d,a))c=d[a].res,delete d[a];else for(var e in d)if(d[e].res===a){c=d[e].res;delete d[e];
break}return c},destroyManaged:function(b){var c=this.$resCache;if(c){for(var d in c){var f=c[d],h=f.res;if(g.isNumber(h))a.clearTimeout(h),a.clearInterval(h);else if(h)if(h.nodeType&&h.parentNode)i.one(h).remove();else for(var j=0;j<e.length;j++)g.isFunction(h[e[j]])&&k(h[e[j]],[],h);b&&!f.hasKey&&delete c[d]}b||delete this.$resCache}},receiveMessage:g.noop,postMessageTo:function(a,c){var d=this.vom;l(d);g.isArray(a)||(a=[a]);c||(c={});for(var e=0,h;e<a.length;e++){h=a[e];var i=d.get(h);i?f(i,c):
(n[h]||(n[h]=[]),n[h].push(c))}},destroyMRequest:function(){var a=this.$resCache;if(a)for(var c in a){var d=a[c].res;d&&d.fetchOne&&d.fetchAll&&(d.destroy(),delete a[c])}}},function(){var a=this;a.on("interact",function(){a.on("rendercall",function(){a.destroyMRequest()});a.on("prerender",function(){a.destroyManaged(!0)});a.on("destroy",function(){a.destroyManaged()})});a.mxViewCtor()})},{requires:["magix/magix","magix/view","magix/router"]});
(function(i){var g=function(){};if(!i.console)i.console={log:g,info:g,error:g};var h,d={};if(!i.Magix)i.Magix={config:function(a){for(var e in a)d[e]=a[e]},start:function(a){h=a}},KISSY.use("magix/magix",function(a,e){i.Magix=e;e.config(d);h&&e.start(h)})})(this);